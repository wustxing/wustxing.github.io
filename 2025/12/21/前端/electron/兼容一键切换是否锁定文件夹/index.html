<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>å…¼å®¹ä¸€é”®åˆ‡æ¢æ˜¯å¦é”å®šæ–‡ä»¶å¤¹ | æ˜Ÿçš„åšå®¢</title>
    <meta name="author" content="wustxing">
    
    <meta name="description" content="ä¹‹å‰ä»‹ç»äº†ä¸¤ç§é”å®šæ–‡ä»¶çš„å½¢å¼ï¼Œ1ã€å¥æŸ„å ç”¨2ã€icacls æƒé™ç®¡ç†æœ€åæˆ‘é€‰æ‹©äº†icaclsæƒé™ç®¡ç†ï¼Œå› ä¸ºå®ƒæ›´åŠ çµæ´»ï¼Œå¯ä»¥é’ˆå¯¹æ–‡ä»¶å¤¹å’Œæ–‡ä»¶åˆ†åˆ«è¿›è¡Œæƒé™æ§åˆ¶ã€‚
é—®é¢˜ï¼Œicaclsç®¡ç† æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æˆ‘æ‹…å¿ƒåé¢åˆä¸æƒ³è¦æƒé™ç®¡ç†äº†ï¼ˆè¿™ä¸ªå–å†³äºéœ€æ±‚ï¼‰ç ”ç©¶åå‘ç°æ”¹åŠ¨ç‚¹å…¶å®ä¸»è¦åœ¨æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„ä¿®æ”¹ ä¿å­˜ åˆ é™¤ é‡å‘½å çš„æ–¹å¼ä¸ä¸€æ ·ã€‚icacls éƒ½æ˜¯å…ˆè§£é” ç„¶åæ“ä½œ ç„¶åä¸Šé”æ­£å¸¸æ¨¡å¼å°±æ˜¯æ²¡æœ‰è§£é”ä¸Šé”çš„è¿‡ç¨‹ç›®å‰å°±æ˜¯è¦å…¼å®¹è¿™ä¸¤ç§ ä¸€é”®åˆ‡æ¢ã€‚">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="å…¼å®¹ä¸€é”®åˆ‡æ¢æ˜¯å¦é”å®šæ–‡ä»¶å¤¹"/>
    <meta property="og:site_name" content="wustxing&#39;s blog"/>

    
    <meta property="og:image" content=""/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="wustxing&#39;s blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify-tomorrow-night-eighties.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="indigo">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">wustxing&#39;s blog</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            Home
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            Archives
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            Categories
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            About
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            Search
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav indigo darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="http://ww2.sinaimg.cn/small/74990035jw1f1rjkd681bj20rs0rsdhg.jpg" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">wustxing</p>
                        <p class="desc">Webå‰ç«¯/æŠ€æœ¯å®…</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    Home
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    Archives
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    Categories
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    About
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    Search
                </a>
            </li>
        
    </ul>

    <ul class="side-nav indigo darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/å‰ç«¯é¢è¯•é¢˜é›†/">
                    å‰ç«¯é¢è¯•é¢˜é›† <span class="right">2</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/vue3/">
                    vue3 <span class="right">4</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/vue3/nuxt/">
                    nuxt <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/vue2/">
                    vue2 <span class="right">6</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/react/">
                    react <span class="right">3</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/webpack/">
                    webpack <span class="right">2</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/cocos/">
                    cocos <span class="right">2</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/vite/">
                    vite <span class="right">2</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/electron/">
                    electron <span class="right">18</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">Search</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper indigo">
        <span class="breadcrumb">Current page(Categories)</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/electron/">electron</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>å…¼å®¹ä¸€é”®åˆ‡æ¢æ˜¯å¦é”å®šæ–‡ä»¶å¤¹</h1>
    


            </div>
            <time class="pink-link-context" datetime="2025-12-21T13:12:20.870Z"><a href="/2025/12/21/%E5%89%8D%E7%AB%AF/electron/%E5%85%BC%E5%AE%B9%E4%B8%80%E9%94%AE%E5%88%87%E6%8D%A2%E6%98%AF%E5%90%A6%E9%94%81%E5%AE%9A%E6%96%87%E4%BB%B6%E5%A4%B9/">2025-12-21</a></time>

            <span id="busuanzi_container_page_pv" class="read-times-container">
    <i class="fa fa-eye"></i>
    <span id="busuanzi_value_page_pv"></span>
</span>

            
    <div class="tags-row">
        
            <a href="/tags/electron/" class="chip pink lighten-1">electron</a>
        
    </div>


            <div class="toc pink-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#%E4%B9%8B%E5%89%8D%E4%BB%8B%E7%BB%8D%E4%BA%86%E4%B8%A4%E7%A7%8D%E9%94%81%E5%AE%9A%E6%96%87%E4%BB%B6%E7%9A%84%E5%BD%A2%E5%BC%8F%EF%BC%8C"><span class="section table-of-contents-text">ä¹‹å‰ä»‹ç»äº†ä¸¤ç§é”å®šæ–‡ä»¶çš„å½¢å¼ï¼Œ</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="section table-of-contents-text">è§£å†³æ–¹æ¡ˆ</span></a></li></ol>
</div>


            <div class="entry pink-link-context">
                <h2 id="ä¹‹å‰ä»‹ç»äº†ä¸¤ç§é”å®šæ–‡ä»¶çš„å½¢å¼ï¼Œ"><a href="#ä¹‹å‰ä»‹ç»äº†ä¸¤ç§é”å®šæ–‡ä»¶çš„å½¢å¼ï¼Œ" class="headerlink" title="ä¹‹å‰ä»‹ç»äº†ä¸¤ç§é”å®šæ–‡ä»¶çš„å½¢å¼ï¼Œ"></a>ä¹‹å‰ä»‹ç»äº†ä¸¤ç§é”å®šæ–‡ä»¶çš„å½¢å¼ï¼Œ</h2><p>1ã€å¥æŸ„å ç”¨<br>2ã€icacls æƒé™ç®¡ç†<br>æœ€åæˆ‘é€‰æ‹©äº†icaclsæƒé™ç®¡ç†ï¼Œå› ä¸ºå®ƒæ›´åŠ çµæ´»ï¼Œå¯ä»¥é’ˆå¯¹æ–‡ä»¶å¤¹å’Œæ–‡ä»¶åˆ†åˆ«è¿›è¡Œæƒé™æ§åˆ¶ã€‚</p>
<p>é—®é¢˜ï¼Œicaclsç®¡ç† æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æˆ‘æ‹…å¿ƒåé¢åˆä¸æƒ³è¦æƒé™ç®¡ç†äº†ï¼ˆè¿™ä¸ªå–å†³äºéœ€æ±‚ï¼‰<br>ç ”ç©¶åå‘ç°æ”¹åŠ¨ç‚¹å…¶å®ä¸»è¦åœ¨æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„ä¿®æ”¹ ä¿å­˜ åˆ é™¤ é‡å‘½å çš„æ–¹å¼ä¸ä¸€æ ·ã€‚<br>icacls éƒ½æ˜¯å…ˆè§£é” ç„¶åæ“ä½œ ç„¶åä¸Šé”<br>æ­£å¸¸æ¨¡å¼å°±æ˜¯æ²¡æœ‰è§£é”ä¸Šé”çš„è¿‡ç¨‹<br>ç›®å‰å°±æ˜¯è¦å…¼å®¹è¿™ä¸¤ç§ ä¸€é”®åˆ‡æ¢ã€‚</p>
<span id="more"></span>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶ç®¡ç† src\main\ipc\file-service.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main/file-service.ts</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs-extra&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; securityManager &#125; <span class="keyword">from</span> <span class="string">&#x27;./security-manager&#x27;</span> <span class="comment">// å¤ç”¨ä¸Šä¸€æ¡å›ç­”ä¸­çš„ SecurityManager</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">FileService</span> &#123;</span><br><span class="line">  <span class="comment">// å½“å‰æ˜¯å¦å¤„äºé”å®šæ¨¡å¼</span></span><br><span class="line">  <span class="keyword">private</span> isLockedMode = <span class="literal">false</span></span><br><span class="line">  <span class="comment">// å½“å‰æ‰“å¼€çš„å·¥ç¨‹æ ¹ç›®å½•</span></span><br><span class="line">  <span class="keyword">private</span> currentRootPath = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ‰“å¼€å·¥ç¨‹</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">openProject</span>(<span class="params"><span class="attr">dirPath</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentRootPath</span> = dirPath</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é»˜è®¤æ‰“å¼€æ—¶ä¸ºæ™®é€šæ¨¡å¼ï¼Œæˆ–è€…ä½ å¯ä»¥è®¾è®¡ä¸ºé»˜è®¤é”å®š</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œæ¼”ç¤ºï¼šæ‰“å¼€æ—¶ä¸é”ï¼Œç”±ç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢ï¼Œæˆ–è€…ä¿æŒä¸Šæ¬¡çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isLockedMode</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> securityManager.<span class="title function_">lockProject</span>(dirPath)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å…³é—­å·¥ç¨‹</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">closeProject</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isLockedMode</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> securityManager.<span class="title function_">unlockProject</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentRootPath</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isLockedMode</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * âœ¨ æ ¸å¿ƒåŠŸèƒ½ï¼šåˆ‡æ¢æ¨¡å¼</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">toggleLockMode</span>(<span class="params"><span class="attr">locked</span>: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">currentRootPath</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;æœªæ‰“å¼€å·¥ç¨‹&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (locked) &#123;</span><br><span class="line">      <span class="comment">// åˆ‡æ¢åˆ°é”å®šæ¨¡å¼</span></span><br><span class="line">      <span class="keyword">await</span> securityManager.<span class="title function_">lockProject</span>(<span class="variable language_">this</span>.<span class="property">currentRootPath</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isLockedMode</span> = <span class="literal">true</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ğŸ”„ æ¨¡å¼åˆ‡æ¢: [ç‹¬å é”å®š]&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// åˆ‡æ¢åˆ°æ™®é€šæ¨¡å¼</span></span><br><span class="line">      <span class="keyword">await</span> securityManager.<span class="title function_">unlockProject</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isLockedMode</span> = <span class="literal">false</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ğŸ”„ æ¨¡å¼åˆ‡æ¢: [æ™®é€šæ¨¡å¼]&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">isLockedMode</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è·å–å½“å‰æ¨¡å¼</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">getMode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">isLockedMode</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ==========================================</span></span><br><span class="line">  <span class="comment">//  ç»Ÿä¸€ CRUD æ“ä½œ (è‡ªåŠ¨åˆ¤æ–­æ¨¡å¼)</span></span><br><span class="line">  <span class="comment">// ==========================================</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">writeFile</span>(<span class="params"><span class="attr">filePath</span>: <span class="built_in">string</span>, <span class="attr">content</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isLockedMode</span>) &#123;</span><br><span class="line">      <span class="comment">// ğŸ”’ é”å®šæ¨¡å¼ï¼šèµ°ç‰¹æƒé€šé“ (Unlock -&gt; Write -&gt; Lock)</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> securityManager.<span class="title function_">privilegedWrite</span>(filePath, content)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ğŸ”“ æ™®é€šæ¨¡å¼ï¼šèµ°åŸç”Ÿ Node.js API</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> fs.<span class="title function_">writeFile</span>(filePath, content, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//   async createFile(targetPath: string, type: &#x27;file&#x27; | &#x27;directory&#x27;) &#123;</span></span><br><span class="line"><span class="comment">//     if (this.isLockedMode) &#123;</span></span><br><span class="line"><span class="comment">//       return await securityManager.privilegedCreate(targetPath, type)</span></span><br><span class="line"><span class="comment">//     &#125; else &#123;</span></span><br><span class="line"><span class="comment">//       if (type === &#x27;directory&#x27;) &#123;</span></span><br><span class="line"><span class="comment">//         return await fs.ensureDir(targetPath)</span></span><br><span class="line"><span class="comment">//       &#125; else &#123;</span></span><br><span class="line"><span class="comment">//         return await fs.ensureFile(targetPath)</span></span><br><span class="line"><span class="comment">//       &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">deleteEntry</span>(<span class="params"><span class="attr">targetPath</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isLockedMode</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> securityManager.<span class="title function_">privilegedDelete</span>(targetPath)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æ™®é€šæ¨¡å¼ç›´æ¥åˆ  (å»ºè®®ç§»å…¥å›æ”¶ç«™ï¼Œè¿™é‡Œæ¼”ç¤ºç›´æ¥åˆ )</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> fs.<span class="title function_">remove</span>(targetPath)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">renameEntry</span>(<span class="params"><span class="attr">oldPath</span>: <span class="built_in">string</span>, <span class="attr">newName</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dir = path.<span class="title function_">dirname</span>(oldPath)</span><br><span class="line">    <span class="keyword">const</span> newPath = path.<span class="title function_">join</span>(dir, newName)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isLockedMode</span>) &#123;</span><br><span class="line">        <span class="comment">// SecurityManager éœ€è¦è¡¥å……ä¸€ä¸ª privilegedRename æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// é€»è¾‘åŒ delete/createï¼šè§£é”çˆ¶ç›®å½• -&gt; rename -&gt; åŠ é”</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œæš‚æ—¶å…ˆç”¨ unlock -&gt; rename -&gt; lock æ¨¡æ‹Ÿ</span></span><br><span class="line">        <span class="keyword">await</span> securityManager.<span class="title function_">privilegedRename</span>(oldPath, newPath) </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> fs.<span class="title function_">rename</span>(oldPath, newPath)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newPath</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ğŸ“– è¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="comment">   * (è¯»å–é€šå¸¸ä¸å—å†™é”å½±å“ï¼Œç›´æ¥è¯»å³å¯)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">readFile</span>(<span class="params"><span class="attr">filePath</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">// ç»Ÿä¸€è¯»å–ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ä¼šæŠ›é”™</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> fs.<span class="title function_">readFile</span>(filePath, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * âœ¨ åˆ›å»ºæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ (è‡ªåŠ¨åˆ¤æ–­æ¨¡å¼)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">createEntry</span>(<span class="params"><span class="attr">targetPath</span>: <span class="built_in">string</span>, <span class="attr">type</span>: <span class="string">&#x27;file&#x27;</span> | <span class="string">&#x27;directory&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isLockedMode</span>) &#123;</span><br><span class="line">      <span class="comment">// ğŸ”’ é”å®šæ¨¡å¼ï¼šèµ°ç‰¹æƒåˆ›å»ºæµç¨‹</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[FileService] ç‰¹æƒåˆ›å»º: <span class="subst">$&#123;targetPath&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">await</span> securityManager.<span class="title function_">privilegedCreate</span>(targetPath, <span class="keyword">type</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ğŸ”“ æ™®é€šæ¨¡å¼ï¼šç›´æ¥åˆ›å»º</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[FileService] æ™®é€šåˆ›å»º: <span class="subst">$&#123;targetPath&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">&#x27;directory&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">await</span> fs.<span class="title function_">ensureDir</span>(targetPath)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> fs.<span class="title function_">ensureFile</span>(targetPath)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fileService = <span class="keyword">new</span> <span class="title class_">FileService</span>()</span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ›å»ºä¸€ä¸ª src\main\ipc\project-ipc.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main/ipc/project-ipc.ts</span></span><br><span class="line"><span class="comment">// src/main/ipc/project-ipc.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; ipcMain, dialog &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fileService &#125; <span class="keyword">from</span> <span class="string">&#x27;./file-service&#x27;</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs-extra&#x27;</span> <span class="comment">// å»ºè®®å®‰è£… fs-extra: npm install fs-extra @types/fs-extra</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="comment">// å®šä¹‰æ–‡ä»¶èŠ‚ç‚¹ç±»å‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FileNode</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">path</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;file&#x27;</span> | <span class="string">&#x27;directory&#x27;</span></span><br><span class="line">    <span class="attr">children</span>?: <span class="title class_">FileNode</span>[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿½ç•¥åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">IGNORE_LIST</span> = [<span class="string">&#x27;.git&#x27;</span>, <span class="string">&#x27;node_modules&#x27;</span>, <span class="string">&#x27;.DS_Store&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’æ„å»ºæ–‡ä»¶æ ‘</span></span><br><span class="line"><span class="keyword">const</span> buildFileTree = (<span class="attr">dirPath</span>: <span class="built_in">string</span>): <span class="title class_">FileNode</span>[] =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> stats = fs.<span class="title function_">statSync</span>(dirPath)</span><br><span class="line">    <span class="keyword">if</span> (!stats.<span class="title function_">isDirectory</span>()) <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> children = fs.<span class="title function_">readdirSync</span>(dirPath)</span><br><span class="line">        .<span class="title function_">filter</span>(<span class="function"><span class="params">name</span> =&gt;</span> !<span class="variable constant_">IGNORE_LIST</span>.<span class="title function_">includes</span>(name))</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> fullPath = path.<span class="title function_">join</span>(dirPath, name)</span><br><span class="line">            <span class="keyword">const</span> fileStats = fs.<span class="title function_">statSync</span>(fullPath)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> <span class="attr">node</span>: <span class="title class_">FileNode</span> = &#123;</span><br><span class="line">                name,</span><br><span class="line">                <span class="attr">path</span>: fullPath,</span><br><span class="line">                <span class="attr">type</span>: fileStats.<span class="title function_">isDirectory</span>() ? <span class="string">&#x27;directory&#x27;</span> : <span class="string">&#x27;file&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (node.<span class="property">type</span> === <span class="string">&#x27;directory&#x27;</span>) &#123;</span><br><span class="line">                node.<span class="property">children</span> = <span class="title function_">buildFileTree</span>(fullPath)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ’åºï¼šæ–‡ä»¶å¤¹åœ¨å‰ï¼Œæ–‡ä»¶åœ¨å</span></span><br><span class="line">    <span class="keyword">return</span> children.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (a.<span class="property">type</span> === b.<span class="property">type</span>) <span class="keyword">return</span> a.<span class="property">name</span>.<span class="title function_">localeCompare</span>(b.<span class="property">name</span>)</span><br><span class="line">        <span class="keyword">return</span> a.<span class="property">type</span> === <span class="string">&#x27;directory&#x27;</span> ? -<span class="number">1</span> : <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupProjectIPC</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 2. è¯»å–æ•´ä¸ªå·¥ç¨‹ç»“æ„</span></span><br><span class="line">    ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;fs-read-project-tree&#x27;</span>, <span class="title function_">async</span> (_, <span class="attr">rootPath</span>: <span class="built_in">string</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(rootPath)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Path not found&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¯»å–æˆ–åˆ›å»ºå·¥ç¨‹é…ç½®æ–‡ä»¶</span></span><br><span class="line">            <span class="comment">// const configPath = path.join(rootPath, &#x27;project.config.json&#x27;)</span></span><br><span class="line">            <span class="keyword">let</span> projectInfo = &#123; <span class="attr">name</span>: path.<span class="title function_">basename</span>(rootPath), <span class="attr">version</span>: <span class="string">&#x27;1.0.0&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// if (fs.existsSync(configPath)) &#123;</span></span><br><span class="line">            <span class="comment">//     projectInfo = await fs.readJson(configPath)</span></span><br><span class="line">            <span class="comment">// &#125; else &#123;</span></span><br><span class="line">            <span class="comment">//     // await fs.writeJson(configPath, projectInfo, &#123; spaces: 2 &#125;)</span></span><br><span class="line">            <span class="comment">//     await securityManager.privilegedWrite(configPath,JSON.stringify(projectInfo))</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="comment">// console.log(&#x27;Project Info:&#x27;, projectInfo,rootPath)</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> tree = <span class="title function_">buildFileTree</span>(rootPath)</span><br><span class="line">            <span class="keyword">return</span> &#123; tree, projectInfo &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line">            <span class="keyword">throw</span> error</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  <span class="comment">// 1. æ‰“å¼€å¹¶é€‰æ‹©å·¥ç¨‹</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;prj-open&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; canceled, filePaths &#125; = <span class="keyword">await</span> dialog.<span class="title function_">showOpenDialog</span>(&#123;</span><br><span class="line">      <span class="attr">properties</span>: [<span class="string">&#x27;openDirectory&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (canceled || !filePaths.<span class="property">length</span>) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> path = filePaths[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">await</span> fileService.<span class="title function_">openProject</span>(path)</span><br><span class="line">    <span class="keyword">return</span> path</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. å…³é—­</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;prj-close&#x27;</span>, <span class="function">() =&gt;</span> fileService.<span class="title function_">closeProject</span>())</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. åˆ‡æ¢é”å®šçŠ¶æ€</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;prj-toggle-lock&#x27;</span>, <span class="function">(<span class="params">_, <span class="attr">locked</span>: <span class="built_in">boolean</span></span>) =&gt;</span> fileService.<span class="title function_">toggleLockMode</span>(locked))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. ç»Ÿä¸€ CRUD</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;prj-write&#x27;</span>, <span class="function">(<span class="params">_, &#123; path, content &#125;</span>) =&gt;</span> fileService.<span class="title function_">writeFile</span>(path, content))</span><br><span class="line"><span class="comment">//   ipcMain.handle(&#x27;prj-create&#x27;, (_, &#123; path, type &#125;) =&gt; fileService.createFile(path, type))</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;prj-delete&#x27;</span>, <span class="function">(<span class="params">_, path</span>) =&gt;</span> fileService.<span class="title function_">deleteEntry</span>(path))</span><br><span class="line">    <span class="comment">// âœ… æ–°å¢ï¼šè¯»å–æ–‡ä»¶</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;prj-read&#x27;</span>, <span class="function">(<span class="params">_, path</span>) =&gt;</span> fileService.<span class="title function_">readFile</span>(path))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âœ… æ–°å¢ï¼šåˆ›å»º (æ³¨æ„å‚æ•°è§£æ„)</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;prj-create&#x27;</span>, <span class="function">(<span class="params">_, &#123; path, <span class="keyword">type</span> &#125;</span>) =&gt;</span> fileService.<span class="title function_">createEntry</span>(path, <span class="keyword">type</span>))</span><br><span class="line">    <span class="comment">// âœ… æ–°å¢ï¼šé‡å‘½å</span></span><br><span class="line">  <span class="comment">// å‚æ•°æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ &#123; oldPath, newName &#125;</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;prj-rename&#x27;</span>, <span class="function">(<span class="params">_, &#123; oldPath, newName &#125;</span>) =&gt;</span> </span><br><span class="line">    fileService.<span class="title function_">renameEntry</span>(oldPath, newName)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºåŠ å¯†çš„ç®¡ç†æ–¹æ³• src\main\ipc\security-manager.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main/ipc/security-manager.ts</span></span><br><span class="line"><span class="comment">// src/main/security-manager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; exec &#125; <span class="keyword">from</span> <span class="string">&#x27;child_process&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; promisify &#125; <span class="keyword">from</span> <span class="string">&#x27;util&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs-extra&#x27;</span></span><br><span class="line"><span class="keyword">import</span> chokidar <span class="keyword">from</span> <span class="string">&#x27;chokidar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> execAsync = <span class="title function_">promisify</span>(exec)</span><br><span class="line"><span class="comment">// ğŸš« é»‘åå•åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">IGNORE_DIRS</span> = [<span class="string">&#x27;.git&#x27;</span>, <span class="string">&#x27;node_modules&#x27;</span>, <span class="string">&#x27;dist&#x27;</span>, <span class="string">&#x27;build&#x27;</span>, <span class="string">&#x27;.vscode&#x27;</span>, <span class="string">&#x27;.idea&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">SecurityManager</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> rootPath = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">watcher</span>: chokidar.<span class="property">FSWatcher</span> | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">private</span> isWindows = process.<span class="property">platform</span> === <span class="string">&#x27;win32&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ğŸ”’ å¼€å¯â€œå®Œå…¨ç‹¬å æ¨¡å¼â€</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">lockProject</span>(<span class="params"><span class="attr">dirPath</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rootPath</span> = dirPath</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸ›¡ï¸ æ­£åœ¨å¼€å¯ç‹¬å æ¨¡å¼ (æ™ºèƒ½æ’é™¤): <span class="subst">$&#123;dirPath&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. ç³»ç»Ÿçº§æƒé™é”å®š (é€’å½’)</span></span><br><span class="line">    <span class="comment">// await this.applySystemLock(dirPath, true)</span></span><br><span class="line">        <span class="comment">// 1. æ™ºèƒ½éå†å¹¶é”å®š</span></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">applySmartLock</span>(dirPath, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. å¯åŠ¨å“¨å…µ (é˜²æ­¢æ¼ç½‘ä¹‹é±¼)</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">startSentry</span>(dirPath)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ğŸ”“ å…³é—­ç‹¬å æ¨¡å¼ (æ¢å¤æƒé™)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">unlockProject</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">rootPath</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸ”“ æ­£åœ¨è§£é™¤ç‹¬å æ¨¡å¼...`</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. å…³é—­å“¨å…µ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">watcher</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">watcher</span>.<span class="title function_">close</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">watcher</span> = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. æ¢å¤ç³»ç»Ÿæƒé™</span></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">applySystemLock</span>(<span class="variable language_">this</span>.<span class="property">rootPath</span>, <span class="literal">false</span>, <span class="literal">true</span>) <span class="comment">// true è¡¨ç¤ºå¼ºåˆ¶é€’å½’</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rootPath</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * âœï¸ ç‰¹æƒå†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">privilegedWrite</span>(<span class="params"><span class="attr">filePath</span>: <span class="built_in">string</span>, <span class="attr">content</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 1. ä¸´æ—¶è§£é”å•ä¸ªæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">unlockSingleFile</span>(filePath)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 2. å†™å…¥</span></span><br><span class="line">      <span class="keyword">await</span> fs.<span class="title function_">writeFile</span>(filePath, content, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// 3. ç«‹å³å›é”</span></span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">lockSingleFile</span>(filePath)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ğŸ“„ ç‰¹æƒåˆ›å»ºæ–‡ä»¶/æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">privilegedCreate</span>(<span class="params"><span class="attr">targetPath</span>: <span class="built_in">string</span>, <span class="attr">type</span>: <span class="string">&#x27;file&#x27;</span> | <span class="string">&#x27;directory&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> parentDir = path.<span class="title function_">dirname</span>(targetPath)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. è§£é”çˆ¶ç›®å½• (æ‰æœ‰æƒé™åˆ›å»ºå­é¡¹)</span></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">unlockSingleFile</span>(parentDir)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">&#x27;directory&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">await</span> fs.<span class="title function_">ensureDir</span>(targetPath)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> fs.<span class="title function_">ensureFile</span>(targetPath)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// 3. å›é”çˆ¶ç›®å½• &amp; é”å®šæ–°æ–‡ä»¶</span></span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">lockSingleFile</span>(parentDir)</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">lockSingleFile</span>(targetPath)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ğŸ—‘ï¸ ç‰¹æƒåˆ é™¤</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">privilegedDelete</span>(<span class="params"><span class="attr">targetPath</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> parentDir = path.<span class="title function_">dirname</span>(targetPath)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. è§£é”çˆ¶ç›®å½• (æ‰æœ‰æƒé™åˆ é™¤å­é¡¹) å’Œ ç›®æ ‡æœ¬èº«</span></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">unlockSingleFile</span>(parentDir)</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">unlockSingleFile</span>(targetPath) <span class="comment">// é˜²æ­¢è‡ªèº«åªè¯»æ— æ³•åˆ é™¤</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> fs.<span class="title function_">remove</span>(targetPath)</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// 3. å›é”çˆ¶ç›®å½•</span></span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">lockSingleFile</span>(parentDir)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * âœ¨ ç‰¹æƒé‡å‘½å (æˆ–ç§»åŠ¨)</span></span><br><span class="line"><span class="comment">   * é€»è¾‘ï¼šè§£é”æ—§çˆ¶ç›®å½• &amp; æ–‡ä»¶ -&gt; é‡å‘½å -&gt; é”æ—§çˆ¶ç›®å½• &amp; é”æ–°æ–‡ä»¶</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">privilegedRename</span>(<span class="params"><span class="attr">oldPath</span>: <span class="built_in">string</span>, <span class="attr">newPath</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> oldParent = path.<span class="title function_">dirname</span>(oldPath)</span><br><span class="line">    <span class="keyword">const</span> newParent = path.<span class="title function_">dirname</span>(newPath)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ (é€šå¸¸é‡å‘½åæ˜¯åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä½†ä¹Ÿæ”¯æŒç§»åŠ¨)</span></span><br><span class="line">    <span class="keyword">const</span> isMove = oldParent !== newParent</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. è§£é”é˜¶æ®µ</span></span><br><span class="line">    <span class="comment">// è§£é”æ—§çˆ¶ç›®å½• (å…è®¸ä»ä¸­ç§»é™¤æ¡ç›®)</span></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">unlockSingleFile</span>(oldParent)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è§£é”æ–‡ä»¶æœ¬èº« (å…è®¸ä¿®æ”¹å…¶å…ƒæ•°æ®/è·¯å¾„ï¼ŒWindows ä¸Š Deny Delete ä¹Ÿä¼šé˜»æ­¢é‡å‘½å)</span></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">unlockSingleFile</span>(oldPath)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯ç§»åŠ¨åˆ°ä¸åŒç›®å½•ï¼Œè¿˜éœ€è¦è§£é”ç›®æ ‡çˆ¶ç›®å½•</span></span><br><span class="line">    <span class="keyword">if</span> (isMove) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">unlockSingleFile</span>(newParent)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 2. æ‰§è¡Œé‡å‘½å</span></span><br><span class="line">      <span class="keyword">await</span> fs.<span class="title function_">rename</span>(oldPath, newPath)</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// 3. å›é”é˜¶æ®µ (æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½è¦å°è¯•æ¢å¤é”)</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ¢å¤æ—§çˆ¶ç›®å½•</span></span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">lockSingleFile</span>(oldParent)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœæ˜¯ç§»åŠ¨ï¼Œæ¢å¤æ–°çˆ¶ç›®å½•</span></span><br><span class="line">      <span class="keyword">if</span> (isMove) &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">lockSingleFile</span>(newParent)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš ï¸ å…³é”®ï¼šæ–°è·¯å¾„ä¸‹çš„æ–‡ä»¶å¿…é¡»è¢«é”ä½ (å› ä¸ºé‡å‘½ååï¼ŒåŸæœ‰çš„è·¯å¾„å¤±æ•ˆï¼Œæ–°è·¯å¾„å¯èƒ½å¤±å»äº†é”)</span></span><br><span class="line">      <span class="comment">// (è™½ç„¶åœ¨åŒä¸€ä¸ªç›˜ç¬¦ä¸‹ç§»åŠ¨é€šå¸¸ä¿ç•™ ACLï¼Œä½†ä¸ºäº†ä¿é™©èµ·è§ï¼Œæ˜¾å¼é”ä¸€æ¬¡)</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">await</span> fs.<span class="title function_">pathExists</span>(newPath)) &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">lockSingleFile</span>(newPath)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// =========================================</span></span><br><span class="line">  <span class="comment">//  åº•å±‚ç³»ç»Ÿå‘½ä»¤å®ç°</span></span><br><span class="line">  <span class="comment">// =========================================</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// =========================================</span></span><br><span class="line">  <span class="comment">//  æ ¸å¿ƒä¼˜åŒ–ï¼šæ™ºèƒ½é”å®šé€»è¾‘</span></span><br><span class="line">  <span class="comment">// =========================================</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">applySmartLock</span>(<span class="params"><span class="attr">basePath</span>: <span class="built_in">string</span>, <span class="attr">isLock</span>: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">    <span class="comment">// è¯»å–æ ¹ç›®å½•ä¸‹çš„ç¬¬ä¸€çº§å†…å®¹</span></span><br><span class="line">    <span class="keyword">const</span> items = <span class="keyword">await</span> fs.<span class="title function_">readdir</span>(basePath, &#123; <span class="attr">withFileTypes</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> items) &#123;</span><br><span class="line">      <span class="keyword">const</span> fullPath = path.<span class="title function_">join</span>(basePath, item.<span class="property">name</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 1. æ£€æŸ¥æ˜¯å¦åœ¨é»‘åå•ä¸­</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable constant_">IGNORE_DIRS</span>.<span class="title function_">includes</span>(item.<span class="property">name</span>)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`â© è·³è¿‡å¿½ç•¥ç›®å½•: <span class="subst">$&#123;item.name&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2. æ‰§è¡Œé”å®š</span></span><br><span class="line">      <span class="keyword">if</span> (item.<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯æ™®é€šæ–‡ä»¶å¤¹ (å¦‚ src)ï¼Œæ‰§è¡Œé€’å½’é”å®š (/T)</span></span><br><span class="line">        <span class="comment">// è¿™æ · src ä¸‹é¢æœ‰ 1000 ä¸ªæ–‡ä»¶ä¹Ÿä¼šè¢«ä¸€æ¬¡æ€§é”ä½ï¼Œæ•ˆç‡å¾ˆé«˜</span></span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">applySystemLock</span>(fullPath, isLock, <span class="literal">true</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯æ–‡ä»¶ï¼Œç›´æ¥é”</span></span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">lockSingleFile</span>(fullPath)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æœ€åï¼Œåˆ«å¿˜äº†é”æ ¹ç›®å½•æœ¬èº«ï¼ˆé˜²æ­¢æ ¹ç›®å½•è¢«é‡å‘½åï¼‰ï¼Œä½†ä¸é€’å½’</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬åªé”æ ¹ç›®å½•çš„â€œå±æ€§â€ï¼Œä¸åŠ  /T</span></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">lockSingleFile</span>(basePath) </span><br><span class="line">  &#125;</span><br><span class="line">   <span class="comment">// ä¿®æ”¹åº•å±‚çš„å‘½ä»¤æ‰§è¡Œæ–¹æ³•ï¼Œå¢åŠ  recursive å‚æ•°</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">applySystemLock</span>(<span class="params"><span class="attr">targetPath</span>: <span class="built_in">string</span>, <span class="attr">isLock</span>: <span class="built_in">boolean</span>, <span class="attr">recursive</span>: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isWindows</span>) &#123;</span><br><span class="line">      <span class="comment">// Windows: ä½¿ç”¨ icacls æ‹’ç»å†™å…¥å’Œåˆ é™¤</span></span><br><span class="line">      <span class="comment">// /deny Everyone:(OI)(CI)(DE,DC,WD,AD,WEA,WA)</span></span><br><span class="line">      <span class="comment">// OI: Object Inherit (å¯¹è±¡ç»§æ‰¿)</span></span><br><span class="line">      <span class="comment">// CI: Container Inherit (å®¹å™¨ç»§æ‰¿)</span></span><br><span class="line">      <span class="comment">// DE: Delete, DC: Delete Child</span></span><br><span class="line">      <span class="comment">// WD: Write Data, AD: Append Data</span></span><br><span class="line">       <span class="keyword">const</span> perm = isLock </span><br><span class="line">        ? <span class="string">&#x27;/deny Everyone:(OI)(CI)(DE,DC,WD,AD,WEA,WA)&#x27;</span> </span><br><span class="line">        : <span class="string">&#x27;/remove:d Everyone&#x27;</span></span><br><span class="line">        <span class="comment">// å…³é”®ï¼šåªæœ‰ recursive ä¸º true æ—¶æ‰åŠ  /T</span></span><br><span class="line">      <span class="keyword">const</span> recursiveFlag = recursive ? <span class="string">&#x27;/T&#x27;</span> : <span class="string">&#x27;&#x27;</span></span><br><span class="line">       <span class="keyword">const</span> cmd = <span class="string">`icacls &quot;<span class="subst">$&#123;targetPath&#125;</span>&quot; <span class="subst">$&#123;perm&#125;</span> <span class="subst">$&#123;recursiveFlag&#125;</span> /C /Q`</span></span><br><span class="line">      <span class="keyword">try</span> &#123; <span class="keyword">await</span> <span class="title function_">execAsync</span>(cmd) &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="comment">//   const cmd = isLock</span></span><br><span class="line">    <span class="comment">//     ? `icacls &quot;$&#123;targetPath&#125;&quot; /deny Everyone:(OI)(CI)(DE,DC,WD,AD,WEA,WA) /T /C /Q`</span></span><br><span class="line">    <span class="comment">//     : `icacls &quot;$&#123;targetPath&#125;&quot; /remove:d Everyone /T /C /Q`</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment">//   try &#123; await execAsync(cmd) &#125; catch (e) &#123; /* å¿½ç•¥éƒ¨åˆ†æƒé™é”™è¯¯ */ &#125;</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// Mac/Linux: ç§»é™¤å†™æƒé™ (chmod -R a-w)</span></span><br><span class="line">      <span class="comment">// æ³¨æ„ï¼šè¿™åœ¨ Linux ä¸Šä¸èƒ½å®Œå…¨é˜²æ­¢æ‹¥æœ‰è€…åˆ é™¤ï¼Œä½†èƒ½é˜²æ­¢ä¿®æ”¹</span></span><br><span class="line">         <span class="comment">// Mac/Linux</span></span><br><span class="line">      <span class="keyword">const</span> perm = isLock ? <span class="string">&#x27;a-w&#x27;</span> : <span class="string">&#x27;u+w&#x27;</span></span><br><span class="line">      <span class="keyword">const</span> recursiveFlag = recursive ? <span class="string">&#x27;-R&#x27;</span> : <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="keyword">const</span> cmd = <span class="string">`chmod <span class="subst">$&#123;recursiveFlag&#125;</span> <span class="subst">$&#123;perm&#125;</span> &quot;<span class="subst">$&#123;targetPath&#125;</span>&quot;`</span></span><br><span class="line">      <span class="keyword">try</span> &#123; <span class="keyword">await</span> <span class="title function_">execAsync</span>(cmd) &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">lockSingleFile</span>(<span class="params"><span class="attr">targetPath</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isWindows</span>) &#123;</span><br><span class="line">      <span class="comment">// é”å®šå•ä¸ªæ–‡ä»¶ (ä¸å¸¦ /T é€’å½’)</span></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">execAsync</span>(<span class="string">`icacls &quot;<span class="subst">$&#123;targetPath&#125;</span>&quot; /deny Everyone:(DE,DC,WD,AD,WEA,WA) /C /Q`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">execAsync</span>(<span class="string">`chmod a-w &quot;<span class="subst">$&#123;targetPath&#125;</span>&quot;`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">unlockSingleFile</span>(<span class="params"><span class="attr">targetPath</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isWindows</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">execAsync</span>(<span class="string">`icacls &quot;<span class="subst">$&#123;targetPath&#125;</span>&quot; /remove:d Everyone /C /Q`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">execAsync</span>(<span class="string">`chmod u+w &quot;<span class="subst">$&#123;targetPath&#125;</span>&quot;`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// =========================================</span></span><br><span class="line">  <span class="comment">//  å“¨å…µæ¨¡å¼ï¼šé˜²æ­¢å¤–éƒ¨å¼ºè¡Œåˆ›å»ºæ–‡ä»¶</span></span><br><span class="line">  <span class="comment">// =========================================</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">startSentry</span>(<span class="params"><span class="attr">dirPath</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">watcher</span> = chokidar.<span class="title function_">watch</span>(dirPath, &#123;</span><br><span class="line">      <span class="attr">ignored</span>: <span class="regexp">/(^|[\/\\])\../</span>,</span><br><span class="line">      <span class="attr">ignoreInitial</span>: <span class="literal">true</span>, <span class="comment">// ä¸å¤„ç†å·²å­˜åœ¨çš„æ–‡ä»¶</span></span><br><span class="line">      <span class="attr">persistent</span>: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ£€æµ‹åˆ°æœ‰æ–°æ–‡ä»¶/æ–‡ä»¶å¤¹è¢«å¤–éƒ¨åˆ›å»ºï¼ˆæ­¤æ—¶æˆ‘ä»¬æ²¡æœ‰è°ƒç”¨ privilegedCreateï¼‰</span></span><br><span class="line">    <span class="comment">// è¯´æ˜ç”¨æˆ·å¯èƒ½é€šè¿‡æ›´é«˜æƒé™å¼ºè¡Œå¡äº†æ–‡ä»¶è¿›æ¥</span></span><br><span class="line">    <span class="comment">// ç­–ç•¥ï¼šç«‹å³é”å®šå®ƒï¼Œæˆ–è€…æ ¹æ®éœ€æ±‚ç›´æ¥åˆ é™¤å®ƒ</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">watcher</span>.<span class="title function_">on</span>(<span class="string">&#x27;add&#x27;</span>, <span class="title function_">async</span> (filePath) =&gt; &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`ğŸš¨ æ£€æµ‹åˆ°å¤–éƒ¨æ–°å¢æ–‡ä»¶: <span class="subst">$&#123;filePath&#125;</span>ï¼Œæ­£åœ¨å¼ºåˆ¶é”å®š...`</span>)</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">lockSingleFile</span>(filePath)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">watcher</span>.<span class="title function_">on</span>(<span class="string">&#x27;addDir&#x27;</span>, <span class="title function_">async</span> (p) =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">lockSingleFile</span>(p)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> securityManager = <span class="keyword">new</span> <span class="title class_">SecurityManager</span>()</span><br></pre></td></tr></table></figure>

<p>åœ¨ src\main\index.ts ä¸­å¼•å…¥ SecurityManager å¹¶åˆå§‹åŒ– projectIPC</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; securityManager &#125; <span class="keyword">from</span> <span class="string">&#x27;./ipc/security-manager&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;setupProjectIPC  &#125; <span class="keyword">from</span> <span class="string">&#x27;./ipc/project-ipc&#x27;</span></span><br><span class="line"></span><br><span class="line">  app.<span class="title function_">whenReady</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Set app user model id for windows</span></span><br><span class="line">  electronApp.<span class="title function_">setAppUserModelId</span>(<span class="string">&#x27;com.electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Default open or close DevTools by F12 in development</span></span><br><span class="line">  <span class="comment">// and ignore CommandOrControl + R in production.</span></span><br><span class="line">  <span class="comment">// see https://github.com/alex8088/electron-toolkit/tree/master/packages/utils</span></span><br><span class="line">  app.<span class="title function_">on</span>(<span class="string">&#x27;browser-window-created&#x27;</span>, <span class="function">(<span class="params">_, <span class="variable language_">window</span></span>) =&gt;</span> &#123;</span><br><span class="line">    optimizer.<span class="title function_">watchWindowShortcuts</span>(<span class="variable language_">window</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// setupWindowIPC()</span></span><br><span class="line">  <span class="comment">// setupLockIPC()</span></span><br><span class="line">  <span class="comment">// setupSecurityIPC()</span></span><br><span class="line">  <span class="title function_">setupProjectIPC</span>()</span><br><span class="line">  <span class="title function_">createWindow</span>()</span><br><span class="line"></span><br><span class="line">  app.<span class="title function_">on</span>(<span class="string">&#x27;activate&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// On macOS it&#x27;s common to re-create a window in the app when the</span></span><br><span class="line">    <span class="comment">// dock icon is clicked and there are no other windows open.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">BrowserWindow</span>.<span class="title function_">getAllWindows</span>().<span class="property">length</span> === <span class="number">0</span>) <span class="title function_">createWindow</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Quit when all windows are closed, except on macOS. There, it&#x27;s common</span></span><br><span class="line"><span class="comment">// for applications and their menu bar to stay active until the user quits</span></span><br><span class="line"><span class="comment">// explicitly with Cmd + Q.</span></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">platform</span> !== <span class="string">&#x27;darwin&#x27;</span>) &#123;</span><br><span class="line">    app.<span class="title function_">quit</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;will-quit&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// ç¡®ä¿é€€å‡ºæ—¶è§£é”ï¼Œå¦åˆ™ä½ çš„æ–‡ä»¶å¤¹ä¼šè¢«é”æ­»ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ä¿®å¤</span></span><br><span class="line">  <span class="keyword">await</span> securityManager.<span class="title function_">unlockProject</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ˜¯ preload.ts æ–‡ä»¶ï¼Œç”¨äºåœ¨æ¸²æŸ“è¿›ç¨‹ä¸­æ³¨å…¥ä¸€äº›å…¨å±€å˜é‡</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/preload/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; contextBridge, ipcRenderer &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; electronAPI &#125; <span class="keyword">from</span> <span class="string">&#x27;@electron-toolkit/preload&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom APIs for renderer</span></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ API</span></span><br><span class="line"><span class="keyword">const</span> api = &#123;</span><br><span class="line">  <span class="comment">// è°ƒç”¨ä¸»è¿›ç¨‹æ£€æµ‹åæ ‡</span></span><br><span class="line">  <span class="attr">checkCursorOutside</span>: <span class="function">() =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;check-cursor-outside-window&#x27;</span>),</span><br><span class="line">  <span class="attr">activateCurrentWindow</span>: <span class="function">() =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;activate-current-window&#x27;</span>),</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> projectAPI = &#123;</span><br><span class="line">  <span class="attr">open</span>: <span class="function">() =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;prj-open&#x27;</span>),</span><br><span class="line">  <span class="attr">close</span>: <span class="function">() =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;prj-close&#x27;</span>),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ‡æ¢æ¨¡å¼ï¼šä¼  true å¼€å¯ç‹¬å ï¼Œä¼  false å…³é—­</span></span><br><span class="line">  <span class="attr">toggleLock</span>: <span class="function">(<span class="params"><span class="attr">locked</span>: <span class="built_in">boolean</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;prj-toggle-lock&#x27;</span>, locked),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç»Ÿä¸€çš„æ“ä½œæ¥å£</span></span><br><span class="line">  <span class="attr">writeFile</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span>, <span class="attr">content</span>: <span class="built_in">string</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;prj-write&#x27;</span>, &#123; path, content &#125;),</span><br><span class="line">  <span class="attr">create</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span>, <span class="attr">type</span>: <span class="string">&#x27;file&#x27;</span> | <span class="string">&#x27;directory&#x27;</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;prj-create&#x27;</span>, &#123; path, <span class="keyword">type</span> &#125;),</span><br><span class="line">  <span class="attr">delete</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;prj-delete&#x27;</span>, path),</span><br><span class="line"></span><br><span class="line">  <span class="attr">readDir</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;fs-read-project-tree&#x27;</span>, path),</span><br><span class="line">  <span class="comment">// âœ… æ–°å¢</span></span><br><span class="line">  <span class="attr">rename</span>: <span class="function">(<span class="params"><span class="attr">oldPath</span>: <span class="built_in">string</span>, <span class="attr">newName</span>: <span class="built_in">string</span></span>) =&gt;</span></span><br><span class="line">    ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;prj-rename&#x27;</span>, &#123; oldPath, newName &#125;),</span><br><span class="line">  <span class="attr">readFile</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;prj-read&#x27;</span>, path),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use `contextBridge` APIs to expose Electron APIs to</span></span><br><span class="line"><span class="comment">// renderer only if context isolation is enabled, otherwise</span></span><br><span class="line"><span class="comment">// just add to the DOM global.</span></span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">contextIsolated</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&#x27;electron&#x27;</span>, electronAPI)</span><br><span class="line">    contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&#x27;api&#x27;</span>, api)</span><br><span class="line">    contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&#x27;lockAPI&#x27;</span>, lockAPI)</span><br><span class="line">    contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&#x27;fsAPI&#x27;</span>, fsAPI)</span><br><span class="line">    contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&#x27;securityAPI&#x27;</span>, securityAPI)</span><br><span class="line">    contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&#x27;projectAPI&#x27;</span>, projectAPI)</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// @ts-ignore (define in dts)</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">electron</span> = electronAPI</span><br><span class="line">  <span class="comment">// @ts-ignore (define in dts)</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">api</span> = api</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">projectAPI</span> = projectAPI</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„tsæ–‡ä»¶</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/preload/index.d.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElectronAPI</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@electron-toolkit/preload&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ProjectAPI</span> &#123;</span><br><span class="line">  <span class="attr">open</span>: <span class="function">() =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">string</span> | <span class="literal">null</span>&gt;;</span><br><span class="line">  <span class="attr">close</span>: <span class="function">() =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="attr">toggleLock</span>: <span class="function">(<span class="params"><span class="attr">locked</span>: <span class="built_in">boolean</span></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  <span class="attr">writeFile</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span>, <span class="attr">content</span>: <span class="built_in">string</span></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="attr">create</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span>, <span class="attr">type</span>: <span class="string">&#x27;file&#x27;</span> | <span class="string">&#x27;directory&#x27;</span></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="attr">delete</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="attr">readDir</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;&#123; <span class="attr">tree</span>: <span class="title class_">FileNode</span>[], <span class="attr">projectInfo</span>: <span class="built_in">string</span> &#125;&gt;;</span><br><span class="line">  <span class="attr">rename</span>: <span class="function">(<span class="params"><span class="attr">oldPath</span>: <span class="built_in">string</span>, <span class="attr">newName</span>: <span class="built_in">string</span></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  <span class="attr">readFile</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">global</span> &#123;</span><br><span class="line">  <span class="keyword">interface</span> <span class="title class_">Window</span> &#123;</span><br><span class="line">    <span class="attr">electron</span>: <span class="title class_">ElectronAPI</span></span><br><span class="line">    <span class="attr">api</span>: &#123;</span><br><span class="line">      <span class="attr">checkCursorOutside</span>: <span class="function">() =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt;</span><br><span class="line">      <span class="attr">activateCurrentWindow</span>: <span class="function">() =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">projectAPI</span>:<span class="title class_">ProjectAPI</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ–°å»ºLockEditor.vueæ–‡ä»¶ï¼Œç”¨äºç¼–è¾‘é”å®šæ–‡ä»¶</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/renderer/components/LockEditor.vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;security-ide&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 1. é¡¶éƒ¨çŠ¶æ€æ  --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;controls&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">class</span>=<span class="string">&quot;btn primary&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          @<span class="attr">click</span>=<span class="string">&quot;handleOpenProject&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">:disabled</span>=<span class="string">&quot;isLocked&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          ğŸ›¡ï¸ æ‰“å¼€å¹¶é”å®šå·¥ç¨‹</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">class</span>=<span class="string">&quot;btn danger&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          @<span class="attr">click</span>=<span class="string">&quot;handleUnlockProject&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">:disabled</span>=<span class="string">&quot;!isLocked&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          ğŸ”“ è§£é”å¹¶å…³é—­</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;status&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        çŠ¶æ€: </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">:class</span>=<span class="string">&quot;[&#x27;badge&#x27;, isLocked ? &#x27;locked&#x27; : &#x27;unlocked&#x27;]&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;&#123; isLocked ? &#x27;ACL æƒé™ç‹¬å ä¸­&#x27; : &#x27;æ™®é€šæ¨¡å¼&#x27; &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;path&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;projectPath&quot;</span>&gt;</span>&#123;&#123; projectPath &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="comment">&lt;!-- âœ¨ ä¸€é”®åˆ‡æ¢å¼€å…³ --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;switch-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">v-model</span>=<span class="string">&quot;isLocked_back&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            @<span class="attr">change</span>=<span class="string">&quot;handleToggleLock&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;slider&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;label-text&quot;</span>&gt;</span>&#123;&#123; isLocked_back ? &#x27;ğŸ›¡ï¸ ç‹¬å æ¨¡å¼&#x27; : &#x27;ğŸ”“ æ™®é€šæ¨¡å¼&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 2. ä¸»ä½“å†…å®¹ --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">main</span> <span class="attr">class</span>=<span class="string">&quot;workspace&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!-- å·¦ä¾§æ–‡ä»¶åˆ—è¡¨ --&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">aside</span> <span class="attr">class</span>=<span class="string">&quot;sidebar&quot;</span> @<span class="attr">contextmenu.prevent</span>=<span class="string">&quot;onSidebarRightClick&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sidebar-title&quot;</span>&gt;</span>èµ„æºç®¡ç†å™¨<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;!files.length&quot;</span> <span class="attr">class</span>=<span class="string">&quot;empty-list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;&#123; isLocked ? &#x27;ç›®å½•ä¸ºç©º&#x27; : &#x27;æœªæ‰“å¼€å·¥ç¨‹&#x27; &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;file-list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">v-for</span>=<span class="string">&quot;file in files&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">:key</span>=<span class="string">&quot;file.path&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">class</span>=<span class="string">&quot;file-item&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">:class</span>=<span class="string">&quot;&#123; active: currentFile?.path === file.path &#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            @<span class="attr">click</span>=<span class="string">&quot;selectFile(file)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            @<span class="attr">contextmenu.stop</span>=<span class="string">&quot;onFileRightClick($event, file)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span>&gt;</span>&#123;&#123; file.type=== &#x27;directory&#x27; ? &#x27;ğŸ“&#x27; : &#x27;ğŸ“„&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>&#123;&#123; file.name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!-- å³ä¾§ç¼–è¾‘å™¨ --&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;editor&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;!currentFile&quot;</span> <span class="attr">class</span>=<span class="string">&quot;welcome&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h3</span>&gt;</span>éªŒè¯è¯´æ˜<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>ç‚¹å‡»å·¦ä¸Šè§’æ‰“å¼€ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶å¤¹ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>éªŒè¯é”å®š<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>ï¼šæ‰“å¼€ç³»ç»Ÿèµ„æºç®¡ç†å™¨ï¼Œå°è¯•åˆ é™¤è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œç³»ç»Ÿåº”æç¤ºâ€œéœ€è¦æƒé™â€ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>éªŒè¯ç‰¹æƒ<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>ï¼šåœ¨ä¸‹æ–¹ç¼–è¾‘å™¨ä¿®æ”¹å†…å®¹ï¼ŒæŒ‰ Ctrl+S ä¿å­˜ï¼Œåº”æˆåŠŸã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>éªŒè¯ç®¡ç†<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>ï¼šåœ¨å·¦ä¾§åˆ—è¡¨å³é”®ï¼Œå°è¯•æ–°å»ºæˆ–åˆ é™¤ï¼Œåº”æˆåŠŸã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">&quot;code-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tab-header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;&#123; currentFile.name &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;isDirty&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dot&quot;</span>&gt;</span>â—<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">textarea</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">class</span>=<span class="string">&quot;code-area&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">v-model</span>=<span class="string">&quot;fileContent&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            @<span class="attr">input</span>=<span class="string">&quot;isDirty = true&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            @<span class="attr">keydown.ctrl.s.prevent</span>=<span class="string">&quot;saveFile&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            @<span class="attr">keydown.meta.s.prevent</span>=<span class="string">&quot;saveFile&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 3. åº•éƒ¨æ—¥å¿— --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;logger&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;log-line&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(log, idx) in logs&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;idx&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;time&quot;</span>&gt;</span>[&#123;&#123; log.time &#125;&#125;]<span class="tag">&lt;/<span class="name">span</span>&gt;</span> &#123;&#123; log.msg &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 4. è‡ªå®šä¹‰å³é”®èœå• --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">v-if</span>=<span class="string">&quot;contextMenu.visible&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">class</span>=<span class="string">&quot;ctx-menu&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:style</span>=<span class="string">&quot;&#123; top: contextMenu.y + &#x27;px&#x27;, left: contextMenu.x + &#x27;px&#x27; &#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;menu-item disabled&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;contextMenu.target&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        æ“ä½œ: &#123;&#123; contextMenu.target.name &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;divider&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;menu-item&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleCreate(&#x27;file&#x27;)&quot;</span>&gt;</span>âœ¨ ç‰¹æƒæ–°å»ºæ–‡ä»¶<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;menu-item&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleCreate(&#x27;directory&#x27;)&quot;</span>&gt;</span>ğŸ“ ç‰¹æƒæ–°å»ºæ–‡ä»¶å¤¹<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;menu-item danger&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleDelete&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;contextMenu.target&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ğŸ—‘ï¸ ç‰¹æƒåˆ é™¤</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- âœ… æ–°å¢ï¼šè‡ªå®šä¹‰è¾“å…¥å¼¹çª— --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;inputBox.visible&quot;</span> <span class="attr">class</span>=<span class="string">&quot;modal-overlay&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-content&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-title&quot;</span>&gt;</span>&#123;&#123; inputBox.title &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">id</span>=<span class="string">&quot;custom-input&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">v-model</span>=<span class="string">&quot;inputBox.value&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          @<span class="attr">keydown.enter</span>=<span class="string">&quot;confirmInput&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          @<span class="attr">keydown.esc</span>=<span class="string">&quot;cancelInput&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">class</span>=<span class="string">&quot;modal-input&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-actions&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;cancelInput&quot;</span>&gt;</span>å–æ¶ˆ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;confirmInput&quot;</span>&gt;</span>ç¡®å®š<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, reactive, onBeforeUnmount, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">// --- ç±»å‹å®šä¹‰ ---</span><br><span class="line">interface FileNode &#123;</span><br><span class="line">  name: string</span><br><span class="line">  path: string</span><br><span class="line">  type: string</span><br><span class="line">  children?: FileNode[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Log &#123;</span><br><span class="line">  time: string</span><br><span class="line">  msg: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// --- çŠ¶æ€æ•°æ® ---</span><br><span class="line">const isLocked = ref(false)</span><br><span class="line">const isLocked_back = ref(false)</span><br><span class="line">const projectPath = ref(&#x27;&#x27;)</span><br><span class="line">const files = ref&lt;FileNode[]&gt;([])</span><br><span class="line">const currentFile = ref&lt;FileNode | null&gt;(null)</span><br><span class="line">const fileContent = ref(&#x27;&#x27;)</span><br><span class="line">const isDirty = ref(false)</span><br><span class="line">const logs = ref&lt;Log[]&gt;([])</span><br><span class="line"></span><br><span class="line">// å³é”®èœå•çŠ¶æ€</span><br><span class="line">const contextMenu = reactive(&#123;</span><br><span class="line">  visible: false,</span><br><span class="line">  x: 0,</span><br><span class="line">  y: 0,</span><br><span class="line">  target: null as FileNode | null // null ä»£è¡¨åœ¨ç©ºç™½å¤„ç‚¹å‡»</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// --- æ–°å¢ï¼šInput å¼¹çª—çš„çŠ¶æ€ ---</span><br><span class="line">const inputBox = reactive(&#123;</span><br><span class="line">  visible: false,</span><br><span class="line">  title: &#x27;&#x27;,</span><br><span class="line">  value: &#x27;&#x27;,</span><br><span class="line">  resolve: null as ((val: string | null) =&gt; void) | null</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// --- æ–°å¢ï¼šå°è£…ä¸€ä¸ª Promise åŒ–çš„è¾“å…¥æ¡†å‡½æ•° ---</span><br><span class="line">const showInputBox = (title: string, defaultValue = &#x27;&#x27;) =&gt; &#123;</span><br><span class="line">  inputBox.title = title</span><br><span class="line">  inputBox.value = defaultValue</span><br><span class="line">  inputBox.visible = true</span><br><span class="line">  </span><br><span class="line">  // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡† (ä½¿ç”¨ nextTick)</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    document.getElementById(&#x27;custom-input&#x27;)?.focus()</span><br><span class="line">  &#125;, 100)</span><br><span class="line"></span><br><span class="line">  return new Promise&lt;string | null&gt;((resolve) =&gt; &#123;</span><br><span class="line">    inputBox.resolve = resolve</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// --- æ–°å¢ï¼šå¼¹çª—ç¡®è®¤ä¸å–æ¶ˆ ---</span><br><span class="line">const confirmInput = () =&gt; &#123;</span><br><span class="line">  if (inputBox.resolve) inputBox.resolve(inputBox.value)</span><br><span class="line">  inputBox.visible = false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const cancelInput = () =&gt; &#123;</span><br><span class="line">  if (inputBox.resolve) inputBox.resolve(null)</span><br><span class="line">  inputBox.visible = false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// --- æ—¥å¿—å·¥å…· ---</span><br><span class="line">const addLog = (msg: string) =&gt; &#123;</span><br><span class="line">  const time = new Date().toLocaleTimeString()</span><br><span class="line">  logs.value.unshift(&#123; time, msg &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// --- 1. å·¥ç¨‹æ“ä½œ ---</span><br><span class="line"></span><br><span class="line">const handleOpenProject = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    addLog(&#x27;æ­£åœ¨è¯·æ±‚ç³»ç»Ÿæƒé™é”å®š...&#x27;)</span><br><span class="line">    // const path = await window.securityAPI.openProject()</span><br><span class="line">      const path = await window.projectAPI.open()</span><br><span class="line">    if (path) &#123;</span><br><span class="line">      projectPath.value = path</span><br><span class="line">      isLocked.value = true</span><br><span class="line">      addLog(`âœ… å·¥ç¨‹å·²é”å®š: $&#123;path&#125;`)</span><br><span class="line">      addLog(&#x27;ğŸ”’ æ­¤æ—¶å¤–éƒ¨åº”ç”¨æ— æ³•å†™å…¥æˆ–åˆ é™¤æ­¤ç›®å½•å†…å®¹&#x27;)</span><br><span class="line">      await refreshFiles()</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      addLog(&#x27;ç”¨æˆ·å–æ¶ˆäº†æ“ä½œ&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (e: any) &#123;</span><br><span class="line">    addLog(`âŒ é”å®šå¤±è´¥: $&#123;e.message&#125;`)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 2. âœ¨ æ ¸å¿ƒï¼šåˆ‡æ¢æ¨¡å¼</span><br><span class="line">const handleToggleLock = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    console.log(&#x27;æ­£åœ¨åˆ‡æ¢æ¨¡å¼...&#x27;, isLocked_back.value)</span><br><span class="line">    // ç›´æ¥è°ƒç”¨ç»Ÿä¸€æ¥å£ï¼Œåç«¯è´Ÿè´£ä¸Šé”æˆ–è§£é”</span><br><span class="line">    await window.projectAPI.toggleLock(isLocked_back.value)</span><br><span class="line">    alert(isLocked_back.value ? &#x27;å·²å¼€å¯ç‹¬å é”å®šï¼å¤–éƒ¨æ— æ³•ä¿®æ”¹æ–‡ä»¶ã€‚&#x27; : &#x27;å·²åˆ‡æ¢å›æ™®é€šæ¨¡å¼ã€‚&#x27;)</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    console.error(e)</span><br><span class="line">    // å¦‚æœåˆ‡æ¢å¤±è´¥ï¼ˆæ¯”å¦‚æƒé™ä¸å¤Ÿï¼‰ï¼Œå›æ»šå¼€å…³çŠ¶æ€</span><br><span class="line">    isLocked_back.value = !isLocked_back.value</span><br><span class="line">    alert(&#x27;åˆ‡æ¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const handleUnlockProject = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    // await window.securityAPI.closeProject()</span><br><span class="line">    await window.projectAPI.close()</span><br><span class="line">    isLocked.value = false</span><br><span class="line">    projectPath.value = &#x27;&#x27;</span><br><span class="line">    files.value = []</span><br><span class="line">    currentFile.value = null</span><br><span class="line">    addLog(&#x27;ğŸ”“ å·¥ç¨‹å·²è§£é”ï¼Œæ¢å¤ç³»ç»Ÿé»˜è®¤æƒé™&#x27;)</span><br><span class="line">  &#125; catch (e: any) &#123;</span><br><span class="line">    addLog(`âŒ è§£é”å¤±è´¥: $&#123;e.message&#125;`)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const refreshFiles = async () =&gt; &#123;</span><br><span class="line">  if (!projectPath.value) return</span><br><span class="line">  try &#123;</span><br><span class="line">    // å‡è®¾åç«¯ ipc å®ç°äº† sec-read-dir</span><br><span class="line">    // å¦‚æœæ²¡æœ‰å®ç°ï¼Œè¯·åœ¨åç«¯è¡¥å…… fs.readdir é€»è¾‘</span><br><span class="line">    const &#123;tree&#125; = await window.projectAPI.readDir(projectPath.value)</span><br><span class="line">    files.value = tree</span><br><span class="line">    console.log(&#x27;Files:&#x27;, files.value)</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    addLog(&#x27;è¯»å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥ (è¯·ç¡®è®¤åç«¯å®ç°äº† readDir)&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// --- 2. æ–‡ä»¶æ“ä½œ ---</span><br><span class="line"></span><br><span class="line">const selectFile = async (file: FileNode) =&gt; &#123;</span><br><span class="line">  if (file.type == &#x27;directory&#x27;) return</span><br><span class="line">  try &#123;</span><br><span class="line">    // è¿™é‡Œä¸ºäº†æ¼”ç¤ºç®€å•ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ª readFile çš„ API</span><br><span class="line">    // æˆ–è€…æˆ‘ä»¬ç›´æ¥æ˜¾ç¤ºä¸€æ®µ Mock å†…å®¹ï¼Œé‡ç‚¹éªŒè¯ Save åŠŸèƒ½</span><br><span class="line">    const content = await window.projectAPI.readFile(file.path)</span><br><span class="line">    currentFile.value = file</span><br><span class="line">    // fileContent.value = content</span><br><span class="line">    fileContent.value = `// è¿™æ˜¯æ–‡ä»¶ $&#123;file.name&#125;\n// å®ƒæ˜¯åªè¯»çš„ (å¯¹äºå¤–éƒ¨ç¨‹åº)\n// è¯•ç€ä¿®æ”¹å¹¶æŒ‰ Ctrl+S ä¿å­˜ã€‚\n// $&#123;content&#125;`</span><br><span class="line">    isDirty.value = false</span><br><span class="line">    addLog(`å·²æ‰“å¼€: $&#123;file.name&#125;`)</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    addLog(&#x27;è¯»å–æ–‡ä»¶å†…å®¹å¤±è´¥&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const saveFile = async () =&gt; &#123;</span><br><span class="line">  if (!currentFile.value) return</span><br><span class="line">  addLog(`æ­£åœ¨é€šè¿‡ç‰¹æƒé€šé“ä¿å­˜ $&#123;currentFile.value.name&#125;...`)</span><br><span class="line">  </span><br><span class="line">  try &#123;</span><br><span class="line">    // âœ¨ æ ¸å¿ƒéªŒè¯ç‚¹ï¼šç‰¹æƒå†™å…¥</span><br><span class="line">    // await window.securityAPI.writeFile(currentFile.value.path, fileContent.value)</span><br><span class="line">      await window.projectAPI.writeFile(currentFile.value.path, fileContent.value)</span><br><span class="line">    isDirty.value = false</span><br><span class="line">    addLog(`âœ… ä¿å­˜æˆåŠŸï¼(ACL æƒé™ä¸´æ—¶ææƒå®Œæˆ)`)</span><br><span class="line">  &#125; catch (e: any) &#123;</span><br><span class="line">    addLog(`âŒ ä¿å­˜å¤±è´¥: $&#123;e.message&#125;`)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// --- 3. å³é”®èœå•ä¸æ–°å»º/åˆ é™¤ ---</span><br><span class="line"></span><br><span class="line">const onSidebarRightClick = (e: MouseEvent) =&gt; &#123;</span><br><span class="line">  showMenu(e.clientX, e.clientY, null)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const onFileRightClick = (e: MouseEvent, file: FileNode) =&gt; &#123;</span><br><span class="line">  showMenu(e.clientX, e.clientY, file)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const showMenu = (x: number, y: number, target: FileNode | null) =&gt; &#123;</span><br><span class="line">  contextMenu.visible = true</span><br><span class="line">  contextMenu.x = x</span><br><span class="line">  contextMenu.y = y</span><br><span class="line">  contextMenu.target = target</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const closeMenu = () =&gt; &#123; contextMenu.visible = false &#125;</span><br><span class="line"></span><br><span class="line">const handleCreate = async (type: &#x27;file&#x27; | &#x27;directory&#x27;) =&gt; &#123;</span><br><span class="line">  closeMenu()</span><br><span class="line">  if (!projectPath.value) return</span><br><span class="line"></span><br><span class="line">//   const name = prompt(`è¯·è¾“å…¥$&#123;type === &#x27;file&#x27; ? &#x27;æ–‡ä»¶&#x27; : &#x27;æ–‡ä»¶å¤¹&#x27;&#125;åç§°:`)</span><br><span class="line">// âœ… æ›¿æ¢ä¸ºè‡ªå®šä¹‰å¼¹çª—:</span><br><span class="line">  const name = await showInputBox(`è¯·è¾“å…¥$&#123;type === &#x27;file&#x27; ? &#x27;æ–‡ä»¶&#x27; : &#x27;æ–‡ä»¶å¤¹&#x27;&#125;åç§°:`)</span><br><span class="line">  if (!name) return</span><br><span class="line"></span><br><span class="line">  const targetPath = `$&#123;projectPath.value&#125;/$&#123;name&#125;` // ç®€å•æ‹¼æ¥ï¼Œå®é™…åº”ç”¨è¯·ç”¨ path.join</span><br><span class="line">  </span><br><span class="line">  try &#123;</span><br><span class="line">    addLog(`æ­£åœ¨åˆ›å»º: $&#123;name&#125;...`)</span><br><span class="line">    // âœ¨ æ ¸å¿ƒéªŒè¯ç‚¹ï¼šç‰¹æƒåˆ›å»º</span><br><span class="line">    await window.projectAPI.create(targetPath, type)</span><br><span class="line">    addLog(`âœ… åˆ›å»ºæˆåŠŸ`)</span><br><span class="line">    await refreshFiles()</span><br><span class="line">  &#125; catch (e: any) &#123;</span><br><span class="line">    addLog(`âŒ åˆ›å»ºå¤±è´¥: $&#123;e.message&#125;`)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const handleDelete = async () =&gt; &#123;</span><br><span class="line">  closeMenu()</span><br><span class="line">  const target = contextMenu.target</span><br><span class="line">  if (!target) return</span><br><span class="line"></span><br><span class="line">  if (!confirm(`ç¡®å®šè¦å¼ºåˆ¶åˆ é™¤ $&#123;target.name&#125; å—ï¼Ÿ`)) return</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    addLog(`æ­£åœ¨åˆ é™¤: $&#123;target.name&#125;...`)</span><br><span class="line">    // âœ¨ æ ¸å¿ƒéªŒè¯ç‚¹ï¼šç‰¹æƒåˆ é™¤</span><br><span class="line">    // await window.securityAPI.delete(target.path)</span><br><span class="line">     // ğŸ’¥ åŒæ ·ä¸éœ€è¦åˆ¤æ–­æ¨¡å¼</span><br><span class="line">    await window.projectAPI.delete(target.path)</span><br><span class="line">    addLog(`âœ… åˆ é™¤æˆåŠŸ`)</span><br><span class="line">    if (currentFile.value?.path === target.path) &#123;</span><br><span class="line">      currentFile.value = null</span><br><span class="line">      fileContent.value = &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    await refreshFiles()</span><br><span class="line">  &#125; catch (e: any) &#123;</span><br><span class="line">    addLog(`âŒ åˆ é™¤å¤±è´¥: $&#123;e.message&#125;`)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const handleRename = async (file: any) =&gt; &#123;</span><br><span class="line">  const newName = await showInputBox(&#x27;è¯·è¾“å…¥æ–°åç§°&#x27;, file.name)</span><br><span class="line">  if (!newName || newName === file.name) return</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    // âœ¨ æ— è®ºæ˜¯å¦é”å®šï¼Œç›´æ¥è°ƒç”¨ç»Ÿä¸€æ¥å£</span><br><span class="line">    await window.projectAPI.rename(file.path, newName)</span><br><span class="line">    </span><br><span class="line">    console.log(&#x27;é‡å‘½åæˆåŠŸ&#x27;)</span><br><span class="line">    // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨</span><br><span class="line">    await refreshFiles()</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    console.error(&#x27;é‡å‘½åå¤±è´¥&#x27;, e)</span><br><span class="line">    alert(&#x27;é‡å‘½åå¤±è´¥ï¼šæƒé™ä¸è¶³æˆ–æ–‡ä»¶è¢«å ç”¨&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å…¨å±€ç‚¹å‡»å…³é—­èœå•</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  window.addEventListener(&#x27;click&#x27;, closeMenu)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">onBeforeUnmount(() =&gt; &#123;</span><br><span class="line">  window.removeEventListener(&#x27;click&#x27;, closeMenu)</span><br><span class="line">  // é˜²æ­¢å¼€å‘æ—¶åˆ·æ–°é¡µé¢å¯¼è‡´é”æ­»</span><br><span class="line">  if (isLocked.value) &#123;</span><br><span class="line">    window.projectAPI.close()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.security-ide &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  height: 100vh;</span><br><span class="line">  background: #1e1e1e;</span><br><span class="line">  color: #ccc;</span><br><span class="line">  font-family: &#x27;Segoe UI&#x27;, sans-serif;</span><br><span class="line">  user-select: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Header */</span><br><span class="line">.header &#123;</span><br><span class="line">  height: 50px;</span><br><span class="line">  background: #252526;</span><br><span class="line">  border-bottom: 1px solid #111;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  padding: 0 16px;</span><br><span class="line">&#125;</span><br><span class="line">.btn &#123;</span><br><span class="line">  padding: 6px 12px;</span><br><span class="line">  border: none;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  margin-right: 10px;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">  color: white;</span><br><span class="line">  opacity: 0.9;</span><br><span class="line">&#125;</span><br><span class="line">.btn:hover:not(:disabled) &#123; opacity: 1; transform: translateY(-1px); &#125;</span><br><span class="line">.btn:disabled &#123; opacity: 0.3; cursor: not-allowed; &#125;</span><br><span class="line">.primary &#123; background: #0e639c; &#125;</span><br><span class="line">.danger &#123; background: #ab1212; &#125;</span><br><span class="line"></span><br><span class="line">.status &#123; font-size: 13px; display: flex; align-items: center; gap: 8px;&#125;</span><br><span class="line">.badge &#123; padding: 2px 6px; border-radius: 3px; font-size: 12px; color: #111; font-weight: bold;&#125;</span><br><span class="line">.badge.locked &#123; background: #4caf50; &#125;</span><br><span class="line">.badge.unlocked &#123; background: #888; &#125;</span><br><span class="line">.path &#123; color: #888; font-family: monospace; &#125;</span><br><span class="line"></span><br><span class="line">/* Workspace */</span><br><span class="line">.workspace &#123; flex: 1; display: flex; overflow: hidden; &#125;</span><br><span class="line"></span><br><span class="line">.sidebar &#123;</span><br><span class="line">  width: 250px;</span><br><span class="line">  background: #252526;</span><br><span class="line">  border-right: 1px solid #111;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">&#125;</span><br><span class="line">.sidebar-title &#123;</span><br><span class="line">  padding: 10px 16px; font-size: 11px; font-weight: bold; color: #888; text-transform: uppercase;</span><br><span class="line">&#125;</span><br><span class="line">.empty-list &#123; padding: 20px; text-align: center; color: #555; font-size: 13px; &#125;</span><br><span class="line">.file-list &#123; list-style: none; padding: 0; margin: 0; overflow-y: auto; &#125;</span><br><span class="line">.file-item &#123;</span><br><span class="line">  padding: 4px 16px; cursor: pointer; display: flex; align-items: center; font-size: 13px;</span><br><span class="line">&#125;</span><br><span class="line">.file-item:hover &#123; background: #2a2d2e; &#125;</span><br><span class="line">.file-item.active &#123; background: #37373d; color: white; &#125;</span><br><span class="line">.icon &#123; margin-right: 6px; &#125;</span><br><span class="line"></span><br><span class="line">.editor &#123; flex: 1; display: flex; flex-direction: column; background: #1e1e1e; &#125;</span><br><span class="line">.welcome &#123; </span><br><span class="line">  flex: 1; display: flex; flex-direction: column; </span><br><span class="line">  justify-content: center; align-items: center; color: #666; </span><br><span class="line">  padding: 40px; line-height: 1.8;</span><br><span class="line">&#125;</span><br><span class="line">.welcome ol &#123; text-align: left; &#125;</span><br><span class="line">.code-wrapper &#123; display: flex; flex-direction: column; height: 100%; &#125;</span><br><span class="line">.tab-header &#123; </span><br><span class="line">  background: #2d2d2d; height: 35px; display: flex; align-items: center; </span><br><span class="line">  padding: 0 16px; font-size: 13px; border-top: 1px solid #007fd4; color: white;</span><br><span class="line">&#125;</span><br><span class="line">.dot &#123; margin-left: 8px; font-size: 20px; line-height: 10px; &#125;</span><br><span class="line">.code-area &#123;</span><br><span class="line">  flex: 1; background: #1e1e1e; color: #d4d4d4; border: none; resize: none;</span><br><span class="line">  padding: 16px; font-family: &#x27;Consolas&#x27;, monospace; outline: none; font-size: 14px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Logger */</span><br><span class="line">.logger &#123;</span><br><span class="line">  height: 120px; background: #111; border-top: 1px solid #333;</span><br><span class="line">  padding: 8px; overflow-y: auto; font-family: monospace; font-size: 12px;</span><br><span class="line">&#125;</span><br><span class="line">.log-line &#123; margin-bottom: 4px; color: #ccc; &#125;</span><br><span class="line">.time &#123; color: #569cd6; margin-right: 8px; &#125;</span><br><span class="line"></span><br><span class="line">/* Context Menu */</span><br><span class="line">.ctx-menu &#123;</span><br><span class="line">  position: fixed; background: #252526; border: 1px solid #454545;</span><br><span class="line">  box-shadow: 0 4px 10px rgba(0,0,0,0.5); z-index: 9999;</span><br><span class="line">  min-width: 160px; border-radius: 4px; padding: 4px 0;</span><br><span class="line">&#125;</span><br><span class="line">.menu-item &#123;</span><br><span class="line">  padding: 6px 12px; cursor: pointer; font-size: 13px; color: #ccc;</span><br><span class="line">&#125;</span><br><span class="line">.menu-item:hover:not(.disabled) &#123; background: #094771; color: white; &#125;</span><br><span class="line">.menu-item.disabled &#123; color: #666; cursor: default; border-bottom: 1px solid #333; padding-bottom: 8px; margin-bottom: 4px;&#125;</span><br><span class="line">.menu-item.danger:hover &#123; background: #881111; &#125;</span><br><span class="line">.divider &#123; height: 1px; background: #454545; margin: 4px 0; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/* âœ… æ–°å¢ï¼šå¼¹çª—æ ·å¼ */</span><br><span class="line">.modal-overlay &#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">  top: 0; left: 0; right: 0; bottom: 0;</span><br><span class="line">  background: rgba(0, 0, 0, 0.5);</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  align-items: center;</span><br><span class="line">  z-index: 10000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-content &#123;</span><br><span class="line">  background: #252526;</span><br><span class="line">  border: 1px solid #454545;</span><br><span class="line">  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);</span><br><span class="line">  width: 300px;</span><br><span class="line">  padding: 16px;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-title &#123;</span><br><span class="line">  margin-bottom: 12px;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  color: #ccc;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-input &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  background: #3c3c3c;</span><br><span class="line">  border: 1px solid #3c3c3c;</span><br><span class="line">  color: white;</span><br><span class="line">  padding: 6px;</span><br><span class="line">  outline: 1px solid transparent;</span><br><span class="line">  margin-bottom: 16px;</span><br><span class="line">  font-family: inherit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-input:focus &#123;</span><br><span class="line">  outline-color: #0e639c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-actions &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: flex-end;</span><br><span class="line">  gap: 8px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>






                
<p class="pink-link-context">
    <a href="/2025/12/28/%E5%89%8D%E7%AB%AF/electron/%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95/" rel="next" title="ä¸€äº›å¸¸ç”¨çš„å·¥å…·æ–¹æ³•">
    Prev: ä¸€äº›å¸¸ç”¨çš„å·¥å…·æ–¹æ³•
  </a>
</p>



<p class="pink-link-context">
    <a href="/2025/12/21/%E5%89%8D%E7%AB%AF/electron/%E4%B8%A4%E7%A7%8D%E7%8B%AC%E5%8D%A0%E5%BC%8F%E6%96%B9%E6%A1%88%E6%AF%94%E8%BE%83/" rel="next" title="Windows (icacls) è¿™ä¸ªæ–¹æ¡ˆ æœ‰æ–‡ä»¶å¤¹node_modle,.gitè¿™ç§é™åˆ¶å—">
    Next: Windows (icacls) è¿™ä¸ªæ–¹æ¡ˆ æœ‰æ–‡ä»¶å¤¹node_modle,.gitè¿™ç§é™åˆ¶å—
  </a>
</p>


            </div>
			
        </div>
    </div>
</article>






</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large pink">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect green" title="Return to top"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse yellow darken-1"  data-activates="main-menu" title="Menu"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer indigo darken-1">
    
    <div class="footer-container container">
        <div class="row">
            
            <div class="social-group col m4 s12">
                <h5 class="white-text">Social</h5>
                
                    <a class="social-link" href="/atom.xml" target="_blank">
                        <i class="fa fa-2x fa-rss"></i>
                    </a>
                
                
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
    </script>
    <div class="site-visitors-container white-text">
        <span>
            <i class="fa fa-user"></i>
            <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
        </span>
        <span>&nbsp;|&nbsp;</span>
        <span>
            <i class="fa fa-eye"></i>
            <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
        </span>
    </div>


            </div>
            

            
            <div class="col m8 s12">
                <h5 class="white-text">Links</h5>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright pink-link-context">
        <div class="container">
            Â© 2015-2026 ypintao.com, All rights reserved.
            <p class="right" style="margin-top: 0;">Blog powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">å½“å‰ç½‘é€Ÿè¾ƒæ…¢æˆ–è€…ä½ ä½¿ç”¨çš„æµè§ˆå™¨ä¸æ”¯æŒåšå®¢ç‰¹å®šåŠŸèƒ½ï¼Œè¯·å°è¯•åˆ·æ–°æˆ–æ¢ç”¨Chromeã€Firefoxç­‰ç°ä»£æµè§ˆå™¨</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">å½“å‰ç½‘é€Ÿè¾ƒæ…¢æˆ–è€…ä½ ä½¿ç”¨çš„æµè§ˆå™¨ä¸æ”¯æŒåšå®¢ç‰¹å®šåŠŸèƒ½ï¼Œè¯·å°è¯•åˆ·æ–°æˆ–æ¢ç”¨Chromeã€Firefoxç­‰ç°ä»£æµè§ˆå™¨</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // éšè—ç¦ç”¨javascriptï¼ˆé’ˆå¯¹å¾®ä¿¡å†…ç½®æµè§ˆå™¨ï¼‰çš„æç¤º
            $('.noscript').hide();

            // å›¾ç‰‡ç¼©æ”¾æ•ˆæœ
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // ç»™å›¾ç‰‡åŠ ä¸Šç‚¹å‡»æ”¾å¤§æ•ˆæœï¼ˆmaterialboxæ’ä»¶ï¼‰
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // ä¼˜åŒ–è¡¨æ ¼çš„æ˜¾ç¤º
            $('table').each(function() {
                var $table = $(this);
                // é™¤å»å¤šè¡Œä»£ç çš„æƒ…å†µ
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // é¦–é¡µå¹»ç¯ç‰‡
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // é’ˆå¯¹gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // æ–‡ç« ç›®å½•
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();

            // ç›®å½•éšå±å¹•æ»šåŠ¨ï¼ˆé˜²æ­¢ç›®å½•è¿‡é•¿è¶Šè¿‡footerï¼‰
            var $toc = $('.toc');
            var scrollTargetTop = 0;
            $(window).scroll(function() {
                var $activeLink = $toc.find('a.active.section');
                if ($(window).scrollTop() < 100) {
                    scrollTargetTop = 0;
                } else {
                    if ($activeLink[0]) {
                        scrollTargetTop = $activeLink.offset().top - $toc.offset().top;
                    }
                }
                $toc.css('top', '-' + scrollTargetTop + 'px');
            });

            // ä¿®æ­£æ–‡ç« ç›®å½•çš„left-borderé¢œè‰²
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // é’ˆå¯¹ç§»åŠ¨ç«¯åšçš„ä¼˜åŒ–ï¼šFABæŒ‰é’®ç‚¹å‡»ä¸€ä¸‹æ”¶å›
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // å›åˆ°é¡¶éƒ¨
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // é‡ç½®è¯»ä¹¦é¡µé¢çš„Tabæ ‡ç­¾é¡µçš„é¢œè‰²
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('pink lighten-2');

            
            // æ·»åŠ newæ ‡ç­¾
            $('.menu-reading, .menu-about').append('<span class="new badge pink"></span>');
            

            // æœç´¢åŠŸèƒ½
            $('.modal-trigger').leanModal({
                // æ‰“å¼€æœç´¢æ¡†æ—¶è‡ªåŠ¨èšç„¦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "search.xml";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // åˆå§‹åŒ–æœç´¢ä¸åŒ¹é…å‡½æ•°
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>


<!-- <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'G-PV4DSBLNBV', 'auto');
    ga('send', 'pageview');

</script> -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PV4DSBLNBV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PV4DSBLNBV');
</script>




<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b83071413c9fe0c6a7af18e6cbaa34ff";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



</body>
</html>
