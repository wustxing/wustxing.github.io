<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>wustxing&#39;s blog</title>
  
  <subtitle>æ˜Ÿçš„åšå®¢</subtitle>
  <link href="http://blog.ypintao.com/atom.xml" rel="self"/>
  
  <link href="http://blog.ypintao.com/"/>
  <updated>2025-12-14T09:31:30.943Z</updated>
  <id>http://blog.ypintao.com/</id>
  
  <author>
    <name>wustxing</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>BroadcastChannel æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•</title>
    <link href="http://blog.ypintao.com/2025/12/14/%E5%89%8D%E7%AB%AF/electron/BroadcastChannel%20%E6%8F%A1%E6%89%8B%E6%9C%BA%E5%88%B6%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>http://blog.ypintao.com/2025/12/14/%E5%89%8D%E7%AB%AF/electron/BroadcastChannel%20%E6%8F%A1%E6%89%8B%E6%9C%BA%E5%88%B6%E7%9A%84%E6%96%B9%E6%B3%95/</id>
    <published>2025-12-14T09:26:57.271Z</published>
    <updated>2025-12-14T09:31:30.943Z</updated>
    
    <content type="html"><![CDATA[<h2 id="BroadcastChannel-æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°"><a href="#BroadcastChannel-æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°" class="headerlink" title="BroadcastChannel æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°"></a>BroadcastChannel æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°</h2><p>ä½¿ç”¨åœºæ™¯ï¼Œdokeview tabæ‹–å‡ºæ¥çª—å£å¤–ç¬¬ä¸€æ¬¡åˆ›å»ºçª—å£çš„æ—¶å€™ä¼ é€’å‚æ•°ã€‚</p><p>å°†è¿™ç§â€œæ¡æ‰‹â€é€»è¾‘å°è£…æˆé€šç”¨çš„å·¥å…·å‡½æ•°ï¼Œå¯ä»¥å¤§å¤§å‡å°‘é‡å¤ä»£ç ï¼Œå¹¶ä¿è¯é€»è¾‘çš„å¥å£®æ€§ã€‚</p><p>å°è£…äº†ä¸€ä¸ªç±»å‹å®‰å…¨ã€æ”¯æŒè¶…æ—¶æ§åˆ¶çš„ <strong><code>WindowSync</code></strong> å·¥å…·åº“ã€‚</p><h3 id="1-åˆ›å»ºå·¥å…·æ–‡ä»¶-src-utils-window-sync-ts"><a href="#1-åˆ›å»ºå·¥å…·æ–‡ä»¶-src-utils-window-sync-ts" class="headerlink" title="1. åˆ›å»ºå·¥å…·æ–‡ä»¶ (src/utils/window-sync.ts)"></a>1. åˆ›å»ºå·¥å…·æ–‡ä»¶ (<code>src/utils/window-sync.ts</code>)</h3><p>è¿™ä¸ªå·¥å…·åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒå‡½æ•°ï¼š</p><ol><li><code>sendToChild</code>: çˆ¶çª—å£è°ƒç”¨ï¼Œç­‰å¾…å­çª—å£å°±ç»ªåå‘é€æ•°æ®ã€‚</li><li><code>receiveFromParent</code>: å­çª—å£è°ƒç”¨ï¼Œå‘é€å°±ç»ªä¿¡å·å¹¶ç­‰å¾…æ•°æ®ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/utils/window-sync.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æ¶ˆæ¯åè®®</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">SyncMessage</span>&lt;T = <span class="built_in">any</span>&gt; = </span><br><span class="line">  | &#123; <span class="attr">type</span>: <span class="string">&#x27;CHILD_READY&#x27;</span>; <span class="attr">id</span>: <span class="built_in">string</span> &#125;</span><br><span class="line">  | &#123; <span class="attr">type</span>: <span class="string">&#x27;PARENT_DATA&#x27;</span>; <span class="attr">id</span>: <span class="built_in">string</span>; <span class="attr">payload</span>: T &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">SyncOptions</span> &#123;</span><br><span class="line">  <span class="attr">timeout</span>?: <span class="built_in">number</span>; <span class="comment">// è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 5000ms</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ã€çˆ¶çª—å£ç”¨ã€‘å‘é€æ•°æ®ç»™æ–°å¼€çš„å­çª—å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> channelName é¢‘é“åç§° (å¿…é¡»ä¸å­çª—å£ä¸€è‡´)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> targetId ç›®æ ‡çª—å£/é¢æ¿çš„å”¯ä¸€ID (ç”¨äºè¿‡æ»¤)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data è¦å‘é€çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> options é…ç½®é¡¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> sendToChild&lt;T&gt;(</span><br><span class="line">  <span class="attr">channelName</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">targetId</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">data</span>: T,</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">SyncOptions</span> = &#123;&#125;</span><br><span class="line">): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; timeout = <span class="number">5000</span> &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(channelName);</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">timer</span>: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¸…ç†å‡½æ•°</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">cleanup</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      channel.<span class="title function_">close</span>();</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. è®¾ç½®è¶…æ—¶æœºåˆ¶ (é˜²æ­¢å­çª—å£æ²¡æ‰“å¼€ï¼Œä¸€ç›´å¡æ­»åœ¨è¿™é‡Œ)</span></span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">cleanup</span>();</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`[WindowSync] Send timeout: Child window &quot;<span class="subst">$&#123;targetId&#125;</span>&quot; did not respond in <span class="subst">$&#123;timeout&#125;</span>ms`</span>));</span><br><span class="line">    &#125;, timeout);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç›‘å¬æ¶ˆæ¯</span></span><br><span class="line">    channel.<span class="property">onmessage</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">SyncMessage</span>&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="keyword">type</span>, id &#125; = event.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç­‰å¾… &quot;CHILD_READY&quot; ä¿¡å·ï¼Œä¸” ID å¿…é¡»åŒ¹é…</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">&#x27;CHILD_READY&#x27;</span> &amp;&amp; id === targetId) &#123;</span><br><span class="line">        <span class="comment">// 3. å‘é€æ•°æ®</span></span><br><span class="line">        channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;PARENT_DATA&#x27;</span>,</span><br><span class="line">          <span class="attr">id</span>: targetId,</span><br><span class="line">          <span class="attr">payload</span>: data,</span><br><span class="line">        &#125; <span class="keyword">as</span> <span class="title class_">SyncMessage</span>&lt;T&gt;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. å®Œæˆ</span></span><br><span class="line">        <span class="title function_">cleanup</span>();</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ã€å­çª—å£ç”¨ã€‘æ¥æ”¶æ¥è‡ªçˆ¶çª—å£çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> channelName é¢‘é“åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> myId è‡ªå·±çš„å”¯ä¸€ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> options é…ç½®é¡¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> receiveFromParent&lt;T&gt;(</span><br><span class="line">  <span class="attr">channelName</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">myId</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">SyncOptions</span> = &#123;&#125;</span><br><span class="line">): <span class="title class_">Promise</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; timeout = <span class="number">5000</span> &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(channelName);</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">timer</span>: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">cleanup</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      channel.<span class="title function_">close</span>();</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. è®¾ç½®è¶…æ—¶</span></span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">cleanup</span>();</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`[WindowSync] Receive timeout: Parent did not send data for &quot;<span class="subst">$&#123;myId&#125;</span>&quot;`</span>));</span><br><span class="line">    &#125;, timeout);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç›‘å¬çˆ¶çª—å£å‘æ¥çš„æ•°æ®</span></span><br><span class="line">    channel.<span class="property">onmessage</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">SyncMessage</span>&lt;T&gt;&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="keyword">type</span>, id, payload &#125; = event.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">&#x27;PARENT_DATA&#x27;</span> &amp;&amp; id === myId &amp;&amp; payload !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="title function_">cleanup</span>();</span><br><span class="line">        <span class="title function_">resolve</span>(payload);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. ä¸»åŠ¨å‘é€ &quot;æˆ‘å‡†å¤‡å¥½äº†&quot; ä¿¡å·</span></span><br><span class="line">    <span class="comment">// ç¨å¾®å»¶è¿Ÿä¸€ç‚¹ï¼Œç¡®ä¿çˆ¶çª—å£çš„ç›‘å¬å™¨å·²ç» ready (è™½ç„¶é€šå¸¸çˆ¶çª—å£æ—©å°± ready äº†)</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;CHILD_READY&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: myId,</span><br><span class="line">      &#125; <span class="keyword">as</span> <span class="title class_">SyncMessage</span>);</span><br><span class="line">    &#125;, <span class="number">50</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-åœ¨çˆ¶çª—å£ä¸­ä½¿ç”¨-CustomTab-vue"><a href="#2-åœ¨çˆ¶çª—å£ä¸­ä½¿ç”¨-CustomTab-vue" class="headerlink" title="2. åœ¨çˆ¶çª—å£ä¸­ä½¿ç”¨ (CustomTab.vue)"></a>2. åœ¨çˆ¶çª—å£ä¸­ä½¿ç”¨ (<code>CustomTab.vue</code>)</h3><p>ç°åœ¨ä½ çš„ä¸šåŠ¡ä»£ç ä¼šå˜å¾—éå¸¸ç®€æ´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; sendToChild &#125; from &#x27;../utils/window-sync&#x27; // å¼•å…¥å·¥å…·</span><br><span class="line"></span><br><span class="line">// ... </span><br><span class="line"></span><br><span class="line">const performPopout = async () =&gt; &#123;</span><br><span class="line">  const panelId = props.params.api.id</span><br><span class="line">  const title = props.params.api.title</span><br><span class="line"></span><br><span class="line">  // 1. å‡†å¤‡å¤§å¯¹è±¡æ•°æ®</span><br><span class="line">  const bigData = &#123;</span><br><span class="line">    panelId,</span><br><span class="line">    title,</span><br><span class="line">    userInfo: &#123; name: &#x27;Admin&#x27;, role: &#x27;SuperUser&#x27; &#125;,</span><br><span class="line">    heavyList: Array.from(&#123; length: 1000 &#125;, (_, i) =&gt; i)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 2. æ‰“å¼€çª—å£ (åªä¼ åŸºæœ¬ ID)</span><br><span class="line">  const url = `?popout=true&amp;panelId=$&#123;panelId&#125;&amp;title=$&#123;encodeURIComponent(title)&#125;`</span><br><span class="line">  window.open(url, &#x27;_blank&#x27;)</span><br><span class="line"></span><br><span class="line">  // 3. å…³é—­å½“å‰é¢æ¿ (UIä¸Šç«‹å³å“åº”)</span><br><span class="line">  props.params.api.group.api.closePanel(props.params.api.panel)</span><br><span class="line"></span><br><span class="line">  // 4. ã€å…³é”®ã€‘è°ƒç”¨å°è£…å¥½çš„å‘é€æ–¹æ³•</span><br><span class="line">  // ä¸ç”¨ç®¡ä»€ä¹ˆ addEventListenerï¼Œä¸€è¡Œä»£ç æå®š</span><br><span class="line">  try &#123;</span><br><span class="line">    await sendToChild(&#x27;dockview-popout&#x27;, panelId, bigData)</span><br><span class="line">    console.log(&#x27;âœ… æ•°æ®å‘é€æˆåŠŸï¼&#x27;)</span><br><span class="line">  &#125; catch (err) &#123;</span><br><span class="line">    console.error(&#x27;âŒ å‘é€å¤±è´¥ (å¯èƒ½æ˜¯çª—å£è¢«æ‹¦æˆªæˆ–å…³é—­äº†):&#x27;, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="3-åœ¨å­çª—å£ä¸­ä½¿ç”¨-App-vue"><a href="#3-åœ¨å­çª—å£ä¸­ä½¿ç”¨-App-vue" class="headerlink" title="3. åœ¨å­çª—å£ä¸­ä½¿ç”¨ (App.vue)"></a>3. åœ¨å­çª—å£ä¸­ä½¿ç”¨ (<code>App.vue</code>)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; receiveFromParent &#125; from &#x27;./utils/window-sync&#x27; // å¼•å…¥å·¥å…·</span><br><span class="line"></span><br><span class="line">const onReady = async (event: DockviewReadyEvent) =&gt; &#123;</span><br><span class="line">  const api = event.api</span><br><span class="line">  const urlParams = new URLSearchParams(window.location.search)</span><br><span class="line">  const isPopout = urlParams.get(&#x27;popout&#x27;) === &#x27;true&#x27;</span><br><span class="line">  const myPanelId = urlParams.get(&#x27;panelId&#x27;)</span><br><span class="line"></span><br><span class="line">  if (isPopout &amp;&amp; myPanelId) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      // 1. ã€å…³é”®ã€‘è°ƒç”¨å°è£…å¥½çš„æ¥æ”¶æ–¹æ³•</span><br><span class="line">      // è¿™é‡Œæ”¯æŒæ³›å‹ï¼Œä¼šæœ‰ä»£ç æç¤º</span><br><span class="line">      const data = await receiveFromParent&lt;any&gt;(&#x27;dockview-popout&#x27;, myPanelId)</span><br><span class="line">      </span><br><span class="line">      console.log(&#x27;ğŸ‘¶ æ”¶åˆ°çˆ¶çª—å£æŠ•å–‚:&#x27;, data)</span><br><span class="line"></span><br><span class="line">      // 2. åˆ›å»ºé¢æ¿</span><br><span class="line">      api.addPanel(&#123;</span><br><span class="line">        id: myPanelId,</span><br><span class="line">        component: &#x27;default&#x27;,</span><br><span class="line">        tabComponent: &#x27;myTab&#x27;,</span><br><span class="line">        params: &#123; </span><br><span class="line">          title: data.title,</span><br><span class="line">          extra: data.userInfo // ä½¿ç”¨æ¥æ”¶åˆ°çš„æ•°æ®</span><br><span class="line">        &#125;,</span><br><span class="line">        title: data.title</span><br><span class="line">      &#125;)</span><br><span class="line">      </span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">      console.error(&#x27;âŒ è·å–æ•°æ®å¤±è´¥:&#x27;, err)</span><br><span class="line">      // é™çº§å¤„ç†ï¼šæ¯”å¦‚æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯æç¤ºæˆ–è€…é»˜è®¤ç©ºé¢æ¿</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // ä¸»çª—å£é€»è¾‘...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="å°è£…åçš„ä¼˜åŠ¿"><a href="#å°è£…åçš„ä¼˜åŠ¿" class="headerlink" title="å°è£…åçš„ä¼˜åŠ¿"></a>å°è£…åçš„ä¼˜åŠ¿</h3><ol><li><strong>ä»£ç è§£è€¦</strong>ï¼šä¸šåŠ¡ç»„ä»¶ä¸éœ€è¦å…³å¿ƒ <code>BroadcastChannel</code> çš„åˆ›å»ºã€é”€æ¯ã€äº‹ä»¶ç›‘å¬é€»è¾‘ã€‚</li><li><strong>èµ„æºè‡ªåŠ¨å›æ”¶</strong>ï¼šå°è£…å†…è‡ªåŠ¨è°ƒç”¨äº† <code>channel.close()</code>ï¼Œé˜²æ­¢å¼€å‘è€…å¿˜è®°å…³é—­å¯¼è‡´å†…å­˜æ³„æ¼ã€‚</li><li><strong>å¥å£®æ€§</strong>ï¼šå¢åŠ äº† <code>timeout</code> è¶…æ—¶å¤„ç†ã€‚å¦‚æœæ–°çª—å£è¢«æµè§ˆå™¨æ‹¦æˆªäº†ï¼Œæˆ–è€…åŠ è½½å¤±è´¥äº†ï¼Œçˆ¶çª—å£çš„ <code>await</code> ä¸ä¼šä¸€ç›´å¡æ­»ã€‚</li><li><strong>ç±»å‹å®‰å…¨</strong>ï¼šæ”¯æŒ TypeScript æ³›å‹ï¼Œæ¥æ”¶åˆ°çš„ data ç›´æ¥æœ‰ç±»å‹æç¤ºã€‚</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;BroadcastChannel-æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°&quot;&gt;&lt;a href=&quot;#BroadcastChannel-æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°&quot; class=&quot;headerlink&quot; title=&quot;BroadcastChannel æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°&quot;&gt;&lt;/a&gt;Broadcas</summary>
      
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>å•ä¾‹ Tab ç­–ç•¥â€ (Singleton Tab Strategy)</title>
    <link href="http://blog.ypintao.com/2025/12/14/%E5%89%8D%E7%AB%AF/electron/%E5%8D%95%E4%BE%8B%20Tab%20%E7%AD%96%E7%95%A5/"/>
    <id>http://blog.ypintao.com/2025/12/14/%E5%89%8D%E7%AB%AF/electron/%E5%8D%95%E4%BE%8B%20Tab%20%E7%AD%96%E7%95%A5/</id>
    <published>2025-12-14T09:24:15.644Z</published>
    <updated>2025-12-14T12:24:58.940Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å•ä¾‹-Tab-ç­–ç•¥â€-Singleton-Tab-Strategy"><a href="#å•ä¾‹-Tab-ç­–ç•¥â€-Singleton-Tab-Strategy" class="headerlink" title="å•ä¾‹ Tab ç­–ç•¥â€ (Singleton Tab Strategy)"></a>å•ä¾‹ Tab ç­–ç•¥â€ (Singleton Tab Strategy)</h1><p>æ ¸å¿ƒé€»è¾‘å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š<strong>â€œå…ˆé—®ä¸€åœˆï¼Œæœ‰äººæœ‰å—ï¼Ÿæœ‰å°±è®©ä»–å¼¹å‡ºæ¥ï¼Œæ²¡äººæœ‰æˆ‘å°±è‡ªå·±é€ ã€‚â€</strong></p><p>æˆ‘ä»¬éœ€è¦è§£å†³ä¸‰ä¸ªæŠ€æœ¯ç‚¹ï¼š</p><ol><li><strong>å…¨å±€æŸ¥è¯¢</strong>ï¼šåˆ©ç”¨ <code>BroadcastChannel</code> è¯¢é—®æ‰€æœ‰çª—å£ï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰ã€‚</li><li><strong>çª—å£æ¿€æ´»</strong>ï¼šå¦‚æœåˆ«çš„çª—å£æœ‰ï¼Œé‚£ä¸ªçª—å£éœ€è¦æŠŠè‡ªå·±ç½®é¡¶ï¼ˆFocusï¼‰ã€‚</li><li><strong>Tab æ¿€æ´»</strong>ï¼šé‚£ä¸ªçª—å£éœ€è¦æŠŠå¯¹åº”çš„ Tab è®¾ä¸ºå½“å‰æ´»åŠ¨ Tabã€‚</li></ol><p>ä¸‹é¢æ˜¯ç³»ç»Ÿæ€§çš„å®ç°æ–¹æ¡ˆã€‚</p><hr><h3 id="ç¬¬ä¸€æ­¥ï¼šä¸»è¿›ç¨‹æ”¯æŒâ€œçª—å£æ¿€æ´»â€-src-main-ipc-window-ipc-ts"><a href="#ç¬¬ä¸€æ­¥ï¼šä¸»è¿›ç¨‹æ”¯æŒâ€œçª—å£æ¿€æ´»â€-src-main-ipc-window-ipc-ts" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šä¸»è¿›ç¨‹æ”¯æŒâ€œçª—å£æ¿€æ´»â€ (src/main/ipc/window-ipc.ts)"></a>ç¬¬ä¸€æ­¥ï¼šä¸»è¿›ç¨‹æ”¯æŒâ€œçª—å£æ¿€æ´»â€ (<code>src/main/ipc/window-ipc.ts</code>)</h3><p>å‰ç«¯æ¸²æŸ“è¿›ç¨‹ä¸èƒ½ç›´æ¥å¼ºåˆ¶æ“ä½œç³»ç»ŸæŠŠçª—å£ç½®é¡¶ï¼Œè¿™å¿…é¡»ç”±ä¸»è¿›ç¨‹ï¼ˆMain Processï¼‰æ¥åšã€‚</p><p>ä¿®æ”¹ <code>src/main/ipc/window-ipc.ts</code>ï¼Œå¢åŠ ä¸€ä¸ªè®©çª—å£â€œæ¿€æ´»è‡ªå·±â€çš„ IPC æ¥å£ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main/ipc/window-ipc.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; ipcMain, <span class="title class_">BrowserWindow</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupWindowIPC</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ... ä¹‹å‰çš„ check-cursor-outside-window ä»£ç  ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// âœ… æ–°å¢ï¼šæ¿€æ´»ï¼ˆç½®é¡¶/èšç„¦ï¼‰å‘é€è¯·æ±‚çš„é‚£ä¸ªçª—å£</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;activate-current-window&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°è§¦å‘äº‹ä»¶çš„çª—å£</span></span><br><span class="line">    <span class="keyword">const</span> win = <span class="title class_">BrowserWindow</span>.<span class="title function_">fromWebContents</span>(event.<span class="property">sender</span>)</span><br><span class="line">    <span class="keyword">if</span> (win) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæœ€å°åŒ–äº†ï¼Œå…ˆè¿˜åŸ</span></span><br><span class="line">      <span class="keyword">if</span> (win.<span class="title function_">isMinimized</span>()) win.<span class="title function_">restore</span>()</span><br><span class="line">      <span class="comment">// èšç„¦çª—å£ (Windows/Mac/Linux é€šç”¨)</span></span><br><span class="line">      win.<span class="title function_">show</span>()</span><br><span class="line">      win.<span class="title function_">focus</span>()</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>(åˆ«å¿˜äº†åœ¨ <code>src/preload/index.ts</code> é‡ŒæŠŠè¿™ä¸ªæ–¹æ³•æš´éœ²ç»™å‰ç«¯ï¼Œç±»ä¼¼äºä¹‹å‰çš„ <code>checkCursorOutside</code>)</em></p><hr><h3 id="ç¬¬äºŒæ­¥ï¼šå°è£…â€œTab-æŸ¥è¯¢å·¥å…·â€-src-utils-tab-manager-ts"><a href="#ç¬¬äºŒæ­¥ï¼šå°è£…â€œTab-æŸ¥è¯¢å·¥å…·â€-src-utils-tab-manager-ts" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå°è£…â€œTab æŸ¥è¯¢å·¥å…·â€ (src/utils/tab-manager.ts)"></a>ç¬¬äºŒæ­¥ï¼šå°è£…â€œTab æŸ¥è¯¢å·¥å…·â€ (<code>src/utils/tab-manager.ts</code>)</h3><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œåˆ©ç”¨ <code>BroadcastChannel</code> å‘å‡ºè¯¢é—®ï¼Œå¹¶ç­‰å¾…å›å¤ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/utils/tab-manager.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TAB_CHANNEL_NAME</span> = <span class="string">&#x27;dockview-tab-manager&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TabMessage</span> &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;CHECK_TAB_EXIST&#x27;</span> | <span class="string">&#x27;TAB_FOUND&#x27;</span></span><br><span class="line">  <span class="attr">tabId</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°è¯•æŸ¥æ‰¾å¹¶æ¿€æ´»å·²å­˜åœ¨çš„ Tab</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tabId è¦æŸ¥æ‰¾çš„ Tab ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> Promise&lt;boolean&gt; true è¡¨ç¤ºæ‰¾åˆ°äº†å¹¶å·²æ¿€æ´»ï¼Œfalse è¡¨ç¤ºæ²¡æ‰¾åˆ°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">findAndActivateTab</span>(<span class="params"><span class="attr">tabId</span>: <span class="built_in">string</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="variable constant_">TAB_CHANNEL_NAME</span>)</span><br><span class="line">    <span class="keyword">let</span> isFound = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. ç›‘å¬å›å¤</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params"><span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">TabMessage</span>&gt;</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (event.<span class="property">data</span>.<span class="property">type</span> === <span class="string">&#x27;TAB_FOUND&#x27;</span> &amp;&amp; event.<span class="property">data</span>.<span class="property">tabId</span> === tabId) &#123;</span><br><span class="line">        isFound = <span class="literal">true</span></span><br><span class="line">        <span class="title function_">cleanup</span>()</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">true</span>) <span class="comment">// æ‰¾åˆ°äº†ï¼</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">cleanup</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      channel.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;message&#x27;</span>, handler)</span><br><span class="line">      channel.<span class="title function_">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    channel.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, handler)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. å‘å‡ºè¯¢é—®å¹¿æ’­</span></span><br><span class="line">    <span class="comment">// &quot;å˜¿ï¼å¤§å®¶æ³¨æ„ï¼Œæœ‰äººæœ‰ç‚¹åè¦æ‰¾ [tabId]ï¼Œæœ‰çš„è¯·å±ä¸€å£°å¹¶è·³å‡ºæ¥ï¼&quot;</span></span><br><span class="line">    channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;CHECK_TAB_EXIST&#x27;</span>,</span><br><span class="line">      tabId</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è®¾ç½®è¶…æ—¶</span></span><br><span class="line">    <span class="comment">// å¦‚æœ 200ms å†…æ²¡äººå›å¤ï¼Œå°±è®¤ä¸ºä¸å­˜åœ¨</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isFound) &#123;</span><br><span class="line">        <span class="title function_">cleanup</span>()</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">false</span>) <span class="comment">// æ²¡æ‰¾åˆ°</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">200</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ã€åœ¨ App.vue åˆå§‹åŒ–æ—¶è°ƒç”¨ã€‘</span></span><br><span class="line"><span class="comment"> * æ³¨å†Œç›‘å¬å™¨ï¼šå“åº”åˆ«äººçš„æŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dockAPI Dockview çš„ API å®ä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">registerTabManager</span>(<span class="params"><span class="attr">dockAPI</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="variable constant_">TAB_CHANNEL_NAME</span>)</span><br><span class="line"></span><br><span class="line">  channel.<span class="property">onmessage</span> = <span class="title function_">async</span> (<span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">TabMessage</span>&gt;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="property">data</span>.<span class="property">type</span> === <span class="string">&#x27;CHECK_TAB_EXIST&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> targetId = event.<span class="property">data</span>.<span class="property">tabId</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 1. æ£€æŸ¥æˆ‘è¿™ä¸ªçª—å£æœ‰æ²¡æœ‰è¿™ä¸ª Tab</span></span><br><span class="line">      <span class="keyword">const</span> panel = dockAPI.<span class="title function_">getPanel</span>(targetId)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (panel) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸ™‹â€â™‚ï¸ æˆ‘è¿™é‡Œæœ‰ Tab [<span class="subst">$&#123;targetId&#125;</span>]ï¼Œæ­£åœ¨æ¿€æ´»...`</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. å‘Šè¯‰å‘èµ·è€…ï¼šæˆ‘æ‰¾åˆ°äº†ï¼</span></span><br><span class="line">        channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;TAB_FOUND&#x27;</span>,</span><br><span class="line">          <span class="attr">tabId</span>: targetId</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. æ¿€æ´» Dockview é‡Œçš„ Tab (è®©å®ƒæ˜¾ç¤ºå‡ºæ¥)</span></span><br><span class="line">        panel.<span class="property">api</span>.<span class="title function_">setActive</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. è°ƒç”¨ä¸»è¿›ç¨‹ï¼šæŠŠè‡ªå·±è¿™ä¸ªçª—å£ç½®é¡¶</span></span><br><span class="line">        <span class="comment">// å‡è®¾ä½ åœ¨ preload é‡Œæš´éœ²äº† activateWindow</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">electronAPI</span> &amp;&amp; (<span class="variable language_">window</span>.<span class="property">electronAPI</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="property">activateWindow</span>) &#123;</span><br><span class="line">           <span class="title function_">await</span> (<span class="variable language_">window</span>.<span class="property">electronAPI</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="title function_">activateWindow</span>()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="comment">// å…¼å®¹å†™æ³•ï¼Œå¦‚æœ preload æ²¡é…å¥½ï¼Œç”¨ window.focus è¯•è¯• (æœ‰æ—¶å€™ä¼šè¢«æµè§ˆå™¨æ‹¦æˆª)</span></span><br><span class="line">           <span class="variable language_">window</span>.<span class="title function_">focus</span>() </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›æ¸…ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> channel.<span class="title function_">close</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ç¬¬ä¸‰æ­¥ï¼šPreload-è¡¥å……-src-preload-index-ts"><a href="#ç¬¬ä¸‰æ­¥ï¼šPreload-è¡¥å……-src-preload-index-ts" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šPreload è¡¥å…… (src/preload/index.ts)"></a>ç¬¬ä¸‰æ­¥ï¼šPreload è¡¥å…… (<code>src/preload/index.ts</code>)</h3><p>ä¸ºäº†è®© <code>activateWindow</code> ç”Ÿæ•ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ preload é‡Œè¡¥ä¸Šè¿™ä¸ª APIã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/preload/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; contextBridge, ipcRenderer &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api = &#123;</span><br><span class="line">  <span class="attr">checkCursorOutside</span>: <span class="function">() =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;check-cursor-outside-window&#x27;</span>),</span><br><span class="line">  <span class="comment">// âœ… æ–°å¢ï¼šè¯·æ±‚ä¸»è¿›ç¨‹æ¿€æ´»å½“å‰çª—å£</span></span><br><span class="line">  <span class="attr">activateWindow</span>: <span class="function">() =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;activate-current-window&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... exposeInMainWorld é€»è¾‘åŒå‰ ...</span></span><br></pre></td></tr></table></figure><p><em>(è®°å¾—æ›´æ–° <code>src/env.d.ts</code> æˆ– <code>window</code> ç±»å‹å®šä¹‰ï¼ŒåŠ ä¸Š <code>activateWindow</code>)</em></p><hr><h3 id="ç¬¬å››æ­¥ï¼šåœ¨-App-vue-æ³¨å†Œç›‘å¬-src-App-vue"><a href="#ç¬¬å››æ­¥ï¼šåœ¨-App-vue-æ³¨å†Œç›‘å¬-src-App-vue" class="headerlink" title="ç¬¬å››æ­¥ï¼šåœ¨ App.vue æ³¨å†Œç›‘å¬ (src/App.vue)"></a>ç¬¬å››æ­¥ï¼šåœ¨ App.vue æ³¨å†Œç›‘å¬ (<code>src/App.vue</code>)</h3><p>æ‰€æœ‰çª—å£ï¼ˆä¸»çª—å£å’Œå­çª—å£ï¼‰éƒ½è¿è¡Œ <code>App.vue</code>ï¼Œæ‰€ä»¥å®ƒä»¬éƒ½éœ€è¦â€œç›‘å¬åˆ«äººçš„æŸ¥è¯¢â€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- src/App.vue --&gt;</span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; onUnmounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; registerTabManager &#125; from &#x27;./utils/tab-manager&#x27; // å¼•å…¥åˆšæ‰å†™çš„å·¥å…·</span><br><span class="line"></span><br><span class="line">// ... ä½ çš„å…¶ä»–ä»£ç  ...</span><br><span class="line"></span><br><span class="line">let cleanupTabManager: Function | null = null</span><br><span class="line"></span><br><span class="line">const onReady = (event: DockviewReadyEvent) =&gt; &#123;</span><br><span class="line">  const api = event.api</span><br><span class="line">  </span><br><span class="line">  // âœ… 1. æ³¨å†Œå…¨å±€ Tab ç®¡ç†å™¨</span><br><span class="line">  // ä¸€æ—¦ dockview å‡†å¤‡å¥½ï¼Œæˆ‘å°±å¼€å§‹ç›‘å¬ &quot;æœ‰æ²¡æœ‰äººæ‰¾ Tab&quot;</span><br><span class="line">  cleanupTabManager = registerTabManager(api)</span><br><span class="line"></span><br><span class="line">  // ... åŸæœ‰çš„é€»è¾‘ ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onUnmounted(() =&gt; &#123;</span><br><span class="line">  // é”€æ¯æ—¶æ¸…ç†ç›‘å¬</span><br><span class="line">  if (cleanupTabManager) cleanupTabManager()</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="ç¬¬äº”æ­¥ï¼šä½¿ç”¨åŠŸèƒ½-åœ¨åˆ›å»º-Tab-çš„åœ°æ–¹"><a href="#ç¬¬äº”æ­¥ï¼šä½¿ç”¨åŠŸèƒ½-åœ¨åˆ›å»º-Tab-çš„åœ°æ–¹" class="headerlink" title="ç¬¬äº”æ­¥ï¼šä½¿ç”¨åŠŸèƒ½ (åœ¨åˆ›å»º Tab çš„åœ°æ–¹)"></a>ç¬¬äº”æ­¥ï¼šä½¿ç”¨åŠŸèƒ½ (åœ¨åˆ›å»º Tab çš„åœ°æ–¹)</h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªä¾§è¾¹æ èœå•æˆ–è€…æŒ‰é’®ç”¨æ¥æ‰“å¼€ Tabï¼Œç°åœ¨æŠŠ <code>dockAPI.addPanel</code> æ›¿æ¢ä¸ºä¸‹é¢çš„é€»è¾‘ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- å‡è®¾è¿™æ˜¯ä½ çš„ Sidebar.vue æˆ–è€…æŸä¸ªä¸šåŠ¡ç»„ä»¶ --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button @click=&quot;openSettings&quot;&gt;æ‰“å¼€è®¾ç½® (å”¯ä¸€)&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; findAndActivateTab &#125; from &#x27;../utils/tab-manager&#x27;</span><br><span class="line"></span><br><span class="line">// å‡è®¾ä½ èƒ½è·å–åˆ° dockAPI (é€šè¿‡ Provide/Inject æˆ–è€… Store)</span><br><span class="line">// å¦‚æœæ˜¯åœ¨ App.vue å†…éƒ¨ç›´æ¥è°ƒç”¨å°±æ›´ç®€å•äº†</span><br><span class="line">const props = defineProps&lt;&#123; dockAPI: any &#125;&gt;() </span><br><span class="line"></span><br><span class="line">const openSettings = async () =&gt; &#123;</span><br><span class="line">  const tabId = &#x27;settings_panel&#x27;</span><br><span class="line">  const tabTitle = &#x27;è®¾ç½®ä¸­å¿ƒ&#x27;</span><br><span class="line"></span><br><span class="line">  // 1. âœ¨ æ ¸å¿ƒæ­¥éª¤ï¼šå…ˆé—®ä¸€åœˆ</span><br><span class="line">  const exists = await findAndActivateTab(tabId)</span><br><span class="line"></span><br><span class="line">  if (exists) &#123;</span><br><span class="line">    console.log(&#x27;âœ… Tab å·²å­˜åœ¨äºæŸä¸ªçª—å£ï¼Œå·²è‡ªåŠ¨æ¿€æ´»ï¼Œæ— éœ€åˆ›å»ºã€‚&#x27;)</span><br><span class="line">    return // ç›´æ¥ç»“æŸ</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 2. å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±åœ¨å½“å‰çª—å£åˆ›å»º</span><br><span class="line">  console.log(&#x27;âœ¨ Tab ä¸å­˜åœ¨ï¼Œæ­£åœ¨å½“å‰çª—å£åˆ›å»º...&#x27;)</span><br><span class="line">  props.dockAPI.addPanel(&#123;</span><br><span class="line">    id: tabId,</span><br><span class="line">    component: &#x27;default&#x27;, // æ›¿æ¢ä¸ºä½ çš„ç»„ä»¶å</span><br><span class="line">    tabComponent: &#x27;myTab&#x27;,</span><br><span class="line">    params: &#123; title: tabTitle &#125;,</span><br><span class="line">    title: tabTitle</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="åœºæ™¯æ¼”ç¤º"><a href="#åœºæ™¯æ¼”ç¤º" class="headerlink" title="åœºæ™¯æ¼”ç¤º"></a>åœºæ™¯æ¼”ç¤º</h3><ol><li><p><strong>åœºæ™¯ Aï¼šåŒçª—å£åˆ‡æ¢</strong></p><ul><li><strong>ç°çŠ¶</strong>ï¼šä¸»çª—å£æœ‰â€œè®¾ç½®â€Tabï¼Œä½†è¢«â€œé¦–é¡µâ€Tab æŒ¡ä½äº†ã€‚</li><li><strong>æ“ä½œ</strong>ï¼šç‚¹å‡»â€œæ‰“å¼€è®¾ç½®â€ã€‚</li><li><strong>æµç¨‹</strong>ï¼š<code>findAndActivateTab</code> å¹¿æ’­ -&gt; ä¸»çª—å£æ”¶åˆ° -&gt; å‘ç°è‡ªå·±æœ‰ -&gt; <code>panel.api.setActive()</code> åˆ‡æ¢åˆ°è®¾ç½® Tab -&gt; æ¿€æ´»çª—å£ -&gt; å›å¤ <code>TAB_FOUND</code>ã€‚</li><li><strong>ç»“æœ</strong>ï¼šä¸»çª—å£ç›´æ¥åˆ‡åˆ°äº†è®¾ç½®é¡µã€‚</li></ul></li><li><p><strong>åœºæ™¯ Bï¼šè·¨çª—å£æ¿€æ´»</strong></p><ul><li><strong>ç°çŠ¶</strong>ï¼šä½ æŠŠâ€œè®¾ç½®â€Tab æ‹–æ‹½åˆ°äº†ä¸€ä¸ª<strong>ç‹¬ç«‹çš„æ–°çª—å£</strong>ï¼ˆå­çª—å£ï¼‰ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªå­çª—å£æœ€å°åŒ–äº†ã€‚</li><li><strong>æ“ä½œ</strong>ï¼šåœ¨<strong>ä¸»çª—å£</strong>ç‚¹å‡»â€œæ‰“å¼€è®¾ç½®â€ã€‚</li><li><strong>æµç¨‹</strong>ï¼šä¸»çª—å£å¹¿æ’­ -&gt; å­çª—å£æ”¶åˆ° -&gt; å‘ç°è‡ªå·±æœ‰ -&gt; è°ƒç”¨ <code>ipc: activate-current-window</code> -&gt; <strong>ä¸»è¿›ç¨‹æŠŠå­çª—å£è¿˜åŸå¹¶ç½®é¡¶</strong> -&gt; å­çª—å£å›å¤ <code>TAB_FOUND</code>ã€‚</li><li><strong>ç»“æœ</strong>ï¼šåŸæœ¬æœ€å°åŒ–çš„å­çª—å£å¼¹åˆ°äº†å±å¹•æœ€å‰é¢ï¼Œæ˜¾ç¤ºç€è®¾ç½®é¡µã€‚ä¸»çª—å£ä¸ä¼šåˆ›å»ºé‡å¤çš„ Tabã€‚</li></ul></li><li><p><strong>åœºæ™¯ Cï¼šä¸å­˜åœ¨</strong></p><ul><li><strong>ç°çŠ¶</strong>ï¼šæ‰€æœ‰çª—å£éƒ½å…³é—­äº†â€œè®¾ç½®â€ã€‚</li><li><strong>æ“ä½œ</strong>ï¼šç‚¹å‡»â€œæ‰“å¼€è®¾ç½®â€ã€‚</li><li><strong>æµç¨‹</strong>ï¼šå¹¿æ’­ -&gt; 200ms å†…æ²¡äººå› -&gt; è¿”å› <code>false</code> -&gt; æ‰§è¡Œ <code>addPanel</code>ã€‚</li><li><strong>ç»“æœ</strong>ï¼šåœ¨å½“å‰çª—å£æ–°å¼€ä¸€ä¸ªè®¾ç½® Tabã€‚</li></ul></li></ol><p>è¿™ä¸ªæ–¹æ¡ˆåˆ©ç”¨äº†ä½ ç°æœ‰çš„ <code>BroadcastChannel</code> æ¶æ„ï¼Œéå¸¸è½»é‡ä¸”é«˜æ•ˆã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å•ä¾‹-Tab-ç­–ç•¥â€-Singleton-Tab-Strategy&quot;&gt;&lt;a href=&quot;#å•ä¾‹-Tab-ç­–ç•¥â€-Singleton-Tab-Strategy&quot; class=&quot;headerlink&quot; title=&quot;å•ä¾‹ Tab ç­–ç•¥â€ (Singleton Tab </summary>
      
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>ç›‘å¬çª—å£åˆ›å»ºå®Œæˆ</title>
    <link href="http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/electron/%E7%9B%91%E5%90%AC%E7%AA%97%E5%8F%A3%E5%88%9B%E5%BB%BA%E5%AE%8C%E6%88%90/"/>
    <id>http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/electron/%E7%9B%91%E5%90%AC%E7%AA%97%E5%8F%A3%E5%88%9B%E5%BB%BA%E5%AE%8C%E6%88%90/</id>
    <published>2025-12-13T15:34:12.853Z</published>
    <updated>2025-12-13T15:34:50.035Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main/index.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. ç›‘å¬æ–°çª—å£åˆ›å»ºè¯·æ±‚ (æ‹¦æˆªå±‚)</span></span><br><span class="line">mainWindow.<span class="property">webContents</span>.<span class="title function_">setWindowOpenHandler</span>(<span class="function">(<span class="params">details</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// details.url åŒ…å«äº†æ–°çª—å£çš„ URL</span></span><br><span class="line">  <span class="comment">// details.frameName å¯èƒ½æ˜¯ dockview æŒ‡å®šçš„åå­—</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;âš¡ï¸ æ£€æµ‹åˆ° Tab è¢«æ‹–å‡ºï¼Œæ­£åœ¨è¯·æ±‚åˆ›å»ºçª—å£:&#x27;</span>, details.<span class="property">url</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½ å¯ä»¥åœ¨è¿™é‡Œåˆ¤æ–­ url æ˜¯å¦åŒ…å«ç‰¹å®šçš„ query å‚æ•°ï¼Œæ¥ç¡®å®šè¿™æ˜¯ dockview çš„å¼¹çª—</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123; </span><br><span class="line">    <span class="attr">action</span>: <span class="string">&#x27;allow&#x27;</span>,</span><br><span class="line">    <span class="attr">overrideBrowserWindowOptions</span>: &#123;</span><br><span class="line">      <span class="comment">// åœ¨è¿™é‡Œå¼ºåˆ¶æŒ‡å®šæ–°çª—å£çš„æ ·å¼</span></span><br><span class="line">      <span class="attr">autoHideMenuBar</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">        <span class="attr">preload</span>: <span class="title function_">join</span>(__dirname, <span class="string">&#x27;../preload/index.js&#x27;</span>), <span class="comment">// åˆ«å¿˜äº† preload</span></span><br><span class="line">        <span class="attr">backgroundThrottling</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="comment">// ...å…¶ä»–é…ç½®</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ç›‘å¬çª—å£åˆ›å»ºå®Œæˆ (ç»“æœå±‚)</span></span><br><span class="line">mainWindow.<span class="property">webContents</span>.<span class="title function_">on</span>(<span class="string">&#x27;did-create-window&#x27;</span>, <span class="function">(<span class="params">childWindow, details</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;âœ… æ–°çª—å£å®ä¾‹å·²åˆ›å»º (Tab å¼¹å‡ºæˆåŠŸ)&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¸šåŠ¡åœºæ™¯ï¼šä½ å¯èƒ½æƒ³å‘Šè¯‰ä¸»æ¸²æŸ“è¿›ç¨‹â€œæœ‰ä¸ªå­çª—å£è¯ç”Ÿäº†â€</span></span><br><span class="line">  mainWindow.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&#x27;popout-window-created&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: childWindow.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">title</span>: childWindow.<span class="title function_">getTitle</span>()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸šåŠ¡åœºæ™¯ï¼šç›‘å¬å­çª—å£çš„å…³é—­ï¼Œåšä¸€äº›æ¸…ç†å·¥ä½œ</span></span><br><span class="line">  childWindow.<span class="title function_">on</span>(<span class="string">&#x27;closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;âŒ å­çª—å£å·²å…³é—­&#x27;</span>)</span><br><span class="line">    mainWindow.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&#x27;popout-window-closed&#x27;</span>, &#123; <span class="attr">id</span>: childWindow.<span class="property">id</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;

&lt;figure class=&quot;highlight typescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=</summary>
      
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>ä¸Šä¼ åˆ°npmä»“åº“</title>
    <link href="http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/electron/%E5%A6%82%E4%BD%95%E5%B0%86%E9%A1%B9%E7%9B%AE%E6%8F%92%E4%BB%B6%E4%BC%A0%E5%88%B0npm%E4%BB%93%E5%BA%93/"/>
    <id>http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/electron/%E5%A6%82%E4%BD%95%E5%B0%86%E9%A1%B9%E7%9B%AE%E6%8F%92%E4%BB%B6%E4%BC%A0%E5%88%B0npm%E4%BB%93%E5%BA%93/</id>
    <published>2025-12-13T14:05:39.322Z</published>
    <updated>2025-12-13T14:10:38.828Z</updated>
    
    <content type="html"><![CDATA[<p>å‘å¸ƒ npm åŒ…ä¸ä»…ä»…æ˜¯æŠŠä»£ç æ”¾ä¸Šå»ï¼Œè¿˜éœ€è¦è€ƒè™‘ <strong>æ„å»ºè§„èŒƒ (ESM&#x2F;CJS)</strong>ã€<strong>ç±»å‹å®šä¹‰ (TypeScript .d.ts)</strong>ã€<strong>Peer Dependencies</strong> ä»¥åŠ <strong>æ‰©å±•æ€§</strong>ã€‚</p><p>æ—¢ç„¶æˆ‘ä»¬è¦æŠŠå®ƒåšæˆä¸€ä¸ªé€šç”¨çš„ <code>pinia-plugin-electron-share</code>ï¼Œæˆ‘ä»¬éœ€è¦è®©å®ƒæ”¯æŒé…ç½®ï¼ˆæ¯”å¦‚è‡ªå®šä¹‰ Channel åç§°ï¼‰ï¼Œå¹¶ä¸”å…·å¤‡å®Œå–„çš„å·¥ç¨‹åŒ–ç»“æ„ã€‚</p><p>è¿™é‡Œæ˜¯<strong>å¯ä»¥ç›´æ¥ <code>npm publish</code> çš„å®Œæ•´å·¥ç¨‹ä»£ç ç»“æ„</strong>ã€‚</p><hr><h3 id="1-é¡¹ç›®ç›®å½•ç»“æ„"><a href="#1-é¡¹ç›®ç›®å½•ç»“æ„" class="headerlink" title="1. é¡¹ç›®ç›®å½•ç»“æ„"></a>1. é¡¹ç›®ç›®å½•ç»“æ„</h3><p>ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼ˆä¾‹å¦‚ <code>pinia-plugin-electron-share</code>ï¼‰ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pinia-plugin-electron-share/</span><br><span class="line">â”œâ”€â”€ src/</span><br><span class="line">â”‚   â””â”€â”€ index.ts        # æ ¸å¿ƒæºç </span><br><span class="line">â”œâ”€â”€ dist/               # æ„å»ºäº§ç‰© (è‡ªåŠ¨ç”Ÿæˆ)</span><br><span class="line">â”œâ”€â”€ package.json        # ä¾èµ–ä¸å…ƒæ•°æ®</span><br><span class="line">â”œâ”€â”€ tsconfig.json       # TS é…ç½®</span><br><span class="line">â”œâ”€â”€ vite.config.ts      # æ„å»ºè„šæœ¬ (ä½¿ç”¨ Vite åº“æ¨¡å¼)</span><br><span class="line">â””â”€â”€ README.md           # è¯´æ˜æ–‡æ¡£</span><br></pre></td></tr></table></figure><hr><h3 id="2-æ ¸å¿ƒä»£ç -src-index-ts"><a href="#2-æ ¸å¿ƒä»£ç -src-index-ts" class="headerlink" title="2. æ ¸å¿ƒä»£ç  (src/index.ts)"></a>2. æ ¸å¿ƒä»£ç  (<code>src/index.ts</code>)</h3><p>è¿™é‡Œæˆ‘åšäº†ä¸€äº›å¢å¼ºï¼š</p><ol><li><strong>æ”¯æŒæ’ä»¶çº§é…ç½®</strong>ï¼šå¯ä»¥åœ¨ <code>pinia.use()</code> æ—¶ä¼ å…¥å…¨å±€é…ç½®ã€‚</li><li><strong>ç±»å‹å£°æ˜å¢å¼º</strong>ï¼šå®Œç¾çš„ TypeScript ç±»å‹æç¤ºã€‚</li><li><strong>åºåˆ—åŒ–ä¿æŠ¤</strong>ï¼šå¢åŠ äº†å¯¹åºåˆ—åŒ–å¼‚å¸¸çš„åŸºç¡€æ•è·ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PiniaPluginContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. æ‰©å±• Pinia ç±»å‹å®šä¹‰</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;pinia&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DefineStoreOptionsBase</span>&lt;S, <span class="title class_">Store</span>&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Enable state synchronization across Electron windows.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@default</span> <span class="variable">false</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">share</span>?: <span class="built_in">boolean</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ’ä»¶é…ç½®æ¥å£</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ElectronShareOptions</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Custom name for BroadcastChannel.</span></span><br><span class="line"><span class="comment">   * Useful if you have multiple apps running on the same domain/protocol.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@default</span> &#x27;pinia-electron-share&#x27;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">channelName</span>?: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ¶ˆæ¯è½½è·å®šä¹‰</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">SyncPayload</span> = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;UPDATE&#x27;</span> | <span class="string">&#x27;REQUEST_INIT&#x27;</span> | <span class="string">&#x27;RESPONSE_INIT&#x27;</span></span><br><span class="line">  <span class="attr">storeId</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line">  <span class="attr">timestamp</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. æ’ä»¶ä¸»å‡½æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createElectronSharePlugin</span>(<span class="params"><span class="attr">globalOptions</span>: <span class="title class_">ElectronShareOptions</span> = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">CHANNEL_NAME</span> = globalOptions.<span class="property">channelName</span> || <span class="string">&#x27;pinia-electron-share&#x27;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºé¢‘é“ (ç”±äºæ˜¯å¹¿æ’­ï¼Œå¯ä»¥åœ¨æ’ä»¶å±‚çº§å¤ç”¨ä¸€ä¸ªå®ä¾‹ï¼Œä¹Ÿå¯ä»¥åœ¨ Store çº§åˆ›å»ºï¼Œè¿™é‡Œä¸ºäº†ç®€å•å’Œæ€§èƒ½å¤ç”¨ä¸€ä¸ª)</span></span><br><span class="line">  <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="variable constant_">CHANNEL_NAME</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">&#123; store, options &#125;: <span class="title class_">PiniaPluginContext</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœ Store æ²¡æœ‰å¼€å¯ shareï¼Œç›´æ¥è·³è¿‡</span></span><br><span class="line">    <span class="keyword">if</span> (!options.<span class="property">share</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> isExternalUpdate = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- æ¶ˆæ¯æ¥æ”¶é€»è¾‘ ---</span></span><br><span class="line">    channel.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">SyncPayload</span>&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="keyword">type</span>, storeId, data &#125; = event.<span class="property">data</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¿½ç•¥ä¸å±äºå½“å‰ Store çš„æ¶ˆæ¯</span></span><br><span class="line">      <span class="keyword">if</span> (storeId !== store.<span class="property">$id</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">switch</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;UPDATE&#x27;</span>:</span><br><span class="line">          <span class="keyword">if</span> (!isExternalUpdate) &#123;</span><br><span class="line">            isExternalUpdate = <span class="literal">true</span></span><br><span class="line">            store.$patch(data)</span><br><span class="line">            <span class="comment">// å®ä»»åŠ¡å»¶è¿Ÿé‡Šæ”¾é”ï¼Œç¡®ä¿ Vue å“åº”å¼é˜Ÿåˆ—æ¸…ç©º</span></span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; isExternalUpdate = <span class="literal">false</span> &#125;, <span class="number">0</span>)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;REQUEST_INIT&#x27;</span>:</span><br><span class="line">          <span class="comment">// æ”¶åˆ°æ–°çª—å£çš„è¯·æ±‚ï¼Œå‘é€å½“å‰çŠ¶æ€</span></span><br><span class="line">          channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;RESPONSE_INIT&#x27;</span>,</span><br><span class="line">            <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(store.<span class="property">$state</span>)),</span><br><span class="line">            <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;RESPONSE_INIT&#x27;</span>:</span><br><span class="line">          <span class="comment">// æ”¶åˆ°åˆå§‹åŒ–æ•°æ®ï¼Œåº”ç”¨åˆ°å½“å‰ Store</span></span><br><span class="line">          isExternalUpdate = <span class="literal">true</span></span><br><span class="line">          store.$patch(data)</span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; isExternalUpdate = <span class="literal">false</span> &#125;, <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- çŠ¶æ€å˜æ›´ç›‘å¬ ---</span></span><br><span class="line">    store.$subscribe(<span class="function">(<span class="params">mutation, state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isExternalUpdate) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> rawState = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(state))</span><br><span class="line">        </span><br><span class="line">        channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;UPDATE&#x27;</span>,</span><br><span class="line">          <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">          <span class="attr">data</span>: rawState,</span><br><span class="line">          <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[pinia-plugin-electron-share] Failed to serialize state for store &quot;<span class="subst">$&#123;store.$id&#125;</span>&quot;. Ensure state is JSON-serializable.`</span>, e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- åˆå§‹åŒ–æ¡æ‰‹ ---</span></span><br><span class="line">    <span class="comment">// å»¶è¿ŸæçŸ­æ—¶é—´å‘é€è¯·æ±‚ï¼Œç¡®ä¿ç›‘å¬å™¨å·²æŒ‚è½½</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;REQUEST_INIT&#x27;</span>,</span><br><span class="line">        <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">50</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="3-æ„å»ºé…ç½®-vite-config-ts"><a href="#3-æ„å»ºé…ç½®-vite-config-ts" class="headerlink" title="3. æ„å»ºé…ç½® (vite.config.ts)"></a>3. æ„å»ºé…ç½® (<code>vite.config.ts</code>)</h3><p>ä½¿ç”¨ Vite çš„åº“æ¨¡å¼ï¼ˆLibrary Modeï¼‰æ˜¯ç›®å‰æ‰“åŒ…ç°ä»£å‰ç«¯åº“çš„æœ€ä½³å®è·µã€‚æˆ‘ä»¬éœ€è¦åŒæ—¶è¾“å‡º ESM (ç»™ Vite&#x2F;Webpack ç”¨) å’Œ CJS (ç»™æ—§ Node ç¯å¢ƒç”¨ï¼Œè™½ç„¶åè€…åœ¨ Electron å‰ç«¯ä¸å¸¸ç”¨ï¼Œä½†ä¸ºäº†è§„èŒƒè¿˜æ˜¯åŠ ä¸Š)ã€‚</p><p>ä½ éœ€è¦å®‰è£…å¼€å‘ä¾èµ–ï¼š<br><code>npm install -D vite vite-plugin-dts typescript vue pinia</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> dts <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-dts&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// è‡ªåŠ¨ç”Ÿæˆ .d.ts ç±»å‹æ–‡ä»¶</span></span><br><span class="line">    <span class="title function_">dts</span>(&#123; </span><br><span class="line">      <span class="attr">include</span>: [<span class="string">&#x27;src/**/*.ts&#x27;</span>],</span><br><span class="line">      <span class="attr">insertTypesEntry</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">lib</span>: &#123;</span><br><span class="line">      <span class="attr">entry</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/index.ts&#x27;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;PiniaPluginElectronShare&#x27;</span>,</span><br><span class="line">      <span class="attr">fileName</span>: <span class="function">(<span class="params">format</span>) =&gt;</span> <span class="string">`index.<span class="subst">$&#123;format&#125;</span>.js`</span> <span class="comment">// index.es.js, index.umd.js</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">      <span class="comment">// ç¡®ä¿å¤–éƒ¨åŒ–å¤„ç†é‚£äº›ä½ ä¸æƒ³æ‰“åŒ…è¿›åº“çš„ä¾èµ–</span></span><br><span class="line">      <span class="attr">external</span>: [<span class="string">&#x27;pinia&#x27;</span>, <span class="string">&#x27;vue&#x27;</span>],</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="comment">// åœ¨ UMD æ„å»ºæ¨¡å¼ä¸‹ä¸ºè¿™äº›å¤–éƒ¨åŒ–çš„ä¾èµ–æä¾›ä¸€ä¸ªå…¨å±€å˜é‡</span></span><br><span class="line">        <span class="attr">globals</span>: &#123;</span><br><span class="line">          <span class="attr">vue</span>: <span class="string">&#x27;Vue&#x27;</span>,</span><br><span class="line">          <span class="attr">pinia</span>: <span class="string">&#x27;Pinia&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><hr><h3 id="4-package-json-é…ç½®"><a href="#4-package-json-é…ç½®" class="headerlink" title="4. package.json é…ç½®"></a>4. <code>package.json</code> é…ç½®</h3><p>è¿™é‡Œæœ‰å‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ol><li><strong><code>peerDependencies</code></strong>ï¼šæ˜ç¡®å‘Šè¯‰ä½¿ç”¨è€…ï¼Œä½ å¿…é¡»å…ˆå®‰è£… <code>pinia</code>ã€‚</li><li><strong><code>exports</code></strong>ï¼šç°ä»£ npm åŒ…çš„å¯¼å‡ºè§„èŒƒã€‚</li><li><strong><code>types</code></strong>ï¼šæŒ‡å‘ç”Ÿæˆçš„ç±»å‹æ–‡ä»¶ã€‚</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pinia-plugin-electron-share&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Sync Pinia state across Electron windows (Renderer processes) using BroadcastChannel. Ideal for Dockview.&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/index.umd.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/index.es.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/index.d.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;.&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;import&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/index.es.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;require&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/index.umd.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/index.d.ts&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;dist&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build --watch&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;prepublishOnly&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run build&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;pinia&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;electron&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;vue&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;share&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;multi-window&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;dockview&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Your Name&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MIT&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;peerDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pinia&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pinia&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;typescript&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vite-plugin-dts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><hr><h3 id="5-tsconfig-json"><a href="#5-tsconfig-json" class="headerlink" title="5. tsconfig.json"></a>5. <code>tsconfig.json</code></h3><p>ç¡®ä¿èƒ½æ­£ç¡®ç¼–è¯‘ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;useDefineForClassFields&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Node&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DOM&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;declaration&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><hr><h3 id="6-ä½¿ç”¨è¯´æ˜-README-md-ç‰‡æ®µ"><a href="#6-ä½¿ç”¨è¯´æ˜-README-md-ç‰‡æ®µ" class="headerlink" title="6. ä½¿ç”¨è¯´æ˜ (README.md ç‰‡æ®µ)"></a>6. ä½¿ç”¨è¯´æ˜ (<code>README.md</code> ç‰‡æ®µ)</h3><p>ä½ å¯ä»¥ç›´æ¥æŠŠè¿™æ®µè´´åˆ°æ–‡æ¡£é‡Œï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># pinia-plugin-electron-share</span></span><br><span class="line"></span><br><span class="line">Sync Pinia state across multiple Electron windows (Renderer Processes).</span><br><span class="line"></span><br><span class="line"><span class="section">## Installation</span></span><br><span class="line"></span><br><span class="line"><span class="code">```bash</span></span><br><span class="line"><span class="code">npm install pinia-plugin-electron-share</span></span><br></pre></td></tr></table></figure><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><h3 id="1-Register-the-Plugin"><a href="#1-Register-the-Plugin" class="headerlink" title="1. Register the Plugin"></a>1. Register the Plugin</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createElectronSharePlugin &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia-plugin-electron-share&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line"></span><br><span class="line">pinia.<span class="title function_">use</span>(<span class="title function_">createElectronSharePlugin</span>(&#123;</span><br><span class="line">  <span class="comment">// Optional: Custom channel name</span></span><br><span class="line">  <span class="attr">channelName</span>: <span class="string">&#x27;my-app-sync&#x27;</span> </span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pinia</span><br></pre></td></tr></table></figure><h3 id="2-Enable-in-Store"><a href="#2-Enable-in-Store" class="headerlink" title="2. Enable in Store"></a>2. Enable in Store</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/user.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>.<span class="property">count</span>++ &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// Enable sync for this store</span></span><br><span class="line">  <span class="attr">share</span>: <span class="literal">true</span> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">### 7. å‘å¸ƒæµç¨‹</span><br><span class="line"></span><br><span class="line">ä½œä¸ºé«˜çº§å·¥ç¨‹å¸ˆï¼Œä½ åº”è¯¥çŸ¥é“å‘å¸ƒæµç¨‹ï¼Œä½†ä¸ºäº†å®Œæ•´æ€§æˆ‘è¿˜æ˜¯åˆ—ä¸€ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">è¿™é‡Œæé†’ä¸€ä¸‹ npm å®˜ç½‘æ›´æ–°äº†éªŒè¯æœºåˆ¶ï¼Œä½ éœ€è¦å»åœ¨ä½ çš„è´¦æˆ·ä¸‹åˆ›å»ºä¸€ä¸ªaccess tokenï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ `npm login --registry=https://registry.npmjs.org/` ç™»å½•ã€‚</span><br><span class="line"></span><br><span class="line">åœ¨é¡¹ç›®ä¸‹åˆ›å»ºä¸€ä¸ª.npmrc æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</span><br></pre></td></tr></table></figure><p>registry&#x3D;<a href="https://registry.npmjs.com/">https://registry.npmjs.com/</a><br>&#x2F;&#x2F;registry.npmjs.com&#x2F;:_authToken&#x3D;YOUR_ACCESS_TOKEN</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1.  **æ„å»º**ï¼š</span><br><span class="line">    ```bash</span><br><span class="line">    npm run build</span><br></pre></td></tr></table></figure><pre><code>*(ç¡®ä¿ `dist` ç›®å½•ä¸‹ç”Ÿæˆäº† `index.es.js` å’Œ `index.d.ts`)*</code></pre><ol start="2"><li><p><strong>å‘å¸ƒ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm login</span><br><span class="line">npm publish --access public</span><br></pre></td></tr></table></figure></li><li><p><strong>åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨</strong>ï¼š<br>åœ¨ä½ çš„ Electron é¡¹ç›®ä¸­ <code>npm install pinia-plugin-electron-share</code>ï¼Œç„¶åæŒ‰ç…§ README é…ç½®å³å¯ã€‚</p></li></ol><h3 id="ä¸ºä»€ä¹ˆè¿™æ ·åšæ›´å¥½ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¿™æ ·åšæ›´å¥½ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¿™æ ·åšæ›´å¥½ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¿™æ ·åšæ›´å¥½ï¼Ÿ</h3><ol><li><strong>è§£è€¦</strong>ï¼šä½ çš„ä¸šåŠ¡ä»£ç åº“ä¸ä¼šæ··å…¥ä¸€å †å¤æ‚çš„ IPC é€šä¿¡é€»è¾‘ã€‚</li><li><strong>å¤ç”¨</strong>ï¼šå¦‚æœä½ æœ‰ä¸‹ä¸€ä¸ª Electron é¡¹ç›®ï¼Œç›´æ¥ install å³å¯ã€‚</li><li><strong>ç±»å‹å®‰å…¨</strong>ï¼šé€šè¿‡ <code>declare module</code>ï¼Œä½ çš„åŒäº‹åœ¨å†™ <code>defineStore</code> æ—¶ï¼Œè¾“å…¥ <code>share:</code> ä¼šè‡ªåŠ¨è·å¾—ä»£ç æç¤ºï¼Œè¿™æ‰æ˜¯é«˜çº§å¼€å‘ä½“éªŒã€‚</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å‘å¸ƒ npm åŒ…ä¸ä»…ä»…æ˜¯æŠŠä»£ç æ”¾ä¸Šå»ï¼Œè¿˜éœ€è¦è€ƒè™‘ &lt;strong&gt;æ„å»ºè§„èŒƒ (ESM&amp;#x2F;CJS)&lt;/strong&gt;ã€&lt;strong&gt;ç±»å‹å®šä¹‰ (TypeScript .d.ts)&lt;/strong&gt;ã€&lt;strong&gt;Peer Dependencies&lt;/strong&gt;</summary>
      
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>electronå¤šçª—å£çŠ¶æ€åŒæ­¥ æ’ä»¶å¼€å‘pinia-plugin-electron-share</title>
    <link href="http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/electron/%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AApinia%E6%8F%92%E4%BB%B6/"/>
    <id>http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/electron/%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AApinia%E6%8F%92%E4%BB%B6/</id>
    <published>2025-12-13T14:02:22.024Z</published>
    <updated>2025-12-13T14:06:01.569Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è®¾è®¡æ–¹æ¡ˆ"><a href="#è®¾è®¡æ–¹æ¡ˆ" class="headerlink" title="è®¾è®¡æ–¹æ¡ˆ"></a>è®¾è®¡æ–¹æ¡ˆ</h2><ol><li><strong>é›¶ä¸»è¿›ç¨‹ä¾èµ–</strong>ï¼šåŸºäº <code>BroadcastChannel</code>ï¼Œä¸éœ€è¦ä¿®æ”¹ Electron ä¸»è¿›ç¨‹ä»£ç ï¼Œçº¯å‰ç«¯å®ç°ã€‚</li><li><strong>è‡ªåŠ¨æ°´åˆï¼ˆHydrationï¼‰</strong>ï¼šæ–°çª—å£ï¼ˆDockview å¼¹å‡ºçª—ï¼‰æ‰“å¼€æ—¶ï¼Œä¼šè‡ªåŠ¨å‘è€çª—å£â€œè¦â€æ•°æ®ï¼Œè§£å†³åˆå§‹åŒ–ç©ºç™½é—®é¢˜ã€‚</li><li><strong>é˜²æ­»å¾ªç¯</strong>ï¼šå†…ç½®äº’æ–¥é”ï¼Œé˜²æ­¢ A -&gt; B -&gt; A çš„æ— é™æ›´æ–°ã€‚</li><li><strong>æŒ‰éœ€åŒæ­¥</strong>ï¼šä¸æ˜¯æ‰€æœ‰ Store éƒ½ä¼šåŒæ­¥ï¼Œä½ å¯ä»¥åœ¨å®šä¹‰ Store æ—¶é€šè¿‡ <code>share: true</code> å¼€å¯ã€‚</li></ol><span id="more"></span><hr><h3 id="1-æ ¸å¿ƒæ’ä»¶ä»£ç "><a href="#1-æ ¸å¿ƒæ’ä»¶ä»£ç " class="headerlink" title="1. æ ¸å¿ƒæ’ä»¶ä»£ç "></a>1. æ ¸å¿ƒæ’ä»¶ä»£ç </h3><p>è¯·åœ¨é¡¹ç›®ä¸­æ–°å»ºæ–‡ä»¶ <code>src/plugins/pinia-plugin-electron-share.ts</code>ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PiniaPluginContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰©å±• Pinia çš„å®šä¹‰ï¼Œä»¥ä¾¿åœ¨ä½¿ç”¨ defineStore æ—¶æœ‰ä»£ç æç¤º</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;pinia&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DefineStoreOptionsBase</span>&lt;S, <span class="title class_">Store</span>&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦åœ¨ Electron å¤šçª—å£ä¹‹é—´åŒæ­¥è¯¥ Store çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@default</span> <span class="variable">false</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">share</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆæ¯ç±»å‹å®šä¹‰</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">SyncPayload</span> = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;UPDATE&#x27;</span> | <span class="string">&#x27;REQUEST_INIT&#x27;</span> | <span class="string">&#x27;RESPONSE_INIT&#x27;</span>;</span><br><span class="line">  <span class="attr">storeId</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">data</span>?: <span class="built_in">any</span>; <span class="comment">// State object</span></span><br><span class="line">  <span class="attr">timestamp</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢‘é“åç§°</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CHANNEL_NAME</span> = <span class="string">&#x27;electron-pinia-share-channel&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">piniaPluginElectronShare</span>(<span class="params">&#123; store, options &#125;: <span class="title class_">PiniaPluginContext</span></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. æ£€æŸ¥å½“å‰ Store æ˜¯å¦å¼€å¯äº†å…±äº«</span></span><br><span class="line">  <span class="keyword">if</span> (!options.<span class="property">share</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. åˆ›å»ºå¹¿æ’­é¢‘é“ (æ‰€æœ‰çª—å£å…±ç”¨åŒä¸€ä¸ªé¢‘é“å)</span></span><br><span class="line">  <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="variable constant_">CHANNEL_NAME</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å†…éƒ¨çŠ¶æ€é”ï¼šé˜²æ­¢æ­»å¾ªç¯ (æ”¶åˆ°æ¶ˆæ¯æ›´æ–°æ—¶ï¼Œä¸å†å¹¿æ’­å‡ºå»)</span></span><br><span class="line">  <span class="keyword">let</span> isExternalUpdate = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ ¸å¿ƒé€»è¾‘ï¼šå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  channel.<span class="property">onmessage</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">SyncPayload</span>&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="keyword">type</span>, storeId, data, timestamp &#125; = event.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åªå¤„ç†å½“å‰ Store çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">if</span> (storeId !== store.<span class="property">$id</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">      <span class="comment">// åœºæ™¯ A: æ”¶åˆ°å…¶ä»–çª—å£çš„çŠ¶æ€æ›´æ–°</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;UPDATE&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> (!isExternalUpdate) &#123;</span><br><span class="line">          isExternalUpdate = <span class="literal">true</span>;</span><br><span class="line">          store.$patch(data);</span><br><span class="line">          <span class="comment">// è¿™é‡Œç¨å¾®å»¶è¿Ÿä¸€ç‚¹é‡Šæ”¾é”ï¼Œç¡®ä¿ Vue å“åº”å¼ç³»ç»Ÿå¤„ç†å®Œæ¯•</span></span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; isExternalUpdate = <span class="literal">false</span>; &#125;, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åœºæ™¯ B: æ–°çª—å£åˆšæ‰“å¼€ï¼Œè¯·æ±‚åˆå§‹åŒ–æ•°æ® (æˆ‘æ˜¯è€çª—å£ï¼Œæˆ‘æœ‰æ•°æ®)</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;REQUEST_INIT&#x27;</span>:</span><br><span class="line">        <span class="comment">// ä¸ºäº†é¿å…å¤šä¸ªè€çª—å£åŒæ—¶å›å¤ï¼Œè¿™é‡Œå¯ä»¥åšä¸€ä¸ªç®€å•çš„éšæœºå»¶è¿Ÿï¼Œæˆ–è€…ç”±äºæ˜¯æ›¿æ¢æ“ä½œï¼Œå¤šæ¬¡å›å¤ä¹Ÿæ— æ‰€è°“</span></span><br><span class="line">        <span class="comment">// ç›´æ¥å‘é€å½“å‰çŠ¶æ€ç»™æ–°çª—å£</span></span><br><span class="line">        channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;RESPONSE_INIT&#x27;</span>,</span><br><span class="line">          <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">          <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(store.<span class="property">$state</span>)),</span><br><span class="line">          <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åœºæ™¯ C: æˆ‘æ˜¯æ–°çª—å£ï¼Œæ”¶åˆ°äº†åˆå§‹åŒ–æ•°æ®</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;RESPONSE_INIT&#x27;</span>:</span><br><span class="line">        isExternalUpdate = <span class="literal">true</span>;</span><br><span class="line">        store.$patch(data);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; isExternalUpdate = <span class="literal">false</span>; &#125;, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ ¸å¿ƒé€»è¾‘ï¼šç›‘å¬å½“å‰ Store å˜åŒ–å¹¶å¹¿æ’­</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  store.$subscribe(<span class="function">(<span class="params">mutation, state</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯ç”±å¤–éƒ¨æ¶ˆæ¯è§¦å‘çš„æ›´æ–°ï¼Œåˆ™ä¸å¹¿æ’­ï¼Œæ–­ç»æ­»å¾ªç¯</span></span><br><span class="line">    <span class="keyword">if</span> (isExternalUpdate) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ– State (å»é™¤ Vue çš„å“åº”å¼ä»£ç†ï¼Œè½¬ä¸ºçº¯ JSON)</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šå¦‚æœæœ‰ Date/Map/Set éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œè¿™é‡Œå‡è®¾æ˜¯åŸºç¡€ JSON</span></span><br><span class="line">    <span class="keyword">const</span> rawState = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(state));</span><br><span class="line"></span><br><span class="line">    channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;UPDATE&#x27;</span>,</span><br><span class="line">      <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">      <span class="attr">data</span>: rawState,</span><br><span class="line">      <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–é€»è¾‘ï¼š</span></span><br><span class="line"><span class="comment">   * æ’ä»¶åŠ è½½ï¼ˆStore åˆ›å»ºï¼‰æ—¶ï¼Œå¦‚æœæ˜¯æ–°çª—å£ï¼Œå¯èƒ½æ•°æ®æ˜¯ç©ºçš„ã€‚</span></span><br><span class="line"><span class="comment">   * å‘é€ä¸€ä¸ª &quot;REQUEST_INIT&quot; å¹¿æ’­ï¼Œé—®é—®æœ‰æ²¡æœ‰å…¶ä»–çª—å£å­˜æ´»ç€å¹¶æœ‰æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// å»¶æ—¶æçŸ­çš„æ—¶é—´ï¼Œç¡®ä¿ BroadcastChannel å·²ç»å‡†å¤‡å¥½ï¼Œä¸”ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;REQUEST_INIT&#x27;</span>,</span><br><span class="line">      <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">      <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, <span class="number">50</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç»„ä»¶é”€æ¯æ—¶å…³é—­é¢‘é“ (å¯é€‰ï¼ŒPinia Store é€šå¸¸ç”Ÿå‘½å‘¨æœŸä¼´éšæ•´ä¸ªåº”ç”¨ï¼Œä¸å…³ä¹Ÿæ²¡äº‹)</span></span><br><span class="line">  <span class="comment">// return () =&gt; &#123; channel.close(); &#125; </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-åœ¨-Pinia-ä¸­æ³¨å†Œæ’ä»¶"><a href="#2-åœ¨-Pinia-ä¸­æ³¨å†Œæ’ä»¶" class="headerlink" title="2. åœ¨ Pinia ä¸­æ³¨å†Œæ’ä»¶"></a>2. åœ¨ Pinia ä¸­æ³¨å†Œæ’ä»¶</h3><p>ä¿®æ”¹ä½ çš„ <code>src/store/index.ts</code> (æˆ–è€…ä½ åˆ›å»º pinia çš„åœ°æ–¹)ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; piniaPluginElectronShare &#125; <span class="keyword">from</span> <span class="string">&#x27;../plugins/pinia-plugin-electron-share&#x27;</span>; <span class="comment">// å¼•å…¥ä¸Šé¢å†™çš„æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œæ’ä»¶</span></span><br><span class="line">pinia.<span class="title function_">use</span>(piniaPluginElectronShare);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pinia;</span><br></pre></td></tr></table></figure><hr><h3 id="3-å¦‚ä½•åœ¨-Store-ä¸­ä½¿ç”¨"><a href="#3-å¦‚ä½•åœ¨-Store-ä¸­ä½¿ç”¨" class="headerlink" title="3. å¦‚ä½•åœ¨ Store ä¸­ä½¿ç”¨"></a>3. å¦‚ä½•åœ¨ Store ä¸­ä½¿ç”¨</h3><p>è¿™æ­¥æœ€å…³é”®ã€‚ä½ éœ€è¦åœ¨é‚£äº›â€œéœ€è¦åœ¨ Dockview çª—å£é—´åŒæ­¥â€çš„ Store é‡Œï¼ŒåŠ ä¸Š <code>share: true</code>ã€‚</p><p>ä¾‹å¦‚ <code>src/store/modules/user.ts</code>ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">userInfo</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Guest&#x27;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å‡è®¾è¿™æ˜¯ Dockview çš„å¸ƒå±€é…ç½®ï¼Œä¹Ÿéœ€è¦åŒæ­¥</span></span><br><span class="line">    <span class="attr">layoutConfig</span>: &#123;&#125; </span><br><span class="line">  &#125;),</span><br><span class="line">  </span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">updateName</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">userInfo</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¼€å¯å¤šçª—å£åŒæ­¥</span></span><br><span class="line">  <span class="attr">share</span>: <span class="literal">true</span> </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ Setup Store å†™æ³•ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123; count.<span class="property">value</span>++ &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; count, increment &#125;;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="comment">// Setup Store çš„é…ç½®é¡¹åœ¨è¿™é‡Œ</span></span><br><span class="line">  <span class="attr">share</span>: <span class="literal">true</span> </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><h3 id="4-éªŒè¯ä¸è°ƒè¯•æ–¹æ³•"><a href="#4-éªŒè¯ä¸è°ƒè¯•æ–¹æ³•" class="headerlink" title="4. éªŒè¯ä¸è°ƒè¯•æ–¹æ³•"></a>4. éªŒè¯ä¸è°ƒè¯•æ–¹æ³•</h3><p>æˆ‘å»ºè®®ä½ æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤éªŒè¯æ–¹æ¡ˆæ˜¯å¦ç”Ÿæ•ˆï¼š</p><ol><li><strong>å¯åŠ¨åº”ç”¨</strong>ï¼šæ‰“å¼€ä¸»çª—å£ã€‚</li><li><strong>ä¿®æ”¹æ•°æ®</strong>ï¼šåœ¨ä¸»çª—å£ä¿®æ”¹ <code>useUserStore</code> ä¸­çš„æ•°æ®ï¼ˆæ¯”å¦‚ç™»å½•ï¼Œæˆ–è€…æ”¹ä¸ªåå­—ï¼‰ã€‚</li><li><strong>å¼¹å‡ºçª—å£ (Dockview)</strong>ï¼šæ‹–æ‹½ Tab å½¢æˆä¸€ä¸ªæ–°çš„å¼¹å‡ºçª—å£ã€‚<ul><li><strong>é¢„æœŸ</strong>ï¼šå¼¹å‡ºçª—å£åº”è¯¥ç«‹å³æ˜¾ç¤ºåˆšæ‰ä¿®æ”¹è¿‡çš„æ•°æ®ï¼ˆè¿™æ˜¯ <code>REQUEST_INIT</code> é€»è¾‘åœ¨èµ·ä½œç”¨ï¼‰ã€‚</li></ul></li><li><strong>åŒå‘åŒæ­¥æµ‹è¯•</strong>ï¼š<ul><li>åœ¨<strong>å¼¹å‡ºçª—å£</strong>é‡Œä¿®æ”¹æ•°æ®ã€‚</li><li>è§‚å¯Ÿ<strong>ä¸»çª—å£</strong>ï¼ˆä»¥åŠå…¶ä»–å¼¹å‡ºçª—å£ï¼‰çš„æ•°æ®æ˜¯å¦è·Ÿç€å˜äº†ã€‚</li><li><strong>é¢„æœŸ</strong>ï¼šåº”è¯¥æ¯«ç§’çº§åŒæ­¥ã€‚</li></ul></li></ol><h3 id="5-æ³¨æ„äº‹é¡¹-Senior-Tips"><a href="#5-æ³¨æ„äº‹é¡¹-Senior-Tips" class="headerlink" title="5. æ³¨æ„äº‹é¡¹ (Senior Tips)"></a>5. æ³¨æ„äº‹é¡¹ (Senior Tips)</h3><ol><li><strong>åŒæºç­–ç•¥</strong>ï¼š<br><code>BroadcastChannel</code> ä¾èµ–æµè§ˆå™¨çš„åŒæºç­–ç•¥ã€‚ç¡®ä¿ä½ çš„ <code>electron-vite</code> åœ¨å¼€å‘æ¨¡å¼ä¸‹æ‰€æœ‰çª—å£éƒ½æ˜¯ <code>http://localhost:xxxx</code>ï¼Œæˆ–è€…åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹åŠ è½½çš„éƒ½æ˜¯ <code>file://</code> æˆ–è€…è‡ªå®šä¹‰åè®® <code>app://</code>ã€‚åªè¦å®ƒä»¬å±äºåŒä¸€ä¸ª Originï¼Œè¿™ä¸ªæ–¹æ¡ˆå°± 100% æœ‰æ•ˆã€‚</li><li><strong>æ€§èƒ½</strong>ï¼š<br>è™½ç„¶ <code>BroadcastChannel</code> å¾ˆå¿«ï¼Œä½†ä¸è¦ç”¨å®ƒä¼ è¾“éå¸¸å¤§çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ Base64ã€è¶…é•¿æ–‡æœ¬ï¼‰ã€‚å¦‚æœ State ç‰¹åˆ«å¤§ï¼Œå»ºè®®å°†å¤§æ•°æ®æ”¾åœ¨ IndexedDBï¼ŒStore é‡Œåªå­˜ IDã€‚</li><li><strong>éåºåˆ—åŒ–æ•°æ®</strong>ï¼š<br><code>JSON.stringify</code> ä¼šä¸¢å¤± <code>Function</code>ã€<code>Map</code>ã€<code>Set</code> ç­‰ç±»å‹ã€‚è¯·ç¡®ä¿ä½ çš„ Pinia State æ˜¯çº¯æ•°æ®å¯¹è±¡ï¼ˆPlain Objectï¼‰ã€‚è¿™æ˜¯ Vue å’Œ Pinia çš„æœ€ä½³å®è·µï¼Œä¹Ÿæ˜¯å¤šè¿›ç¨‹é€šä¿¡çš„é™åˆ¶ã€‚</li></ol><p>è¿™å¥—ä»£ç è™½ç„¶çœ‹èµ·æ¥ç®€å•ï¼Œä½†å¤„ç†äº†å¤šè¿›ç¨‹æ¶æ„ä¸­æœ€æ£˜æ‰‹çš„â€œç«äº‰â€å’Œâ€œåˆå§‹åŒ–â€é—®é¢˜ï¼Œå®Œå…¨å¯ä»¥ç›´æ¥åˆå…¥é¡¹ç›®ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;è®¾è®¡æ–¹æ¡ˆ&quot;&gt;&lt;a href=&quot;#è®¾è®¡æ–¹æ¡ˆ&quot; class=&quot;headerlink&quot; title=&quot;è®¾è®¡æ–¹æ¡ˆ&quot;&gt;&lt;/a&gt;è®¾è®¡æ–¹æ¡ˆ&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é›¶ä¸»è¿›ç¨‹ä¾èµ–&lt;/strong&gt;ï¼šåŸºäº &lt;code&gt;BroadcastChannel&lt;/code&gt;ï¼Œä¸éœ€è¦ä¿®æ”¹ Electron ä¸»è¿›ç¨‹ä»£ç ï¼Œçº¯å‰ç«¯å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨æ°´åˆï¼ˆHydrationï¼‰&lt;/strong&gt;ï¼šæ–°çª—å£ï¼ˆDockview å¼¹å‡ºçª—ï¼‰æ‰“å¼€æ—¶ï¼Œä¼šè‡ªåŠ¨å‘è€çª—å£â€œè¦â€æ•°æ®ï¼Œè§£å†³åˆå§‹åŒ–ç©ºç™½é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜²æ­»å¾ªç¯&lt;/strong&gt;ï¼šå†…ç½®äº’æ–¥é”ï¼Œé˜²æ­¢ A -&amp;gt; B -&amp;gt; A çš„æ— é™æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒ‰éœ€åŒæ­¥&lt;/strong&gt;ï¼šä¸æ˜¯æ‰€æœ‰ Store éƒ½ä¼šåŒæ­¥ï¼Œä½ å¯ä»¥åœ¨å®šä¹‰ Store æ—¶é€šè¿‡ &lt;code&gt;share: true&lt;/code&gt; å¼€å¯ã€‚&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>electron å¼€å‘è€…çš„è‡ªæˆ‘ä»‹ç»</title>
    <link href="http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/%E5%A6%82%E4%BD%95%E6%8F%8F%E8%BF%B0%E8%87%AA%E5%B7%B1%E5%81%9A%E7%9A%84%E4%BA%8B%E6%83%85/"/>
    <id>http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/%E5%A6%82%E4%BD%95%E6%8F%8F%E8%BF%B0%E8%87%AA%E5%B7%B1%E5%81%9A%E7%9A%84%E4%BA%8B%E6%83%85/</id>
    <published>2025-12-13T03:47:13.697Z</published>
    <updated>2025-12-13T03:56:15.612Z</updated>
    
    <content type="html"><![CDATA[<p>ä½œä¸ºä¸€ååœ¨å‰ç«¯å’Œæ¡Œé¢ç«¯åº”ç”¨å¼€å‘é¢†åŸŸæ·±è€• 10 å¹´çš„é«˜çº§æ¶æ„å¸ˆï¼Œæˆ‘ä¸ä»…ç†Ÿæ‚‰ Electron çš„åº•å±‚åŸç†ï¼ˆChromium + Node.js + Native APIsï¼‰ï¼Œä¹Ÿæ·±è°™ç°ä»£å‰ç«¯æ¡†æ¶ï¼ˆVue3&#x2F;Reactï¼‰ä¸åç«¯æœåŠ¡ï¼ˆNest.js&#x2F;Next.jsï¼‰çš„ç»“åˆä¹‹é“ã€‚<br>&lt;â€“moreâ€“&gt;<br>åœ¨ Electron å¼€å‘ä¸­ï¼Œæˆ‘é€šå¸¸ä¼šä»ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»´åº¦ä¸ºæ‚¨æ„å»ºç³»ç»Ÿæ€§çš„è§£å†³æ–¹æ¡ˆï¼š<br>æ¶æ„è®¾è®¡ (Architecture)ï¼š<br>è¿›ç¨‹æ¨¡å‹ï¼šä¸»è¿›ç¨‹ (Main)ã€æ¸²æŸ“è¿›ç¨‹ (Renderer) ä¸ GPU è¿›ç¨‹çš„èŒè´£åˆ’åˆ†ã€‚<br>é€šä¿¡æœºåˆ¶ï¼šå¦‚ä½•è®¾è®¡é«˜æ•ˆã€ç±»å‹å®‰å…¨ï¼ˆType-safeï¼‰çš„ IPCï¼ˆInter-Process Communicationï¼‰é€šä¿¡ç­–ç•¥ï¼ˆä¾‹å¦‚ä½¿ç”¨ ipcRenderer.invoke + handle æ¨¡å¼ï¼‰ã€‚<br>å®‰å…¨æ€§ (Security)ï¼šä¸Šä¸‹æ–‡éš”ç¦» (Context Isolation)ã€æ²™ç®±æ¨¡å¼ (Sandbox)ã€ä»¥åŠå¦‚ä½•å®‰å…¨åœ°æš´éœ² Node.js èƒ½åŠ›ï¼ˆPreload Scriptsï¼‰ã€‚<br>æŠ€æœ¯æ ˆæ•´åˆ (Integration)ï¼š<br>Vue3&#x2F;Reactï¼šå¦‚ä½•å¤„ç†è·¯ç”±ï¼ˆHash vs History modeï¼‰ã€çŠ¶æ€ç®¡ç†ï¼ˆPinia&#x2F;Redux&#x2F;Zustandï¼‰åœ¨å¤šçª—å£é—´çš„æ•°æ®åŒæ­¥ã€‚<br>åç«¯äº¤äº’ï¼šå¦‚ä½•ä¸ Nest.js ç­‰åç«¯å¾®æœåŠ¡è¿›è¡Œé‰´æƒã€Socket è¿æ¥æˆ–æœ¬åœ° Node.js æœåŠ¡çš„é›†æˆã€‚<br>æ€§èƒ½ä¼˜åŒ– (Performance)ï¼š<br>å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–ï¼ˆVite&#x2F;Webpack æ„å»ºè°ƒä¼˜ï¼‰ã€‚<br>å†…å­˜æ³„æ¼æ’æŸ¥ä¸é•¿åˆ—è¡¨æ¸²æŸ“ã€‚<br>å®‰è£…åŒ…ä½“ç§¯ç˜¦èº«ï¼ˆAsaræ‰“åŒ…ã€ä¾èµ–å‰”é™¤ï¼‰ã€‚<br>åŸç”Ÿèƒ½åŠ›ä¸å·¥ç¨‹åŒ– (Native &amp; DevOps)ï¼š<br>æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€ç³»ç»Ÿæ‰˜ç›˜ã€åŸç”Ÿèœå•ã€å¿«æ·é”®ã€‚<br>C++&#x2F;Rust Addons è°ƒç”¨ï¼ˆNode-APIï¼‰ã€‚<br>è‡ªåŠ¨æ›´æ–° (Auto-updater) ç­–ç•¥ã€‚<br>CI&#x2F;CD æµç¨‹åŠå¤šå¹³å°ï¼ˆWin&#x2F;Mac&#x2F;Linuxï¼‰ç­¾åä¸æ„å»ºã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä½œä¸ºä¸€ååœ¨å‰ç«¯å’Œæ¡Œé¢ç«¯åº”ç”¨å¼€å‘é¢†åŸŸæ·±è€• 10 å¹´çš„é«˜çº§æ¶æ„å¸ˆï¼Œæˆ‘ä¸ä»…ç†Ÿæ‚‰ Electron çš„åº•å±‚åŸç†ï¼ˆChromium + Node.js + Native APIsï¼‰ï¼Œä¹Ÿæ·±è°™ç°ä»£å‰ç«¯æ¡†æ¶ï¼ˆVue3&amp;#x2F;Reactï¼‰ä¸åç«¯æœåŠ¡ï¼ˆNest.js&amp;#x2F;Next.j</summary>
      
    
    
    
    <category term="cocos" scheme="http://blog.ypintao.com/categories/cocos/"/>
    
    
    <category term="cocos" scheme="http://blog.ypintao.com/tags/cocos/"/>
    
  </entry>
  
  <entry>
    <title>electron-viteç›¸å…³</title>
    <link href="http://blog.ypintao.com/2025/12/07/%E5%89%8D%E7%AB%AF/electron/electron-vite%E7%9B%B8%E5%85%B3/"/>
    <id>http://blog.ypintao.com/2025/12/07/%E5%89%8D%E7%AB%AF/electron/electron-vite%E7%9B%B8%E5%85%B3/</id>
    <published>2025-12-07T14:46:54.676Z</published>
    <updated>2025-12-13T03:53:23.050Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»"><a href="#1-electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»" class="headerlink" title="1. electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»"></a>1. electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»</h2><p><a href="https://github.com/alex8088/electron-vite">https://github.com/alex8088/electron-vite</a><br><a href="https://cn.electron-vite.org/">https://cn.electron-vite.org/</a></p><span id="more"></span><h2 id="2-electron-viteå¦‚ä½•é›†æˆ-Dockview"><a href="#2-electron-viteå¦‚ä½•é›†æˆ-Dockview" class="headerlink" title="2. electron-viteå¦‚ä½•é›†æˆ Dockview"></a>2. electron-viteå¦‚ä½•é›†æˆ Dockview</h2><p><a href="https://dockview.dev/templates/">https://dockview.dev/templates/</a><br>å®Œæ•´ Dockview æµ®åŠ¨çª—å£ç¤ºä¾‹ (Electron-Vite)</p><ol><li>âš™ï¸ ä¸»è¿›ç¨‹ (Main Process) è®¾ç½®<br>åœ¨ä½ çš„ Electron ä¸»è¿›ç¨‹æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ src&#x2F;main&#x2F;index.ts æˆ– src&#x2F;main&#x2F;main.tsï¼‰ä¸­ï¼Œä½ éœ€è¦æ·»åŠ ä»£ç æ¥ç›‘å¬æ¸²æŸ“è¿›ç¨‹å‘å‡ºçš„åˆ›å»ºæ–°çª—å£çš„è¯·æ±‚ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">TypeScript</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/main/index.ts (æˆ–ç±»ä¼¼çš„ä¸»è¿›ç¨‹æ–‡ä»¶)</span></span><br><span class="line"><span class="keyword">import</span> &#123; app, <span class="title class_">BrowserWindow</span>, ipcMain &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; join &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... (çœç•¥äº† createWindow ç­‰åˆå§‹åŒ–ä»£ç )</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> externalWindows = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">BrowserWindow</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬æ¸²æŸ“è¿›ç¨‹è¯·æ±‚åˆ›å»ºæµ®åŠ¨é¢æ¿çª—å£</span></span><br><span class="line">ipcMain.<span class="title function_">on</span>(<span class="string">&#x27;create-external-panel-window&#x27;</span>, <span class="function">(<span class="params">_, <span class="attr">data</span>: &#123; groupId: <span class="built_in">string</span>, initialBounds: <span class="built_in">any</span>, url: <span class="built_in">string</span> &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; groupId, initialBounds, url &#125; = data;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (externalWindows.<span class="title function_">has</span>(groupId)) &#123;</span><br><span class="line">    externalWindows.<span class="title function_">get</span>(groupId)?.<span class="title function_">focus</span>();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Electron æµè§ˆå™¨çª—å£</span></span><br><span class="line">  <span class="keyword">const</span> externalWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">x</span>: initialBounds.<span class="property">x</span>,</span><br><span class="line">    <span class="attr">y</span>: initialBounds.<span class="property">y</span>,</span><br><span class="line">    <span class="attr">width</span>: initialBounds.<span class="property">width</span>,</span><br><span class="line">    <span class="attr">height</span>: initialBounds.<span class="property">height</span>,</span><br><span class="line">    <span class="attr">show</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">      <span class="attr">preload</span>: <span class="title function_">join</span>(__dirname, <span class="string">&#x27;../preload/index.js&#x27;</span>),</span><br><span class="line">      <span class="comment">// æ³¨æ„ï¼šè¿™é‡Œéœ€è¦å¯ç”¨ sandboxï¼Œç„¶åé€šè¿‡ preload æš´éœ²å®‰å…¨ API</span></span><br><span class="line">      <span class="attr">sandbox</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">contextIsolation</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  externalWindow.<span class="title function_">on</span>(<span class="string">&#x27;closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    externalWindows.<span class="title function_">delete</span>(groupId);</span><br><span class="line">    <span class="comment">// é€šçŸ¥ä¸»çª—å£é¢æ¿å·²å…³é—­</span></span><br><span class="line">    <span class="title class_">BrowserWindow</span>.<span class="title function_">getAllWindows</span>().<span class="title function_">forEach</span>(<span class="function"><span class="params">win</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (win !== externalWindow) &#123;</span><br><span class="line">            win.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&#x27;external-panel-closed&#x27;</span>, groupId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŠ è½½ Dockview å¤–éƒ¨çª—å£çš„ç‰¹å®š URL</span></span><br><span class="line">  <span class="comment">// æˆ‘ä»¬å°†ä½¿ç”¨ä¸»çª—å£çš„ URLï¼Œä½†å¸¦ä¸ŠæŸ¥è¯¢å‚æ•°æ¥æŒ‡ç¤ºå®ƒæ˜¯å¤–éƒ¨çª—å£</span></span><br><span class="line">  externalWindow.<span class="title function_">loadURL</span>(<span class="string">`<span class="subst">$&#123;url&#125;</span>?groupId=<span class="subst">$&#123;groupId&#125;</span>&amp;external=true`</span>);</span><br><span class="line">  </span><br><span class="line">  externalWindow.<span class="title function_">once</span>(<span class="string">&#x27;ready-to-show&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    externalWindow.<span class="title function_">show</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  externalWindows.<span class="title function_">set</span>(groupId, externalWindow);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬å¹¶è½¬å‘æ¥è‡ªä¸»çª—å£çš„æ¶ˆæ¯åˆ°ç‰¹å®šçš„å¤–éƒ¨çª—å£</span></span><br><span class="line">ipcMain.<span class="title function_">on</span>(<span class="string">&#x27;external-panel-message&#x27;</span>, <span class="function">(<span class="params">_, <span class="attr">groupId</span>: <span class="built_in">string</span>, <span class="attr">message</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> win = externalWindows.<span class="title function_">get</span>(groupId);</span><br><span class="line">    <span class="keyword">if</span> (win) &#123;</span><br><span class="line">        win.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&#x27;dockview-message&#x27;</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="2"><li>Preload è„šæœ¬è®¾ç½®<br>ä¸ºäº†åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­å®‰å…¨åœ°ä½¿ç”¨ IPCï¼Œä½ éœ€è¦é€šè¿‡ contextBridge åœ¨ Preload è„šæœ¬ä¸­æš´éœ²å¿…è¦çš„ IPC åŠŸèƒ½ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">TypeScript</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/preload/index.ts (æˆ–ç±»ä¼¼çš„ Preload æ–‡ä»¶)</span></span><br><span class="line"><span class="keyword">import</span> &#123; contextBridge, ipcRenderer &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... (çœç•¥äº†å…¶ä»– IPC æš´éœ²)</span></span><br><span class="line"></span><br><span class="line">contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&#x27;electron&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">ipcRenderer</span>: &#123;</span><br><span class="line">    <span class="comment">// Dockview å¤–éƒ¨åŒ–åŠŸèƒ½æ‰€éœ€çš„ IPC</span></span><br><span class="line">    <span class="attr">send</span>: <span class="function">(<span class="params"><span class="attr">channel</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> validChannels = [</span><br><span class="line">          <span class="string">&#x27;create-external-panel-window&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;external-panel-message&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;dispose-external-panel-window&#x27;</span></span><br><span class="line">      ];</span><br><span class="line">      <span class="keyword">if</span> (validChannels.<span class="title function_">includes</span>(channel)) &#123;</span><br><span class="line">        ipcRenderer.<span class="title function_">send</span>(channel, ...args);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">on</span>: <span class="function">(<span class="params"><span class="attr">channel</span>: <span class="built_in">string</span>, <span class="attr">func</span>: (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">void</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> validChannels = [</span><br><span class="line">          <span class="string">&#x27;dockview-message&#x27;</span>, <span class="comment">// æ¥æ”¶æ¥è‡ªä¸»è¿›ç¨‹çš„æ¶ˆæ¯</span></span><br><span class="line">          <span class="string">&#x27;external-panel-closed&#x27;</span></span><br><span class="line">      ];</span><br><span class="line">      <span class="keyword">if</span> (validChannels.<span class="title function_">includes</span>(channel)) &#123;</span><br><span class="line">        <span class="comment">// ... (çœç•¥äº†ç±»å‹æ£€æŸ¥å’Œ IPC ç›‘å¬çš„å®ç°ç»†èŠ‚)</span></span><br><span class="line">        ipcRenderer.<span class="title function_">on</span>(channel, <span class="function">(<span class="params">_event, ...args</span>) =&gt;</span> <span class="title function_">func</span>(...args));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ... å…¶ä»–å¿…è¦çš„ IPC æ–¹æ³•</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="3"><li>ğŸ–¼ï¸ æ¸²æŸ“è¿›ç¨‹ (Renderer Process) - Dockview ç»„ä»¶ä¿®æ”¹<br>ä½ éœ€è¦ä¿®æ”¹ DockviewContainer.vueï¼Œå®ç° createExternalWindow é’©å­ã€‚</li></ol><p>ä»£ç æ®µ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;containerRef&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; &#x27;dockview-external-host&#x27;: isExternal &#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 100vh; width: 100vw;&quot;</span>/&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">import &#123; ref, onMounted, shallowRef &#125; from &#x27;vue&#x27;;</span></span><br><span class="line"><span class="language-xml">import &#123; createApp, type App &#125; from &#x27;vue&#x27;;</span></span><br><span class="line"><span class="language-xml">import &#123; DockviewComponent, IDockviewPanel, DockviewExternalWindow &#125; from &#x27;dockview&#x27;;</span></span><br><span class="line"><span class="language-xml">import PanelContent from &#x27;./PanelContent.vue&#x27;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// --- æ£€æŸ¥æ˜¯å¦ä¸ºå¤–éƒ¨çª—å£ ---</span></span><br><span class="line"><span class="language-xml">// ç®€å•æ–¹æ³•ï¼šæ£€æŸ¥ URL æ˜¯å¦æœ‰ `?external=true` æŸ¥è¯¢å‚æ•°</span></span><br><span class="line"><span class="language-xml">const isExternal = window.location.search.includes(&#x27;external=true&#x27;);</span></span><br><span class="line"><span class="language-xml">const urlParams = new URLSearchParams(window.location.search);</span></span><br><span class="line"><span class="language-xml">const groupId = urlParams.get(&#x27;groupId&#x27;) || &#x27;&#x27;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// ... (çœç•¥ PanelContent æŒ‚è½½å’Œ vueApps Map çš„ä»£ç ï¼Œè§ä¸Šä¸€ä¸ªå›ç­”)</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// --- Dockview å¤–éƒ¨åŒ–é…ç½® ---</span></span><br><span class="line"><span class="language-xml">const createExternalWindow = (event: &#123;</span></span><br><span class="line"><span class="language-xml">    groupId: string;</span></span><br><span class="line"><span class="language-xml">    bounds: &#123; x: number; y: number; width: number; height: number &#125;;</span></span><br><span class="line"><span class="language-xml">&#125;): DockviewExternalWindow =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    // 1. é€šçŸ¥ä¸»è¿›ç¨‹åˆ›å»ºæ–°çª—å£</span></span><br><span class="line"><span class="language-xml">    window.electron.ipcRenderer.send(&#x27;create-external-panel-window&#x27;, &#123;</span></span><br><span class="line"><span class="language-xml">        groupId: event.groupId,</span></span><br><span class="line"><span class="language-xml">        initialBounds: event.bounds,</span></span><br><span class="line"><span class="language-xml">        // ä¼ é€’å½“å‰ URLï¼Œè®©æ–°çª—å£çŸ¥é“åŠ è½½ä»€ä¹ˆ</span></span><br><span class="line"><span class="language-xml">        url: window.location.href.split(&#x27;?&#x27;)[0] </span></span><br><span class="line"><span class="language-xml">    &#125;);</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    // 2. è¿”å› Dockview éœ€è¦çš„ PostMessage æ¥å£</span></span><br><span class="line"><span class="language-xml">    return &#123;</span></span><br><span class="line"><span class="language-xml">        // ç”¨äºå‘æ–°çª—å£å‘é€æ•°æ® (ç”± Dockview å†…éƒ¨è°ƒç”¨)</span></span><br><span class="line"><span class="language-xml">        postMessage: (message) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">            window.electron.ipcRenderer.send(&#x27;external-panel-message&#x27;, event.groupId, message);</span></span><br><span class="line"><span class="language-xml">        &#125;,</span></span><br><span class="line"><span class="language-xml">        // å½“æµ®åŠ¨é¢æ¿å…³é—­æˆ–è¢«é‡æ–°æ‹–å›ä¸»çª—å£æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="language-xml">        dispose: () =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">            window.electron.ipcRenderer.send(&#x27;dispose-external-panel-window&#x27;, event.groupId);</span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">    &#125;;</span></span><br><span class="line"><span class="language-xml">&#125;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// --- Dockview å®ä¾‹åŒ– ---</span></span><br><span class="line"><span class="language-xml">onMounted(() =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">  if (!containerRef.value) return;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  const dockview = new DockviewComponent(&#123;</span></span><br><span class="line"><span class="language-xml">    parentElement: containerRef.value,</span></span><br><span class="line"><span class="language-xml">    createComponent: createVueComponent,</span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    // å¯ç”¨å¤–éƒ¨æ‹–æ‹½</span></span><br><span class="line"><span class="language-xml">    allowExternalDrag: true, </span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    // å®ç°åˆ›å»ºå¤–éƒ¨çª—å£çš„é’©å­</span></span><br><span class="line"><span class="language-xml">    createExternalWindow: createExternalWindow, </span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    // å¦‚æœæ˜¯å¤–éƒ¨çª—å£ï¼Œéœ€è¦ä¼ å…¥ groupdId æ¥æ¢å¤å¸ƒå±€</span></span><br><span class="line"><span class="language-xml">    is\&#x27;external\&#x27; = isExternal,</span></span><br><span class="line"><span class="language-xml">    externalGroupId: groupId || undefined</span></span><br><span class="line"><span class="language-xml">  &#125;);</span></span><br><span class="line"><span class="language-xml">  dockviewRef.value = dockview;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  // --- å¤–éƒ¨çª—å£çš„ç‰¹æ®Šå¤„ç† ---</span></span><br><span class="line"><span class="language-xml">  if (isExternal) &#123;</span></span><br><span class="line"><span class="language-xml">    // 1. ç›‘å¬æ¥è‡ªä¸»çª—å£çš„æ¶ˆæ¯ï¼Œå¹¶è½¬å‘ç»™ Dockview å®ä¾‹</span></span><br><span class="line"><span class="language-xml">    window.electron.ipcRenderer.on(&#x27;dockview-message&#x27;, (message) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        dockview.processExternalWindowMessage(message);</span></span><br><span class="line"><span class="language-xml">    &#125;);</span></span><br><span class="line"><span class="language-xml">  &#125; else &#123;</span></span><br><span class="line"><span class="language-xml">    // 2. ä¸»çª—å£åˆå§‹åŒ–å¸ƒå±€</span></span><br><span class="line"><span class="language-xml">    dockview.addPanel(&#123; id: &#x27;panel-1&#x27;, component: &#x27;vue-panel&#x27;, title: &#x27;ä¸»çª—å£é¢æ¿ 1&#x27; &#125;);</span></span><br><span class="line"><span class="language-xml">    dockview.addPanel(&#123; id: &#x27;panel-2&#x27;, component: &#x27;vue-panel&#x27;, title: &#x27;ä¸»çª—å£é¢æ¿ 2&#x27; &#125;);</span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    // 3. ç›‘å¬å¤–éƒ¨çª—å£å…³é—­äº‹ä»¶</span></span><br><span class="line"><span class="language-xml">    window.electron.ipcRenderer.on(&#x27;external-panel-closed&#x27;, (closedGroupId) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        // é€šçŸ¥ Dockview å¤–éƒ¨ç»„å·²å…³é—­ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ¸…ç†å†…éƒ¨çŠ¶æ€</span></span><br><span class="line"><span class="language-xml">        dockview.removeExternalComponent(closedGroupId);</span></span><br><span class="line"><span class="language-xml">    &#125;);</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  // ... (çœç•¥ resize ç›‘å¬ä»£ç )</span></span><br><span class="line"><span class="language-xml">&#125;);</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="comment">/* å¯é€‰ï¼šä¸ºå¤–éƒ¨çª—å£æä¾›ä¸€ä¸ªä¸åŒçš„èƒŒæ™¯æˆ–è¾¹æ¡† */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.dockview-external-host</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="comment">/* å¤–éƒ¨çª—å£é€šå¸¸ä¸éœ€è¦è¾¹æ¡† */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ğŸ”‘ æ€»ç»“å’Œæ“ä½œæ­¥éª¤<br>è®¾ç½® IPC (Preload &amp; Main): åœ¨ä¸»è¿›ç¨‹ä¸­é…ç½® ipcMain æ¥åˆ›å»º BrowserWindowï¼Œå¹¶åœ¨ Preload ä¸­é€šè¿‡ contextBridge å®‰å…¨æš´éœ² ipcRenderer çš„ send å’Œ on æ–¹æ³•ã€‚</p><p>å®ç° createExternalWindow: åœ¨ DockviewContainer.vue ä¸­ï¼Œå®ç° createExternalWindow é’©å­ï¼Œå®ƒå‘ä¸»è¿›ç¨‹å‘é€åˆ›å»ºæ–°çª—å£çš„è¯·æ±‚ï¼Œå¹¶è¿”å› Dockview æ‰€éœ€çš„ postMessage æ¥å£ã€‚</p><p>å¤„ç†å¤–éƒ¨çª—å£åˆå§‹åŒ–:</p><p>æ£€æŸ¥ URL ä¸­çš„æŸ¥è¯¢å‚æ•° (?external&#x3D;true) æ¥åˆ¤æ–­å½“å‰çª—å£æ˜¯ä¸»çª—å£è¿˜æ˜¯æµ®åŠ¨é¢æ¿çª—å£ã€‚</p><p>å¦‚æœæ˜¯æµ®åŠ¨é¢æ¿çª—å£ï¼Œåœ¨å®ä¾‹åŒ– DockviewComponent æ—¶ä¼ å…¥ isExternal: true å’Œ externalGroupIdï¼Œå¹¶ç›‘å¬ä¸»çª—å£å‘æ¥çš„ dockview-messageã€‚</p><p>æ“ä½œæ­¥éª¤ï¼š</p><p>è¿è¡Œä½ çš„ Electron-Vite åº”ç”¨ã€‚</p><p>ç‚¹å‡»ä¸€ä¸ªé¢æ¿çš„æ ‡é¢˜æ ã€‚</p><p>å°†æ ‡é¢˜æ æ‹–å‡ºä¸»çª—å£çš„è¾¹ç•Œã€‚</p><p>é‡Šæ”¾é¼ æ ‡ï¼Œä¸€ä¸ªæ–°çš„ã€ç‹¬ç«‹çš„ Electron çª—å£å°±ä¼šå¼¹å‡ºï¼Œå…¶ä¸­åŒ…å«ä½ æ‹–å‡ºçš„é¢æ¿</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»&quot;&gt;&lt;a href=&quot;#1-electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»&quot; class=&quot;headerlink&quot; title=&quot;1. electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»&quot;&gt;&lt;/a&gt;1. electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/alex8088/electron-vite&quot;&gt;https://github.com/alex8088/electron-vite&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://cn.electron-vite.org/&quot;&gt;https://cn.electron-vite.org/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>viteæ³¨æ„äº‹é¡¹</title>
    <link href="http://blog.ypintao.com/2025/12/07/tools/vite%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E6%A0%B7%E5%BC%8F%E5%86%B2%E7%AA%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>http://blog.ypintao.com/2025/12/07/tools/vite%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E6%A0%B7%E5%BC%8F%E5%86%B2%E7%AA%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</id>
    <published>2025-12-07T04:00:00.000Z</published>
    <updated>2025-12-07T14:46:02.479Z</updated>
    
    <content type="html"><![CDATA[<h1 id="viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ"><a href="#viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ" class="headerlink" title="viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ"></a>viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ</h1><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨ä½¿ç”¨viteå¼€å‘vueé¡¹ç›®æ—¶ï¼Œ<br>åŒæ—¶ä½¿ç”¨äº† elementui-pluså’Œ element-plus-x,<br>ç„¶å åœ¨å¼€å‘ç¯å¢ƒ é‡Œé¢æœ‰ä¸€äº› element-plus-x çš„ç‰¹æ®Šæ ·å¼ä¼šæ±¡æŸ“elementui-plusçš„åŸæœ‰æ ·å¼ã€‚</p><span id="more"></span><p>æ¯”å¦‚ ThoughtChain  è¿™ä¸ªæ€ç»´é“¾çš„ç»„ä»¶ ç”¨äº† el-collapse ï¼Œç„¶åä¿®æ”¹äº†ä»–çš„æ ·å¼çš„é«˜åº¦ height<br>elementui-plusçš„åŸæ ·å¼</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.el-collapse-item__header</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="built_in">var</span>(--el-collapse-header-height);</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="built_in">var</span>(--el-collapse-header-height);</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--el-collapse-header-bg-color);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--el-collapse-header-text-color);</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--el-collapse-border-color);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--el-collapse-header-font-size);</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">    <span class="attribute">transition</span>: border-bottom-color <span class="built_in">var</span>(--el-transition-duration);</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å å¤šäº†ä¸€ä¸ªå›ºå®šé«˜åº¦</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#elx_wrapper</span> <span class="selector-class">.el-collapse-item__header</span> &#123;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--el-collapse-header-bg-color);</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--el-collapse-border-color);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--el-collapse-header-text-color);</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--el-collapse-header-font-size);</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="built_in">var</span>(--el-collapse-header-height); //è¿™ä¸€è¡Œ ä¸Šé¢æ˜¯æ²¡æœ‰çš„ã€‚</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="built_in">var</span>(--el-collapse-header-height);</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transition</span>: border-bottom-color <span class="built_in">var</span>(--el-transition-duration);</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢åªæ˜¯ä¸ªæ¯”å–»</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ä¹Ÿæ˜¯è€ƒè™‘äº†å¥½å‡ ç§æ–¹æ¡ˆã€‚ä½†æ˜¯éƒ½æ„Ÿè§‰å¯¹å·²æœ‰é¡¹ç›®çš„æ”¹åŠ¨å¤ªå¤§ã€‚</p><ul><li>æ–¹æ¡ˆä¸€ï¼š<br>ç”¨element-plusçš„ el-config-provider åŒ…è£¹ï¼Œç„¶åä¿®æ”¹namespaceä¸ºepã€‚å…¨å±€ä¿®æ”¹element-plusçš„æ ·å¼æµ…é†‰</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-config-provider namespace=<span class="string">&quot;ep&quot;</span>&gt;</span><br><span class="line">    &lt;!-- ... --&gt;</span><br><span class="line">  &lt;/el-config-provider&gt;</span><br><span class="line"></span><br><span class="line">  å†™ä¸€ä¸ª css styles/element/index.<span class="property">scss</span>ï¼š</span><br><span class="line">  @forward <span class="string">&#x27;element-plus/theme-chalk/src/mixins/config.scss&#x27;</span> <span class="title function_">with</span> (</span><br><span class="line">  <span class="attr">$namespace</span>: <span class="string">&#x27;ep&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">åœ¨ vite.<span class="property">config</span>.<span class="property">ts</span> ä¸­å¯¼å…¥ styles/element/index.<span class="property">scss</span>ï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="attr">preprocessorOptions</span>: &#123;</span><br><span class="line">      <span class="attr">scss</span>: &#123;</span><br><span class="line">        <span class="attr">additionalData</span>: <span class="string">`@use &quot;~/styles/element/index.scss&quot; as *;`</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>æ–¹æ¡ˆäºŒï¼š ä½¿ç”¨posscssæ’ä»¶</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">åœ¨vite.<span class="property">config</span>.<span class="property">ts</span>ä¸­é…ç½®</span><br><span class="line"><span class="keyword">import</span> prefixSelector <span class="keyword">from</span> <span class="string">&#x27;postcss-prefix-selector&#x27;</span></span><br><span class="line"><span class="attr">css</span>: &#123;</span><br><span class="line">      <span class="attr">preprocessorOptions</span>: &#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰å…¨å±€ SCSS å˜é‡</span></span><br><span class="line">        <span class="attr">scss</span>: &#123;</span><br><span class="line">          <span class="attr">additionalData</span>: <span class="string">`@use &quot;@/styles/variables.scss&quot; as *;`</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">postcss</span>: &#123;</span><br><span class="line">      <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">prefixSelector</span>(&#123;</span><br><span class="line">          <span class="comment">// åªæœ‰å½“å¤„ç† element-plus-x çš„æ ·å¼æ–‡ä»¶æ—¶æ‰ç”Ÿæ•ˆ</span></span><br><span class="line">          <span class="comment">// æ³¨æ„ï¼šä½ éœ€è¦ç¡®è®¤è¯¥åº“æ ·å¼æ–‡ä»¶çš„å…·ä½“è·¯å¾„ç‰¹å¾</span></span><br><span class="line">          <span class="attr">includeFiles</span>: [<span class="regexp">/element-plus-x/</span>, <span class="regexp">/node_modules\/element-plus-x/</span>], </span><br><span class="line">          </span><br><span class="line">          <span class="comment">// å¿½ç•¥ html å’Œ body æ ‡ç­¾ï¼Œé¿å…ç ´åå…¨å±€åŸºç¡€æ ·å¼</span></span><br><span class="line">          <span class="attr">exclude</span>: [<span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;:root&#x27;</span>],</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// æ ¸å¿ƒï¼šå°†æ‰€æœ‰æ ·å¼é™åˆ¶åœ¨è¿™ä¸ª ID ä¸‹</span></span><br><span class="line">          <span class="attr">prefix</span>: <span class="string">&#x27;#elx_wrapper&#x27;</span>, </span><br><span class="line">          </span><br><span class="line">          <span class="title function_">transform</span>(<span class="params">prefix: string, selector: string, prefixedSelector: string, filePath: string</span>) &#123;</span><br><span class="line">            <span class="comment">// å¯¹äº :root ä¸‹çš„å˜é‡å®šä¹‰ï¼Œå¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†ä»¥å…ä¸¢å¤±</span></span><br><span class="line">            <span class="keyword">if</span> (selector === <span class="string">&#x27;:root&#x27;</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="string">&#x27;:root #elx_wrapper&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> prefixedSelector</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ&quot;&gt;&lt;a href=&quot;#viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ&quot; class=&quot;headerlink&quot; title=&quot;viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ&quot;&gt;&lt;/a&gt;viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ&lt;/h1&gt;&lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;åœ¨ä½¿ç”¨viteå¼€å‘vueé¡¹ç›®æ—¶ï¼Œ&lt;br&gt;åŒæ—¶ä½¿ç”¨äº† elementui-pluså’Œ element-plus-x,&lt;br&gt;ç„¶å åœ¨å¼€å‘ç¯å¢ƒ é‡Œé¢æœ‰ä¸€äº› element-plus-x çš„ç‰¹æ®Šæ ·å¼ä¼šæ±¡æŸ“elementui-plusçš„åŸæœ‰æ ·å¼ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="vite" scheme="http://blog.ypintao.com/categories/vite/"/>
    
    
    <category term="vite" scheme="http://blog.ypintao.com/tags/vite/"/>
    
  </entry>
  
  <entry>
    <title>nuxtç›¸å…³é—®é¢˜</title>
    <link href="http://blog.ypintao.com/2025/12/07/%E5%89%8D%E7%AB%AF/vue/nuxt%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/"/>
    <id>http://blog.ypintao.com/2025/12/07/%E5%89%8D%E7%AB%AF/vue/nuxt%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/</id>
    <published>2025-12-07T04:00:00.000Z</published>
    <updated>2025-12-07T14:52:46.527Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜"><a href="#1-nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜" class="headerlink" title="1. nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜"></a>1. nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜</h2><p>assets&#x2F;: ç”¨äºå­˜å‚¨æœªç¼–è¯‘çš„èµ„æºï¼Œå¦‚å›¾åƒã€å­—ä½“å’Œæ ·å¼è¡¨ã€‚</p><p>components&#x2F;: ç”¨äºå­˜å‚¨ Vue ç»„ä»¶ï¼ŒNuxt ä¼šè‡ªåŠ¨å¯¼å…¥ã€‚</p><p>composables&#x2F;: å­˜æ”¾å¯å¤ç”¨çš„ Composition API å‡½æ•°ï¼ˆç»„åˆå¼å‡½æ•°ï¼‰ã€‚</p><p>layouts&#x2F;: å®šä¹‰åº”ç”¨ç¨‹åºçš„å¸ƒå±€ç»“æ„ï¼ˆå¦‚é¡µçœ‰ã€é¡µè„šï¼‰ã€‚</p><p>pages&#x2F;: æœ€é‡è¦çš„ç›®å½•ï¼Œç”¨äºå®šä¹‰åº”ç”¨ç¨‹åºçš„è·¯ç”±å’Œè§†å›¾ã€‚</p><p>plugins&#x2F;: ç”¨äºåœ¨ Nuxt åº”ç”¨ç¨‹åºå¯åŠ¨å‰è¿è¡Œçš„ JavaScript æ’ä»¶ã€‚</p><p>server&#x2F;: å­˜æ”¾ Nitro å¼•æ“ çš„æœåŠ¡ç«¯è·¯ç”±å’Œ API æ¥å£ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜&quot;&gt;&lt;a href=&quot;#1-nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;1. nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜&quot;&gt;&lt;/a&gt;1. nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜&lt;/h2&gt;&lt;p&gt;assets&amp;#x2F;: ç”¨äº</summary>
      
    
    
    
    <category term="vue3" scheme="http://blog.ypintao.com/categories/vue3/"/>
    
    <category term="nuxt" scheme="http://blog.ypintao.com/categories/vue3/nuxt/"/>
    
    
    <category term="vue3" scheme="http://blog.ypintao.com/tags/vue3/"/>
    
    <category term="nuxt" scheme="http://blog.ypintao.com/tags/nuxt/"/>
    
  </entry>
  
  <entry>
    <title>viteæ³¨æ„äº‹é¡¹</title>
    <link href="http://blog.ypintao.com/2025/03/01/tools/vite/"/>
    <id>http://blog.ypintao.com/2025/03/01/tools/vite/</id>
    <published>2025-03-01T04:00:00.000Z</published>
    <updated>2025-12-07T14:46:05.893Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Vite-æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Vite-æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Vite æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Vite æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Viteçš„å¿«é€Ÿå¼€å‘ä½“éªŒæ˜¯é€šè¿‡ä»¥ä¸‹åŸç†å®ç°çš„ï¼š</p><p>ä½¿ç”¨åŸç”ŸESæ¨¡å—åŒ–ï¼Œæ— éœ€é¢„æ‰“åŒ…ã€‚<br>åˆ©ç”¨æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰å°†æºä»£ç è½¬æ¢ä¸ºæµè§ˆå™¨å¯è¯†åˆ«çš„æ¨¡å—ã€‚<br>åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼ŒæŒ‰éœ€ç¼–è¯‘å’Œæä¾›æ¨¡å—ï¼Œå®ç°å¿«é€Ÿçš„å†·å¯åŠ¨å’Œçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰ã€‚</p><span id="more"></span>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Vite-æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;a href=&quot;#Vite-æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;Vite æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;/a&gt;Vite æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;&lt;p&gt;Viteçš„å¿«é€Ÿå¼€å‘ä½“éªŒæ˜¯é€šè¿‡ä»¥ä¸‹åŸç†å®ç°çš„ï¼š&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨åŸç”ŸESæ¨¡å—åŒ–ï¼Œæ— éœ€é¢„æ‰“åŒ…ã€‚&lt;br&gt;åˆ©ç”¨æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰å°†æºä»£ç è½¬æ¢ä¸ºæµè§ˆå™¨å¯è¯†åˆ«çš„æ¨¡å—ã€‚&lt;br&gt;åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼ŒæŒ‰éœ€ç¼–è¯‘å’Œæä¾›æ¨¡å—ï¼Œå®ç°å¿«é€Ÿçš„å†·å¯åŠ¨å’Œçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="vite" scheme="http://blog.ypintao.com/categories/vite/"/>
    
    
    <category term="vite" scheme="http://blog.ypintao.com/tags/vite/"/>
    
  </entry>
  
  <entry>
    <title>webpackæ‰“åŒ…å·¥å…·æ³¨æ„äº‹é¡¹</title>
    <link href="http://blog.ypintao.com/2025/03/01/tools/webpack/"/>
    <id>http://blog.ypintao.com/2025/03/01/tools/webpack/</id>
    <published>2025-03-01T04:00:00.000Z</published>
    <updated>2025-12-07T14:45:45.279Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Webpack-çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Webpack-çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Webpack çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Webpack çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>åˆ—ä¸¾å¹¶ç®€è¿° Webpack çš„å››å¤§æ ¸å¿ƒé…ç½®é¡¹ã€‚<br>æ¦‚å¿µæè¿°<br>entryå…¥å£æ–‡ä»¶ï¼ŒæŒ‡å®š Webpack å¼€å§‹æ„å»ºçš„ä½ç½®<br>outputè¾“å‡ºè·¯å¾„ä¸æ–‡ä»¶åé…ç½®<br>loaderå¤„ç†é JS æ–‡ä»¶ï¼ˆå¦‚ CSSã€å›¾ç‰‡ã€TypeScriptï¼‰<br>pluginæ‰©å±• Webpack åŠŸèƒ½ï¼ˆå¦‚å‹ç¼©ã€ä¼˜åŒ–ã€æ³¨å…¥å˜é‡ï¼‰</p><span id="more"></span><h2 id="å¦‚ä½•é…ç½®å¤šä¸ªå…¥å£ï¼ˆentryï¼‰ï¼Ÿ"><a href="#å¦‚ä½•é…ç½®å¤šä¸ªå…¥å£ï¼ˆentryï¼‰ï¼Ÿ" class="headerlink" title="å¦‚ä½•é…ç½®å¤šä¸ªå…¥å£ï¼ˆentryï¼‰ï¼Ÿ"></a>å¦‚ä½•é…ç½®å¤šä¸ªå…¥å£ï¼ˆentryï¼‰ï¼Ÿ</h2><p>é…ç½® Webpack åŒæ—¶æ‰“åŒ…ä¸¤ä¸ªç‹¬ç«‹é¡µé¢ï¼ˆå¦‚ index å’Œ about é¡µé¢ï¼‰ã€‚</p><h2 id="å¦‚ä½•é…ç½®ç¯å¢ƒå˜é‡ï¼Ÿ"><a href="#å¦‚ä½•é…ç½®ç¯å¢ƒå˜é‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•é…ç½®ç¯å¢ƒå˜é‡ï¼Ÿ"></a>å¦‚ä½•é…ç½®ç¯å¢ƒå˜é‡ï¼Ÿ</h2><p> åœ¨ä¸åŒç¯å¢ƒä¸­æ³¨å…¥ä¸åŒçš„ API åœ°å€ã€‚<br> ä½¿ç”¨ DefinePlugin å®šä¹‰å…¨å±€å˜é‡ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Tree-Shakingï¼Ÿå¦‚ä½•å¯ç”¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Tree-Shakingï¼Ÿå¦‚ä½•å¯ç”¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Tree Shakingï¼Ÿå¦‚ä½•å¯ç”¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Tree Shakingï¼Ÿå¦‚ä½•å¯ç”¨ï¼Ÿ</h2><p> åªæ‰“åŒ…å®é™…ä½¿ç”¨çš„ä»£ç ï¼Œå‡å°‘ä½“ç§¯ã€‚<br> Tree Shaking æ˜¯é€šè¿‡ ES Module é™æ€åˆ†æåˆ é™¤æœªä½¿ç”¨ä»£ç çš„æŠ€æœ¯ã€‚</p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">usedExports</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;sideEffects&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•ä¼˜åŒ–æ‰“åŒ…ä½“ç§¯ï¼Ÿ"><a href="#å¦‚ä½•ä¼˜åŒ–æ‰“åŒ…ä½“ç§¯ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–æ‰“åŒ…ä½“ç§¯ï¼Ÿ"></a>å¦‚ä½•ä¼˜åŒ–æ‰“åŒ…ä½“ç§¯ï¼Ÿ</h2><p>å‡å°‘æœ€ç»ˆæ‰“åŒ…æ–‡ä»¶å¤§å°çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ</p><p>ä½¿ç”¨ TerserPlugin å‹ç¼© JSã€‚<br>ä½¿ç”¨ MiniCssExtractPlugin æå– CSSã€‚<br>ä½¿ç”¨ SplitChunksPlugin åˆ†åŒ…ã€‚<br>ç§»é™¤æ— ç”¨ä»£ç ï¼ˆTree Shakingï¼‰ã€‚<br>ä½¿ç”¨ externals æ’é™¤ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ Reactï¼‰ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">  <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">minimizer</span>: [<span class="keyword">new</span> <span class="title class_">TerserPlugin</span>()],</span><br><span class="line">  <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">    <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•é…ç½®-Webpack-æ„å»ºå¤šé¡µåº”ç”¨ï¼ˆMPAï¼‰ï¼Ÿ"><a href="#å¦‚ä½•é…ç½®-Webpack-æ„å»ºå¤šé¡µåº”ç”¨ï¼ˆMPAï¼‰ï¼Ÿ" class="headerlink" title="å¦‚ä½•é…ç½® Webpack æ„å»ºå¤šé¡µåº”ç”¨ï¼ˆMPAï¼‰ï¼Ÿ"></a>å¦‚ä½•é…ç½® Webpack æ„å»ºå¤šé¡µåº”ç”¨ï¼ˆMPAï¼‰ï¼Ÿ</h2><p>åŒæ—¶æ‰“åŒ…å¤šä¸ª HTML é¡µé¢ï¼Œæ¯ä¸ªé¡µé¢å¯¹åº”ä¸€ä¸ªå…¥å£æ–‡ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">home</span>: <span class="string">&#x27;./src/home.js&#x27;</span>,</span><br><span class="line">    <span class="attr">about</span>: <span class="string">&#x27;./src/about.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123; <span class="attr">filename</span>: <span class="string">&#x27;home.html&#x27;</span>, <span class="attr">template</span>: <span class="string">&#x27;./src/home.html&#x27;</span>, <span class="attr">chunks</span>: [<span class="string">&#x27;home&#x27;</span>] &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123; <span class="attr">filename</span>: <span class="string">&#x27;about.html&#x27;</span>, <span class="attr">template</span>: <span class="string">&#x27;./src/about.html&#x27;</span>, <span class="attr">chunks</span>: [<span class="string">&#x27;about&#x27;</span>] &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Webpack-çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;a href=&quot;#Webpack-çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;Webpack çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;/a&gt;Webpack çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;&lt;p&gt;åˆ—ä¸¾å¹¶ç®€è¿° Webpack çš„å››å¤§æ ¸å¿ƒé…ç½®é¡¹ã€‚&lt;br&gt;æ¦‚å¿µ	æè¿°&lt;br&gt;entry	å…¥å£æ–‡ä»¶ï¼ŒæŒ‡å®š Webpack å¼€å§‹æ„å»ºçš„ä½ç½®&lt;br&gt;output	è¾“å‡ºè·¯å¾„ä¸æ–‡ä»¶åé…ç½®&lt;br&gt;loader	å¤„ç†é JS æ–‡ä»¶ï¼ˆå¦‚ CSSã€å›¾ç‰‡ã€TypeScriptï¼‰&lt;br&gt;plugin	æ‰©å±• Webpack åŠŸèƒ½ï¼ˆå¦‚å‹ç¼©ã€ä¼˜åŒ–ã€æ³¨å…¥å˜é‡ï¼‰&lt;/p&gt;</summary>
    
    
    
    <category term="webpack" scheme="http://blog.ypintao.com/categories/webpack/"/>
    
    
    <category term="webpack" scheme="http://blog.ypintao.com/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>cocoså°æ¸¸æˆå¼€å‘</title>
    <link href="http://blog.ypintao.com/2025/01/01/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/cocos%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3/"/>
    <id>http://blog.ypintao.com/2025/01/01/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/cocos%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3/</id>
    <published>2025-01-01T04:00:00.000Z</published>
    <updated>2025-09-25T02:31:15.893Z</updated>
    
    
    
    
    <category term="cocos" scheme="http://blog.ypintao.com/categories/cocos/"/>
    
    
    <category term="cocos" scheme="http://blog.ypintao.com/tags/cocos/"/>
    
  </entry>
  
  <entry>
    <title>Vue2ç»„ä»¶åº“å¼€å‘</title>
    <link href="http://blog.ypintao.com/2024/06/01/%E5%89%8D%E7%AB%AF/vue/vue2%E7%BB%84%E4%BB%B6%E5%BA%93/"/>
    <id>http://blog.ypintao.com/2024/06/01/%E5%89%8D%E7%AB%AF/vue/vue2%E7%BB%84%E4%BB%B6%E5%BA%93/</id>
    <published>2024-06-01T04:00:00.000Z</published>
    <updated>2025-09-25T06:57:13.061Z</updated>
    
    <content type="html"><![CDATA[<p>Vue2ç»„ä»¶åº“å¼€å‘</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Vue2ç»„ä»¶åº“å¼€å‘&lt;/p&gt;
</summary>
      
    
    
    
    <category term="vue2" scheme="http://blog.ypintao.com/categories/vue2/"/>
    
    
    <category term="vue2" scheme="http://blog.ypintao.com/tags/vue2/"/>
    
  </entry>
  
  <entry>
    <title>Vue3é‡ç‚¹</title>
    <link href="http://blog.ypintao.com/2024/05/01/%E5%89%8D%E7%AB%AF/vue/vue3%E9%9D%A2%E8%AF%95/"/>
    <id>http://blog.ypintao.com/2024/05/01/%E5%89%8D%E7%AB%AF/vue/vue3%E9%9D%A2%E8%AF%95/</id>
    <published>2024-05-01T04:00:00.000Z</published>
    <updated>2025-09-25T06:57:20.974Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Vue-3-é¢è¯•é¢˜é›†"><a href="#Vue-3-é¢è¯•é¢˜é›†" class="headerlink" title="Vue 3 é¢è¯•é¢˜é›†"></a>Vue 3 é¢è¯•é¢˜é›†</h1><h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><h3 id="1-Vue-3-ç›¸æ¯”-Vue-2-æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ"><a href="#1-Vue-3-ç›¸æ¯”-Vue-2-æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ" class="headerlink" title="1. Vue 3 ç›¸æ¯” Vue 2 æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ"></a>1. Vue 3 ç›¸æ¯” Vue 2 æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š</p><ul><li><strong>æ€§èƒ½æå‡</strong>ï¼šVue 3 é‡å†™äº†è™šæ‹Ÿ DOM å®ç°ï¼Œæ¸²æŸ“æ€§èƒ½æå‡çº¦ 1.3~2 å€ï¼Œå†…å­˜å ç”¨å‡å°‘çº¦ 50%</li><li><strong>Composition API</strong>ï¼šæ–°å¢ç»„åˆå¼ APIï¼Œæä¾›æ›´çµæ´»çš„é€»è¾‘ç»„ç»‡å’Œå¤ç”¨æ–¹å¼</li><li><strong>TypeScript æ”¯æŒ</strong>ï¼šVue 3 æ˜¯ç”¨ TypeScript é‡å†™çš„ï¼Œæä¾›äº†æ›´å¥½çš„ç±»å‹æ¨æ–­</li><li><strong>Teleport ç»„ä»¶</strong>ï¼šå…è®¸å°†ç»„ä»¶çš„å†…å®¹ä¼ é€åˆ° DOM çš„å…¶ä»–ä½ç½®</li><li><strong>Fragments</strong>ï¼šç»„ä»¶å¯ä»¥æœ‰å¤šä¸ªæ ¹èŠ‚ç‚¹</li><li><strong>Suspense</strong>ï¼šå¤„ç†å¼‚æ­¥ç»„ä»¶çš„æ–°ç‰¹æ€§</li><li><strong>å“åº”å¼ç³»ç»Ÿå‡çº§</strong>ï¼šä½¿ç”¨ ES6 çš„ Proxy ä»£æ›¿ Object.definePropertyï¼Œè§£å†³äº† Vue 2 ä¸­çš„æ•°ç»„å’Œå¯¹è±¡å“åº”å¼é—®é¢˜</li><li><strong>å…¨å±€ API æ”¹ä¸ºåº”ç”¨å®ä¾‹è°ƒç”¨</strong>ï¼šå‡å°‘äº†å…¨å±€æ±¡æŸ“</li><li><strong>æ›´å¥½çš„ Tree-shaking æ”¯æŒ</strong>ï¼šå‡å°æ‰“åŒ…ä½“ç§¯</li></ul><span id="more"></span><h3 id="2-ä»€ä¹ˆæ˜¯-Composition-APIï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#2-ä»€ä¹ˆæ˜¯-Composition-APIï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="2. ä»€ä¹ˆæ˜¯ Composition APIï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>2. ä»€ä¹ˆæ˜¯ Composition APIï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Composition API æ˜¯ Vue 3 å¼•å…¥çš„ä¸€ç§æ–°çš„ç»„ä»¶é€»è¾‘ç»„ç»‡æ–¹å¼ï¼Œå®ƒå…è®¸æˆ‘ä»¬æŒ‰ç…§åŠŸèƒ½&#x2F;å…³æ³¨ç‚¹ç»„ç»‡ä»£ç ï¼Œè€Œä¸æ˜¯æŒ‰ç…§é€‰é¡¹ï¼ˆdataã€methodsã€computed ç­‰ï¼‰ã€‚</p><p><strong>è§£å†³çš„é—®é¢˜</strong>ï¼š</p><ul><li><strong>é€»è¾‘å¤ç”¨</strong>ï¼šç›¸æ¯”äº Vue 2 çš„ mixinsï¼ŒComposition API æä¾›äº†æ›´æ¸…æ™°ã€æ›´çµæ´»çš„é€»è¾‘å¤ç”¨æ–¹å¼</li><li><strong>æ›´å¥½çš„ç±»å‹æ¨æ–­</strong>ï¼šå¯¹ TypeScript çš„æ”¯æŒæ›´å¥½</li><li><strong>ä»£ç ç»„ç»‡</strong>ï¼šç›¸å…³åŠŸèƒ½çš„ä»£ç å¯ä»¥æ”¾åœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯åˆ†æ•£åœ¨ä¸åŒçš„é€‰é¡¹ä¸­</li><li><strong>é¿å…å‘½åå†²çª</strong>ï¼šä¸åŒåŠŸèƒ½æ¨¡å—å¯ä»¥åœ¨å„è‡ªçš„ä½œç”¨åŸŸä¸­å®šä¹‰å˜é‡ï¼Œé¿å…äº† mixins ä¸­çš„å‘½åå†²çªé—®é¢˜</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vue 2 çš„ Options API</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">user</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">age</span>: <span class="number">0</span> &#125;,</span><br><span class="line">      <span class="attr">posts</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">fetchUserData</span>(<span class="params"></span>) &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">    <span class="title function_">fetchUserPosts</span>(<span class="params"></span>) &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="title function_">userFullName</span>(<span class="params"></span>) &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue 3 çš„ Composition API</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ç”¨æˆ·ç›¸å…³é€»è¾‘</span></span><br><span class="line">    <span class="keyword">const</span> user = <span class="title function_">ref</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">age</span>: <span class="number">0</span> &#125;)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fetchUserData</span> = (<span class="params"></span>) =&gt; &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">    <span class="keyword">const</span> userFullName = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">/* ... */</span> &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ–‡ç« ç›¸å…³é€»è¾‘</span></span><br><span class="line">    <span class="keyword">const</span> posts = <span class="title function_">ref</span>([])</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fetchUserPosts</span> = (<span class="params"></span>) =&gt; &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">fetchUserData</span>()</span><br><span class="line">      <span class="title function_">fetchUserPosts</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      user,</span><br><span class="line">      posts,</span><br><span class="line">      userFullName,</span><br><span class="line">      fetchUserData,</span><br><span class="line">      fetchUserPosts</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ref-å’Œ-reactive-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å®ƒä»¬ï¼Ÿ"><a href="#3-ref-å’Œ-reactive-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å®ƒä»¬ï¼Ÿ" class="headerlink" title="3. ref å’Œ reactive æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å®ƒä»¬ï¼Ÿ"></a>3. ref å’Œ reactive æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å®ƒä»¬ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>ref å’Œ reactive éƒ½æ˜¯ç”¨äºåˆ›å»ºå“åº”å¼æ•°æ®çš„ APIï¼Œä½†å®ƒä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š</p><p><strong>ref</strong>ï¼š</p><ul><li>å¯ä»¥åŒ…è£…ä»»ä½•ç±»å‹çš„å€¼ï¼ˆåŸºæœ¬ç±»å‹å’Œå¯¹è±¡ç±»å‹ï¼‰</li><li>åˆ›å»ºä¸€ä¸ªåŒ…å« <code>.value</code> å±æ€§çš„å“åº”å¼å¯¹è±¡</li><li>åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ—¶ä¼šè‡ªåŠ¨è§£åŒ…ï¼ˆä¸éœ€è¦ <code>.value</code>ï¼‰</li><li>é€‚åˆå¤„ç†åŸºæœ¬ç±»å‹å€¼ï¼ˆå¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ï¼‰</li></ul><p><strong>reactive</strong>ï¼š</p><ul><li>åªèƒ½ç”¨äºå¯¹è±¡ç±»å‹ï¼ˆåŒ…æ‹¬æ•°ç»„å’Œæ™®é€šå¯¹è±¡ï¼‰</li><li>ç›´æ¥è¿”å›åŸå§‹å¯¹è±¡çš„å“åº”å¼ä»£ç†</li><li>ä¸èƒ½ç”¨äºåŸºæœ¬ç±»å‹å€¼</li><li>ä¸èƒ½è¢«é‡æ–°èµ‹å€¼ï¼ˆä¼šç ´åå“åº”æ€§ï¼‰</li></ul><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>å¯¹äºåŸºæœ¬ç±»å‹å€¼ï¼ˆå¦‚ stringã€numberã€booleanï¼‰ï¼Œå¿…é¡»ä½¿ç”¨ ref</li><li>å¯¹äºå¤æ‚å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ reactive æˆ– ref</li><li>å¦‚æœéœ€è¦æ•´ä½“æ›¿æ¢ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œåº”è¯¥ä½¿ç”¨ ref</li><li>å¦‚æœåªéœ€è¦ä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ reactive</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ ref</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>) <span class="comment">// 0</span></span><br><span class="line">count.<span class="property">value</span>++</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ reactive</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">count</span>) <span class="comment">// 0</span></span><br><span class="line">state.<span class="property">count</span>++</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">count</span>) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ref å¯ä»¥åŒ…è£…å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="title function_">ref</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;)</span><br><span class="line">user.<span class="property">value</span>.<span class="property">age</span>++</span><br><span class="line"><span class="comment">// æˆ–è€…æ•´ä½“æ›¿æ¢</span></span><br><span class="line">user.<span class="property">value</span> = &#123; <span class="attr">name</span>: <span class="string">&#x27;Jane&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// reactive ä¸èƒ½é‡æ–°èµ‹å€¼</span></span><br><span class="line"><span class="keyword">const</span> user2 = <span class="title function_">reactive</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;)</span><br><span class="line">user2.<span class="property">age</span>++</span><br><span class="line"><span class="comment">// ä¸‹é¢è¿™æ ·ä¼šç ´åå“åº”æ€§</span></span><br><span class="line"><span class="comment">// user2 = &#123; name: &#x27;Jane&#x27;, age: 25 &#125; // é”™è¯¯ç”¨æ³•</span></span><br></pre></td></tr></table></figure><h3 id="4-Vue-3-ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å“ªäº›å˜åŒ–ï¼Ÿ"><a href="#4-Vue-3-ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å“ªäº›å˜åŒ–ï¼Ÿ" class="headerlink" title="4. Vue 3 ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å“ªäº›å˜åŒ–ï¼Ÿ"></a>4. Vue 3 ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å“ªäº›å˜åŒ–ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸ Vue 2 ç›¸æ¯”æœ‰ä»¥ä¸‹å˜åŒ–ï¼š</p><ol><li><p><strong>å‘½åå˜åŒ–</strong>ï¼š</p><ul><li><code>beforeCreate</code> å’Œ <code>created</code> è¢« <code>setup()</code> å‡½æ•°æœ¬èº«æ›¿ä»£</li><li>å…¶ä»–é’©å­å‰ç¼€æ”¹ä¸º <code>on</code>ï¼Œå¦‚ <code>mounted</code> å˜ä¸º <code>onMounted</code></li></ul></li><li><p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼šåœ¨ Composition API ä¸­ï¼Œç”Ÿå‘½å‘¨æœŸé’©å­ä½œä¸ºå‡½æ•°å¯¼å…¥å¹¶åœ¨ <code>setup()</code> ä¸­è°ƒç”¨</p></li><li><p><strong>æ–°å¢é’©å­</strong>ï¼š</p><ul><li><code>onRenderTracked</code>ï¼šå½“ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹ä¸­è¿½è¸ªåˆ°å“åº”å¼ä¾èµ–æ—¶è°ƒç”¨</li><li><code>onRenderTriggered</code>ï¼šå½“å“åº”å¼ä¾èµ–è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶è°ƒç”¨</li></ul></li><li><p><strong>ç§»é™¤é’©å­</strong>ï¼š</p><ul><li><code>beforeDestroy</code> æ”¹åä¸º <code>beforeUnmount</code></li><li><code>destroyed</code> æ”¹åä¸º <code>unmounted</code></li></ul></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">  onBeforeMount, </span><br><span class="line">  onMounted, </span><br><span class="line">  onBeforeUpdate, </span><br><span class="line">  onUpdated, </span><br><span class="line">  onBeforeUnmount, </span><br><span class="line">  onUnmounted,</span><br><span class="line">  onActivated,</span><br><span class="line">  onDeactivated,</span><br><span class="line">  onErrorCaptured</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">onBeforeMount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç»„ä»¶æŒ‚è½½å‰&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç»„ä»¶æŒ‚è½½å®Œæˆ&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¶ä»–ç”Ÿå‘½å‘¨æœŸé’©å­...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-ä»€ä¹ˆæ˜¯-Teleportï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#5-ä»€ä¹ˆæ˜¯-Teleportï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="5. ä»€ä¹ˆæ˜¯ Teleportï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>5. ä»€ä¹ˆæ˜¯ Teleportï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Teleport æ˜¯ Vue 3 æ–°å¢çš„ä¸€ä¸ªå†…ç½®ç»„ä»¶ï¼Œå®ƒå¯ä»¥å°†ç»„ä»¶çš„ä¸€éƒ¨åˆ† DOM ä¼ é€åˆ°ç»„ä»¶ DOM æ ‘ä¹‹å¤–çš„ä½ç½®ã€‚</p><p><strong>è§£å†³çš„é—®é¢˜</strong>ï¼š</p><ul><li>è§£å†³äº†æ¨¡æ€æ¡†ã€å¼¹å‡ºèœå•ã€é€šçŸ¥ç­‰éœ€è¦æ‰“ç ´ç»„ä»¶å±‚æ¬¡ç»“æ„çš„ UI å…ƒç´ çš„å®šä½é—®é¢˜</li><li>é¿å…äº† CSS æ ·å¼ï¼ˆå¦‚ z-indexã€overflowã€positionï¼‰å¸¦æ¥çš„é™åˆ¶</li><li>ä¿æŒäº†ç»„ä»¶çš„é€»è¾‘å°è£…ï¼ŒåŒæ—¶å…è®¸ DOM ç»“æ„çš„çµæ´»å¸ƒå±€</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showModal = true&quot;</span>&gt;</span>æ‰“å¼€æ¨¡æ€æ¡†<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- ä½¿ç”¨ Teleport å°†æ¨¡æ€æ¡†ä¼ é€åˆ° body ä¸‹ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;showModal&quot;</span> <span class="attr">class</span>=<span class="string">&quot;modal&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>æ¨¡æ€æ¡†æ ‡é¢˜<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ¨¡æ€æ¡†å†…å®¹...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showModal = false&quot;</span>&gt;</span>å…³é—­<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">teleport</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> showModal = <span class="title function_">ref</span>(<span class="literal">false</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123; showModal &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å“åº”å¼ç³»ç»Ÿ"><a href="#å“åº”å¼ç³»ç»Ÿ" class="headerlink" title="å“åº”å¼ç³»ç»Ÿ"></a>å“åº”å¼ç³»ç»Ÿ</h2><h3 id="6-Vue-3-çš„å“åº”å¼ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"><a href="#6-Vue-3-çš„å“åº”å¼ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ" class="headerlink" title="6. Vue 3 çš„å“åº”å¼ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"></a>6. Vue 3 çš„å“åº”å¼ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 çš„å“åº”å¼ç³»ç»ŸåŸºäº ES6 çš„ Proxy å®ç°ï¼Œä¸»è¦å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>åˆ›å»ºå“åº”å¼å¯¹è±¡</strong>ï¼šé€šè¿‡ <code>reactive()</code> æˆ– <code>ref()</code> åˆ›å»ºå“åº”å¼å¯¹è±¡</li><li><strong>ä»£ç†æ‹¦æˆª</strong>ï¼šä½¿ç”¨ Proxy æ‹¦æˆªå¯¹è±¡çš„å±æ€§è®¿é—®ã€ä¿®æ”¹ç­‰æ“ä½œ</li><li><strong>ä¾èµ–è¿½è¸ª</strong>ï¼šå½“ç»„ä»¶æ¸²æŸ“æˆ–è®¡ç®—å±æ€§è®¡ç®—æ—¶ï¼Œä¼šè®¿é—®å“åº”å¼å¯¹è±¡çš„å±æ€§ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šè®°å½•è¿™äº›ä¾èµ–å…³ç³»</li><li><strong>å˜æ›´é€šçŸ¥</strong>ï¼šå½“å“åº”å¼å¯¹è±¡çš„å±æ€§è¢«ä¿®æ”¹æ—¶ï¼ŒProxy çš„ set å¤„ç†å™¨ä¼šè¢«è§¦å‘ï¼Œç„¶åé€šçŸ¥æ‰€æœ‰ä¾èµ–äºè¯¥å±æ€§çš„å‰¯ä½œç”¨ï¼ˆå¦‚ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼‰</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®€åŒ–ç‰ˆçš„å“åº”å¼ç³»ç»Ÿå®ç°åŸç†</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">      <span class="comment">// è¿½è¸ªä¾èµ–</span></span><br><span class="line">      <span class="title function_">track</span>(target, key)</span><br><span class="line">      <span class="keyword">const</span> value = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver)</span><br><span class="line">      <span class="comment">// å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œåˆ™é€’å½’ä½¿å…¶å“åº”å¼</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> value === <span class="string">&#x27;object&#x27;</span> ? <span class="title function_">reactive</span>(value) : value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, value, receiver</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> oldValue = target[key]</span><br><span class="line">      <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, value, receiver)</span><br><span class="line">      <span class="keyword">if</span> (oldValue !== value) &#123;</span><br><span class="line">        <span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line">        <span class="title function_">trigger</span>(target, key)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-Vue-3-ä¸­å¦‚ä½•å®ç°è®¡ç®—å±æ€§ï¼Ÿ"><a href="#7-Vue-3-ä¸­å¦‚ä½•å®ç°è®¡ç®—å±æ€§ï¼Ÿ" class="headerlink" title="7. Vue 3 ä¸­å¦‚ä½•å®ç°è®¡ç®—å±æ€§ï¼Ÿ"></a>7. Vue 3 ä¸­å¦‚ä½•å®ç°è®¡ç®—å±æ€§ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 ä¸­ä½¿ç”¨ <code>computed()</code> å‡½æ•°æ¥åˆ›å»ºè®¡ç®—å±æ€§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> firstName = <span class="title function_">ref</span>(<span class="string">&#x27;John&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> lastName = <span class="title function_">ref</span>(<span class="string">&#x27;Doe&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºåªè¯»è®¡ç®—å±æ€§</span></span><br><span class="line">    <span class="keyword">const</span> fullName = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;firstName.value&#125;</span> <span class="subst">$&#123;lastName.value&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºå¯å†™è®¡ç®—å±æ€§</span></span><br><span class="line">    <span class="keyword">const</span> fullName2 = <span class="title function_">computed</span>(&#123;</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;firstName.value&#125;</span> <span class="subst">$&#123;lastName.value&#125;</span>`</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> names = newValue.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        firstName.<span class="property">value</span> = names[<span class="number">0</span>]</span><br><span class="line">        lastName.<span class="property">value</span> = names[<span class="number">1</span>] || <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      firstName,</span><br><span class="line">      lastName,</span><br><span class="line">      fullName,</span><br><span class="line">      fullName2</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¡ç®—å±æ€§å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>åŸºäºå…¶å“åº”å¼ä¾èµ–è¿›è¡Œç¼“å­˜</li><li>åªæœ‰å½“ä¾èµ–é¡¹å˜åŒ–æ—¶æ‰ä¼šé‡æ–°è®¡ç®—</li><li>è¿”å›ä¸€ä¸ªåªè¯»çš„å“åº”å¼å¼•ç”¨</li><li>å¯ä»¥é€šè¿‡æä¾› get å’Œ set å‡½æ•°åˆ›å»ºå¯å†™çš„è®¡ç®—å±æ€§</li></ul><h3 id="8-watchEffect-å’Œ-watch-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#8-watchEffect-å’Œ-watch-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="8. watchEffect å’Œ watch æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>8. watchEffect å’Œ watch æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br><code>watchEffect</code> å’Œ <code>watch</code> éƒ½ç”¨äºä¾¦å¬å“åº”å¼æ•°æ®çš„å˜åŒ–å¹¶æ‰§è¡Œå‰¯ä½œç”¨ï¼Œä½†å®ƒä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š</p><p><strong>watchEffect</strong>ï¼š</p><ul><li>ç«‹å³æ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°ï¼Œå¹¶è‡ªåŠ¨è¿½è¸ªå…¶ä¸­çš„å“åº”å¼ä¾èµ–</li><li>å½“ä»»ä½•ä¾èµ–é¡¹å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œå›è°ƒ</li><li>ä¸éœ€è¦æ˜ç¡®æŒ‡å®šè¦ä¾¦å¬çš„æ•°æ®æº</li><li>æ— æ³•è·å–è¢«ä¾¦å¬çŠ¶æ€çš„å‰ä¸€ä¸ªå€¼</li></ul><p><strong>watch</strong>ï¼š</p><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰åœ¨ä¾¦å¬çš„æºæ•°æ®å˜åŒ–æ—¶æ‰æ‰§è¡Œå›è°ƒ</li><li>éœ€è¦æ˜ç¡®æŒ‡å®šè¦ä¾¦å¬çš„æ•°æ®æº</li><li>å¯ä»¥è®¿é—®è¢«ä¾¦å¬çŠ¶æ€çš„å½“å‰å€¼å’Œå‰ä¸€ä¸ªå€¼</li><li>æ”¯æŒä¾¦å¬å¤šä¸ªæ•°æ®æº</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, watch, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> name = <span class="title function_">ref</span>(<span class="string">&#x27;Vue&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// watchEffect ç¤ºä¾‹</span></span><br><span class="line">    <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Count is: <span class="subst">$&#123;count.value&#125;</span>, Name is: <span class="subst">$&#123;name.value&#125;</span>`</span>)</span><br><span class="line">      <span class="comment">// è‡ªåŠ¨è¿½è¸ª count å’Œ name çš„å˜åŒ–</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// watch ç¤ºä¾‹ - ä¾¦å¬å•ä¸ªæ•°æ®æº</span></span><br><span class="line">    <span class="title function_">watch</span>(count, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Count changed from <span class="subst">$&#123;oldValue&#125;</span> to <span class="subst">$&#123;newValue&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// watch ç¤ºä¾‹ - ä¾¦å¬å¤šä¸ªæ•°æ®æº</span></span><br><span class="line">    <span class="title function_">watch</span>([count, name], <span class="function">(<span class="params">[newCount, newName], [oldCount, oldName]</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Count: <span class="subst">$&#123;oldCount&#125;</span> -&gt; <span class="subst">$&#123;newCount&#125;</span>, Name: <span class="subst">$&#123;oldName&#125;</span> -&gt; <span class="subst">$&#123;newName&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// watch ç¤ºä¾‹ - æ·±åº¦ä¾¦å¬</span></span><br><span class="line">    <span class="keyword">const</span> user = <span class="title function_">ref</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;)</span><br><span class="line">    <span class="title function_">watch</span>(user, <span class="function">(<span class="params">newUser, oldUser</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;User changed:&#x27;</span>, newUser, oldUser)</span><br><span class="line">    &#125;, &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count,</span><br><span class="line">      name,</span><br><span class="line">      user</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»„ä»¶é€šä¿¡"><a href="#ç»„ä»¶é€šä¿¡" class="headerlink" title="ç»„ä»¶é€šä¿¡"></a>ç»„ä»¶é€šä¿¡</h2><h3 id="9-Vue-3-ä¸­ç»„ä»¶ä¹‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ"><a href="#9-Vue-3-ä¸­ç»„ä»¶ä¹‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ" class="headerlink" title="9. Vue 3 ä¸­ç»„ä»¶ä¹‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ"></a>9. Vue 3 ä¸­ç»„ä»¶ä¹‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 ä¸­ç»„ä»¶é€šä¿¡çš„ä¸»è¦æ–¹å¼åŒ…æ‹¬ï¼š</p><ol><li><p><strong>Props å’Œ Events</strong>ï¼š</p><ul><li>çˆ¶ç»„ä»¶é€šè¿‡ props å‘å­ç»„ä»¶ä¼ é€’æ•°æ®</li><li>å­ç»„ä»¶é€šè¿‡ emits å‘çˆ¶ç»„ä»¶å‘é€äº‹ä»¶</li></ul></li><li><p><strong>v-model</strong>ï¼š</p><ul><li>Vue 3 ä¸­çš„ v-model å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ prop å’Œäº‹ä»¶</li><li>å¯ä»¥åœ¨åŒä¸€ç»„ä»¶ä¸Šä½¿ç”¨å¤šä¸ª v-model</li></ul></li><li><p><strong>provide&#x2F;inject</strong>ï¼š</p><ul><li>é€‚ç”¨äºæ·±å±‚ç»„ä»¶åµŒå¥—çš„åœºæ™¯</li><li>ç¥–å…ˆç»„ä»¶é€šè¿‡ provide æä¾›æ•°æ®ï¼Œåä»£ç»„ä»¶é€šè¿‡ inject æ³¨å…¥æ•°æ®</li></ul></li><li><p><strong>Vuex&#x2F;Pinia</strong>ï¼š</p><ul><li>é›†ä¸­å¼çŠ¶æ€ç®¡ç†</li><li>é€‚ç”¨äºå¤æ‚åº”ç”¨çš„å…¨å±€çŠ¶æ€ç®¡ç†</li></ul></li><li><p><strong>mitt&#x2F;tiny-emitter</strong>ï¼š</p><ul><li>äº‹ä»¶æ€»çº¿ï¼Œç”¨äºä»»æ„ç»„ä»¶é—´é€šä¿¡</li><li>Vue 3 ç§»é™¤äº† $on, $off ç­‰äº‹ä»¶ APIï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å®ç°</li></ul></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Props å’Œ Events</span></span><br><span class="line"><span class="comment">// å­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;update&#x27;</span>],</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, &#123; emit &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">emit</span>(<span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;New message&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; handleClick &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çˆ¶ç»„ä»¶</span></span><br><span class="line">&lt;child-component </span><br><span class="line">  :message=<span class="string">&quot;parentMessage&quot;</span> </span><br><span class="line">  @update=<span class="string">&quot;parentMessage = $event&quot;</span> </span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// provide/inject</span></span><br><span class="line"><span class="comment">// çˆ¶ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> &#123; provide, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> theme = <span class="title function_">ref</span>(<span class="string">&#x27;light&#x27;</span>)</span><br><span class="line">    <span class="title function_">provide</span>(<span class="string">&#x27;theme&#x27;</span>, theme) <span class="comment">// æä¾›å“åº”å¼æ•°æ®</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; theme &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç»„ä»¶æˆ–åä»£ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> theme = <span class="title function_">inject</span>(<span class="string">&#x27;theme&#x27;</span>) <span class="comment">// æ³¨å…¥æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> &#123; theme &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-Vue-3-ä¸­çš„-v-model-æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ"><a href="#10-Vue-3-ä¸­çš„-v-model-æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ" class="headerlink" title="10. Vue 3 ä¸­çš„ v-model æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ"></a>10. Vue 3 ä¸­çš„ v-model æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 ä¸­çš„ v-model ç›¸æ¯” Vue 2 æœ‰ä»¥ä¸‹å˜åŒ–ï¼š</p><ol><li><p><strong>é»˜è®¤ prop å’Œäº‹ä»¶åç§°å˜åŒ–</strong>ï¼š</p><ul><li>Vue 2ï¼šprop ä¸º <code>value</code>ï¼Œäº‹ä»¶ä¸º <code>input</code></li><li>Vue 3ï¼šprop ä¸º <code>modelValue</code>ï¼Œäº‹ä»¶ä¸º <code>update:modelValue</code></li></ul></li><li><p><strong>æ”¯æŒå¤šä¸ª v-model</strong>ï¼š</p><ul><li>Vue 3 å…è®¸åœ¨åŒä¸€ç»„ä»¶ä¸Šä½¿ç”¨å¤šä¸ª v-modelï¼Œæ¯ä¸ªç»‘å®šå¯ä»¥æœ‰ä¸åŒçš„åç§°</li></ul></li><li><p><strong>ç§»é™¤ .sync ä¿®é¥°ç¬¦</strong>ï¼š</p><ul><li>Vue 3 ä¸­ v-model å¯ä»¥æ›¿ä»£ Vue 2 ä¸­çš„ .sync ä¿®é¥°ç¬¦</li></ul></li><li><p><strong>è‡ªå®šä¹‰ v-model ä¿®é¥°ç¬¦</strong>ï¼š</p><ul><li>Vue 3 æ”¯æŒè‡ªå®šä¹‰ v-model ä¿®é¥°ç¬¦</li></ul></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åŸºæœ¬ç”¨æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">custom-input</span> <span class="attr">v-model</span>=<span class="string">&quot;searchText&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç­‰ä»·äº --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">custom-input</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:modelValue</span>=<span class="string">&quot;searchText&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">update:modelValue</span>=<span class="string">&quot;searchText = $event&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¤šä¸ª v-model --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user-form</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model:name</span>=<span class="string">&quot;userName&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model:age</span>=<span class="string">&quot;userAge&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç­‰ä»·äº --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user-form</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:name</span>=<span class="string">&quot;userName&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">update:name</span>=<span class="string">&quot;userName = $event&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:age</span>=<span class="string">&quot;userAge&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">update:age</span>=<span class="string">&quot;userAge = $event&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¸¦ä¿®é¥°ç¬¦çš„ v-model --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">custom-input</span> <span class="attr">v-model.capitalize</span>=<span class="string">&quot;searchText&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>ç»„ä»¶å®ç°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å•ä¸ª v-model</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">modelValue</span>: <span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;update:modelValue&#x27;</span>],</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, &#123; emit &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleInput</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">emit</span>(<span class="string">&#x27;update:modelValue&#x27;</span>, e.<span class="property">target</span>.<span class="property">value</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; handleInput &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šä¸ª v-model</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;update:name&#x27;</span>, <span class="string">&#x27;update:age&#x27;</span>],</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, &#123; emit &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">updateName</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">emit</span>(<span class="string">&#x27;update:name&#x27;</span>, name)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">updateAge</span> = (<span class="params">age</span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">emit</span>(<span class="string">&#x27;update:age&#x27;</span>, age)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; updateName, updateAge &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ä¿®é¥°ç¬¦</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">modelValue</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">modelModifiers</span>: &#123;</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> (&#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;update:modelValue&#x27;</span>],</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, &#123; emit &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleInput</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> value = e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// åº”ç”¨ä¿®é¥°ç¬¦</span></span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">modelModifiers</span>.<span class="property">capitalize</span>) &#123;</span><br><span class="line">        value = value.<span class="title function_">charAt</span>(<span class="number">0</span>).<span class="title function_">toUpperCase</span>() + value.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="title function_">emit</span>(<span class="string">&#x27;update:modelValue&#x27;</span>, value)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; handleInput &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h2><h3 id="11-Vue-3-ä¸­å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Ÿ"><a href="#11-Vue-3-ä¸­å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Ÿ" class="headerlink" title="11. Vue 3 ä¸­å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Ÿ"></a>11. Vue 3 ä¸­å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 ä¸­çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•åŒ…æ‹¬ï¼š</p><ol><li><p><strong>ä½¿ç”¨ v-memo å‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</strong>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-memo</span>=<span class="string">&quot;[item.id === selected]&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- åªæœ‰å½“ item.id === selected å˜åŒ–æ—¶æ‰ä¼šé‡æ–°æ¸²æŸ“ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ v-once æ¸²æŸ“é™æ€å†…å®¹</strong>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-once</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- åªæ¸²æŸ“ä¸€æ¬¡ï¼Œä¹‹åä¸å†æ›´æ–° --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ computed ç¼“å­˜è®¡ç®—ç»“æœ</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> filteredItems = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> items.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">price</span> &gt; <span class="number">100</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ shallowRef å’Œ shallowReactive å‡å°‘æ·±å±‚å“åº”</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åªæœ‰ state çš„é¡¶å±‚å±æ€§æ˜¯å“åº”å¼çš„</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">shallowReactive</span>(&#123;</span><br><span class="line">  <span class="attr">user</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">address</span>: &#123; <span class="attr">city</span>: <span class="string">&#x27;New York&#x27;</span> &#125; &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ defineAsyncComponent å¼‚æ­¥åŠ è½½ç»„ä»¶</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">AsyncComponent</span> = <span class="title function_">defineAsyncComponent</span>(<span class="function">() =&gt;</span> </span><br><span class="line">  <span class="keyword">import</span>(<span class="string">&#x27;./components/AsyncComponent.vue&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ KeepAlive ç¼“å­˜ç»„ä»¶å®ä¾‹</strong>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;currentComponent&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ Suspense å¤„ç†å¼‚æ­¥ä¾èµ–</strong>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">suspense</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">async-component</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">fallback</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loading-spinner</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">suspense</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨æ¸²æŸ“å¤§é‡æ•°æ®</strong>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">virtual-list</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:items</span>=<span class="string">&quot;items&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:item-height</span>=<span class="string">&quot;50&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-slot</span>=<span class="string">&quot;&#123; item &#125;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">virtual-list</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="12-Vue-3-ä¸­å¦‚ä½•å®ç°è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ"><a href="#12-Vue-3-ä¸­å¦‚ä½•å®ç°è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ" class="headerlink" title="12. Vue 3 ä¸­å¦‚ä½•å®ç°è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ"></a>12. Vue 3 ä¸­å¦‚ä½•å®ç°è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 ä¸­è‡ªå®šä¹‰æŒ‡ä»¤çš„å®ç°æ–¹å¼ä¸ Vue 2 æœ‰æ‰€ä¸åŒï¼Œä¸»è¦å˜åŒ–åœ¨äºé’©å­å‡½æ•°çš„åç§°ä¸ç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¨å±€æ³¨å†Œ</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    el.<span class="title function_">focus</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å±€éƒ¨æ³¨å†Œ</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">directives</span>: &#123;</span><br><span class="line">    <span class="attr">focus</span>: &#123;</span><br><span class="line">      <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">        el.<span class="title function_">focus</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Vue 3 ä¸­è‡ªå®šä¹‰æŒ‡ä»¤çš„é’©å­å‡½æ•°åŒ…æ‹¬ï¼š</p><ul><li><code>created</code>ï¼šåœ¨ç»‘å®šå…ƒç´ çš„ attribute æˆ–äº‹ä»¶ç›‘å¬å™¨è¢«åº”ç”¨ä¹‹å‰è°ƒç”¨</li><li><code>beforeMount</code>ï¼šåœ¨å…ƒç´ è¢«æ’å…¥åˆ° DOM ä¹‹å‰è°ƒç”¨</li><li><code>mounted</code>ï¼šåœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶è¢«æŒ‚è½½åè°ƒç”¨</li><li><code>beforeUpdate</code>ï¼šåœ¨åŒ…å«ç»„ä»¶çš„ VNode æ›´æ–°ä¹‹å‰è°ƒç”¨</li><li><code>updated</code>ï¼šåœ¨åŒ…å«ç»„ä»¶çš„ VNode åŠå…¶å­ç»„ä»¶çš„ VNode æ›´æ–°ä¹‹åè°ƒç”¨</li><li><code>beforeUnmount</code>ï¼šåœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶å¸è½½ä¹‹å‰è°ƒç”¨</li><li><code>unmounted</code>ï¼šå½“æŒ‡ä»¤ä¸å…ƒç´ è§£é™¤ç»‘å®šä¸”çˆ¶ç»„ä»¶å·²å¸è½½æ—¶è°ƒç”¨</li></ul><p>è‡ªå®šä¹‰æŒ‡ä»¤çš„å‚æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">directive</span>(<span class="string">&#x27;my-directive&#x27;</span>, <span class="function">(<span class="params">el, binding, vnode, prevVnode</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// binding åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</span></span><br><span class="line">  <span class="comment">// valueï¼šä¼ é€’ç»™æŒ‡ä»¤çš„å€¼</span></span><br><span class="line">  <span class="comment">// oldValueï¼šä¹‹å‰çš„å€¼ï¼Œä»…åœ¨ beforeUpdate å’Œ updated ä¸­å¯ç”¨</span></span><br><span class="line">  <span class="comment">// argï¼šä¼ é€’ç»™æŒ‡ä»¤çš„å‚æ•°ï¼Œå¦‚ v-my-directive:arg</span></span><br><span class="line">  <span class="comment">// modifiersï¼šåŒ…å«ä¿®é¥°ç¬¦çš„å¯¹è±¡ï¼Œå¦‚ v-my-directive.foo.bar ä¸­ï¼Œmodifiers ä¸º &#123; foo: true, bar: true &#125;</span></span><br><span class="line">  <span class="comment">// instanceï¼šä½¿ç”¨è¯¥æŒ‡ä»¤çš„ç»„ä»¶å®ä¾‹</span></span><br><span class="line">  <span class="comment">// dirï¼šæŒ‡ä»¤å®šä¹‰å¯¹è±¡</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="å·¥ç¨‹åŒ–ä¸ç”Ÿæ€"><a href="#å·¥ç¨‹åŒ–ä¸ç”Ÿæ€" class="headerlink" title="å·¥ç¨‹åŒ–ä¸ç”Ÿæ€"></a>å·¥ç¨‹åŒ–ä¸ç”Ÿæ€</h2><h3 id="13-Vue-3-ä¸­å¦‚ä½•ä½¿ç”¨-TypeScriptï¼Ÿ"><a href="#13-Vue-3-ä¸­å¦‚ä½•ä½¿ç”¨-TypeScriptï¼Ÿ" class="headerlink" title="13. Vue 3 ä¸­å¦‚ä½•ä½¿ç”¨ TypeScriptï¼Ÿ"></a>13. Vue 3 ä¸­å¦‚ä½•ä½¿ç”¨ TypeScriptï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 å¯¹ TypeScript æœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œä¸»è¦ä½¿ç”¨æ–¹å¼åŒ…æ‹¬ï¼š</p><ol><li><p><strong>ä½¿ç”¨ defineComponent åŒ…è£…ç»„ä»¶é€‰é¡¹</strong>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>åœ¨ setup å‡½æ•°ä¸­ä½¿ç”¨ç±»å‹æ³¨è§£</strong>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, ref, <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">count</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt; = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">User</span>&gt; = <span class="title function_">ref</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; count, user &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ defineProps å’Œ defineEmits</strong>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="comment">// ä½¿ç”¨è¿è¡Œæ—¶å£°æ˜</span></span><br><span class="line"><span class="keyword">const</span> props = defineProps&lt;&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>?: <span class="built_in">number</span>;</span><br><span class="line">&#125;&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emit = defineEmits&lt;&#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&#x27;update&#x27;</span>, <span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&#x27;delete&#x27;</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;&gt;()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line"><span class="title function_">withDefaults</span>(defineProps&lt;&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>?: <span class="built_in">number</span>;</span><br><span class="line">&#125;&gt;(), &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¸º ref å’Œ reactive æä¾›ç±»å‹</strong>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸º ref æä¾›ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> user = ref&lt;<span class="title class_">User</span>&gt;(&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸º reactive æä¾›ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> state = reactive&lt;&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">users</span>: <span class="title class_">User</span>[];</span><br><span class="line">&#125;&gt;(&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">users</span>: []</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ PropType å®šä¹‰å¤æ‚ prop ç±»å‹</strong>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, <span class="title class_">PropType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">user</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Object</span> <span class="keyword">as</span> <span class="title class_">PropType</span>&lt;<span class="title class_">User</span>&gt;,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">callback</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Function</span> <span class="keyword">as</span> <span class="title class_">PropType</span>&lt;<span class="function">(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span>&gt;,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><h3 id="14-Vue-3-ä¸­å¦‚ä½•ä½¿ç”¨-Pinia-è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Ÿ"><a href="#14-Vue-3-ä¸­å¦‚ä½•ä½¿ç”¨-Pinia-è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Ÿ" class="headerlink" title="14. Vue 3 ä¸­å¦‚ä½•ä½¿ç”¨ Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Ÿ"></a>14. Vue 3 ä¸­å¦‚ä½•ä½¿ç”¨ Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Pinia æ˜¯ Vue å®˜æ–¹æ¨èçš„çŠ¶æ€ç®¡ç†åº“ï¼Œç”¨äºæ›¿ä»£ Vuexã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><ol><li><p><strong>å®‰è£… Pinia</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ›å»º Pinia å®ä¾‹å¹¶æŒ‚è½½åˆ°åº”ç”¨</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(pinia)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p><strong>å®šä¹‰ Store</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stores/counter.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åº”ç”¨ä¸­ store çš„å”¯ä¸€ ID</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">// state</span></span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Eduardo&#x27;</span></span><br><span class="line">  &#125;),</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// getters</span></span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">doubleCount</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span>,</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ this è®¿é—®å…¶ä»– getter</span></span><br><span class="line">    <span class="title function_">doubleCountPlusOne</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">doubleCount</span> + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// actions</span></span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> api.<span class="title function_">get</span>(<span class="string">&#x27;...&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span> = data.<span class="property">count</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ Setup Stores</strong>ï¼ˆæ›´ç®€æ´çš„è¯­æ³•ï¼‰ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// state</span></span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> name = <span class="title function_">ref</span>(<span class="string">&#x27;Eduardo&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// getters</span></span><br><span class="line">  <span class="keyword">const</span> doubleCount = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> count.<span class="property">value</span> * <span class="number">2</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// actions</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">    count.<span class="property">value</span>++</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123; count, name, doubleCount, increment &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Store</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Count: &#123;&#123; counter.count &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;Double count: &#123;&#123; counter.doubleCount &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;button @click=&quot;counter.increment()&quot;&gt;Increment&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;increment&quot;&gt;Increment (extracted)&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useCounterStore &#125; from &#x27;@/stores/counter&#x27;</span><br><span class="line">import &#123; storeToRefs &#125; from &#x27;pinia&#x27;</span><br><span class="line"></span><br><span class="line">const counter = useCounterStore()</span><br><span class="line"></span><br><span class="line">// è§£æ„ store æ—¶ä¿æŒå“åº”æ€§</span><br><span class="line">const &#123; count, doubleCount &#125; = storeToRefs(counter)</span><br><span class="line">// ç›´æ¥è§£æ„ actions</span><br><span class="line">const &#123; increment &#125; = counter</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¿®æ”¹ State</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼ 1ï¼šç›´æ¥ä¿®æ”¹</span></span><br><span class="line">counter.<span class="property">count</span>++</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼ 2ï¼šä½¿ç”¨ $patch æ–¹æ³•</span></span><br><span class="line">counter.$patch(&#123;</span><br><span class="line">  <span class="attr">count</span>: counter.<span class="property">count</span> + <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Alex&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼ 3ï¼šä½¿ç”¨ $patch å‡½æ•°</span></span><br><span class="line">counter.$patch(<span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">  state.<span class="property">count</span>++</span><br><span class="line">  state.<span class="property">name</span> = <span class="string">&#x27;Alex&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼ 4ï¼šä½¿ç”¨ actions</span></span><br><span class="line">counter.<span class="title function_">increment</span>()</span><br></pre></td></tr></table></figure></li><li><p><strong>é‡ç½® State</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">counter.$reset()</span><br></pre></td></tr></table></figure></li></ol><h3 id="15-Vue-3-ä¸­çš„-script-setup-è¯­æ³•æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"><a href="#15-Vue-3-ä¸­çš„-script-setup-è¯­æ³•æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ" class="headerlink" title="15. Vue 3 ä¸­çš„ script setup è¯­æ³•æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"></a>15. Vue 3 ä¸­çš„ script setup è¯­æ³•æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br><code>&lt;script setup&gt;</code> æ˜¯ Vue 3.2 å¼•å…¥çš„ç¼–è¯‘æ—¶è¯­æ³•ç³–ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p><ol><li><p><strong>æ›´å°‘çš„æ ·æ¿ä»£ç </strong>ï¼š</p><ul><li>ä¸éœ€è¦è¿”å›è¦æš´éœ²ç»™æ¨¡æ¿çš„å˜é‡</li><li>å¯¼å…¥çš„ç»„ä»¶è‡ªåŠ¨æ³¨å†Œï¼Œæ— éœ€åœ¨ components é€‰é¡¹ä¸­å£°æ˜</li></ul></li><li><p><strong>æ›´å¥½çš„æ€§èƒ½</strong>ï¼š</p><ul><li>ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œå‡å°‘è¿è¡Œæ—¶å¼€é”€</li><li>æ¨¡æ¿ä¸­çš„å˜é‡è®¿é—®ä¸éœ€è¦é€šè¿‡ä»£ç†</li></ul></li><li><p><strong>æ›´å¥½çš„ TypeScript æ”¯æŒ</strong>ï¼š</p><ul><li>ç›´æ¥åœ¨ <code>&lt;script setup&gt;</code> ä¸­ä½¿ç”¨ TypeScript</li><li>ä½¿ç”¨ defineProps å’Œ defineEmits è·å¾—å®Œæ•´çš„ç±»å‹æ¨æ–­</li></ul></li><li><p><strong>æ›´å¥½çš„ IDE æ”¯æŒ</strong>ï¼š</p><ul><li>æ›´å¥½çš„è‡ªåŠ¨è¡¥å…¨</li><li>æ›´å‡†ç¡®çš„ç±»å‹æ£€æŸ¥</li></ul></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, computed &#125; from &#x27;vue&#x27;</span><br><span class="line">import MyComponent from &#x27;./MyComponent.vue&#x27; // è‡ªåŠ¨æ³¨å†Œ</span><br><span class="line"></span><br><span class="line">// å£°æ˜å“åº”å¼çŠ¶æ€</span><br><span class="line">const count = ref(0)</span><br><span class="line"></span><br><span class="line">// è®¡ç®—å±æ€§</span><br><span class="line">const doubleCount = computed(() =&gt; count.value * 2)</span><br><span class="line"></span><br><span class="line">// æ–¹æ³•</span><br><span class="line">function increment() &#123;</span><br><span class="line">  count.value++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç”Ÿå‘½å‘¨æœŸé’©å­</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  console.log(&#x27;Component mounted&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// ç›´æ¥å¯¼å…¥å¹¶ä½¿ç”¨ç»„ä»¶ï¼Œæ— éœ€æ³¨å†Œ</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Count: &#123;&#123; count &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;Double count: &#123;&#123; doubleCount &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;button @click=&quot;increment&quot;&gt;Increment&lt;/button&gt;</span><br><span class="line">    &lt;MyComponent /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ defineProps å’Œ defineEmitsï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">// å£°æ˜ props</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  title: String,</span><br><span class="line">  likes: &#123;</span><br><span class="line">    type: Number,</span><br><span class="line">    default: 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// å£°æ˜ emits</span><br><span class="line">const emit = defineEmits([&#x27;update&#x27;, &#x27;delete&#x27;])</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨ emit</span><br><span class="line">function handleClick() &#123;</span><br><span class="line">  emit(&#x27;update&#x27;, 123)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ TypeScriptï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">// ä½¿ç”¨ç±»å‹å£°æ˜ props</span><br><span class="line">const props = defineProps&lt;&#123;</span><br><span class="line">  title: string;</span><br><span class="line">  likes?: number;</span><br><span class="line">&#125;&gt;()</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨ç±»å‹å£°æ˜ emits</span><br><span class="line">const emit = defineEmits&lt;&#123;</span><br><span class="line">  (e: &#x27;update&#x27;, id: number): void;</span><br><span class="line">  (e: &#x27;delete&#x27;): void;</span><br><span class="line">&#125;&gt;()</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="é€‚åˆå¿«é€Ÿç†Ÿæ‚‰-Vue-3-çš„-GitHub-é¡¹ç›®"><a href="#é€‚åˆå¿«é€Ÿç†Ÿæ‚‰-Vue-3-çš„-GitHub-é¡¹ç›®" class="headerlink" title="é€‚åˆå¿«é€Ÿç†Ÿæ‚‰ Vue 3 çš„ GitHub é¡¹ç›®"></a>é€‚åˆå¿«é€Ÿç†Ÿæ‚‰ Vue 3 çš„ GitHub é¡¹ç›®</h2><p>ä»¥ä¸‹æ˜¯ä¸€äº›ä¼˜è´¨çš„ Vue 3 é¡¹ç›®ï¼Œå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿç†Ÿæ‚‰ Vue 3 çš„å„ç§ç‰¹æ€§å’Œæœ€ä½³å®è·µï¼š</p><ol><li><p><strong>Vue 3 å®˜æ–¹ç¤ºä¾‹</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/vuejs/vue-next-examples">https://github.com/vuejs/vue-next-examples</a></li><li>æè¿°ï¼šVue å›¢é˜Ÿæä¾›çš„ Vue 3 ç¤ºä¾‹é›†åˆï¼Œæ¶µç›–äº†å„ç§ API çš„ä½¿ç”¨æ–¹æ³•</li></ul></li><li><p><strong>Hoppscotch</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/hoppscotch/hoppscotch">https://github.com/hoppscotch/hoppscotch</a></li><li>æè¿°ï¼šå¼€æºçš„ API å¼€å‘ç”Ÿæ€ç³»ç»Ÿï¼Œä½¿ç”¨ Vue 3 + TypeScript æ„å»ºï¼Œæ‹¥æœ‰ 55K+ stars</li></ul></li><li><p><strong>VueUse</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/vueuse/vueuse">https://github.com/vueuse/vueuse</a></li><li>æè¿°ï¼šVue Composition API çš„å®ç”¨å·¥å…·é›†åˆï¼ŒåŒ…å«å¤§é‡å¯å¤ç”¨çš„ç»„åˆå¼å‡½æ•°</li></ul></li><li><p><strong>Element Plus</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/element-plus/element-plus">https://github.com/element-plus/element-plus</a></li><li>æè¿°ï¼šåŸºäº Vue 3 çš„æ¡Œé¢ç«¯ç»„ä»¶åº“</li></ul></li><li><p><strong>Vite</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/vitejs/vite">https://github.com/vitejs/vite</a></li><li>æè¿°ï¼šä¸‹ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…·ï¼Œç”± Vue ä½œè€…å°¤é›¨æºªåˆ›å»ºï¼Œä¸ Vue 3 é…åˆä½¿ç”¨æ•ˆæœæœ€ä½³</li></ul></li><li><p><strong>Vue 3 Instagram Clone</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/selemondev/8-Awesome-Vue-Projects">https://github.com/selemondev/8-Awesome-Vue-Projects</a></li><li>æè¿°ï¼šä½¿ç”¨ Vue 3ã€Piniaã€TailwindCSS å’Œ Firebase æ„å»ºçš„ Instagram å…‹éš†é¡¹ç›®</li></ul></li><li><p><strong>Vue 3 Whatsapp Clone</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/selemondev/8-Awesome-Vue-Projects">https://github.com/selemondev/8-Awesome-Vue-Projects</a></li><li>æè¿°ï¼šä½¿ç”¨ Vue 3ã€Piniaã€TailwindCSS å’Œ Firebase æ„å»ºçš„ Whatsapp å…‹éš†é¡¹ç›®</li></ul></li><li><p><strong>Vue 3 Netflix Clone</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/selemondev/8-Awesome-Vue-Projects">https://github.com/selemondev/8-Awesome-Vue-Projects</a></li><li>æè¿°ï¼šä½¿ç”¨ Vue 3ã€Supabaseã€Pinia å’Œ TailwindCSS æ„å»ºçš„ Netflix å…‹éš†é¡¹ç›®</li></ul></li><li><p><strong>Elk</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/elk-zone/elk">https://github.com/elk-zone/elk</a></li><li>æè¿°ï¼šä¸€ä¸ª Mastodon ç½‘é¡µå®¢æˆ·ç«¯ï¼Œä½¿ç”¨ Vue 3 å’Œ Nuxt 3 æ„å»º</li></ul></li><li><p><strong>Pinia</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/vuejs/pinia">https://github.com/vuejs/pinia</a></li><li>æè¿°ï¼šVue å®˜æ–¹æ¨èçš„çŠ¶æ€ç®¡ç†åº“ï¼Œäº†è§£å…¶æºç æœ‰åŠ©äºæ·±å…¥ç†è§£ Vue 3 çš„å“åº”å¼ç³»ç»Ÿ</li></ul></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;Vue-3-é¢è¯•é¢˜é›†&quot;&gt;&lt;a href=&quot;#Vue-3-é¢è¯•é¢˜é›†&quot; class=&quot;headerlink&quot; title=&quot;Vue 3 é¢è¯•é¢˜é›†&quot;&gt;&lt;/a&gt;Vue 3 é¢è¯•é¢˜é›†&lt;/h1&gt;&lt;h2 id=&quot;åŸºç¡€æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#åŸºç¡€æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;åŸºç¡€æ¦‚å¿µ&quot;&gt;&lt;/a&gt;åŸºç¡€æ¦‚å¿µ&lt;/h2&gt;&lt;h3 id=&quot;1-Vue-3-ç›¸æ¯”-Vue-2-æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-Vue-3-ç›¸æ¯”-Vue-2-æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1. Vue 3 ç›¸æ¯” Vue 2 æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ&quot;&gt;&lt;/a&gt;1. Vue 3 ç›¸æ¯” Vue 2 æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç­”æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½æå‡&lt;/strong&gt;ï¼šVue 3 é‡å†™äº†è™šæ‹Ÿ DOM å®ç°ï¼Œæ¸²æŸ“æ€§èƒ½æå‡çº¦ 1.3~2 å€ï¼Œå†…å­˜å ç”¨å‡å°‘çº¦ 50%&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Composition API&lt;/strong&gt;ï¼šæ–°å¢ç»„åˆå¼ APIï¼Œæä¾›æ›´çµæ´»çš„é€»è¾‘ç»„ç»‡å’Œå¤ç”¨æ–¹å¼&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TypeScript æ”¯æŒ&lt;/strong&gt;ï¼šVue 3 æ˜¯ç”¨ TypeScript é‡å†™çš„ï¼Œæä¾›äº†æ›´å¥½çš„ç±»å‹æ¨æ–­&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Teleport ç»„ä»¶&lt;/strong&gt;ï¼šå…è®¸å°†ç»„ä»¶çš„å†…å®¹ä¼ é€åˆ° DOM çš„å…¶ä»–ä½ç½®&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Fragments&lt;/strong&gt;ï¼šç»„ä»¶å¯ä»¥æœ‰å¤šä¸ªæ ¹èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Suspense&lt;/strong&gt;ï¼šå¤„ç†å¼‚æ­¥ç»„ä»¶çš„æ–°ç‰¹æ€§&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å“åº”å¼ç³»ç»Ÿå‡çº§&lt;/strong&gt;ï¼šä½¿ç”¨ ES6 çš„ Proxy ä»£æ›¿ Object.definePropertyï¼Œè§£å†³äº† Vue 2 ä¸­çš„æ•°ç»„å’Œå¯¹è±¡å“åº”å¼é—®é¢˜&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€ API æ”¹ä¸ºåº”ç”¨å®ä¾‹è°ƒç”¨&lt;/strong&gt;ï¼šå‡å°‘äº†å…¨å±€æ±¡æŸ“&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›´å¥½çš„ Tree-shaking æ”¯æŒ&lt;/strong&gt;ï¼šå‡å°æ‰“åŒ…ä½“ç§¯&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="vue3" scheme="http://blog.ypintao.com/categories/vue3/"/>
    
    
    <category term="vue3" scheme="http://blog.ypintao.com/tags/vue3/"/>
    
  </entry>
  
  <entry>
    <title>webpack æ’ä»¶å¦‚ä½•ç¼–å†™</title>
    <link href="http://blog.ypintao.com/2024/04/01/tools/webpack%20%E6%8F%92%E4%BB%B6%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99/"/>
    <id>http://blog.ypintao.com/2024/04/01/tools/webpack%20%E6%8F%92%E4%BB%B6%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99/</id>
    <published>2024-04-01T04:00:00.000Z</published>
    <updated>2025-12-07T14:45:51.824Z</updated>
    
    <content type="html"><![CDATA[<p>ç¼–å†™ Webpack æ’ä»¶å¯ä»¥å¸®åŠ©ä½ åœ¨ Webpack æ„å»ºè¿‡ç¨‹ä¸­æ·»åŠ è‡ªå®šä¹‰è¡Œä¸ºã€‚Webpack æ’ä»¶æ˜¯ä¸€ä¸ªå…·æœ‰ apply æ–¹æ³•çš„ JavaScript å¯¹è±¡ã€‚è¿™ä¸ª apply æ–¹æ³•ä¼šåœ¨ Webpack ç¼–è¯‘å™¨å®ä¾‹ä¸Šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è®¿é—® Webpack çš„ç¼–è¯‘å™¨å¯¹è±¡ï¼Œä»è€Œåœ¨ç‰¹å®šçš„ç¼–è¯‘é˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚   ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ­¥éª¤æŒ‡å—å’Œç¤ºä¾‹ä»£ç ï¼Œå¸®åŠ©ä½ ç¼–å†™ä¸€ä¸ªåŸºæœ¬çš„ Webpack æ’ä»¶ã€‚<br>æ­¥éª¤æŒ‡å—<br>åˆ›å»ºæ’ä»¶å¯¹è±¡ï¼šåˆ›å»ºä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œå¹¶å®šä¹‰ä¸€ä¸ª apply æ–¹æ³•ã€‚<br>è®¿é—®ç¼–è¯‘å™¨å¯¹è±¡ï¼šåœ¨ apply æ–¹æ³•ä¸­ï¼Œé€šè¿‡å‚æ•°è®¿é—® Webpack ç¼–è¯‘å™¨å¯¹è±¡ã€‚<br>ç»‘å®šé’©å­ï¼šä½¿ç”¨ç¼–è¯‘å™¨å¯¹è±¡æä¾›çš„é’©å­æ¥ç»‘å®šä½ çš„æ’ä»¶é€»è¾‘ã€‚<br>å¯¼å‡ºæ’ä»¶ï¼šå°†ä½ çš„æ’ä»¶å¯¹è±¡å¯¼å‡ºï¼Œä»¥ä¾¿åœ¨ Webpack é…ç½®ä¸­ä½¿ç”¨ã€‚<br>ç¤ºä¾‹ä»£ç <br>å‡è®¾æˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªç®€å•çš„æ’ä»¶ï¼Œåœ¨ Webpack æ„å»ºå®Œæˆåè¾“å‡ºä¸€æ¡æ¶ˆæ¯åˆ°æ§åˆ¶å°ã€‚<br>åˆ›å»ºæ’ä»¶æ–‡ä»¶   é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ MyWebpackPlugin.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><span id="more"></span><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;./MyWebpackPlugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MyWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;è‡ªå®šä¹‰æ„å»ºæ¶ˆæ¯ï¼šæ„å»ºæˆåŠŸï¼&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¯¦ç»†è¯´æ˜<br>æ’ä»¶å¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyWebpackPlugin</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">options</span> = options;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">done</span>.<span class="title function_">tap</span>(<span class="string">&#x27;MyWebpackPlugin&#x27;</span>, <span class="function">(<span class="params">stats</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Webpack æ„å»ºå®Œæˆï¼&#x27;</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æ„å»ºæ—¶é—´: <span class="subst">$&#123;stats.endTime - stats.startTime&#125;</span> ms`</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">message</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">message</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°ï¼šç”¨äºæ¥æ”¶é…ç½®é€‰é¡¹ã€‚<br>apply æ–¹æ³•ï¼šè¿™æ˜¯æ’ä»¶çš„æ ¸å¿ƒæ–¹æ³•ã€‚å®ƒä¼šåœ¨ Webpack ç¼–è¯‘å™¨å®ä¾‹ä¸Šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”ä½ å¯ä»¥é€šè¿‡å‚æ•°è®¿é—®ç¼–è¯‘å™¨å¯¹è±¡ã€‚<br>ç»‘å®šé’©å­ï¼šåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† compiler.hooks.done.tap æ¥ç»‘å®šåˆ° Webpack çš„ done é’©å­ã€‚done é’©å­åœ¨æ„å»ºå®Œæˆæ—¶è§¦å‘ã€‚tap æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ’ä»¶çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä¼šåœ¨é’©å­è§¦å‘æ—¶æ‰§è¡Œ</p><p>ä½¿ç”¨æ’ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;./MyWebpackPlugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MyWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;è‡ªå®šä¹‰æ„å»ºæ¶ˆæ¯ï¼šæ„å»ºæˆåŠŸï¼&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¼•å…¥æ’ä»¶ï¼šä½¿ç”¨ require å¼•å…¥ä½ ç¼–å†™çš„æ’ä»¶ã€‚<br>é…ç½®æ’ä»¶ï¼šåœ¨ plugins æ•°ç»„ä¸­å®ä¾‹åŒ–ä½ çš„æ’ä»¶ï¼Œå¹¶ä¼ å…¥é…ç½®é€‰é¡¹ã€‚<br>æ›´å¤šé’©å­<br>Webpack æä¾›äº†è®¸å¤šä¸åŒçš„é’©å­ï¼Œå¯ä»¥åœ¨ä¸åŒçš„ç¼–è¯‘é˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„é’©å­ï¼š<br>compiler.hooks.compileï¼šåœ¨ç¼–è¯‘å¼€å§‹æ—¶è§¦å‘ã€‚<br>compiler.hooks.emitï¼šåœ¨ç”Ÿæˆæ–‡ä»¶ä¹‹å‰è§¦å‘ï¼Œå¯ä»¥ç”¨æ¥ä¿®æ”¹ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹ã€‚<br>compiler.hooks.doneï¼šåœ¨ç¼–è¯‘å®Œæˆæ—¶è§¦å‘ã€‚<br>compilation.hooks.moduleIdsï¼šåœ¨æ¨¡å— ID åˆ†é…æ—¶è§¦å‘ã€‚<br>compilation.hooks.chunkIdsï¼šåœ¨ chunk ID åˆ†é…æ—¶è§¦å‘ã€‚<br>compilation.hooks.optimizeDependenciesï¼šåœ¨ä¼˜åŒ–ä¾èµ–æ—¶è§¦å‘ã€‚<br>ä½ å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„é’©å­æ¥å®ç°ä½ çš„æ’ä»¶åŠŸèƒ½ã€‚<br>æ€»ç»“<br>ç¼–å†™ Webpack æ’ä»¶çš„åŸºæœ¬æ­¥éª¤åŒ…æ‹¬åˆ›å»ºæ’ä»¶å¯¹è±¡ã€å®šä¹‰ apply æ–¹æ³•ã€è®¿é—®ç¼–è¯‘å™¨å¯¹è±¡ã€ç»‘å®šé’©å­ä»¥åŠå¯¼å‡ºæ’ä»¶ã€‚é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œä½ å¯ä»¥ä¸º Webpack æ„å»ºè¿‡ç¨‹æ·»åŠ å„ç§è‡ªå®šä¹‰è¡Œä¸ºï¼Œä»è€Œæ›´å¥½åœ°æ»¡è¶³é¡¹ç›®çš„ç‰¹å®šéœ€æ±‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç¼–å†™ Webpack æ’ä»¶å¯ä»¥å¸®åŠ©ä½ åœ¨ Webpack æ„å»ºè¿‡ç¨‹ä¸­æ·»åŠ è‡ªå®šä¹‰è¡Œä¸ºã€‚Webpack æ’ä»¶æ˜¯ä¸€ä¸ªå…·æœ‰ apply æ–¹æ³•çš„ JavaScript å¯¹è±¡ã€‚è¿™ä¸ª apply æ–¹æ³•ä¼šåœ¨ Webpack ç¼–è¯‘å™¨å®ä¾‹ä¸Šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è®¿é—® Webpack çš„ç¼–è¯‘å™¨å¯¹è±¡ï¼Œä»è€Œåœ¨ç‰¹å®šçš„ç¼–è¯‘é˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚   ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ­¥éª¤æŒ‡å—å’Œç¤ºä¾‹ä»£ç ï¼Œå¸®åŠ©ä½ ç¼–å†™ä¸€ä¸ªåŸºæœ¬çš„ Webpack æ’ä»¶ã€‚&lt;br&gt;æ­¥éª¤æŒ‡å—&lt;br&gt;åˆ›å»ºæ’ä»¶å¯¹è±¡ï¼šåˆ›å»ºä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œå¹¶å®šä¹‰ä¸€ä¸ª apply æ–¹æ³•ã€‚&lt;br&gt;è®¿é—®ç¼–è¯‘å™¨å¯¹è±¡ï¼šåœ¨ apply æ–¹æ³•ä¸­ï¼Œé€šè¿‡å‚æ•°è®¿é—® Webpack ç¼–è¯‘å™¨å¯¹è±¡ã€‚&lt;br&gt;ç»‘å®šé’©å­ï¼šä½¿ç”¨ç¼–è¯‘å™¨å¯¹è±¡æä¾›çš„é’©å­æ¥ç»‘å®šä½ çš„æ’ä»¶é€»è¾‘ã€‚&lt;br&gt;å¯¼å‡ºæ’ä»¶ï¼šå°†ä½ çš„æ’ä»¶å¯¹è±¡å¯¼å‡ºï¼Œä»¥ä¾¿åœ¨ Webpack é…ç½®ä¸­ä½¿ç”¨ã€‚&lt;br&gt;ç¤ºä¾‹ä»£ç &lt;br&gt;å‡è®¾æˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªç®€å•çš„æ’ä»¶ï¼Œåœ¨ Webpack æ„å»ºå®Œæˆåè¾“å‡ºä¸€æ¡æ¶ˆæ¯åˆ°æ§åˆ¶å°ã€‚&lt;br&gt;åˆ›å»ºæ’ä»¶æ–‡ä»¶   é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ MyWebpackPlugin.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;</summary>
    
    
    
    <category term="webpack" scheme="http://blog.ypintao.com/categories/webpack/"/>
    
    
    <category term="webpack" scheme="http://blog.ypintao.com/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>Vue 3 æºç è§£è¯»</title>
    <link href="http://blog.ypintao.com/2024/04/01/%E5%89%8D%E7%AB%AF/vue/vue3%E6%BA%90%E7%A0%81/"/>
    <id>http://blog.ypintao.com/2024/04/01/%E5%89%8D%E7%AB%AF/vue/vue3%E6%BA%90%E7%A0%81/</id>
    <published>2024-04-01T04:00:00.000Z</published>
    <updated>2025-09-25T06:57:31.774Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>Vue 3çš„æºç é‡‡ç”¨monorepoçš„æ–¹å¼ç»„ç»‡ï¼Œä½¿ç”¨pnpmè¿›è¡ŒåŒ…ç®¡ç†ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š</p><ul><li><strong>reactivity</strong>: å“åº”å¼ç³»ç»Ÿ</li><li><strong>runtime-core</strong>: ä¸å¹³å°æ— å…³çš„è¿è¡Œæ—¶æ ¸å¿ƒ</li><li><strong>runtime-dom</strong>: æµè§ˆå™¨å¹³å°ç‰¹å®šçš„è¿è¡Œæ—¶</li><li><strong>compiler-core</strong>: ä¸å¹³å°æ— å…³çš„ç¼–è¯‘å™¨æ ¸å¿ƒ</li><li><strong>compiler-dom</strong>: æµè§ˆå™¨å¹³å°ç‰¹å®šçš„ç¼–è¯‘å™¨å®ç°</li><li><strong>compiler-sfc</strong>: å•æ–‡ä»¶ç»„ä»¶(.vueæ–‡ä»¶)ç¼–è¯‘å™¨</li><li><strong>shared</strong>: å…±äº«å·¥å…·å‡½æ•°</li><li><strong>vue</strong>: å®Œæ•´ç‰ˆæœ¬ï¼ŒåŒ…å«è¿è¡Œæ—¶å’Œç¼–è¯‘å™¨</li></ul><span id="more"></span><h2 id="ä¸€ã€å“åº”å¼ç³»ç»Ÿ-reactivity"><a href="#ä¸€ã€å“åº”å¼ç³»ç»Ÿ-reactivity" class="headerlink" title="ä¸€ã€å“åº”å¼ç³»ç»Ÿ (reactivity)"></a>ä¸€ã€å“åº”å¼ç³»ç»Ÿ (reactivity)</h2><p>Vue 3çš„å“åº”å¼ç³»ç»Ÿæ˜¯æ•´ä¸ªæ¡†æ¶çš„æ ¸å¿ƒï¼Œå®ƒåŸºäºES6çš„Proxyå®ç°ï¼Œç›¸æ¯”Vue 2ä½¿ç”¨çš„Object.definePropertyæœ‰äº†è´¨çš„é£è·ƒã€‚</p><h3 id="1-1-æ ¸å¿ƒAPIå®ç°åŸç†"><a href="#1-1-æ ¸å¿ƒAPIå®ç°åŸç†" class="headerlink" title="1.1 æ ¸å¿ƒAPIå®ç°åŸç†"></a>1.1 æ ¸å¿ƒAPIå®ç°åŸç†</h3><h4 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h4><p><code>reactive</code>å‡½æ•°æ˜¯åˆ›å»ºå“åº”å¼å¯¹è±¡çš„ä¸»è¦å…¥å£ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/reactivity/src/reactive.ts (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">target: object</span>) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯åªè¯»å¯¹è±¡ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isReadonly</span>(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ›å»ºå“åº”å¼ä»£ç†</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createReactiveObject</span>(</span><br><span class="line">    target,</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    mutableHandlers,</span><br><span class="line">    mutableCollectionHandlers,</span><br><span class="line">    reactiveMap</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createReactiveObject</span>(<span class="params"></span></span><br><span class="line"><span class="params">  target: Target,</span></span><br><span class="line"><span class="params">  isReadonly: boolean,</span></span><br><span class="line"><span class="params">  baseHandlers: ProxyHandler&lt;any&gt;,</span></span><br><span class="line"><span class="params">  collectionHandlers: ProxyHandler&lt;any&gt;,</span></span><br><span class="line"><span class="params">  proxyMap: <span class="built_in">WeakMap</span>&lt;Target, any&gt;</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœç›®æ ‡ä¸æ˜¯å¯¹è±¡ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isObject</span>(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¦‚æœå·²ç»æ˜¯å“åº”å¼å¯¹è±¡ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    target[<span class="title class_">ReactiveFlags</span>.<span class="property">RAW</span>] &amp;&amp;</span><br><span class="line">    !(isReadonly &amp;&amp; target[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_REACTIVE</span>])</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å·²å­˜åœ¨å¯¹åº”çš„ä»£ç†</span></span><br><span class="line">  <span class="keyword">const</span> existingProxy = proxyMap.<span class="title function_">get</span>(target)</span><br><span class="line">  <span class="keyword">if</span> (existingProxy) &#123;</span><br><span class="line">    <span class="keyword">return</span> existingProxy</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–ç›®æ ‡çš„ç±»å‹</span></span><br><span class="line">  <span class="keyword">const</span> targetType = <span class="title function_">getTargetType</span>(target)</span><br><span class="line">  <span class="comment">// å¦‚æœç›®æ ‡ç±»å‹æ— æ•ˆï¼Œç›´æ¥è¿”å›åŸå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">if</span> (targetType === <span class="title class_">TargetType</span>.<span class="property">INVALID</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ ¹æ®ç›®æ ‡ç±»å‹é€‰æ‹©ä¸åŒçš„handlers</span></span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(</span><br><span class="line">    target,</span><br><span class="line">    targetType === <span class="title class_">TargetType</span>.<span class="property">COLLECTION</span> ? collectionHandlers : baseHandlers</span><br><span class="line">  )</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç¼“å­˜ä»£ç†å¯¹è±¡</span></span><br><span class="line">  proxyMap.<span class="title function_">set</span>(target, proxy)</span><br><span class="line">  <span class="keyword">return</span> proxy</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="effect"><a href="#effect" class="headerlink" title="effect"></a>effect</h4><p><code>effect</code>å‡½æ•°ç”¨äºæ³¨å†Œå‰¯ä½œç”¨å‡½æ•°ï¼Œå½“å“åº”å¼æ•°æ®å˜åŒ–æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/reactivity/src/effect.ts (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> effect&lt;T = any&gt;(</span><br><span class="line">  <span class="attr">fn</span>: <span class="function">() =&gt;</span> T,</span><br><span class="line">  options?: <span class="title class_">ReactiveEffectOptions</span></span><br><span class="line">): <span class="title class_">ReactiveEffectRunner</span> &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœfnå·²ç»æ˜¯ä¸€ä¸ªeffectå‡½æ•°ï¼Œè·å–åŸå§‹å‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> ((fn <span class="keyword">as</span> <span class="title class_">ReactiveEffectRunner</span>).<span class="property">effect</span>) &#123;</span><br><span class="line">    fn = (fn <span class="keyword">as</span> <span class="title class_">ReactiveEffectRunner</span>).<span class="property">effect</span>.<span class="property">fn</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºå“åº”å¼effect</span></span><br><span class="line">  <span class="keyword">const</span> _effect = <span class="keyword">new</span> <span class="title class_">ReactiveEffect</span>(fn)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆå¹¶é€‰é¡¹</span></span><br><span class="line">  <span class="keyword">if</span> (options) &#123;</span><br><span class="line">    <span class="title function_">extend</span>(_effect, options)</span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">scope</span>) <span class="title function_">recordEffectScope</span>(_effect, options.<span class="property">scope</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¦‚æœä¸æ˜¯æ‡’æ‰§è¡Œï¼Œç«‹å³è¿è¡Œ</span></span><br><span class="line">  <span class="keyword">if</span> (!options || !options.<span class="property">lazy</span>) &#123;</span><br><span class="line">    _effect.<span class="title function_">run</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è¿”å›ç»‘å®šäº†thisçš„runå‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> runner = _effect.<span class="property">run</span>.<span class="title function_">bind</span>(_effect) <span class="keyword">as</span> <span class="title class_">ReactiveEffectRunner</span></span><br><span class="line">  runner.<span class="property">effect</span> = _effect</span><br><span class="line">  <span class="keyword">return</span> runner</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ReactiveEffect</span>&lt;T = any&gt; &#123;</span><br><span class="line">  active = <span class="literal">true</span></span><br><span class="line">  <span class="attr">deps</span>: <span class="title class_">Dep</span>[] = []</span><br><span class="line">  <span class="attr">parent</span>: <span class="title class_">ReactiveEffect</span> | <span class="literal">undefined</span> = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    public fn: () =&gt; T,</span></span><br><span class="line"><span class="params">    public scheduler: EffectScheduler | <span class="literal">null</span> = <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">    scope?: EffectScope</span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line">    <span class="title function_">recordEffectScope</span>(<span class="variable language_">this</span>, scope)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">active</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">fn</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// è®¾ç½®å½“å‰æ´»åŠ¨çš„effect</span></span><br><span class="line">      activeEffect = <span class="variable language_">this</span></span><br><span class="line">      <span class="comment">// æ‰§è¡Œå‡½æ•°å‰ï¼Œå°†å…¶æ ‡è®°ä¸ºå…è®¸è¿½è¸ª</span></span><br><span class="line">      trackOpBit = <span class="number">1</span> &lt;&lt; ++effectTrackDepth</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// å¦‚æœåµŒå¥—æ·±åº¦å°äºæœ€å¤§å€¼ï¼Œä½¿ç”¨ä½æ“ä½œè¿½è¸ª</span></span><br><span class="line">      <span class="keyword">if</span> (effectTrackDepth &lt;= maxMarkerBits) &#123;</span><br><span class="line">        <span class="title function_">initDepMarkers</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦åˆ™æ¸…é™¤æ‰€æœ‰ä¾èµ–</span></span><br><span class="line">        <span class="title function_">cleanupEffect</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ‰§è¡Œå‡½æ•°ï¼Œæ­¤æ—¶ä¼šè§¦å‘ä»£ç†çš„getterï¼Œä»è€Œæ”¶é›†ä¾èµ–</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">fn</span>()</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// æ¢å¤çŠ¶æ€</span></span><br><span class="line">      <span class="keyword">if</span> (effectTrackDepth &lt;= maxMarkerBits) &#123;</span><br><span class="line">        <span class="title function_">finalizeDepMarkers</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      trackOpBit = <span class="number">1</span> &lt;&lt; --effectTrackDepth</span><br><span class="line">      activeEffect = <span class="variable language_">this</span>.<span class="property">parent</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">parent</span> = <span class="literal">undefined</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">stop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">active</span>) &#123;</span><br><span class="line">      <span class="title function_">cleanupEffect</span>(<span class="variable language_">this</span>)</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">onStop</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">onStop</span>()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">active</span> = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><p><code>ref</code>å‡½æ•°ç”¨äºåˆ›å»ºåŸºæœ¬ç±»å‹çš„å“åº”å¼å¼•ç”¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/reactivity/src/ref.ts (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">ref</span>(<span class="params">value?: unknown</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createRef</span>(value, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createRef</span>(<span class="params">rawValue: unknown, shallow: boolean</span>) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå·²ç»æ˜¯refï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isRef</span>(rawValue)) &#123;</span><br><span class="line">    <span class="keyword">return</span> rawValue</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RefImpl</span>(rawValue, shallow)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RefImpl</span>&lt;T&gt; &#123;</span><br><span class="line">  private <span class="attr">_value</span>: T</span><br><span class="line">  private <span class="attr">_rawValue</span>: T</span><br><span class="line">  </span><br><span class="line">  public dep?: <span class="title class_">Dep</span> = <span class="literal">undefined</span></span><br><span class="line">  public readonly __v_isRef = <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">value: T, public readonly __v_isShallow: boolean</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_rawValue</span> = __v_isShallow ? value : <span class="title function_">toRaw</span>(value)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_value</span> = __v_isShallow ? value : <span class="title function_">toReactive</span>(value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">    <span class="comment">// è¿½è¸ªä¾èµ–</span></span><br><span class="line">    <span class="title function_">trackRefValue</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_value</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">    <span class="comment">// è·å–åŸå§‹å€¼è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">    newVal = <span class="variable language_">this</span>.<span class="property">__v_isShallow</span> ? newVal : <span class="title function_">toRaw</span>(newVal)</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">hasChanged</span>(newVal, <span class="variable language_">this</span>.<span class="property">_rawValue</span>)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_rawValue</span> = newVal</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_value</span> = <span class="variable language_">this</span>.<span class="property">__v_isShallow</span> ? newVal : <span class="title function_">toReactive</span>(newVal)</span><br><span class="line">      <span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line">      <span class="title function_">triggerRefValue</span>(<span class="variable language_">this</span>, newVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-ä¾èµ–æ”¶é›†ä¸è§¦å‘æ›´æ–°"><a href="#1-2-ä¾èµ–æ”¶é›†ä¸è§¦å‘æ›´æ–°" class="headerlink" title="1.2 ä¾èµ–æ”¶é›†ä¸è§¦å‘æ›´æ–°"></a>1.2 ä¾èµ–æ”¶é›†ä¸è§¦å‘æ›´æ–°</h3><p>Vue 3çš„å“åº”å¼ç³»ç»Ÿæ ¸å¿ƒåœ¨äºä¾èµ–æ”¶é›†(track)å’Œè§¦å‘æ›´æ–°(trigger)ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/reactivity/src/effect.ts (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="comment">// ä¾èµ–æ”¶é›†</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">track</span>(<span class="params">target: object, type: TrackOpTypes, key: unknown</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (shouldTrack &amp;&amp; activeEffect) &#123;</span><br><span class="line">    <span class="comment">// è·å–targetå¯¹åº”çš„ä¾èµ–Map</span></span><br><span class="line">    <span class="keyword">let</span> depsMap = targetMap.<span class="title function_">get</span>(target)</span><br><span class="line">    <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">      targetMap.<span class="title function_">set</span>(target, (depsMap = <span class="keyword">new</span> <span class="title class_">Map</span>()))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–keyå¯¹åº”çš„ä¾èµ–é›†åˆ</span></span><br><span class="line">    <span class="keyword">let</span> dep = depsMap.<span class="title function_">get</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (!dep) &#123;</span><br><span class="line">      depsMap.<span class="title function_">set</span>(key, (dep = <span class="title function_">createDep</span>()))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ”¶é›†ä¾èµ–</span></span><br><span class="line">    <span class="title function_">trackEffects</span>(dep)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params"></span></span><br><span class="line"><span class="params">  target: object,</span></span><br><span class="line"><span class="params">  type: TriggerOpTypes,</span></span><br><span class="line"><span class="params">  key?: unknown,</span></span><br><span class="line"><span class="params">  newValue?: unknown,</span></span><br><span class="line"><span class="params">  oldValue?: unknown,</span></span><br><span class="line"><span class="params">  oldTarget?: <span class="built_in">Map</span>&lt;unknown, unknown&gt; | <span class="built_in">Set</span>&lt;unknown&gt;</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// è·å–targetå¯¹åº”çš„ä¾èµ–Map</span></span><br><span class="line">  <span class="keyword">const</span> depsMap = targetMap.<span class="title function_">get</span>(target)</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰ä¾èµ–ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¶é›†éœ€è¦è§¦å‘çš„effects</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">deps</span>: (<span class="title class_">Dep</span> | <span class="literal">undefined</span>)[] = []</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ ¹æ®æ“ä½œç±»å‹æ”¶é›†ç›¸å…³ä¾èµ–</span></span><br><span class="line">  <span class="keyword">if</span> (type === <span class="title class_">TriggerOpTypes</span>.<span class="property">CLEAR</span>) &#123;</span><br><span class="line">    <span class="comment">// æ¸…é™¤æ“ä½œï¼Œè§¦å‘æ‰€æœ‰ä¾èµ–</span></span><br><span class="line">    deps = [...depsMap.<span class="title function_">values</span>()]</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">&#x27;length&#x27;</span> &amp;&amp; <span class="title function_">isArray</span>(target)) &#123;</span><br><span class="line">    <span class="comment">// æ•°ç»„lengthå˜åŒ–</span></span><br><span class="line">    depsMap.<span class="title function_">forEach</span>(<span class="function">(<span class="params">dep, key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&#x27;length&#x27;</span> || key &gt;= (newValue <span class="keyword">as</span> number)) &#123;</span><br><span class="line">        deps.<span class="title function_">push</span>(dep)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ™®é€šå±æ€§å˜åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (key !== <span class="keyword">void</span> <span class="number">0</span>) &#123;</span><br><span class="line">      deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(key))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ¹æ®æ“ä½œç±»å‹æ·»åŠ é¢å¤–ä¾èµ–</span></span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="title class_">TriggerOpTypes</span>.<span class="property">ADD</span>:</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">isArray</span>(target)) &#123;</span><br><span class="line">          deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">ITERATE_KEY</span>))</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">isMap</span>(target)) &#123;</span><br><span class="line">            deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">MAP_KEY_ITERATE_KEY</span>))</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isIntegerKey</span>(key)) &#123;</span><br><span class="line">          <span class="comment">// æ•°ç»„ç´¢å¼•æ·»åŠ ï¼Œè§¦å‘lengthç›¸å…³ä¾èµ–</span></span><br><span class="line">          deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(<span class="string">&#x27;length&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="title class_">TriggerOpTypes</span>.<span class="property">DELETE</span>:</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">isArray</span>(target)) &#123;</span><br><span class="line">          deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">ITERATE_KEY</span>))</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">isMap</span>(target)) &#123;</span><br><span class="line">            deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">MAP_KEY_ITERATE_KEY</span>))</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="title class_">TriggerOpTypes</span>.<span class="property">SET</span>:</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isMap</span>(target)) &#123;</span><br><span class="line">          deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">ITERATE_KEY</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è§¦å‘æ”¶é›†çš„effects</span></span><br><span class="line">  <span class="keyword">if</span> (deps.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (deps[<span class="number">0</span>]) &#123;</span><br><span class="line">      <span class="title function_">triggerEffects</span>(deps[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">effects</span>: <span class="title class_">ReactiveEffect</span>[] = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> dep <span class="keyword">of</span> deps) &#123;</span><br><span class="line">      <span class="keyword">if</span> (dep) &#123;</span><br><span class="line">        effects.<span class="title function_">push</span>(...dep)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">triggerEffects</span>(<span class="title function_">createDep</span>(effects))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒã€ç»„ä»¶ç³»ç»Ÿä¸æ¸²æŸ“æœºåˆ¶"><a href="#äºŒã€ç»„ä»¶ç³»ç»Ÿä¸æ¸²æŸ“æœºåˆ¶" class="headerlink" title="äºŒã€ç»„ä»¶ç³»ç»Ÿä¸æ¸²æŸ“æœºåˆ¶"></a>äºŒã€ç»„ä»¶ç³»ç»Ÿä¸æ¸²æŸ“æœºåˆ¶</h2><p>Vue 3çš„ç»„ä»¶ç³»ç»Ÿæ˜¯æ„å»ºç”¨æˆ·ç•Œé¢çš„æ ¸å¿ƒï¼Œå®ƒåŸºäºè™šæ‹ŸDOMå®ç°é«˜æ•ˆçš„æ¸²æŸ“ã€‚</p><h3 id="2-1-è™šæ‹ŸDOM-VNode"><a href="#2-1-è™šæ‹ŸDOM-VNode" class="headerlink" title="2.1 è™šæ‹ŸDOM (VNode)"></a>2.1 è™šæ‹ŸDOM (VNode)</h3><p>VNodeæ˜¯Vueä¸­è™šæ‹ŸDOMèŠ‚ç‚¹çš„è¡¨ç¤ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/runtime-core/src/vnode.ts (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createVNode = (</span><br><span class="line">  <span class="attr">type</span>: <span class="title class_">VNodeTypes</span>,</span><br><span class="line">  <span class="attr">props</span>: <span class="title class_">VNodeProps</span> | <span class="literal">null</span> = <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">children</span>: unknown = <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">patchFlag</span>: number = <span class="number">0</span>,</span><br><span class="line">  <span class="attr">dynamicProps</span>: string[] | <span class="literal">null</span> = <span class="literal">null</span>,</span><br><span class="line">  isBlockNode = <span class="literal">false</span></span><br><span class="line">): <span class="function"><span class="params">VNode</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// å¤„ç†classå’Œstyleè§„èŒƒåŒ–</span></span><br><span class="line">  <span class="keyword">if</span> (props) &#123;</span><br><span class="line">    <span class="comment">// è§„èŒƒåŒ–class</span></span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">class</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">      props.<span class="property">class</span> = <span class="title function_">normalizeClass</span>(props.<span class="property">class</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è§„èŒƒåŒ–style</span></span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">style</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">      props.<span class="property">style</span> = <span class="title function_">normalizeStyle</span>(props.<span class="property">style</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ ¹æ®typeç±»å‹ç¡®å®šshapeFlag</span></span><br><span class="line">  <span class="keyword">const</span> shapeFlag = <span class="title function_">isString</span>(type)</span><br><span class="line">    ? <span class="title class_">ShapeFlags</span>.<span class="property">ELEMENT</span></span><br><span class="line">    : <span class="title function_">isObject</span>(type)</span><br><span class="line">    ? <span class="title class_">ShapeFlags</span>.<span class="property">STATEFUL_COMPONENT</span></span><br><span class="line">    : <span class="title function_">isFunction</span>(type)</span><br><span class="line">    ? <span class="title class_">ShapeFlags</span>.<span class="property">FUNCTIONAL_COMPONENT</span></span><br><span class="line">    : <span class="number">0</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºVNodeå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createBaseVNode</span>(</span><br><span class="line">    type,</span><br><span class="line">    props,</span><br><span class="line">    children,</span><br><span class="line">    patchFlag,</span><br><span class="line">    dynamicProps,</span><br><span class="line">    shapeFlag,</span><br><span class="line">    isBlockNode,</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-ç»„ä»¶å®ä¾‹åˆ›å»ºä¸ç”Ÿå‘½å‘¨æœŸ"><a href="#2-2-ç»„ä»¶å®ä¾‹åˆ›å»ºä¸ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2.2 ç»„ä»¶å®ä¾‹åˆ›å»ºä¸ç”Ÿå‘½å‘¨æœŸ"></a>2.2 ç»„ä»¶å®ä¾‹åˆ›å»ºä¸ç”Ÿå‘½å‘¨æœŸ</h3><p>ç»„ä»¶å®ä¾‹çš„åˆ›å»ºè¿‡ç¨‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/runtime-core/src/component.ts (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createComponentInstance</span>(<span class="params"></span></span><br><span class="line"><span class="params">  vnode: VNode,</span></span><br><span class="line"><span class="params">  parent: ComponentInternalInstance | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  suspense: SuspenseBoundary | <span class="literal">null</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// è·å–ç»„ä»¶ç±»å‹å’Œä¸Šä¸‹æ–‡</span></span><br><span class="line">  <span class="keyword">const</span> type = vnode.<span class="property">type</span> <span class="keyword">as</span> <span class="title class_">ConcreteComponent</span></span><br><span class="line">  <span class="keyword">const</span> appContext = (parent ? parent.<span class="property">appContext</span> : vnode.<span class="property">appContext</span>) || emptyAppContext</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºç»„ä»¶å®ä¾‹å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">instance</span>: <span class="title class_">ComponentInternalInstance</span> = &#123;</span><br><span class="line">    <span class="attr">uid</span>: uid++,</span><br><span class="line">    vnode,</span><br><span class="line">    type,</span><br><span class="line">    parent,</span><br><span class="line">    appContext,</span><br><span class="line">    <span class="attr">root</span>: <span class="literal">null</span>!, <span class="comment">// ç¨åè®¾ç½®</span></span><br><span class="line">    <span class="attr">next</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">subTree</span>: <span class="literal">null</span>!, <span class="comment">// ç¨åè®¾ç½®</span></span><br><span class="line">    <span class="attr">effect</span>: <span class="literal">null</span>!,</span><br><span class="line">    <span class="attr">update</span>: <span class="literal">null</span>!, <span class="comment">// ç¨åè®¾ç½®</span></span><br><span class="line">    <span class="attr">scope</span>: <span class="keyword">new</span> <span class="title class_">EffectScope</span>(<span class="literal">true</span> <span class="comment">/* detached */</span>),</span><br><span class="line">    <span class="attr">render</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">proxy</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">exposed</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">exposeProxy</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">withProxy</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">provides</span>: parent ? parent.<span class="property">provides</span> : <span class="title class_">Object</span>.<span class="title function_">create</span>(appContext.<span class="property">provides</span>),</span><br><span class="line">    <span class="attr">accessCache</span>: <span class="literal">null</span>!,</span><br><span class="line">    <span class="attr">renderCache</span>: [],</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»„ä»¶çŠ¶æ€</span></span><br><span class="line">    <span class="attr">components</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">directives</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">propsOptions</span>: <span class="title function_">normalizePropsOptions</span>(type, appContext),</span><br><span class="line">    <span class="attr">emitsOptions</span>: <span class="title function_">normalizeEmitsOptions</span>(type, appContext),</span><br><span class="line">    <span class="attr">emit</span>: <span class="literal">null</span>!, <span class="comment">// ç¨åè®¾ç½®</span></span><br><span class="line">    <span class="attr">emitted</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">propsDefaults</span>: <span class="variable constant_">EMPTY_OBJ</span>,</span><br><span class="line">    <span class="attr">inheritAttrs</span>: type.<span class="property">inheritAttrs</span>,</span><br><span class="line">    <span class="attr">ctx</span>: <span class="variable constant_">EMPTY_OBJ</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="variable constant_">EMPTY_OBJ</span>,</span><br><span class="line">    <span class="attr">props</span>: <span class="variable constant_">EMPTY_OBJ</span>,</span><br><span class="line">    <span class="attr">attrs</span>: <span class="variable constant_">EMPTY_OBJ</span>,</span><br><span class="line">    <span class="attr">slots</span>: <span class="variable constant_">EMPTY_OBJ</span>,</span><br><span class="line">    <span class="attr">refs</span>: <span class="variable constant_">EMPTY_OBJ</span>,</span><br><span class="line">    <span class="attr">setupState</span>: <span class="variable constant_">EMPTY_OBJ</span>,</span><br><span class="line">    <span class="attr">setupContext</span>: <span class="literal">null</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”Ÿå‘½å‘¨æœŸé’©å­</span></span><br><span class="line">    suspense,</span><br><span class="line">    <span class="attr">suspenseId</span>: suspense ? suspense.<span class="property">pendingId</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">asyncDep</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">asyncResolved</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">isMounted</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">isUnmounted</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">isDeactivated</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">bc</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">c</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">bm</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">m</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">bu</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">u</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">um</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">bum</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">da</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">a</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">rtg</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">rtc</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">ec</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">sp</span>: <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¼€å‘ç¯å¢ƒä¸‹ä½¿ç”¨ä»£ç†å¯¹è±¡ä½œä¸ºä¸Šä¸‹æ–‡</span></span><br><span class="line">  instance.<span class="property">ctx</span> = &#123; <span class="attr">_</span>: instance &#125;</span><br><span class="line">  instance.<span class="property">root</span> = parent ? parent.<span class="property">root</span> : instance</span><br><span class="line">  instance.<span class="property">emit</span> = emit.<span class="title function_">bind</span>(<span class="literal">null</span>, instance)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> instance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-ç»„ä»¶æŒ‚è½½ä¸æ›´æ–°"><a href="#2-3-ç»„ä»¶æŒ‚è½½ä¸æ›´æ–°" class="headerlink" title="2.3 ç»„ä»¶æŒ‚è½½ä¸æ›´æ–°"></a>2.3 ç»„ä»¶æŒ‚è½½ä¸æ›´æ–°</h3><p>ç»„ä»¶çš„æŒ‚è½½å’Œæ›´æ–°è¿‡ç¨‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/runtime-core/src/renderer.ts (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mountComponent</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  initialVNode: VNode,</span></span><br><span class="line"><span class="params">  container: RendererElement,</span></span><br><span class="line"><span class="params">  anchor: RendererNode | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  parentComponent: ComponentInternalInstance | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  parentSuspense: SuspenseBoundary | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  isSVG: boolean,</span></span><br><span class="line"><span class="params">  optimized: boolean</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºç»„ä»¶å®ä¾‹</span></span><br><span class="line">  <span class="keyword">const</span> instance = (initialVNode.<span class="property">component</span> = <span class="title function_">createComponentInstance</span>(</span><br><span class="line">    initialVNode,</span><br><span class="line">    parentComponent,</span><br><span class="line">    parentSuspense</span><br><span class="line">  ))</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®¾ç½®ç»„ä»¶å®ä¾‹</span></span><br><span class="line">  <span class="title function_">setupComponent</span>(instance)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®¾ç½®å¹¶è¿è¡Œå¸¦æœ‰å‰¯ä½œç”¨çš„æ¸²æŸ“å‡½æ•°</span></span><br><span class="line">  <span class="title function_">setupRenderEffect</span>(</span><br><span class="line">    instance,</span><br><span class="line">    initialVNode,</span><br><span class="line">    container,</span><br><span class="line">    anchor,</span><br><span class="line">    parentSuspense,</span><br><span class="line">    isSVG,</span><br><span class="line">    optimized</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">setupRenderEffect</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  instance: ComponentInternalInstance,</span></span><br><span class="line"><span class="params">  initialVNode: VNode,</span></span><br><span class="line"><span class="params">  container: RendererElement,</span></span><br><span class="line"><span class="params">  anchor: RendererNode | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  parentSuspense: SuspenseBoundary | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  isSVG: boolean,</span></span><br><span class="line"><span class="params">  optimized: boolean</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">componentUpdateFn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!instance.<span class="property">isMounted</span>) &#123;</span><br><span class="line">      <span class="comment">// æŒ‚è½½ç»„ä»¶</span></span><br><span class="line">      <span class="keyword">const</span> &#123; bm, m, parent &#125; = instance</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// beforeMount é’©å­</span></span><br><span class="line">      <span class="keyword">if</span> (bm) &#123;</span><br><span class="line">        <span class="title function_">invokeArrayFns</span>(bm)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ¸²æŸ“ç»„ä»¶å­æ ‘</span></span><br><span class="line">      <span class="keyword">const</span> subTree = (instance.<span class="property">subTree</span> = <span class="title function_">renderComponentRoot</span>(instance))</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æŒ‚è½½å­æ ‘</span></span><br><span class="line">      <span class="title function_">patch</span>(</span><br><span class="line">        <span class="literal">null</span>,</span><br><span class="line">        subTree,</span><br><span class="line">        container,</span><br><span class="line">        anchor,</span><br><span class="line">        instance,</span><br><span class="line">        parentSuspense,</span><br><span class="line">        isSVG</span><br><span class="line">      )</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// è®¾ç½®å…ƒç´ å¼•ç”¨</span></span><br><span class="line">      initialVNode.<span class="property">el</span> = subTree.<span class="property">el</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// mounted é’©å­</span></span><br><span class="line">      <span class="keyword">if</span> (m) &#123;</span><br><span class="line">        <span class="title function_">queuePostRenderEffect</span>(m, parentSuspense)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ ‡è®°ä¸ºå·²æŒ‚è½½</span></span><br><span class="line">      instance.<span class="property">isMounted</span> = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æ›´æ–°ç»„ä»¶</span></span><br><span class="line">      <span class="keyword">let</span> &#123; next, bu, u, parent, vnode &#125; = instance</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// å¦‚æœæœ‰å¾…æ›´æ–°çš„VNode</span></span><br><span class="line">      <span class="keyword">if</span> (next) &#123;</span><br><span class="line">        next.<span class="property">el</span> = vnode.<span class="property">el</span></span><br><span class="line">        <span class="title function_">updateComponentPreRender</span>(instance, next, optimized)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        next = vnode</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// beforeUpdate é’©å­</span></span><br><span class="line">      <span class="keyword">if</span> (bu) &#123;</span><br><span class="line">        <span class="title function_">invokeArrayFns</span>(bu)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ¸²æŸ“æ–°çš„å­æ ‘</span></span><br><span class="line">      <span class="keyword">const</span> nextTree = <span class="title function_">renderComponentRoot</span>(instance)</span><br><span class="line">      <span class="keyword">const</span> prevTree = instance.<span class="property">subTree</span></span><br><span class="line">      instance.<span class="property">subTree</span> = nextTree</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ›´æ–°å­æ ‘</span></span><br><span class="line">      <span class="title function_">patch</span>(</span><br><span class="line">        prevTree,</span><br><span class="line">        nextTree,</span><br><span class="line">        <span class="title function_">hostParentNode</span>(prevTree.<span class="property">el</span>!)!,</span><br><span class="line">        <span class="title function_">getNextHostNode</span>(prevTree),</span><br><span class="line">        instance,</span><br><span class="line">        parentSuspense,</span><br><span class="line">        isSVG</span><br><span class="line">      )</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ›´æ–°å¼•ç”¨</span></span><br><span class="line">      next.<span class="property">el</span> = nextTree.<span class="property">el</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// updated é’©å­</span></span><br><span class="line">      <span class="keyword">if</span> (u) &#123;</span><br><span class="line">        <span class="title function_">queuePostRenderEffect</span>(u, parentSuspense)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºå“åº”å¼effect</span></span><br><span class="line">  <span class="keyword">const</span> effect = (instance.<span class="property">effect</span> = <span class="keyword">new</span> <span class="title class_">ReactiveEffect</span>(</span><br><span class="line">    componentUpdateFn,</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">queueJob</span>(update),</span><br><span class="line">    instance.<span class="property">scope</span></span><br><span class="line">  ))</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç»„ä»¶æ›´æ–°å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> update = (instance.<span class="property">update</span> = <span class="function">() =&gt;</span> effect.<span class="title function_">run</span>())</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ‰§è¡Œæ›´æ–°</span></span><br><span class="line">  <span class="title function_">update</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€Composition-API-å®ç°"><a href="#ä¸‰ã€Composition-API-å®ç°" class="headerlink" title="ä¸‰ã€Composition API å®ç°"></a>ä¸‰ã€Composition API å®ç°</h2><p>Composition APIæ˜¯Vue 3çš„ä¸€å¤§ç‰¹è‰²ï¼Œå®ƒæä¾›äº†ä¸€ç§æ›´çµæ´»çš„ç»„ç»‡ç»„ä»¶é€»è¾‘çš„æ–¹å¼ã€‚</p><h3 id="3-1-setupå‡½æ•°"><a href="#3-1-setupå‡½æ•°" class="headerlink" title="3.1 setupå‡½æ•°"></a>3.1 setupå‡½æ•°</h3><p><code>setup</code>å‡½æ•°æ˜¯Composition APIçš„å…¥å£ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/runtime-core/src/component.ts (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupComponent</span>(<span class="params"></span></span><br><span class="line"><span class="params">  instance: ComponentInternalInstance,</span></span><br><span class="line"><span class="params">  isSSR = <span class="literal">false</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; props, children &#125; = instance.<span class="property">vnode</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¤„ç†props</span></span><br><span class="line">  <span class="title function_">initProps</span>(instance, props, isSSR)</span><br><span class="line">  <span class="comment">// å¤„ç†slots</span></span><br><span class="line">  <span class="title function_">initSlots</span>(instance, children)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®¾ç½®æœ‰çŠ¶æ€çš„ç»„ä»¶</span></span><br><span class="line">  <span class="keyword">const</span> setupResult = <span class="title function_">setupStatefulComponent</span>(instance, isSSR)</span><br><span class="line">  <span class="keyword">return</span> setupResult</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setupStatefulComponent</span>(<span class="params"></span></span><br><span class="line"><span class="params">  instance: ComponentInternalInstance,</span></span><br><span class="line"><span class="params">  isSSR: boolean</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Component</span> = instance.<span class="property">type</span> <span class="keyword">as</span> <span class="title class_">ComponentOptions</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†</span></span><br><span class="line">  instance.<span class="property">proxy</span> = <span class="title function_">markRaw</span>(<span class="keyword">new</span> <span class="title class_">Proxy</span>(instance.<span class="property">ctx</span>, <span class="title class_">PublicInstanceProxyHandlers</span>))</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–setupå‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> &#123; setup &#125; = <span class="title class_">Component</span></span><br><span class="line">  <span class="keyword">if</span> (setup) &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºsetupä¸Šä¸‹æ–‡</span></span><br><span class="line">    <span class="keyword">const</span> setupContext = (instance.<span class="property">setupContext</span> =</span><br><span class="line">      setup.<span class="property">length</span> &gt; <span class="number">1</span> ? <span class="title function_">createSetupContext</span>(instance) : <span class="literal">null</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®å½“å‰å®ä¾‹</span></span><br><span class="line">    <span class="title function_">setCurrentInstance</span>(instance)</span><br><span class="line">    <span class="comment">// æš‚åœä¾èµ–æ”¶é›†</span></span><br><span class="line">    <span class="title function_">pauseTracking</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è°ƒç”¨setupå‡½æ•°</span></span><br><span class="line">    <span class="keyword">const</span> setupResult = <span class="title function_">callWithErrorHandling</span>(</span><br><span class="line">      setup,</span><br><span class="line">      instance,</span><br><span class="line">      <span class="title class_">ErrorCodes</span>.<span class="property">SETUP_FUNCTION</span>,</span><br><span class="line">      [instance.<span class="property">props</span>, setupContext]</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¢å¤ä¾èµ–æ”¶é›†</span></span><br><span class="line">    <span class="title function_">resetTracking</span>()</span><br><span class="line">    <span class="comment">// æ¸…é™¤å½“å‰å®ä¾‹</span></span><br><span class="line">    <span class="title function_">unsetCurrentInstance</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†setupè¿”å›å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isPromise</span>(setupResult)) &#123;</span><br><span class="line">      <span class="comment">// å¼‚æ­¥setup</span></span><br><span class="line">      setupResult.<span class="title function_">then</span>(unsetCurrentInstance, unsetCurrentInstance)</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (isSSR) &#123;</span><br><span class="line">        <span class="comment">// æœåŠ¡ç«¯æ¸²æŸ“å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span> setupResult</span><br><span class="line">          .<span class="title function_">then</span>(<span class="function">(<span class="params">resolvedResult</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">handleSetupResult</span>(instance, resolvedResult, isSSR)</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">handleError</span>(e, instance, <span class="title class_">ErrorCodes</span>.<span class="property">SETUP_FUNCTION</span>)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å®¢æˆ·ç«¯å¼‚æ­¥ç»„ä»¶å¤„ç†</span></span><br><span class="line">        instance.<span class="property">asyncDep</span> = setupResult</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// åŒæ­¥setup</span></span><br><span class="line">      <span class="title function_">handleSetupResult</span>(instance, setupResult, isSSR)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ— setupå‡½æ•°ï¼Œå®Œæˆç»„ä»¶è®¾ç½®</span></span><br><span class="line">    <span class="title function_">finishComponentSetup</span>(instance, isSSR)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-æ ¸å¿ƒComposition-APIå®ç°"><a href="#3-2-æ ¸å¿ƒComposition-APIå®ç°" class="headerlink" title="3.2 æ ¸å¿ƒComposition APIå®ç°"></a>3.2 æ ¸å¿ƒComposition APIå®ç°</h3><h4 id="refå’Œreactive"><a href="#refå’Œreactive" class="headerlink" title="refå’Œreactive"></a>refå’Œreactive</h4><p>å‰é¢å·²ç»ä»‹ç»è¿‡ï¼Œè¿™é‡Œä¸å†é‡å¤ã€‚</p><h4 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h4><p><code>computed</code>å‡½æ•°ç”¨äºåˆ›å»ºè®¡ç®—å±æ€§ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/reactivity/src/computed.ts (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> computed&lt;T&gt;(</span><br><span class="line">  <span class="attr">getterOrOptions</span>: <span class="title class_">ComputedGetter</span>&lt;T&gt; | <span class="title class_">WritableComputedOptions</span>&lt;T&gt;,</span><br><span class="line">  debugOptions?: <span class="title class_">DebuggerOptions</span>,</span><br><span class="line">  isSSR = <span class="literal">false</span></span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">getter</span>: <span class="title class_">ComputedGetter</span>&lt;T&gt;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">setter</span>: <span class="title class_">ComputedSetter</span>&lt;T&gt;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è§„èŒƒåŒ–å‚æ•°</span></span><br><span class="line">  <span class="keyword">const</span> onlyGetter = <span class="title function_">isFunction</span>(getterOrOptions)</span><br><span class="line">  <span class="keyword">if</span> (onlyGetter) &#123;</span><br><span class="line">    getter = getterOrOptions</span><br><span class="line">    setter = <span class="variable constant_">NOOP</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    getter = getterOrOptions.<span class="property">get</span></span><br><span class="line">    setter = getterOrOptions.<span class="property">set</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºè®¡ç®—å±æ€§å®ä¾‹</span></span><br><span class="line">  <span class="keyword">const</span> cRef = <span class="keyword">new</span> <span class="title class_">ComputedRefImpl</span>(getter, setter, onlyGetter || !setter, isSSR)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> cRef <span class="keyword">as</span> any</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComputedRefImpl</span>&lt;T&gt; &#123;</span><br><span class="line">  public dep?: <span class="title class_">Dep</span> = <span class="literal">undefined</span></span><br><span class="line">  </span><br><span class="line">  private _value!: T</span><br><span class="line">  public readonly <span class="attr">effect</span>: <span class="title class_">ReactiveEffect</span>&lt;T&gt;</span><br><span class="line">  </span><br><span class="line">  public readonly __v_isRef = <span class="literal">true</span></span><br><span class="line">  public readonly [<span class="title class_">ReactiveFlags</span>.<span class="property">IS_READONLY</span>]: boolean = <span class="literal">false</span></span><br><span class="line">  </span><br><span class="line">  public _dirty = <span class="literal">true</span></span><br><span class="line">  public <span class="attr">_cacheable</span>: boolean</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    getter: ComputedGetter&lt;T&gt;,</span></span><br><span class="line"><span class="params">    private readonly _setter: ComputedSetter&lt;T&gt;,</span></span><br><span class="line"><span class="params">    isReadonly: boolean,</span></span><br><span class="line"><span class="params">    isSSR: boolean</span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºeffect</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">effect</span> = <span class="keyword">new</span> <span class="title class_">ReactiveEffect</span>(getter, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// å½“ä¾èµ–å˜åŒ–æ—¶ï¼Œæ ‡è®°ä¸ºè„</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">_dirty</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_dirty</span> = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line">        <span class="title function_">triggerRefValue</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">effect</span>.<span class="property">computed</span> = <span class="variable language_">this</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">effect</span>.<span class="property">active</span> = <span class="variable language_">this</span>.<span class="property">_cacheable</span> = !isSSR</span><br><span class="line">    <span class="variable language_">this</span>[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_READONLY</span>] = isReadonly</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å¯ç¼“å­˜çš„ï¼Œä¸”æœ‰ä¾èµ–è¿½è¸ª</span></span><br><span class="line">    <span class="keyword">const</span> self = <span class="title function_">toRaw</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="comment">// è¿½è¸ªä¾èµ–</span></span><br><span class="line">    <span class="title function_">trackRefValue</span>(self)</span><br><span class="line">    <span class="comment">// å¦‚æœè„æˆ–è€…ä¸å¯ç¼“å­˜ï¼Œé‡æ–°è®¡ç®—</span></span><br><span class="line">    <span class="keyword">if</span> (self.<span class="property">_dirty</span> || !self.<span class="property">_cacheable</span>) &#123;</span><br><span class="line">      self.<span class="property">_dirty</span> = <span class="literal">false</span></span><br><span class="line">      self.<span class="property">_value</span> = self.<span class="property">effect</span>.<span class="title function_">run</span>()!</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> self.<span class="property">_value</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newValue: T</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">_setter</span>(newValue)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="watchå’ŒwatchEffect"><a href="#watchå’ŒwatchEffect" class="headerlink" title="watchå’ŒwatchEffect"></a>watchå’ŒwatchEffect</h4><p><code>watch</code>å’Œ<code>watchEffect</code>ç”¨äºç›‘å¬å“åº”å¼æ•°æ®å˜åŒ–ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/runtime-core/src/apiWatch.ts (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> watch&lt;T = any, <span class="title class_">Immediate</span> <span class="keyword">extends</span> <span class="title class_">Readonly</span>&lt;boolean&gt; = <span class="literal">false</span>&gt;(</span><br><span class="line">  <span class="attr">source</span>: T | <span class="title class_">WatchSource</span>&lt;T&gt;,</span><br><span class="line">  <span class="attr">cb</span>: any,</span><br><span class="line">  options?: <span class="title class_">WatchOptions</span>&lt;<span class="title class_">Immediate</span>&gt;</span><br><span class="line">): <span class="title class_">WatchStopHandle</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">doWatch</span>(source <span class="keyword">as</span> any, cb, options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">watchEffect</span>(<span class="params"></span></span><br><span class="line"><span class="params">  effect: WatchEffect,</span></span><br><span class="line"><span class="params">  options?: WatchOptionsBase</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">WatchStopHandle</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">doWatch</span>(effect, <span class="literal">null</span>, options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doWatch</span>(<span class="params"></span></span><br><span class="line"><span class="params">  source: WatchSource | WatchSource[] | WatchEffect | object,</span></span><br><span class="line"><span class="params">  cb: WatchCallback | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  &#123; immediate, deep, flush, onTrack, onTrigger &#125;: WatchOptions = EMPTY_OBJ</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">WatchStopHandle</span> &#123;</span><br><span class="line">  <span class="comment">// å¤„ç†source</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">getter</span>: <span class="function">() =&gt;</span> any</span><br><span class="line">  <span class="keyword">let</span> forceTrigger = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">let</span> isMultiSource = <span class="literal">false</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isRef</span>(source)) &#123;</span><br><span class="line">    <span class="comment">// refç±»å‹</span></span><br><span class="line">    getter = <span class="function">() =&gt;</span> source.<span class="property">value</span></span><br><span class="line">    forceTrigger = <span class="title function_">isShallow</span>(source)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isReactive</span>(source)) &#123;</span><br><span class="line">    <span class="comment">// reactiveç±»å‹</span></span><br><span class="line">    getter = <span class="function">() =&gt;</span> source</span><br><span class="line">    deep = <span class="literal">true</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isArray</span>(source)) &#123;</span><br><span class="line">    <span class="comment">// æ•°ç»„ç±»å‹</span></span><br><span class="line">    isMultiSource = <span class="literal">true</span></span><br><span class="line">    forceTrigger = source.<span class="title function_">some</span>(<span class="function"><span class="params">s</span> =&gt;</span> <span class="title function_">isReactive</span>(s) || <span class="title function_">isShallow</span>(s))</span><br><span class="line">    getter = <span class="function">() =&gt;</span></span><br><span class="line">      source.<span class="title function_">map</span>(<span class="function"><span class="params">s</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isRef</span>(s)) &#123;</span><br><span class="line">          <span class="keyword">return</span> s.<span class="property">value</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isReactive</span>(s)) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">traverse</span>(s)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isFunction</span>(s)) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">callWithErrorHandling</span>(s, instance, <span class="title class_">ErrorCodes</span>.<span class="property">WATCH_GETTER</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> s</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isFunction</span>(source)) &#123;</span><br><span class="line">    <span class="comment">// å‡½æ•°ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">      <span class="comment">// watch(getter, cb)</span></span><br><span class="line">      getter = <span class="function">() =&gt;</span></span><br><span class="line">        <span class="title function_">callWithErrorHandling</span>(source, instance, <span class="title class_">ErrorCodes</span>.<span class="property">WATCH_GETTER</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// watchEffect</span></span><br><span class="line">      getter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance &amp;&amp; instance.<span class="property">isUnmounted</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cleanup) &#123;</span><br><span class="line">          <span class="title function_">cleanup</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">callWithAsyncErrorHandling</span>(</span><br><span class="line">          source,</span><br><span class="line">          instance,</span><br><span class="line">          <span class="title class_">ErrorCodes</span>.<span class="property">WATCH_CALLBACK</span>,</span><br><span class="line">          [onCleanup]</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ— æ•ˆsource</span></span><br><span class="line">    getter = <span class="variable constant_">NOOP</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¤„ç†deepé€‰é¡¹</span></span><br><span class="line">  <span class="keyword">if</span> (cb &amp;&amp; deep) &#123;</span><br><span class="line">    <span class="keyword">const</span> baseGetter = getter</span><br><span class="line">    getter = <span class="function">() =&gt;</span> <span class="title function_">traverse</span>(<span class="title function_">baseGetter</span>())</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ¸…ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">cleanup</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">onCleanup</span>: <span class="title class_">OnCleanup</span> = <span class="function">(<span class="params">fn: () =&gt; <span class="keyword">void</span></span>) =&gt;</span> &#123;</span><br><span class="line">    cleanup = effect.<span class="property">onStop</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">callWithErrorHandling</span>(fn, instance, <span class="title class_">ErrorCodes</span>.<span class="property">WATCH_CLEANUP</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ—§å€¼</span></span><br><span class="line">  <span class="keyword">let</span> oldValue = isMultiSource</span><br><span class="line">    ? <span class="keyword">new</span> <span class="title class_">Array</span>((source <span class="keyword">as</span> []).<span class="property">length</span>).<span class="title function_">fill</span>(<span class="variable constant_">INITIAL_WATCHER_VALUE</span>)</span><br><span class="line">    : <span class="variable constant_">INITIAL_WATCHER_VALUE</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è°ƒåº¦å™¨å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">job</span>: <span class="title class_">SchedulerJob</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!effect.<span class="property">active</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">      <span class="comment">// watch(source, cb)</span></span><br><span class="line">      <span class="keyword">const</span> newValue = effect.<span class="title function_">run</span>()</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        deep ||</span><br><span class="line">        forceTrigger ||</span><br><span class="line">        (isMultiSource</span><br><span class="line">          ? (newValue <span class="keyword">as</span> any[]).<span class="title function_">some</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span></span><br><span class="line">              <span class="title function_">hasChanged</span>(v, (oldValue <span class="keyword">as</span> any[])[i])</span><br><span class="line">            )</span><br><span class="line">          : <span class="title function_">hasChanged</span>(newValue, oldValue))</span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="comment">// æ¸…ç†æ—§çš„å‰¯ä½œç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (cleanup) &#123;</span><br><span class="line">          <span class="title function_">cleanup</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è°ƒç”¨å›è°ƒ</span></span><br><span class="line">        <span class="title function_">callWithAsyncErrorHandling</span>(cb, instance, <span class="title class_">ErrorCodes</span>.<span class="property">WATCH_CALLBACK</span>, [</span><br><span class="line">          newValue,</span><br><span class="line">          oldValue === <span class="variable constant_">INITIAL_WATCHER_VALUE</span></span><br><span class="line">            ? <span class="literal">undefined</span></span><br><span class="line">            : isMultiSource &amp;&amp; oldValue[<span class="number">0</span>] === <span class="variable constant_">INITIAL_WATCHER_VALUE</span></span><br><span class="line">            ? []</span><br><span class="line">            : oldValue,</span><br><span class="line">          onCleanup</span><br><span class="line">        ])</span><br><span class="line">        <span class="comment">// æ›´æ–°æ—§å€¼</span></span><br><span class="line">        oldValue = newValue</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// watchEffect</span></span><br><span class="line">      effect.<span class="title function_">run</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®¾ç½®è°ƒåº¦å™¨ä¼˜å…ˆçº§</span></span><br><span class="line">  job.<span class="property">allowRecurse</span> = !!cb</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ ¹æ®flushé€‰é¡¹è®¾ç½®è°ƒåº¦å™¨</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">scheduler</span>: <span class="title class_">EffectScheduler</span></span><br><span class="line">  <span class="keyword">if</span> (flush === <span class="string">&#x27;sync&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// åŒæ­¥è°ƒåº¦</span></span><br><span class="line">    scheduler = job <span class="keyword">as</span> any</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flush === <span class="string">&#x27;post&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// åç½®è°ƒåº¦ï¼ˆç»„ä»¶æ›´æ–°åï¼‰</span></span><br><span class="line">    scheduler = <span class="function">() =&gt;</span> <span class="title function_">queuePostRenderEffect</span>(job, instance &amp;&amp; instance.<span class="property">suspense</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// é»˜è®¤ï¼š&#x27;pre&#x27;ï¼Œå‰ç½®è°ƒåº¦ï¼ˆç»„ä»¶æ›´æ–°å‰ï¼‰</span></span><br><span class="line">    job.<span class="property">pre</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (instance) job.<span class="property">id</span> = instance.<span class="property">uid</span></span><br><span class="line">    scheduler = <span class="function">() =&gt;</span> <span class="title function_">queueJob</span>(job)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºeffect</span></span><br><span class="line">  <span class="keyword">const</span> effect = <span class="keyword">new</span> <span class="title class_">ReactiveEffect</span>(getter, scheduler)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆå§‹è¿è¡Œ</span></span><br><span class="line">  <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">    <span class="keyword">if</span> (immediate) &#123;</span><br><span class="line">      <span class="title function_">job</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      oldValue = effect.<span class="title function_">run</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flush === <span class="string">&#x27;post&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_">queuePostRenderEffect</span>(</span><br><span class="line">      effect.<span class="property">run</span>.<span class="title function_">bind</span>(effect),</span><br><span class="line">      instance &amp;&amp; instance.<span class="property">suspense</span></span><br><span class="line">    )</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    effect.<span class="title function_">run</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è¿”å›åœæ­¢å‡½æ•°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    effect.<span class="title function_">stop</span>()</span><br><span class="line">    <span class="keyword">if</span> (instance &amp;&amp; instance.<span class="property">scope</span>) &#123;</span><br><span class="line">      <span class="title function_">remove</span>(instance.<span class="property">scope</span>.<span class="property">effects</span>!, effect)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››ã€ç¼–è¯‘ä¼˜åŒ–"><a href="#å››ã€ç¼–è¯‘ä¼˜åŒ–" class="headerlink" title="å››ã€ç¼–è¯‘ä¼˜åŒ–"></a>å››ã€ç¼–è¯‘ä¼˜åŒ–</h2><p>Vue 3åœ¨ç¼–è¯‘é˜¶æ®µå¼•å…¥äº†è®¸å¤šä¼˜åŒ–ï¼Œæé«˜äº†æ¸²æŸ“æ€§èƒ½ã€‚</p><h3 id="4-1-é™æ€æå‡"><a href="#4-1-é™æ€æå‡" class="headerlink" title="4.1 é™æ€æå‡"></a>4.1 é™æ€æå‡</h3><p>é™æ€æå‡æ˜¯æŒ‡å°†é™æ€èŠ‚ç‚¹æå‡åˆ°æ¸²æŸ“å‡½æ•°ä¹‹å¤–ï¼Œé¿å…é‡å¤åˆ›å»ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘å‰çš„æ¨¡æ¿</span></span><br><span class="line">&lt;div&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;static&quot;</span>&gt;</span>Static<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; dynamic &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue 2ç¼–è¯‘åçš„æ¸²æŸ“å‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;static&#x27;</span> &#125;, <span class="string">&#x27;Static&#x27;</span>),</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, <span class="variable language_">this</span>.<span class="property">dynamic</span>)</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue 3ç¼–è¯‘åçš„æ¸²æŸ“å‡½æ•°ï¼ˆå¸¦é™æ€æå‡ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> hoisted = <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;static&#x27;</span> &#125;, <span class="string">&#x27;Static&#x27;</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">    hoisted,</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, ctx.<span class="property">dynamic</span>)</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-è¡¥ä¸æ ‡è®°-PatchFlags"><a href="#4-2-è¡¥ä¸æ ‡è®°-PatchFlags" class="headerlink" title="4.2 è¡¥ä¸æ ‡è®° (PatchFlags)"></a>4.2 è¡¥ä¸æ ‡è®° (PatchFlags)</h3><p>è¡¥ä¸æ ‡è®°ç”¨äºæ ‡è¯†åŠ¨æ€å†…å®¹çš„ç±»å‹ï¼Œä¼˜åŒ–æ›´æ–°æ€§èƒ½ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘å‰çš„æ¨¡æ¿</span></span><br><span class="line">&lt;div id=<span class="string">&quot;foo&quot;</span> :<span class="keyword">class</span>=<span class="string">&quot;cls&quot;</span>&gt;&#123;&#123; text &#125;&#125;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue 3ç¼–è¯‘åçš„æ¸²æŸ“å‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, </span><br><span class="line">    &#123; </span><br><span class="line">      <span class="attr">id</span>: <span class="string">&#x27;foo&#x27;</span>, </span><br><span class="line">      <span class="attr">class</span>: ctx.<span class="property">cls</span> <span class="comment">// åŠ¨æ€class</span></span><br><span class="line">    &#125;, </span><br><span class="line">    ctx.<span class="property">text</span>,       <span class="comment">// åŠ¨æ€æ–‡æœ¬</span></span><br><span class="line">    <span class="title class_">PatchFlags</span>.<span class="property">CLASS</span> | <span class="title class_">PatchFlags</span>.<span class="property">TEXT</span> <span class="comment">// è¡¥ä¸æ ‡è®°</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-å—æ ‘-Block-Tree"><a href="#4-3-å—æ ‘-Block-Tree" class="headerlink" title="4.3 å—æ ‘ (Block Tree)"></a>4.3 å—æ ‘ (Block Tree)</h3><p>å—æ ‘æ˜¯Vue 3å¼•å…¥çš„æ–°æ¦‚å¿µï¼Œç”¨äºè·Ÿè¸ªåŠ¨æ€å­èŠ‚ç‚¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘å‰çš„æ¨¡æ¿</span></span><br><span class="line">&lt;div&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Static<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;show&quot;</span>&gt;</span>Conditional<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue 3ç¼–è¯‘åçš„æ¸²æŸ“å‡½æ•°ï¼ˆç®€åŒ–ï¼‰</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createBlock</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">null</span>, [</span><br><span class="line">    <span class="title function_">createVNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">null</span>, <span class="string">&#x27;Static&#x27;</span>),</span><br><span class="line">    (ctx.<span class="property">show</span>)</span><br><span class="line">      ? <span class="title function_">createVNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">null</span>, <span class="string">&#x27;Conditional&#x27;</span>, <span class="title class_">PatchFlags</span>.<span class="property">DYNAMIC</span>)</span><br><span class="line">      : <span class="title function_">createCommentVNode</span>(<span class="string">&#x27;v-if&#x27;</span>),</span><br><span class="line">    <span class="title function_">renderList</span>(ctx.<span class="property">list</span>, <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">createVNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">null</span>, item, <span class="title class_">PatchFlags</span>.<span class="property">TEXT</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  ], <span class="title class_">PatchFlags</span>.<span class="property">STABLE_FRAGMENT</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Vue 3æºç çš„æ ¸å¿ƒäº®ç‚¹ï¼š</p><ol><li><strong>å“åº”å¼ç³»ç»Ÿ</strong>ï¼šåŸºäºProxyçš„å…¨æ–°å“åº”å¼ç³»ç»Ÿï¼Œæä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œæ›´å®Œæ•´çš„å“åº”å¼è¦†ç›–</li><li><strong>ç»„åˆå¼API</strong>ï¼šæä¾›äº†æ›´çµæ´»çš„é€»è¾‘ç»„ç»‡æ–¹å¼ï¼Œè§£å†³äº†é€‰é¡¹å¼APIçš„é™åˆ¶</li><li><strong>ç¼–è¯‘ä¼˜åŒ–</strong>ï¼šé™æ€æå‡ã€è¡¥ä¸æ ‡è®°ã€å—æ ‘ç­‰ä¼˜åŒ–å¤§å¹…æå‡äº†æ¸²æŸ“æ€§èƒ½</li><li><strong>TypeScriptæ”¯æŒ</strong>ï¼šæºç å®Œå…¨ç”¨TypeScripté‡å†™ï¼Œæä¾›äº†æ›´å¥½çš„ç±»å‹æ¨å¯¼</li><li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šé‡‡ç”¨monorepoç®¡ç†ï¼Œå„ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹ä½¿ç”¨</li></ol><p>Vue 3çš„æºç è®¾è®¡ä½“ç°äº†ç°ä»£å‰ç«¯æ¡†æ¶çš„æœ€ä½³å®è·µï¼Œé€šè¿‡æ·±å…¥ç†è§£å…¶å®ç°åŸç†ï¼Œå¯ä»¥æ›´å¥½åœ°ä½¿ç”¨Vue 3è¿›è¡Œå¼€å‘ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ç›®å½•ç»“æ„&quot;&gt;&lt;a href=&quot;#ç›®å½•ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;ç›®å½•ç»“æ„&quot;&gt;&lt;/a&gt;ç›®å½•ç»“æ„&lt;/h2&gt;&lt;p&gt;Vue 3çš„æºç é‡‡ç”¨monorepoçš„æ–¹å¼ç»„ç»‡ï¼Œä½¿ç”¨pnpmè¿›è¡ŒåŒ…ç®¡ç†ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;reactivity&lt;/strong&gt;: å“åº”å¼ç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;runtime-core&lt;/strong&gt;: ä¸å¹³å°æ— å…³çš„è¿è¡Œæ—¶æ ¸å¿ƒ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;runtime-dom&lt;/strong&gt;: æµè§ˆå™¨å¹³å°ç‰¹å®šçš„è¿è¡Œæ—¶&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;compiler-core&lt;/strong&gt;: ä¸å¹³å°æ— å…³çš„ç¼–è¯‘å™¨æ ¸å¿ƒ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;compiler-dom&lt;/strong&gt;: æµè§ˆå™¨å¹³å°ç‰¹å®šçš„ç¼–è¯‘å™¨å®ç°&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;compiler-sfc&lt;/strong&gt;: å•æ–‡ä»¶ç»„ä»¶(.vueæ–‡ä»¶)ç¼–è¯‘å™¨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;shared&lt;/strong&gt;: å…±äº«å·¥å…·å‡½æ•°&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;vue&lt;/strong&gt;: å®Œæ•´ç‰ˆæœ¬ï¼ŒåŒ…å«è¿è¡Œæ—¶å’Œç¼–è¯‘å™¨&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="vue3" scheme="http://blog.ypintao.com/categories/vue3/"/>
    
    
    <category term="vue3" scheme="http://blog.ypintao.com/tags/vue3/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯é¢è¯•é¢˜é›†</title>
    <link href="http://blog.ypintao.com/2023/03/02/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/%E9%9D%A2%E8%AF%95/"/>
    <id>http://blog.ypintao.com/2023/03/02/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/%E9%9D%A2%E8%AF%95/</id>
    <published>2023-03-02T04:00:00.000Z</published>
    <updated>2025-09-25T02:28:31.984Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é€‚é…é—®é¢˜"><a href="#é€‚é…é—®é¢˜" class="headerlink" title="é€‚é…é—®é¢˜"></a>é€‚é…é—®é¢˜</h2><h2 id="reactç›¸å…³é—®é¢˜"><a href="#reactç›¸å…³é—®é¢˜" class="headerlink" title="reactç›¸å…³é—®é¢˜"></a>reactç›¸å…³é—®é¢˜</h2><h2 id="ç½‘ç»œé—®é¢˜"><a href="#ç½‘ç»œé—®é¢˜" class="headerlink" title="ç½‘ç»œé—®é¢˜"></a>ç½‘ç»œé—®é¢˜</h2><h2 id="æ€§èƒ½é—®é¢˜"><a href="#æ€§èƒ½é—®é¢˜" class="headerlink" title="æ€§èƒ½é—®é¢˜"></a>æ€§èƒ½é—®é¢˜</h2><h2 id="å…¼å®¹æ€§é—®é¢˜"><a href="#å…¼å®¹æ€§é—®é¢˜" class="headerlink" title="å…¼å®¹æ€§é—®é¢˜"></a>å…¼å®¹æ€§é—®é¢˜</h2><h2 id="å·¥ç¨‹åŒ–é—®é¢˜"><a href="#å·¥ç¨‹åŒ–é—®é¢˜" class="headerlink" title="å·¥ç¨‹åŒ–é—®é¢˜"></a>å·¥ç¨‹åŒ–é—®é¢˜</h2><h2 id="å®‰å…¨é—®é¢˜"><a href="#å®‰å…¨é—®é¢˜" class="headerlink" title="å®‰å…¨é—®é¢˜"></a>å®‰å…¨é—®é¢˜</h2><h3 id="ç§»åŠ¨ç«¯é€‚é…é—®é¢˜ã€‚"><a href="#ç§»åŠ¨ç«¯é€‚é…é—®é¢˜ã€‚" class="headerlink" title="ç§»åŠ¨ç«¯é€‚é…é—®é¢˜ã€‚"></a>ç§»åŠ¨ç«¯é€‚é…é—®é¢˜ã€‚</h3><h2 id="createElement-å’Œ-cloneElement-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#createElement-å’Œ-cloneElement-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="createElement å’Œ cloneElement æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>createElement å’Œ cloneElement æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸åŒ</p><p>React.createElement():JSX è¯­æ³•å°±æ˜¯ç”¨ React.createElement()æ¥æ„å»º React å…ƒç´ çš„ã€‚</p><p>å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªæ ‡ç­¾åã€‚å¦‚ divã€spanï¼Œæˆ–è€… React ç»„ä»¶ã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¼ å…¥çš„å±æ€§ã€‚ç¬¬ä¸‰ä¸ªä»¥åŠä¹‹åçš„å‚æ•°ï¼Œçš†ä½œä¸ºç»„ä»¶çš„å­ç»„ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">React</span>.<span class="title function_">createElement</span>(type, [props], [...children]);</span><br></pre></td></tr></table></figure><p>React.cloneElement()ä¸ React.createElement()ç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª React å…ƒç´ ï¼Œè€Œä¸æ˜¯æ ‡ç­¾åæˆ–ç»„ä»¶ã€‚æ–°æ·»åŠ çš„å±æ€§ä¼šå¹¶å…¥åŸæœ‰çš„å±æ€§ï¼Œä¼ å…¥åˆ°è¿”å›çš„æ–°å…ƒç´ ä¸­ï¼Œè€Œæ—§çš„å­å…ƒç´ å°†è¢«æ›¿æ¢ã€‚å°†ä¿ç•™åŸå§‹å…ƒç´ çš„é”®å’Œå¼•ç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">React</span>.<span class="title function_">cloneElement</span>(element, [props], [...children]);</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="1ã€react-çˆ¶ç»„ä»¶æ€ä¹ˆè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•"><a href="#1ã€react-çˆ¶ç»„ä»¶æ€ä¹ˆè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•" class="headerlink" title="1ã€react çˆ¶ç»„ä»¶æ€ä¹ˆè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•"></a>1ã€react çˆ¶ç»„ä»¶æ€ä¹ˆè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•</h2><p>â€Œå‡½æ•°ç»„ä»¶ä½¿ç”¨ forwardRef+useImperativeHandleâ€Œï¼šå­ç»„ä»¶é€šè¿‡useImperativeHandleæš´éœ²æ–¹æ³•ï¼Œçˆ¶ç»„ä»¶é€šè¿‡refè°ƒç”¨</p><h2 id="2ã€react-useEffect-ä¾èµ–é¡¹æ•°ç»„ä¸ºç©º-æˆ–è€…ä¸å†™æ•°ç»„æœ‰å•¥åŒºåˆ«"><a href="#2ã€react-useEffect-ä¾èµ–é¡¹æ•°ç»„ä¸ºç©º-æˆ–è€…ä¸å†™æ•°ç»„æœ‰å•¥åŒºåˆ«" class="headerlink" title="2ã€react useEffect ä¾èµ–é¡¹æ•°ç»„ä¸ºç©º æˆ–è€…ä¸å†™æ•°ç»„æœ‰å•¥åŒºåˆ«"></a>2ã€react useEffect ä¾èµ–é¡¹æ•°ç»„ä¸ºç©º æˆ–è€…ä¸å†™æ•°ç»„æœ‰å•¥åŒºåˆ«</h2><p>ç©ºæ•°ç»„[]â€Œï¼šä»…åœ¨æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œå¸è½½æ—¶æ¸…ç†<br>â€Œä¸ä¼ æ•°ç»„â€Œï¼šæ¯æ¬¡æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œ<br>â€Œå«ä¾èµ–é¡¹â€Œï¼šä¾èµ–å˜åŒ–æ—¶æ‰§è¡ŒMCP_3]^</p><p>1ã€reactæ€§èƒ½ä¼˜åŒ–<br>1.1ã€useMemo<br>1.2ã€useCallback</p><ol start="2"><li>useLayoutEffect () ä¸ useEffect () çš„åŒºåˆ«<br>useLayoutEffectä¼šé˜»å¡æµè§ˆå™¨æ¸²æŸ“ï¼ŒuseEffectä¸ä¼š<br>useEffect()ï¼šå¼‚æ­¥æ‰§è¡Œï¼ŒDOM æ›´æ–°åè§¦å‘ï¼ˆé€‚åˆå¤§å¤šæ•°å‰¯ä½œç”¨ï¼‰ã€‚<br>useLayoutEffect()ï¼šåŒæ­¥æ‰§è¡Œï¼ŒDOM æ›´æ–°å‰è§¦å‘ï¼ˆé€‚åˆéœ€è¦æµ‹é‡ DOM çš„åœºæ™¯ï¼‰ã€‚</li></ol><p>React.memoç¼“å­˜ç»„ä»¶ï¼Œé¿å…æ— æ„ä¹‰é‡æ–°æ¸²æŸ“<br>useMemo&#x2F;useCallbackç¼“å­˜å‡½æ•°æˆ–è®¡ç®—ç»“æœ</p><h2 id="3ã€usecontext-æœ‰ä»€ä¹ˆä½œç”¨å’Œç¼ºç‚¹"><a href="#3ã€usecontext-æœ‰ä»€ä¹ˆä½œç”¨å’Œç¼ºç‚¹" class="headerlink" title="3ã€usecontext,æœ‰ä»€ä¹ˆä½œç”¨å’Œç¼ºç‚¹"></a>3ã€usecontext,æœ‰ä»€ä¹ˆä½œç”¨å’Œç¼ºç‚¹</h2><p>ä¼˜ç‚¹â€Œï¼š<br>è·¨ç»„ä»¶å±‚çº§å…±äº«çŠ¶æ€<br>é¿å…prop drilling<br>â€Œç¼ºç‚¹â€Œï¼š<br>çŠ¶æ€æ›´æ–°ä¼šå¯¼è‡´æ‰€æœ‰æ¶ˆè´¹è€…é‡æ–°æ¸²æŸ“<br>ä¸é€‚åˆé«˜é¢‘æ›´æ–°çš„åœºæ™¯MCP_3]^</p><h2 id="4ã€reactç»„ä»¶é€»è¾‘æœç”¨æ€ä¹ˆå¼„ã€‚"><a href="#4ã€reactç»„ä»¶é€»è¾‘æœç”¨æ€ä¹ˆå¼„ã€‚" class="headerlink" title="4ã€reactç»„ä»¶é€»è¾‘æœç”¨æ€ä¹ˆå¼„ã€‚"></a>4ã€reactç»„ä»¶é€»è¾‘æœç”¨æ€ä¹ˆå¼„ã€‚</h2><p>Reactç»„ä»¶é€»è¾‘å¤ç”¨<br>â€Œè‡ªå®šä¹‰Hooksâ€Œï¼šæå–é€šç”¨é€»è¾‘ä¸ºå¯å¤ç”¨å‡½æ•°<br>â€ŒHOCé«˜é˜¶ç»„ä»¶â€Œï¼šé€šè¿‡ç»„ä»¶åŒ…è£…å¢å¼ºåŠŸèƒ½<br>â€ŒRender Propsâ€Œï¼šé€šè¿‡å‡½æ•°propå…±äº«ä»£ç <br>â€ŒContext APIâ€Œï¼šè·¨å±‚çº§çŠ¶æ€å…±äº«MCP_3]^</p><h3 id="5ã€React-Hooks-çš„ä½œç”¨å’Œå¸¸ç”¨-Hook-æœ‰å“ªäº›ï¼Ÿ"><a href="#5ã€React-Hooks-çš„ä½œç”¨å’Œå¸¸ç”¨-Hook-æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="5ã€React Hooks çš„ä½œç”¨å’Œå¸¸ç”¨ Hook æœ‰å“ªäº›ï¼Ÿ"></a>5ã€React Hooks çš„ä½œç”¨å’Œå¸¸ç”¨ Hook æœ‰å“ªäº›ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>React Hooks æ˜¯ React 16.8 å¼•å…¥çš„ç‰¹æ€§ï¼Œå…è®¸åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€å’Œå…¶ä»– React ç‰¹æ€§ï¼Œè€Œä¸éœ€è¦ç¼–å†™ç±»ç»„ä»¶ã€‚</p><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸç‰¹æ€§</li><li>å¤ç”¨çŠ¶æ€é€»è¾‘ï¼Œè€Œä¸éœ€è¦æ”¹å˜ç»„ä»¶å±‚æ¬¡ç»“æ„</li><li>å°†ç›¸å…³é€»è¾‘ç»„åˆåœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯æŒ‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•åˆ†æ•£</li></ul><p><strong>å¸¸ç”¨çš„ Hook</strong>ï¼š</p><ul><li><strong>useState</strong>ï¼šç®¡ç†ç»„ä»¶çŠ¶æ€</li><li><strong>useEffect</strong>ï¼šå¤„ç†å‰¯ä½œç”¨ï¼ˆç±»ä¼¼ componentDidMountã€componentDidUpdateã€componentWillUnmountï¼‰</li><li><strong>useContext</strong>ï¼šè®¿é—® React Context</li><li><strong>useReducer</strong>ï¼šä½¿ç”¨ reducer ç®¡ç†å¤æ‚çŠ¶æ€é€»è¾‘</li><li><strong>useCallback</strong>ï¼šè®°å¿†å‡½æ•°ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</li><li><strong>useMemo</strong>ï¼šè®°å¿†è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—</li><li><strong>useRef</strong>ï¼šä¿å­˜å¯å˜å€¼ï¼Œä¸è§¦å‘é‡æ–°æ¸²æŸ“</li></ul><h3 id="çŠ¶æ€ç®¡ç†å·¥å…·ï¼ˆRedux-Vuex-Piniaï¼‰çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†"><a href="#çŠ¶æ€ç®¡ç†å·¥å…·ï¼ˆRedux-Vuex-Piniaï¼‰çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†" class="headerlink" title="çŠ¶æ€ç®¡ç†å·¥å…·ï¼ˆRedux&#x2F;Vuex&#x2F;Piniaï¼‰çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†"></a>çŠ¶æ€ç®¡ç†å·¥å…·ï¼ˆRedux&#x2F;Vuex&#x2F;Piniaï¼‰çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>çŠ¶æ€ç®¡ç†å·¥å…·ç”¨äºé›†ä¸­ç®¡ç†åº”ç”¨çš„çŠ¶æ€ï¼Œä½¿çŠ¶æ€å˜åŒ–å¯é¢„æµ‹å’Œå¯è¿½è¸ªã€‚</p><p><strong>Reduxï¼ˆReactï¼‰æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p><ul><li><strong>Store</strong>ï¼šå­˜å‚¨åº”ç”¨çš„çŠ¶æ€</li><li><strong>Action</strong>ï¼šæè¿°çŠ¶æ€å˜åŒ–çš„æ™®é€šå¯¹è±¡</li><li><strong>Reducer</strong>ï¼šçº¯å‡½æ•°ï¼Œæ ¹æ®å½“å‰çŠ¶æ€å’Œ action è®¡ç®—æ–°çŠ¶æ€</li><li><strong>Dispatch</strong>ï¼šå‘é€ action çš„æ–¹æ³•</li><li><strong>Middleware</strong>ï¼šæ‰©å±• Redux åŠŸèƒ½çš„ä¸­é—´ä»¶ï¼ˆå¦‚å¤„ç†å¼‚æ­¥æ“ä½œï¼‰</li></ul><h3 id="6ã€é—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨é€”å’Œæ½œåœ¨é—®é¢˜ï¼Ÿ"><a href="#6ã€é—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨é€”å’Œæ½œåœ¨é—®é¢˜ï¼Ÿ" class="headerlink" title="6ã€é—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨é€”å’Œæ½œåœ¨é—®é¢˜ï¼Ÿ"></a>6ã€é—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨é€”å’Œæ½œåœ¨é—®é¢˜ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>é—­åŒ…æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®å…¶è¯æ³•ä½œç”¨åŸŸï¼Œå³ä½¿è¯¥å‡½æ•°åœ¨å…¶è¯æ³•ä½œç”¨åŸŸä¹‹å¤–æ‰§è¡Œã€‚</p><p><strong>ç”¨é€”</strong>ï¼š</p><ul><li>æ•°æ®ç§æœ‰åŒ–&#x2F;å°è£…</li><li>åˆ›å»ºå‡½æ•°å·¥å‚</li><li>å®ç°æ¨¡å—æ¨¡å¼</li><li>ç»´æŒçŠ¶æ€</li></ul><p><strong>æ½œåœ¨é—®é¢˜</strong>ï¼š</p><ul><li>å†…å­˜æ³„æ¼ï¼šé—­åŒ…ä¼šä¿æŒå¯¹å¤–éƒ¨å˜é‡çš„å¼•ç”¨ï¼Œå¯èƒ½å¯¼è‡´è¿™äº›å˜é‡æ— æ³•è¢«åƒåœ¾å›æ”¶</li><li>æ€§èƒ½é—®é¢˜ï¼šè¿‡åº¦ä½¿ç”¨é—­åŒ…å¯èƒ½å½±å“æ€§èƒ½</li></ul><p> è§£é‡Š JavaScript ä¸­çš„åŸå‹å’ŒåŸå‹é“¾<br><strong>ç­”æ¡ˆ</strong>ï¼š<br>JavaScript ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŸå‹ï¼ˆprototypeï¼‰ï¼ŒåŸå‹ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡å¯ä»¥ä»åŸå‹ç»§æ‰¿å±æ€§å’Œæ–¹æ³•ã€‚</p><ul><li><strong>åŸå‹</strong>ï¼šæ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ª <code>prototype</code> å±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯è¯¥å‡½æ•°çš„å®ä¾‹çš„åŸå‹</li><li><strong>åŸå‹é“¾</strong>ï¼šå½“è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå¦‚æœå¯¹è±¡æœ¬èº«æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼ŒJavaScript ä¼šæ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥å±æ€§æˆ–åˆ°è¾¾åŸå‹é“¾çš„æœ«ç«¯ï¼ˆ<code>null</code>ï¼‰</li></ul><h3 id="è§£é‡Šäº‹ä»¶å¾ªç¯ï¼ˆEvent-Loopï¼‰æœºåˆ¶"><a href="#è§£é‡Šäº‹ä»¶å¾ªç¯ï¼ˆEvent-Loopï¼‰æœºåˆ¶" class="headerlink" title="è§£é‡Šäº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰æœºåˆ¶"></a>è§£é‡Šäº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰æœºåˆ¶</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œäº‹ä»¶å¾ªç¯æ˜¯ JavaScript å®ç°å¼‚æ­¥çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå®ƒç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p><ul><li><strong>è°ƒç”¨æ ˆï¼ˆCall Stackï¼‰</strong>ï¼šæ‰§è¡ŒåŒæ­¥ä»£ç </li><li><strong>ä»»åŠ¡é˜Ÿåˆ—ï¼ˆTask Queueï¼‰</strong>ï¼š<ul><li><strong>å®ä»»åŠ¡ï¼ˆMacrotaskï¼‰</strong>ï¼šsetTimeoutã€setIntervalã€I&#x2F;Oã€UI æ¸²æŸ“ç­‰</li><li><strong>å¾®ä»»åŠ¡ï¼ˆMicrotaskï¼‰</strong>ï¼šPromise å›è°ƒã€MutationObserverã€queueMicrotask() ç­‰</li></ul></li></ul><p>äº‹ä»¶å¾ªç¯çš„æ‰§è¡Œé¡ºåºï¼š</p><ol><li>æ‰§è¡ŒåŒæ­¥ä»£ç ï¼ˆè°ƒç”¨æ ˆä¸­çš„ä»»åŠ¡ï¼‰</li><li>æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡</li><li>æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡</li><li>é‡å¤æ­¥éª¤ 2-3</li></ol><pre><code class="language-javascript"></code></pre>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;é€‚é…é—®é¢˜&quot;&gt;&lt;a href=&quot;#é€‚é…é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é€‚é…é—®é¢˜&quot;&gt;&lt;/a&gt;é€‚é…é—®é¢˜&lt;/h2&gt;&lt;h2 id=&quot;reactç›¸å…³é—®é¢˜&quot;&gt;&lt;a href=&quot;#reactç›¸å…³é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;reactç›¸å…³é—®é¢˜&quot;&gt;&lt;/a&gt;reactç›¸å…³é—®é¢˜&lt;/h2&gt;&lt;h2 id=&quot;ç½‘ç»œé—®é¢˜&quot;&gt;&lt;a href=&quot;#ç½‘ç»œé—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;ç½‘ç»œé—®é¢˜&quot;&gt;&lt;/a&gt;ç½‘ç»œé—®é¢˜&lt;/h2&gt;&lt;h2 id=&quot;æ€§èƒ½é—®é¢˜&quot;&gt;&lt;a href=&quot;#æ€§èƒ½é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;æ€§èƒ½é—®é¢˜&quot;&gt;&lt;/a&gt;æ€§èƒ½é—®é¢˜&lt;/h2&gt;&lt;h2 id=&quot;å…¼å®¹æ€§é—®é¢˜&quot;&gt;&lt;a href=&quot;#å…¼å®¹æ€§é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;å…¼å®¹æ€§é—®é¢˜&quot;&gt;&lt;/a&gt;å…¼å®¹æ€§é—®é¢˜&lt;/h2&gt;&lt;h2 id=&quot;å·¥ç¨‹åŒ–é—®é¢˜&quot;&gt;&lt;a href=&quot;#å·¥ç¨‹åŒ–é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;å·¥ç¨‹åŒ–é—®é¢˜&quot;&gt;&lt;/a&gt;å·¥ç¨‹åŒ–é—®é¢˜&lt;/h2&gt;&lt;h2 id=&quot;å®‰å…¨é—®é¢˜&quot;&gt;&lt;a href=&quot;#å®‰å…¨é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;å®‰å…¨é—®é¢˜&quot;&gt;&lt;/a&gt;å®‰å…¨é—®é¢˜&lt;/h2&gt;&lt;h3 id=&quot;ç§»åŠ¨ç«¯é€‚é…é—®é¢˜ã€‚&quot;&gt;&lt;a href=&quot;#ç§»åŠ¨ç«¯é€‚é…é—®é¢˜ã€‚&quot; class=&quot;headerlink&quot; title=&quot;ç§»åŠ¨ç«¯é€‚é…é—®é¢˜ã€‚&quot;&gt;&lt;/a&gt;ç§»åŠ¨ç«¯é€‚é…é—®é¢˜ã€‚&lt;/h3&gt;&lt;h2 id=&quot;createElement-å’Œ-cloneElement-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&quot;&gt;&lt;a href=&quot;#createElement-å’Œ-cloneElement-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;createElement å’Œ cloneElement æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&quot;&gt;&lt;/a&gt;createElement å’Œ cloneElement æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&lt;/h2&gt;&lt;p&gt;ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸åŒ&lt;/p&gt;
&lt;p&gt;React.createElement():JSX è¯­æ³•å°±æ˜¯ç”¨ React.createElement()æ¥æ„å»º React å…ƒç´ çš„ã€‚&lt;/p&gt;
&lt;p&gt;å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªæ ‡ç­¾åã€‚å¦‚ divã€spanï¼Œæˆ–è€… React ç»„ä»¶ã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¼ å…¥çš„å±æ€§ã€‚ç¬¬ä¸‰ä¸ªä»¥åŠä¹‹åçš„å‚æ•°ï¼Œçš†ä½œä¸ºç»„ä»¶çš„å­ç»„ä»¶ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title class_&quot;&gt;React&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;createElement&lt;/span&gt;(type, [props], [...children]);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;React.cloneElement()ä¸ React.createElement()ç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª React å…ƒç´ ï¼Œè€Œä¸æ˜¯æ ‡ç­¾åæˆ–ç»„ä»¶ã€‚æ–°æ·»åŠ çš„å±æ€§ä¼šå¹¶å…¥åŸæœ‰çš„å±æ€§ï¼Œä¼ å…¥åˆ°è¿”å›çš„æ–°å…ƒç´ ä¸­ï¼Œè€Œæ—§çš„å­å…ƒç´ å°†è¢«æ›¿æ¢ã€‚å°†ä¿ç•™åŸå§‹å…ƒç´ çš„é”®å’Œå¼•ç”¨ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title class_&quot;&gt;React&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;cloneElement&lt;/span&gt;(element, [props], [...children]);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="å‰ç«¯é¢è¯•é¢˜é›†" scheme="http://blog.ypintao.com/categories/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98%E9%9B%86/"/>
    
    
    <category term="å‰ç«¯é¢è¯•é¢˜é›†" scheme="http://blog.ypintao.com/tags/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯é¢è¯•é¢˜é›†</title>
    <link href="http://blog.ypintao.com/2022/03/02/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    <id>http://blog.ypintao.com/2022/03/02/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98/</id>
    <published>2022-03-02T04:00:00.000Z</published>
    <updated>2025-09-27T05:11:56.214Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JavaScript-åŸºç¡€"><a href="#JavaScript-åŸºç¡€" class="headerlink" title="JavaScript åŸºç¡€"></a>JavaScript åŸºç¡€</h2><h3 id="Javascriptä¸­applyå’Œcallçš„åŒºåˆ«"><a href="#Javascriptä¸­applyå’Œcallçš„åŒºåˆ«" class="headerlink" title="Javascriptä¸­applyå’Œcallçš„åŒºåˆ«"></a>Javascriptä¸­applyå’Œcallçš„åŒºåˆ«</h3><p>å‚æ•°ä¼ é€’æ–¹å¼ä¸åŒï¼šcall æ–¹æ³•æ¥å—çš„æ˜¯ä¸€ä¸ªå‚æ•°åˆ—è¡¨ï¼Œè€Œ apply æ–¹æ³•æ¥å—çš„æ˜¯ä¸€ä¸ªå‚æ•°æ•°ç»„ã€‚<br>é€‚ç”¨åœºæ™¯ä¸åŒï¼šå½“å‚æ•°æ•°é‡å›ºå®šæ—¶ï¼Œé€šå¸¸ä½¿ç”¨ callï¼›å½“å‚æ•°æ•°é‡ä¸å›ºå®šæ—¶ï¼Œä½¿ç”¨ apply æ›´ä¸ºæ–¹ä¾¿ã€‚</p><p>call å’Œ apply éƒ½ç”¨äºæ”¹å˜å‡½æ•°æ‰§è¡Œæ—¶çš„ this æŒ‡å‘ã€‚</p><p>call æ¥å—å‚æ•°åˆ—è¡¨ï¼Œapply æ¥å—å‚æ•°æ•°ç»„ã€‚</p><p>æ ¹æ®å‚æ•°çš„æ•°é‡å’Œå½¢å¼é€‰æ‹©åˆé€‚çš„è°ƒç”¨æ–¹å¼ã€‚</p><p>æŒæ¡ call å’Œ apply çš„ä½¿ç”¨ï¼Œèƒ½å¤Ÿè®©ä½ åœ¨ JavaScript ä¸­æ›´åŠ çµæ´»åœ°æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæå‡ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id="1-è§£é‡Š-JavaScript-ä¸­çš„åŸå‹å’ŒåŸå‹é“¾"><a href="#1-è§£é‡Š-JavaScript-ä¸­çš„åŸå‹å’ŒåŸå‹é“¾" class="headerlink" title="1. è§£é‡Š JavaScript ä¸­çš„åŸå‹å’ŒåŸå‹é“¾"></a>1. è§£é‡Š JavaScript ä¸­çš„åŸå‹å’ŒåŸå‹é“¾</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>JavaScript ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŸå‹ï¼ˆprototypeï¼‰ï¼ŒåŸå‹ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡å¯ä»¥ä»åŸå‹ç»§æ‰¿å±æ€§å’Œæ–¹æ³•ã€‚</p><ul><li><strong>åŸå‹</strong>ï¼šæ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ª <code>prototype</code> å±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯è¯¥å‡½æ•°çš„å®ä¾‹çš„åŸå‹</li><li><strong>åŸå‹é“¾</strong>ï¼šå½“è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå¦‚æœå¯¹è±¡æœ¬èº«æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼ŒJavaScript ä¼šæ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥å±æ€§æˆ–åˆ°è¾¾åŸå‹é“¾çš„æœ«ç«¯ï¼ˆ<code>null</code>ï¼‰</li></ul><span id="more"></span><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, my name is <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> alice = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Alice&#x27;</span>);</span><br><span class="line">alice.<span class="title function_">sayHello</span>(); <span class="comment">// &quot;Hello, my name is Alice&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸå‹é“¾ç¤ºä¾‹</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(alice.<span class="property">__proto__</span> === <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="literal">null</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="2-varã€let-å’Œ-const-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-varã€let-å’Œ-const-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. varã€let å’Œ const çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2. varã€let å’Œ const çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š</p><ul><li><p><strong>var</strong>ï¼š</p><ul><li>å‡½æ•°ä½œç”¨åŸŸæˆ–å…¨å±€ä½œç”¨åŸŸ</li><li>å­˜åœ¨å˜é‡æå‡ï¼ˆå¯ä»¥åœ¨å£°æ˜å‰ä½¿ç”¨ï¼Œå€¼ä¸º undefinedï¼‰</li><li>å¯ä»¥é‡å¤å£°æ˜åŒåå˜é‡</li><li>å¯ä»¥é‡æ–°èµ‹å€¼</li></ul></li><li><p><strong>let</strong>ï¼š</p><ul><li>å—çº§ä½œç”¨åŸŸ</li><li>å­˜åœ¨æš‚æ—¶æ€§æ­»åŒºï¼ˆä¸èƒ½åœ¨å£°æ˜å‰ä½¿ç”¨ï¼‰</li><li>ä¸å¯ä»¥é‡å¤å£°æ˜åŒåå˜é‡</li><li>å¯ä»¥é‡æ–°èµ‹å€¼</li></ul></li><li><p><strong>const</strong>ï¼š</p><ul><li>å—çº§ä½œç”¨åŸŸ</li><li>å­˜åœ¨æš‚æ—¶æ€§æ­»åŒºï¼ˆä¸èƒ½åœ¨å£°æ˜å‰ä½¿ç”¨ï¼‰</li><li>ä¸å¯ä»¥é‡å¤å£°æ˜åŒåå˜é‡</li><li>ä¸å¯ä»¥é‡æ–°èµ‹å€¼ï¼ˆä½†å¯¹äºå¼•ç”¨ç±»å‹ï¼Œå¯ä»¥ä¿®æ”¹å…¶å±æ€§ï¼‰</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">2</span>; <span class="comment">// åŒä¸€ä¸ªå˜é‡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// let ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">let</span> y = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> y = <span class="number">2</span>; <span class="comment">// ä¸åŒçš„å˜é‡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(y); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> z = &#123; <span class="attr">value</span>: <span class="number">1</span> &#125;;</span><br><span class="line">z.<span class="property">value</span> = <span class="number">2</span>; <span class="comment">// å¯ä»¥ä¿®æ”¹å±æ€§</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(z.<span class="property">value</span>); <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// z = &#123; value: 3 &#125;; // é”™è¯¯ï¼šä¸èƒ½é‡æ–°èµ‹å€¼</span></span><br></pre></td></tr></table></figure><h3 id="3-è§£é‡Šäº‹ä»¶å¾ªç¯ï¼ˆEvent-Loopï¼‰æœºåˆ¶"><a href="#3-è§£é‡Šäº‹ä»¶å¾ªç¯ï¼ˆEvent-Loopï¼‰æœºåˆ¶" class="headerlink" title="3. è§£é‡Šäº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰æœºåˆ¶"></a>3. è§£é‡Šäº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰æœºåˆ¶</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œäº‹ä»¶å¾ªç¯æ˜¯ JavaScript å®ç°å¼‚æ­¥çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå®ƒç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p><ul><li><strong>è°ƒç”¨æ ˆï¼ˆCall Stackï¼‰</strong>ï¼šæ‰§è¡ŒåŒæ­¥ä»£ç </li><li><strong>ä»»åŠ¡é˜Ÿåˆ—ï¼ˆTask Queueï¼‰</strong>ï¼š<ul><li><strong>å®ä»»åŠ¡ï¼ˆMacrotaskï¼‰</strong>ï¼šsetTimeoutã€setIntervalã€I&#x2F;Oã€UI æ¸²æŸ“ç­‰</li><li><strong>å¾®ä»»åŠ¡ï¼ˆMicrotaskï¼‰</strong>ï¼šPromise å›è°ƒã€MutationObserverã€queueMicrotask() ç­‰</li></ul></li></ul><p>äº‹ä»¶å¾ªç¯çš„æ‰§è¡Œé¡ºåºï¼š</p><ol><li>æ‰§è¡ŒåŒæ­¥ä»£ç ï¼ˆè°ƒç”¨æ ˆä¸­çš„ä»»åŠ¡ï¼‰</li><li>æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡</li><li>æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡</li><li>é‡å¤æ­¥éª¤ 2-3</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>); <span class="comment">// åŒæ­¥ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>); <span class="comment">// å®ä»»åŠ¡</span></span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>); <span class="comment">// å¾®ä»»åŠ¡</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4&#x27;</span>); <span class="comment">// åŒæ­¥ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºé¡ºåºï¼š1, 4, 3, 2</span></span><br></pre></td></tr></table></figure><h3 id="4-é—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨é€”å’Œæ½œåœ¨é—®é¢˜ï¼Ÿ"><a href="#4-é—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨é€”å’Œæ½œåœ¨é—®é¢˜ï¼Ÿ" class="headerlink" title="4. é—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨é€”å’Œæ½œåœ¨é—®é¢˜ï¼Ÿ"></a>4. é—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨é€”å’Œæ½œåœ¨é—®é¢˜ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>é—­åŒ…æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®å…¶è¯æ³•ä½œç”¨åŸŸï¼Œå³ä½¿è¯¥å‡½æ•°åœ¨å…¶è¯æ³•ä½œç”¨åŸŸä¹‹å¤–æ‰§è¡Œã€‚</p><p><strong>ç”¨é€”</strong>ï¼š</p><ul><li>æ•°æ®ç§æœ‰åŒ–&#x2F;å°è£…</li><li>åˆ›å»ºå‡½æ•°å·¥å‚</li><li>å®ç°æ¨¡å—æ¨¡å¼</li><li>ç»´æŒçŠ¶æ€</li></ul><p><strong>æ½œåœ¨é—®é¢˜</strong>ï¼š</p><ul><li>å†…å­˜æ³„æ¼ï¼šé—­åŒ…ä¼šä¿æŒå¯¹å¤–éƒ¨å˜é‡çš„å¼•ç”¨ï¼Œå¯èƒ½å¯¼è‡´è¿™äº›å˜é‡æ— æ³•è¢«åƒåœ¾å›æ”¶</li><li>æ€§èƒ½é—®é¢˜ï¼šè¿‡åº¦ä½¿ç”¨é—­åŒ…å¯èƒ½å½±å“æ€§èƒ½</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—­åŒ…ç¤ºä¾‹ - è®¡æ•°å™¨</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createCounter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>; <span class="comment">// ç§æœ‰å˜é‡</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">increment</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      count++;</span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">decrement</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      count--;</span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getCount</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counter = <span class="title function_">createCounter</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">increment</span>()); <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">increment</span>()); <span class="comment">// 2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">decrement</span>()); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h3 id="5-Promiseã€async-await-çš„ä½œç”¨å’ŒåŒºåˆ«"><a href="#5-Promiseã€async-await-çš„ä½œç”¨å’ŒåŒºåˆ«" class="headerlink" title="5. Promiseã€async&#x2F;await çš„ä½œç”¨å’ŒåŒºåˆ«"></a>5. Promiseã€async&#x2F;await çš„ä½œç”¨å’ŒåŒºåˆ«</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Promise å’Œ async&#x2F;await éƒ½æ˜¯ç”¨äºå¤„ç† JavaScript ä¸­çš„å¼‚æ­¥æ“ä½œã€‚</p><p><strong>Promise</strong>ï¼š</p><ul><li>è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆå®Œæˆï¼ˆæˆ–å¤±è´¥ï¼‰åŠå…¶ç»“æœå€¼</li><li>æœ‰ä¸‰ç§çŠ¶æ€ï¼špendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€fulfilledï¼ˆå·²æˆåŠŸï¼‰ã€rejectedï¼ˆå·²å¤±è´¥ï¼‰</li><li>ä½¿ç”¨ <code>.then()</code> å’Œ <code>.catch()</code> æ–¹æ³•å¤„ç†ç»“æœå’Œé”™è¯¯</li></ul><p><strong>async&#x2F;await</strong>ï¼š</p><ul><li>æ˜¯åŸºäº Promise çš„è¯­æ³•ç³–</li><li><code>async</code> å‡½æ•°è¿”å›ä¸€ä¸ª Promise</li><li><code>await</code> å…³é”®å­—åªèƒ½åœ¨ <code>async</code> å‡½æ•°å†…ä½¿ç”¨ï¼Œç”¨äºç­‰å¾… Promise è§£å†³</li><li>ä½¿ä»£ç çœ‹èµ·æ¥æ›´åƒåŒæ­¥ä»£ç ï¼Œæ›´æ˜“è¯»</li></ul><p><strong>åŒºåˆ«</strong>ï¼š</p><ul><li>è¯­æ³•ï¼šasync&#x2F;await è¯­æ³•æ›´ç®€æ´ï¼Œæ›´æ¥è¿‘åŒæ­¥ä»£ç </li><li>é”™è¯¯å¤„ç†ï¼šPromise ä½¿ç”¨ <code>.catch()</code>ï¼Œasync&#x2F;await ä½¿ç”¨ try&#x2F;catch</li><li>è°ƒè¯•ï¼šasync&#x2F;await æ›´å®¹æ˜“è°ƒè¯•</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promise ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchDataPromise</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">fetch</span>(<span class="string">&#x27;https://api.example.com/data&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">      <span class="keyword">return</span> data;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// async/await ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchDataAsync</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;https://api.example.com/data&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HTML-CSS"><a href="#HTML-CSS" class="headerlink" title="HTML &amp; CSS"></a>HTML &amp; CSS</h2><h3 id="6-è¯­ä¹‰åŒ–-HTML-çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#6-è¯­ä¹‰åŒ–-HTML-çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="6. è¯­ä¹‰åŒ– HTML çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ"></a>6. è¯­ä¹‰åŒ– HTML çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>è¯­ä¹‰åŒ– HTML æ˜¯æŒ‡ä½¿ç”¨æ°å½“çš„ HTML æ ‡ç­¾æ¥è¡¨ç¤ºå†…å®¹çš„ç»“æ„å’Œå«ä¹‰ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸ºäº†å±•ç¤ºæ•ˆæœã€‚</p><p><strong>æ„ä¹‰</strong>ï¼š</p><ul><li><strong>å¯è®¿é—®æ€§</strong>ï¼šå±å¹•é˜…è¯»å™¨ç­‰è¾…åŠ©æŠ€æœ¯å¯ä»¥æ›´å¥½åœ°è§£é‡Šé¡µé¢å†…å®¹</li><li><strong>SEO ä¼˜åŒ–</strong>ï¼šæœç´¢å¼•æ“æ›´å®¹æ˜“ç†è§£é¡µé¢å†…å®¹å’Œç»“æ„</li><li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šä»£ç æ›´æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤</li><li><strong>è®¾å¤‡å…¼å®¹æ€§</strong>ï¼šåœ¨ä¸åŒè®¾å¤‡ä¸Šæœ‰æ›´å¥½çš„å±•ç¤ºæ•ˆæœ</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- éè¯­ä¹‰åŒ–çš„å†™æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span>ç½‘ç«™åç§°<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>å…³äº<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è¯­ä¹‰åŒ–çš„å†™æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ç½‘ç«™åç§°<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>å…³äº<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="7-è§£é‡Š-CSS-ç›’æ¨¡å‹åŠå…¶ä¸åŒç±»å‹"><a href="#7-è§£é‡Š-CSS-ç›’æ¨¡å‹åŠå…¶ä¸åŒç±»å‹" class="headerlink" title="7. è§£é‡Š CSS ç›’æ¨¡å‹åŠå…¶ä¸åŒç±»å‹"></a>7. è§£é‡Š CSS ç›’æ¨¡å‹åŠå…¶ä¸åŒç±»å‹</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>CSS ç›’æ¨¡å‹æè¿°äº†å…ƒç´ å†…å®¹ï¼ˆcontentï¼‰ã€å†…è¾¹è·ï¼ˆpaddingï¼‰ã€è¾¹æ¡†ï¼ˆborderï¼‰å’Œå¤–è¾¹è·ï¼ˆmarginï¼‰å¦‚ä½•ä¸€èµ·å†³å®šå…ƒç´ çš„æ€»å°ºå¯¸ã€‚</p><p><strong>ä¸¤ç§ç›’æ¨¡å‹</strong>ï¼š</p><ul><li><p><strong>æ ‡å‡†ç›’æ¨¡å‹ï¼ˆcontent-boxï¼‰</strong>ï¼š</p><ul><li><code>width</code> å’Œ <code>height</code> åªåŒ…æ‹¬å†…å®¹åŒºåŸŸ</li><li>æ€»å®½åº¦ &#x3D; width + padding + border + margin</li></ul></li><li><p><strong>æ›¿ä»£ç›’æ¨¡å‹ï¼ˆborder-boxï¼‰</strong>ï¼š</p><ul><li><code>width</code> å’Œ <code>height</code> åŒ…æ‹¬å†…å®¹åŒºåŸŸã€å†…è¾¹è·å’Œè¾¹æ¡†</li><li>æ€»å®½åº¦ &#x3D; width + marginï¼ˆwidth å·²ç»åŒ…å«äº† padding å’Œ borderï¼‰</li></ul></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ ‡å‡†ç›’æ¨¡å‹ï¼ˆé»˜è®¤ï¼‰ */</span></span><br><span class="line"><span class="selector-class">.box-content</span> &#123;</span><br><span class="line">  <span class="attribute">box-sizing</span>: content-box;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">10px</span> solid black;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="comment">/* æ€»å®½åº¦ = 300px + 40px(padding) + 20px(border) + 30px(margin) = 390px */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ›¿ä»£ç›’æ¨¡å‹ */</span></span><br><span class="line"><span class="selector-class">.box-border</span> &#123;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">10px</span> solid black;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="comment">/* æ€»å®½åº¦ = 300px + 30px(margin) = 330px */</span></span><br><span class="line">  <span class="comment">/* å†…å®¹åŒºå®é™…å®½åº¦ = 300px - 40px(padding) - 20px(border) = 240px */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-CSS-é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ"><a href="#8-CSS-é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ" class="headerlink" title="8. CSS é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ"></a>8. CSS é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>CSS é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§æŒ‰ç…§ä»¥ä¸‹è§„åˆ™è®¡ç®—ï¼š</p><ol><li><strong>å†…è”æ ·å¼</strong>ï¼š1000 åˆ†</li><li><strong>ID é€‰æ‹©å™¨</strong>ï¼š100 åˆ†</li><li><strong>ç±»é€‰æ‹©å™¨ã€å±æ€§é€‰æ‹©å™¨ã€ä¼ªç±»</strong>ï¼š10 åˆ†</li><li><strong>å…ƒç´ é€‰æ‹©å™¨ã€ä¼ªå…ƒç´ </strong>ï¼š1 åˆ†</li><li><strong>é€šé…ç¬¦ï¼ˆ*ï¼‰</strong>ï¼š0 åˆ†</li><li><strong>ç»§æ‰¿çš„æ ·å¼</strong>ï¼šæ— ä¼˜å…ˆçº§</li></ol><p>å½“ä¼˜å…ˆçº§ç›¸åŒæ—¶ï¼Œåå£°æ˜çš„æ ·å¼ä¼šè¦†ç›–å…ˆå£°æ˜çš„æ ·å¼ã€‚<br>ä½¿ç”¨ <code>!important</code> å¯ä»¥è¦†ç›–æ‰€æœ‰å…¶ä»–æ ·å¼ï¼ˆé™¤éå¯¹æ–¹ä¹Ÿä½¿ç”¨äº† <code>!important</code>ï¼Œæ­¤æ—¶ä»æŒ‰ä¼˜å…ˆçº§è®¡ç®—ï¼‰ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä¼˜å…ˆçº§: 1 (å…ƒç´ é€‰æ‹©å™¨) */</span></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä¼˜å…ˆçº§: 10 (ç±»é€‰æ‹©å™¨) */</span></span><br><span class="line"><span class="selector-class">.text</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä¼˜å…ˆçº§: 11 (ç±»é€‰æ‹©å™¨ + å…ƒç´ é€‰æ‹©å™¨) */</span></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.text</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä¼˜å…ˆçº§: 110 (IDé€‰æ‹©å™¨ + å…ƒç´ é€‰æ‹©å™¨) */</span></span><br><span class="line"><span class="selector-id">#content</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä¼˜å…ˆçº§: 10 (ç±»é€‰æ‹©å™¨)ï¼Œä½†ä½¿ç”¨ !important */</span></span><br><span class="line"><span class="selector-class">.highlight</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: yellow <span class="meta">!important</span>; <span class="comment">/* ä¼šè¦†ç›–ä¸Šé¢æ‰€æœ‰è§„åˆ™ */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-å“åº”å¼è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™å’Œå®ç°æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#9-å“åº”å¼è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™å’Œå®ç°æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="9. å“åº”å¼è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™å’Œå®ç°æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"></a>9. å“åº”å¼è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™å’Œå®ç°æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>å“åº”å¼è®¾è®¡æ˜¯ä¸€ç§è®©ç½‘ç«™èƒ½å¤Ÿé€‚åº”ä¸åŒè®¾å¤‡å’Œå±å¹•å°ºå¯¸çš„è®¾è®¡æ–¹æ³•ã€‚</p><p><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼š</p><ul><li><strong>æµå¼å¸ƒå±€</strong>ï¼šä½¿ç”¨ç›¸å¯¹å•ä½ï¼ˆ%ã€emã€remï¼‰è€Œéå›ºå®šå•ä½ï¼ˆpxï¼‰</li><li><strong>åª’ä½“æŸ¥è¯¢</strong>ï¼šæ ¹æ®è®¾å¤‡ç‰¹æ€§åº”ç”¨ä¸åŒçš„æ ·å¼</li><li><strong>çµæ´»çš„å›¾ç‰‡</strong>ï¼šç¡®ä¿å›¾ç‰‡èƒ½å¤Ÿç¼©æ”¾è€Œä¸æº¢å‡ºå®¹å™¨</li><li><strong>ç§»åŠ¨ä¼˜å…ˆ</strong>ï¼šå…ˆè®¾è®¡ç§»åŠ¨ç«¯ç•Œé¢ï¼Œå†é€æ­¥å¢å¼ºåˆ°å¤§å±å¹•</li></ul><p><strong>å®ç°æ–¹æ³•</strong>ï¼š</p><ul><li>ä½¿ç”¨åª’ä½“æŸ¥è¯¢ï¼ˆ@mediaï¼‰</li><li>ä½¿ç”¨ viewport å…ƒæ ‡ç­¾</li><li>ä½¿ç”¨ CSS Grid å’Œ Flexbox å¸ƒå±€</li><li>ä½¿ç”¨ç›¸å¯¹å•ä½ï¼ˆ%ã€emã€remã€vwã€vhï¼‰</li><li>ä½¿ç”¨å“åº”å¼å›¾ç‰‡æŠ€æœ¯ï¼ˆsrcsetã€sizes å±æ€§ï¼‰</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- viewport è®¾ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æµå¼å¸ƒå±€ */</span></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">1200px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å“åº”å¼å›¾ç‰‡ */</span></span><br><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* åª’ä½“æŸ¥è¯¢ */</span></span><br><span class="line"><span class="comment">/* ç§»åŠ¨è®¾å¤‡ */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">767px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.main-content</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å¹³æ¿è®¾å¤‡ */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">768px</span>) <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">1023px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">30%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.main-content</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">70%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ¡Œé¢è®¾å¤‡ */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">1024px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">25%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.main-content</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">75%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-è§£é‡Š-CSS-Grid-å’Œ-Flexbox-çš„åŒºåˆ«åŠé€‚ç”¨åœºæ™¯"><a href="#10-è§£é‡Š-CSS-Grid-å’Œ-Flexbox-çš„åŒºåˆ«åŠé€‚ç”¨åœºæ™¯" class="headerlink" title="10. è§£é‡Š CSS Grid å’Œ Flexbox çš„åŒºåˆ«åŠé€‚ç”¨åœºæ™¯"></a>10. è§£é‡Š CSS Grid å’Œ Flexbox çš„åŒºåˆ«åŠé€‚ç”¨åœºæ™¯</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>CSS Grid å’Œ Flexbox éƒ½æ˜¯ç°ä»£ CSS å¸ƒå±€æŠ€æœ¯ï¼Œä½†å®ƒä»¬æœ‰ä¸åŒçš„è®¾è®¡ç›®æ ‡å’Œé€‚ç”¨åœºæ™¯ã€‚</p><p><strong>Flexboxï¼ˆå¼¹æ€§ç›’å­ï¼‰</strong>ï¼š</p><ul><li><strong>ä¸€ç»´å¸ƒå±€ç³»ç»Ÿ</strong>ï¼šä¸»è¦æ²¿ä¸€ä¸ªè½´ï¼ˆä¸»è½´æˆ–äº¤å‰è½´ï¼‰è¿›è¡Œå¸ƒå±€</li><li><strong>å†…å®¹é©±åŠ¨</strong>ï¼šå…ƒç´ å¤§å°ç”±å…¶å†…å®¹å†³å®š</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¯¼èˆªèœå•ã€å¡ç‰‡å¸ƒå±€ã€å±…ä¸­å…ƒç´ ã€ç®€å•çš„ä¸€ç»´å¸ƒå±€</li></ul><p><strong>CSS Gridï¼ˆç½‘æ ¼å¸ƒå±€ï¼‰</strong>ï¼š</p><ul><li><strong>äºŒç»´å¸ƒå±€ç³»ç»Ÿ</strong>ï¼šåŒæ—¶æ§åˆ¶è¡Œå’Œåˆ—</li><li><strong>å¸ƒå±€é©±åŠ¨</strong>ï¼šå…ˆå®šä¹‰å¸ƒå±€ç»“æ„ï¼Œå†æ”¾å…¥å…ƒç´ </li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ•´ä½“é¡µé¢å¸ƒå±€ã€å¤æ‚çš„äºŒç»´å¸ƒå±€ã€ä¸è§„åˆ™å¸ƒå±€</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Flexbox ç¤ºä¾‹ - å¯¼èˆªèœå• */</span></span><br><span class="line"><span class="selector-class">.nav</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav-item</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">1</span> auto;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* CSS Grid ç¤ºä¾‹ - é¡µé¢å¸ƒå±€ */</span></span><br><span class="line"><span class="selector-class">.page</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">1</span>fr <span class="number">3</span>fr <span class="number">1</span>fr;</span><br><span class="line">  <span class="attribute">grid-template-rows</span>: auto <span class="number">1</span>fr auto;</span><br><span class="line">  <span class="attribute">grid-template-areas</span>:</span><br><span class="line">    <span class="string">&quot;header header header&quot;</span></span><br><span class="line">    <span class="string">&quot;sidebar main aside&quot;</span></span><br><span class="line">    <span class="string">&quot;footer footer footer&quot;</span>;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">100vh</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header</span> &#123; <span class="attribute">grid-area</span>: header; &#125;</span><br><span class="line"><span class="selector-class">.sidebar</span> &#123; <span class="attribute">grid-area</span>: sidebar; &#125;</span><br><span class="line"><span class="selector-class">.main</span> &#123; <span class="attribute">grid-area</span>: main; &#125;</span><br><span class="line"><span class="selector-class">.aside</span> &#123; <span class="attribute">grid-area</span>: aside; &#125;</span><br><span class="line"><span class="selector-class">.footer</span> &#123; <span class="attribute">grid-area</span>: footer; &#125;</span><br></pre></td></tr></table></figure><h2 id="å‰ç«¯æ¡†æ¶"><a href="#å‰ç«¯æ¡†æ¶" class="headerlink" title="å‰ç«¯æ¡†æ¶"></a>å‰ç«¯æ¡†æ¶</h2><h3 id="11-React-ä¸­çš„è™šæ‹Ÿ-DOM-æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"><a href="#11-React-ä¸­çš„è™šæ‹Ÿ-DOM-æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ" class="headerlink" title="11. React ä¸­çš„è™šæ‹Ÿ DOM æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"></a>11. React ä¸­çš„è™šæ‹Ÿ DOM æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>è™šæ‹Ÿ DOM (Virtual DOM) æ˜¯ React ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒæ˜¯çœŸå® DOM çš„ä¸€ç§è½»é‡çº§çš„ JavaScript å¯¹è±¡è¡¨ç¤ºã€‚</p><p><strong>å·¥ä½œåŸç†</strong>ï¼š</p><ol><li>å½“ç»„ä»¶çŠ¶æ€æ”¹å˜æ—¶ï¼ŒReact åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿ DOM æ ‘</li><li>å°†æ–°çš„è™šæ‹Ÿ DOM æ ‘ä¸ä¹‹å‰çš„è™šæ‹Ÿ DOM æ ‘è¿›è¡Œæ¯”è¾ƒï¼ˆDiffing ç®—æ³•ï¼‰</li><li>è®¡ç®—å‡ºéœ€è¦æ›´æ–°çš„éƒ¨åˆ†</li><li>åªæ›´æ–°çœŸå® DOM ä¸­éœ€è¦å˜åŒ–çš„éƒ¨åˆ†</li></ol><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå‡å°‘ç›´æ¥æ“ä½œ DOM çš„æ¬¡æ•°ï¼Œæ‰¹é‡å¤„ç† DOM æ›´æ–°</li><li><strong>è·¨å¹³å°</strong>ï¼šè™šæ‹Ÿ DOM æ˜¯å¹³å°æ— å…³çš„ï¼Œå¯ä»¥æ¸²æŸ“åˆ°ä¸åŒç¯å¢ƒï¼ˆWebã€Nativeã€æœåŠ¡å™¨ç­‰ï¼‰</li><li><strong>å£°æ˜å¼ç¼–ç¨‹</strong>ï¼šå¼€å‘è€…åªéœ€å…³æ³¨çŠ¶æ€å’Œ UI çš„æ˜ å°„å…³ç³»ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ“ä½œ DOM</li><li><strong>è°ƒè¯•æ–¹ä¾¿</strong>ï¼šå¯ä»¥è¿½è¸ª DOM å˜åŒ–çš„å†å²è®°å½•</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// React ç»„ä»¶ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Count: &#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;Increment<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ç‚¹å‡»æŒ‰é’®æ—¶ï¼ŒReact ä¼šï¼š</span></span><br><span class="line"><span class="comment">// 1. åˆ›å»ºæ–°çš„è™šæ‹Ÿ DOM æ ‘ï¼ˆcount å€¼æ›´æ–°ï¼‰</span></span><br><span class="line"><span class="comment">// 2. ä¸æ—§çš„è™šæ‹Ÿ DOM æ ‘æ¯”è¾ƒ</span></span><br><span class="line"><span class="comment">// 3. å‘ç°åªæœ‰ &lt;p&gt; ä¸­çš„æ–‡æœ¬å†…å®¹éœ€è¦æ›´æ–°</span></span><br><span class="line"><span class="comment">// 4. åªæ›´æ–°çœŸå® DOM ä¸­çš„é‚£éƒ¨åˆ†å†…å®¹</span></span><br></pre></td></tr></table></figure><h3 id="12-Vue-çš„å“åº”å¼åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#12-Vue-çš„å“åº”å¼åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="12. Vue çš„å“åº”å¼åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>12. Vue çš„å“åº”å¼åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue çš„å“åº”å¼ç³»ç»Ÿæ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨è¿½è¸ªä¾èµ–å…³ç³»å¹¶åœ¨æ•°æ®å˜åŒ–æ—¶æ›´æ–°è§†å›¾ã€‚</p><p><strong>Vue 2 å“åº”å¼åŸç†</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>Object.defineProperty()</code> åŠ«æŒå¯¹è±¡çš„å±æ€§</li><li>åœ¨ getter ä¸­æ”¶é›†ä¾èµ–ï¼ˆWatcherï¼‰</li><li>åœ¨ setter ä¸­é€šçŸ¥ä¾èµ–æ›´æ–°</li><li>å¯¹äºæ•°ç»„ï¼Œé€šè¿‡é‡å†™æ•°ç»„æ–¹æ³•ï¼ˆpushã€pop ç­‰ï¼‰å®ç°å“åº”å¼</li></ul><p><strong>Vue 3 å“åº”å¼åŸç†</strong>ï¼š</p><ul><li>ä½¿ç”¨ ES6 çš„ Proxy ä»£æ›¿ Object.defineProperty</li><li>å¯ä»¥ç›‘å¬æ•´ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬å±æ€§çš„æ·»åŠ å’Œåˆ é™¤</li><li>å¯ä»¥ç›‘å¬æ•°ç»„çš„ç´¢å¼•å’Œé•¿åº¦å˜åŒ–</li><li>æ€§èƒ½æ›´å¥½ï¼Œæ²¡æœ‰ Vue 2 ä¸­çš„ä¸€äº›é™åˆ¶</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vue 2 å“åº”å¼ç³»ç»Ÿç®€åŒ–ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defineReactive</span>(<span class="params">obj, key, val</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>(); <span class="comment">// ä¾èµ–æ”¶é›†å™¨</span></span><br><span class="line">  </span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) &#123;</span><br><span class="line">        dep.<span class="title function_">depend</span>(); <span class="comment">// æ”¶é›†ä¾èµ–</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> val;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (newVal === val) <span class="keyword">return</span>;</span><br><span class="line">      val = newVal;</span><br><span class="line">      dep.<span class="title function_">notify</span>(); <span class="comment">// é€šçŸ¥ä¾èµ–æ›´æ–°</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue 3 å“åº”å¼ç³»ç»Ÿç®€åŒ–ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">      <span class="title function_">track</span>(target, key); <span class="comment">// æ”¶é›†ä¾èµ–</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, value, receiver</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, value, receiver);</span><br><span class="line">      <span class="title function_">trigger</span>(target, key); <span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="13-React-Hooks-çš„ä½œç”¨å’Œå¸¸ç”¨-Hook-æœ‰å“ªäº›ï¼Ÿ"><a href="#13-React-Hooks-çš„ä½œç”¨å’Œå¸¸ç”¨-Hook-æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="13. React Hooks çš„ä½œç”¨å’Œå¸¸ç”¨ Hook æœ‰å“ªäº›ï¼Ÿ"></a>13. React Hooks çš„ä½œç”¨å’Œå¸¸ç”¨ Hook æœ‰å“ªäº›ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>React Hooks æ˜¯ React 16.8 å¼•å…¥çš„ç‰¹æ€§ï¼Œå…è®¸åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€å’Œå…¶ä»– React ç‰¹æ€§ï¼Œè€Œä¸éœ€è¦ç¼–å†™ç±»ç»„ä»¶ã€‚</p><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸç‰¹æ€§</li><li>å¤ç”¨çŠ¶æ€é€»è¾‘ï¼Œè€Œä¸éœ€è¦æ”¹å˜ç»„ä»¶å±‚æ¬¡ç»“æ„</li><li>å°†ç›¸å…³é€»è¾‘ç»„åˆåœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯æŒ‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•åˆ†æ•£</li></ul><p><strong>å¸¸ç”¨çš„ Hook</strong>ï¼š</p><ul><li><strong>useState</strong>ï¼šç®¡ç†ç»„ä»¶çŠ¶æ€</li><li><strong>useEffect</strong>ï¼šå¤„ç†å‰¯ä½œç”¨ï¼ˆç±»ä¼¼ componentDidMountã€componentDidUpdateã€componentWillUnmountï¼‰</li><li><strong>useContext</strong>ï¼šè®¿é—® React Context</li><li><strong>useReducer</strong>ï¼šä½¿ç”¨ reducer ç®¡ç†å¤æ‚çŠ¶æ€é€»è¾‘</li><li><strong>useCallback</strong>ï¼šè®°å¿†å‡½æ•°ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</li><li><strong>useMemo</strong>ï¼šè®°å¿†è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—</li><li><strong>useRef</strong>ï¼šä¿å­˜å¯å˜å€¼ï¼Œä¸è§¦å‘é‡æ–°æ¸²æŸ“</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useState ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Count: &#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;Increment<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// useEffect ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">DataFetcher</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [loading, setLoading] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;https://api.example.com/data&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">        <span class="title function_">setData</span>(result);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error fetching data:&#x27;</span>, error);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="title function_">setLoading</span>(<span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">fetchData</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¸…ç†å‡½æ•°ï¼ˆç±»ä¼¼ componentWillUnmountï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// å–æ¶ˆè¯·æ±‚æˆ–æ¸…ç†èµ„æº</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []); <span class="comment">// ç©ºä¾èµ–æ•°ç»„è¡¨ç¤ºåªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œ</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (loading) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;/* æ¸²æŸ“æ•°æ® */&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14-å‰ç«¯è·¯ç”±çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#14-å‰ç«¯è·¯ç”±çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="14. å‰ç«¯è·¯ç”±çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>14. å‰ç«¯è·¯ç”±çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>å‰ç«¯è·¯ç”±æ˜¯æŒ‡åœ¨å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ä¸­ï¼Œé€šè¿‡ JavaScript æ§åˆ¶é¡µé¢å†…å®¹çš„åˆ‡æ¢ï¼Œè€Œä¸åˆ·æ–°æ•´ä¸ªé¡µé¢ã€‚ä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š</p><p><strong>Hash æ¨¡å¼</strong>ï¼š</p><ul><li>åŸºäº URL çš„å“ˆå¸Œéƒ¨åˆ†ï¼ˆ<code>#</code> åé¢çš„éƒ¨åˆ†ï¼‰</li><li>é€šè¿‡ç›‘å¬ <code>hashchange</code> äº‹ä»¶æ£€æµ‹è·¯ç”±å˜åŒ–</li><li>å…¼å®¹æ€§å¥½ï¼Œä½† URL ä¸å¤Ÿç¾è§‚</li></ul><p><strong>History æ¨¡å¼</strong>ï¼š</p><ul><li>åŸºäº HTML5 History APIï¼ˆ<code>pushState</code>ã€<code>replaceState</code>ï¼‰</li><li>é€šè¿‡ç›‘å¬ <code>popstate</code> äº‹ä»¶æ£€æµ‹è·¯ç”±å˜åŒ–</li><li>URL æ›´ç¾è§‚ï¼Œä½†éœ€è¦æœåŠ¡å™¨é…ç½®æ”¯æŒ</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Hash æ¨¡å¼è·¯ç”±ç®€å•å®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HashRouter</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">routes</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;hashchange&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleHashChange</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">handleHashChange</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">route</span>(<span class="params">path, callback</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">routes</span>[path] = callback;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">handleHashChange</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> hash = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span>.<span class="title function_">slice</span>(<span class="number">1</span>) || <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="variable language_">this</span>.<span class="property">routes</span>[hash];</span><br><span class="line">    <span class="keyword">if</span> (handler) &#123;</span><br><span class="line">      <span class="title function_">handler</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// History æ¨¡å¼è·¯ç”±ç®€å•å®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HistoryRouter</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">routes</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;popstate&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handlePopState</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">handlePopState</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">route</span>(<span class="params">path, callback</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">routes</span>[path] = callback;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">navigate</span>(<span class="params">path</span>) &#123;</span><br><span class="line">    history.<span class="title function_">pushState</span>(<span class="literal">null</span>, <span class="literal">null</span>, path);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">handlePopState</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">handlePopState</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> path = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="variable language_">this</span>.<span class="property">routes</span>[path];</span><br><span class="line">    <span class="keyword">if</span> (handler) &#123;</span><br><span class="line">      <span class="title function_">handler</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="15-çŠ¶æ€ç®¡ç†å·¥å…·ï¼ˆRedux-Vuex-Piniaï¼‰çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†"><a href="#15-çŠ¶æ€ç®¡ç†å·¥å…·ï¼ˆRedux-Vuex-Piniaï¼‰çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†" class="headerlink" title="15. çŠ¶æ€ç®¡ç†å·¥å…·ï¼ˆRedux&#x2F;Vuex&#x2F;Piniaï¼‰çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†"></a>15. çŠ¶æ€ç®¡ç†å·¥å…·ï¼ˆRedux&#x2F;Vuex&#x2F;Piniaï¼‰çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>çŠ¶æ€ç®¡ç†å·¥å…·ç”¨äºé›†ä¸­ç®¡ç†åº”ç”¨çš„çŠ¶æ€ï¼Œä½¿çŠ¶æ€å˜åŒ–å¯é¢„æµ‹å’Œå¯è¿½è¸ªã€‚</p><p><strong>Reduxï¼ˆReactï¼‰æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p><ul><li><strong>Store</strong>ï¼šå­˜å‚¨åº”ç”¨çš„çŠ¶æ€</li><li><strong>Action</strong>ï¼šæè¿°çŠ¶æ€å˜åŒ–çš„æ™®é€šå¯¹è±¡</li><li><strong>Reducer</strong>ï¼šçº¯å‡½æ•°ï¼Œæ ¹æ®å½“å‰çŠ¶æ€å’Œ action è®¡ç®—æ–°çŠ¶æ€</li><li><strong>Dispatch</strong>ï¼šå‘é€ action çš„æ–¹æ³•</li><li><strong>Middleware</strong>ï¼šæ‰©å±• Redux åŠŸèƒ½çš„ä¸­é—´ä»¶ï¼ˆå¦‚å¤„ç†å¼‚æ­¥æ“ä½œï¼‰</li></ul><p><strong>Vuexï¼ˆVue 2ï¼‰æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p><ul><li><strong>State</strong>ï¼šåº”ç”¨çš„çŠ¶æ€</li><li><strong>Getters</strong>ï¼šä» state æ´¾ç”Ÿçš„çŠ¶æ€</li><li><strong>Mutations</strong>ï¼šåŒæ­¥ä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•</li><li><strong>Actions</strong>ï¼šå¯åŒ…å«å¼‚æ­¥æ“ä½œï¼Œæäº¤ mutation</li><li><strong>Modules</strong>ï¼šå°† store åˆ†å‰²æˆæ¨¡å—</li></ul><p><strong>Piniaï¼ˆVue 3ï¼‰æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p><ul><li><strong>Store</strong>ï¼šå®šä¹‰çŠ¶æ€å’Œæ“ä½œçš„å®¹å™¨</li><li><strong>State</strong>ï¼šå­˜å‚¨çš„å“åº”å¼çŠ¶æ€</li><li><strong>Getters</strong>ï¼šç±»ä¼¼è®¡ç®—å±æ€§ï¼Œä» state æ´¾ç”ŸçŠ¶æ€</li><li><strong>Actions</strong>ï¼šä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•ï¼Œå¯ä»¥æ˜¯å¼‚æ­¥çš„</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Redux ç¤ºä¾‹</span></span><br><span class="line"><span class="comment">// åˆ›å»º reducer</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">counterReducer</span>(<span class="params">state = &#123; count: <span class="number">0</span> &#125;, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;INCREMENT&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;DECREMENT&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º store</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title class_">Redux</span>.<span class="title function_">createStore</span>(counterReducer);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜…å˜åŒ–</span></span><br><span class="line">store.<span class="title function_">subscribe</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(store.<span class="title function_">getState</span>());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€ action</span></span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;INCREMENT&#x27;</span> &#125;); <span class="comment">// &#123; count: 1 &#125;</span></span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;INCREMENT&#x27;</span> &#125;); <span class="comment">// &#123; count: 2 &#125;</span></span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;DECREMENT&#x27;</span> &#125;); <span class="comment">// &#123; count: 1 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Vuex ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      state.<span class="property">count</span>++;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">decrement</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      state.<span class="property">count</span>--;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">incrementAsync</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;increment&#x27;</span>);</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">doubleCount</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pinia ç¤ºä¾‹ (Vue 3)</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">doubleCount</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">incrementAsync</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>));</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">increment</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="å‰ç«¯å·¥ç¨‹åŒ–ä¸æ€§èƒ½ä¼˜åŒ–"><a href="#å‰ç«¯å·¥ç¨‹åŒ–ä¸æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="å‰ç«¯å·¥ç¨‹åŒ–ä¸æ€§èƒ½ä¼˜åŒ–"></a>å‰ç«¯å·¥ç¨‹åŒ–ä¸æ€§èƒ½ä¼˜åŒ–</h2><h3 id="16-å‰ç«¯æ¨¡å—åŒ–çš„å‘å±•å†ç¨‹å’Œä¸»è¦è§„èŒƒ"><a href="#16-å‰ç«¯æ¨¡å—åŒ–çš„å‘å±•å†ç¨‹å’Œä¸»è¦è§„èŒƒ" class="headerlink" title="16. å‰ç«¯æ¨¡å—åŒ–çš„å‘å±•å†ç¨‹å’Œä¸»è¦è§„èŒƒ"></a>16. å‰ç«¯æ¨¡å—åŒ–çš„å‘å±•å†ç¨‹å’Œä¸»è¦è§„èŒƒ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>å‰ç«¯æ¨¡å—åŒ–æ˜¯ä¸ºäº†è§£å†³å…¨å±€å˜é‡æ±¡æŸ“ã€ä»£ç å¤ç”¨ã€ä¾èµ–ç®¡ç†ç­‰é—®é¢˜è€Œå‘å±•èµ·æ¥çš„ã€‚</p><p><strong>å‘å±•å†ç¨‹</strong>ï¼š</p><ol><li><strong>å…¨å±€å‡½æ•°</strong>ï¼šæœ€åˆçš„ä»£ç ç»„ç»‡æ–¹å¼ï¼Œå®¹æ˜“é€ æˆå‘½åå†²çª</li><li><strong>å‘½åç©ºé—´</strong>ï¼šå°†ç›¸å…³åŠŸèƒ½å°è£…åœ¨å¯¹è±¡ä¸­ï¼Œå‡å°‘å…¨å±€å˜é‡</li><li><strong>IIFEï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼ï¼‰</strong>ï¼šåˆ›å»ºç§æœ‰ä½œç”¨åŸŸï¼Œé¿å…å˜é‡æ³„éœ²</li><li><strong>CommonJS</strong>ï¼šNode.js é‡‡ç”¨çš„æ¨¡å—è§„èŒƒï¼ŒåŒæ­¥åŠ è½½</li><li><strong>AMDï¼ˆAsynchronous Module Definitionï¼‰</strong>ï¼šå¼‚æ­¥åŠ è½½æ¨¡å—ï¼Œé€‚ç”¨äºæµè§ˆå™¨</li><li><strong>UMDï¼ˆUniversal Module Definitionï¼‰</strong>ï¼šå…¼å®¹ CommonJS å’Œ AMD</li><li><strong>ES Modules</strong>ï¼šECMAScript å®˜æ–¹æ¨¡å—ç³»ç»Ÿï¼Œç°ä»£æµè§ˆå™¨åŸç”Ÿæ”¯æŒ</li></ol><p><strong>ä¸»è¦è§„èŒƒ</strong>ï¼š</p><p><strong>CommonJS</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>require()</code> å¯¼å…¥ï¼Œ<code>module.exports</code> æˆ– <code>exports</code> å¯¼å‡º</li><li>åŒæ­¥åŠ è½½ï¼Œé€‚åˆæœåŠ¡å™¨ç¯å¢ƒ</li><li>Node.js é»˜è®¤ä½¿ç”¨</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å‡º (math.js)</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">add</span>: <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b,</span><br><span class="line">  <span class="attr">subtract</span>: <span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å…¥</span></span><br><span class="line"><span class="keyword">const</span> math = <span class="built_in">require</span>(<span class="string">&#x27;./math&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(math.<span class="title function_">add</span>(<span class="number">2</span>, <span class="number">3</span>)); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><p><strong>AMD</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>define()</code> å®šä¹‰æ¨¡å—ï¼Œ<code>require()</code> åŠ è½½æ¨¡å—</li><li>å¼‚æ­¥åŠ è½½ï¼Œé€‚åˆæµè§ˆå™¨ç¯å¢ƒ</li><li>RequireJS æ˜¯å…¶å®ç°</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰æ¨¡å—</span></span><br><span class="line"><span class="title function_">define</span>(<span class="string">&#x27;math&#x27;</span>, [], <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">add</span>: <span class="keyword">function</span>(<span class="params">a, b</span>) &#123; <span class="keyword">return</span> a + b; &#125;,</span><br><span class="line">    <span class="attr">subtract</span>: <span class="keyword">function</span>(<span class="params">a, b</span>) &#123; <span class="keyword">return</span> a - b; &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ¨¡å—</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;math&#x27;</span>], <span class="keyword">function</span>(<span class="params">math</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(math.<span class="title function_">add</span>(<span class="number">2</span>, <span class="number">3</span>)); <span class="comment">// 5</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>ES Modules</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>import</code> å¯¼å…¥ï¼Œ<code>export</code> å¯¼å‡º</li><li>é™æ€åˆ†æï¼Œæ”¯æŒ tree-shaking</li><li>ç°ä»£æµè§ˆå™¨åŸç”Ÿæ”¯æŒ</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å‡º (math.js)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">subtract</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å…¥</span></span><br><span class="line"><span class="keyword">import</span> &#123; add, subtract &#125; <span class="keyword">from</span> <span class="string">&#x27;./math.js&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">2</span>, <span class="number">3</span>)); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><h3 id="17-Webpack-çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†"><a href="#17-Webpack-çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†" class="headerlink" title="17. Webpack çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†"></a>17. Webpack çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Webpack æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„é™æ€æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œå®ƒå°†é¡¹ç›®ä¸­çš„å„ç§èµ„æºï¼ˆJSã€CSSã€å›¾ç‰‡ç­‰ï¼‰è§†ä¸ºæ¨¡å—ï¼Œæ ¹æ®æ¨¡å—çš„ä¾èµ–å…³ç³»è¿›è¡Œæ‰“åŒ…ã€‚</p><p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p><ul><li><strong>Entry</strong>ï¼šå…¥å£ï¼ŒæŒ‡å®š webpack å¼€å§‹æ„å»ºçš„èµ·ç‚¹</li><li><strong>Output</strong>ï¼šè¾“å‡ºï¼ŒæŒ‡å®šæ‰“åŒ…åçš„èµ„æºè¾“å‡ºåˆ°å“ªé‡Œ</li><li><strong>Loaders</strong>ï¼šåŠ è½½å™¨ï¼Œå¤„ç†é JavaScript æ–‡ä»¶ï¼ˆå¦‚ CSSã€å›¾ç‰‡ï¼‰</li><li><strong>Plugins</strong>ï¼šæ’ä»¶ï¼Œæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ï¼ˆå¦‚æ‰“åŒ…ä¼˜åŒ–ã€èµ„æºç®¡ç†ï¼‰</li><li><strong>Mode</strong>ï¼šæ¨¡å¼ï¼ŒæŒ‡å®šå¼€å‘ç¯å¢ƒæˆ–ç”Ÿäº§ç¯å¢ƒ</li><li><strong>Chunks</strong>ï¼šä»£ç å—ï¼Œæ‰“åŒ…è¿‡ç¨‹ä¸­çš„ä»£ç å•å…ƒ</li></ul><p><strong>å·¥ä½œåŸç†</strong>ï¼š</p><ol><li><strong>åˆå§‹åŒ–å‚æ•°</strong>ï¼šä»é…ç½®æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°ä¸­è¯»å–é…ç½®</li><li><strong>å¼€å§‹ç¼–è¯‘</strong>ï¼šåˆå§‹åŒ– Compiler å¯¹è±¡ï¼ŒåŠ è½½æ‰€æœ‰é…ç½®çš„æ’ä»¶</li><li><strong>ç¡®å®šå…¥å£</strong>ï¼šæ ¹æ®é…ç½®ä¸­çš„ entry æ‰¾å‡ºæ‰€æœ‰å…¥å£æ–‡ä»¶</li><li><strong>ç¼–è¯‘æ¨¡å—</strong>ï¼šä»å…¥å£æ–‡ä»¶å‡ºå‘ï¼Œè°ƒç”¨æ‰€æœ‰é…ç½®çš„ Loader å¯¹æ¨¡å—è¿›è¡Œè½¬æ¢ï¼Œå†é€’å½’å¤„ç†ä¾èµ–çš„æ¨¡å—</li><li><strong>å®Œæˆæ¨¡å—ç¼–è¯‘</strong>ï¼šå¾—åˆ°æ¯ä¸ªæ¨¡å—è¢«è½¬æ¢åçš„æœ€ç»ˆå†…å®¹å’Œå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»</li><li><strong>è¾“å‡ºèµ„æº</strong>ï¼šæ ¹æ®ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ Chunk</li><li><strong>è¾“å‡ºå®Œæˆ</strong>ï¼šæ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºè·¯å¾„å’Œæ–‡ä»¶åï¼Œå°†æ–‡ä»¶å†…å®¹å†™å…¥æ–‡ä»¶ç³»ç»Ÿ</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// å…¥å£</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è¾“å‡º</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.[contenthash].js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ¨¡å¼</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ¨¡å—å¤„ç†</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      <span class="comment">// å¤„ç† JavaScript</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// å¤„ç† CSS</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// å¤„ç†å›¾ç‰‡</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|svg|jpg|jpeg|gif)$/i</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;asset/resource&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ’ä»¶</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¼˜åŒ–</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="18-å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ–¹æ³•å’ŒæŒ‡æ ‡"><a href="#18-å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ–¹æ³•å’ŒæŒ‡æ ‡" class="headerlink" title="18. å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ–¹æ³•å’ŒæŒ‡æ ‡"></a>18. å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ–¹æ³•å’ŒæŒ‡æ ‡</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>å‰ç«¯æ€§èƒ½ä¼˜åŒ–æ˜¯æå‡ç”¨æˆ·ä½“éªŒçš„å…³é”®ï¼ŒåŒ…æ‹¬å¤šä¸ªæ–¹é¢çš„ä¼˜åŒ–ç­–ç•¥ã€‚</p><p><strong>ä¸»è¦ä¼˜åŒ–æ–¹æ³•</strong>ï¼š</p><p><strong>ç½‘ç»œä¼˜åŒ–</strong>ï¼š</p><ul><li>å‡å°‘ HTTP è¯·æ±‚æ•°ï¼ˆåˆå¹¶æ–‡ä»¶ã€CSS Spritesã€Base64 ç¼–ç ï¼‰</li><li>ä½¿ç”¨ HTTP&#x2F;2</li><li>ä½¿ç”¨ CDN åŠ é€Ÿ</li><li>å¯ç”¨ Gzip å‹ç¼©</li><li>ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜ï¼ˆCache-Controlã€ETagï¼‰</li><li>æ‡’åŠ è½½å’Œé¢„åŠ è½½èµ„æº</li></ul><p><strong>èµ„æºä¼˜åŒ–</strong>ï¼š</p><ul><li>å‹ç¼©ä»£ç ï¼ˆJSã€CSSã€HTMLï¼‰</li><li>å‹ç¼©å’Œä¼˜åŒ–å›¾ç‰‡ï¼ˆWebPã€SVGã€å“åº”å¼å›¾ç‰‡ï¼‰</li><li>Tree-shaking ç§»é™¤æœªä½¿ç”¨çš„ä»£ç </li><li>ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰</li><li>ä½¿ç”¨ç°ä»£æ ¼å¼çš„å›¾ç‰‡</li></ul><p><strong>æ¸²æŸ“ä¼˜åŒ–</strong>ï¼š</p><ul><li>é¿å…é‡æ’ï¼ˆreflowï¼‰å’Œé‡ç»˜ï¼ˆrepaintï¼‰</li><li>ä½¿ç”¨ CSS åŠ¨ç”»ä»£æ›¿ JavaScript åŠ¨ç”»</li><li>ä½¿ç”¨ <code>requestAnimationFrame</code> å¤„ç†åŠ¨ç”»</li><li>ä½¿ç”¨ Web Workers å¤„ç†å¤æ‚è®¡ç®—</li><li>è™šæ‹Ÿæ»šåŠ¨å¤„ç†é•¿åˆ—è¡¨</li></ul><p><strong>åº”ç”¨ä¼˜åŒ–</strong>ï¼š</p><ul><li>æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰æˆ–é™æ€ç«™ç‚¹ç”Ÿæˆï¼ˆSSGï¼‰</li><li>åº”ç”¨ PWA æŠ€æœ¯</li><li>ä½¿ç”¨ Web ç¼“å­˜ API</li><li>å®ç°éª¨æ¶å±ï¼ˆSkeleton Screenï¼‰</li><li>ä¼˜åŒ–é¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼ˆFCPï¼‰</li></ul><p><strong>ä¸»è¦æ€§èƒ½æŒ‡æ ‡</strong>ï¼š</p><ul><li><strong>FCP (First Contentful Paint)</strong>ï¼šé¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼Œé¡µé¢ä¸Šé¦–æ¬¡ç»˜åˆ¶ä»»ä½•æ–‡æœ¬ã€å›¾åƒã€éç©ºç™½ canvas æˆ– SVG çš„æ—¶é—´</li><li><strong>LCP (Largest Contentful Paint)</strong>ï¼šæœ€å¤§å†…å®¹ç»˜åˆ¶ï¼Œè§†å£ä¸­æœ€å¤§çš„å†…å®¹å…ƒç´ ç»˜åˆ¶å®Œæˆçš„æ—¶é—´</li><li><strong>FID (First Input Delay)</strong>ï¼šé¦–æ¬¡è¾“å…¥å»¶è¿Ÿï¼Œç”¨æˆ·é¦–æ¬¡ä¸é¡µé¢äº¤äº’åˆ°æµè§ˆå™¨å“åº”çš„æ—¶é—´</li><li><strong>CLS (Cumulative Layout Shift)</strong>ï¼šç´¯ç§¯å¸ƒå±€åç§»ï¼Œé¡µé¢åŠ è½½è¿‡ç¨‹ä¸­å…ƒç´ æ„å¤–ç§»åŠ¨çš„ç¨‹åº¦</li><li><strong>TTI (Time to Interactive)</strong>ï¼šå¯äº¤äº’æ—¶é—´ï¼Œé¡µé¢å®Œå…¨å¯äº¤äº’æ‰€éœ€çš„æ—¶é—´</li><li><strong>TBT (Total Blocking Time)</strong>ï¼šæ€»é˜»å¡æ—¶é—´ï¼ŒFCP å’Œ TTI ä¹‹é—´ä¸»çº¿ç¨‹è¢«é˜»å¡çš„æ€»æ—¶é—´</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ€§èƒ½ç›‘æµ‹ç¤ºä¾‹</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨ Performance API æµ‹é‡å…³é”®æŒ‡æ ‡</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> list.<span class="title function_">getEntries</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;entry.name&#125;</span>: <span class="subst">$&#123;entry.startTime&#125;</span>ms`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬å„ç§æ€§èƒ½æŒ‡æ ‡</span></span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">entryTypes</span>: [<span class="string">&#x27;paint&#x27;</span>, <span class="string">&#x27;largest-contentful-paint&#x27;</span>, <span class="string">&#x27;layout-shift&#x27;</span>] &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰æ€§èƒ½æ ‡è®°</span></span><br><span class="line">performance.<span class="title function_">mark</span>(<span class="string">&#x27;app-init-start&#x27;</span>);</span><br><span class="line"><span class="comment">// ... åˆå§‹åŒ–åº”ç”¨ ...</span></span><br><span class="line">performance.<span class="title function_">mark</span>(<span class="string">&#x27;app-init-end&#x27;</span>);</span><br><span class="line">performance.<span class="title function_">measure</span>(<span class="string">&#x27;app-initialization&#x27;</span>, <span class="string">&#x27;app-init-start&#x27;</span>, <span class="string">&#x27;app-init-end&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="19-å‰ç«¯å®‰å…¨é—®é¢˜åŠé˜²èŒƒæªæ–½"><a href="#19-å‰ç«¯å®‰å…¨é—®é¢˜åŠé˜²èŒƒæªæ–½" class="headerlink" title="19. å‰ç«¯å®‰å…¨é—®é¢˜åŠé˜²èŒƒæªæ–½"></a>19. å‰ç«¯å®‰å…¨é—®é¢˜åŠé˜²èŒƒæªæ–½</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>å‰ç«¯å®‰å…¨æ˜¯ Web åº”ç”¨å®‰å…¨çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å®‰å…¨é—®é¢˜å’Œé˜²èŒƒæªæ–½ï¼š</p><p><strong>XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰</strong>ï¼š</p><ul><li><strong>é—®é¢˜</strong>ï¼šæ”»å‡»è€…å°†æ¶æ„è„šæœ¬æ³¨å…¥åˆ°ç½‘é¡µä¸­ï¼Œå½“ç”¨æˆ·æµè§ˆé¡µé¢æ—¶æ‰§è¡Œ</li><li><strong>é˜²èŒƒæªæ–½</strong>ï¼š<ul><li>å¯¹è¾“å…¥è¾“å‡ºè¿›è¡Œè½¬ä¹‰å’ŒéªŒè¯</li><li>ä½¿ç”¨ Content-Security-Policy (CSP) å¤´</li><li>ä½¿ç”¨ HttpOnly å’Œ Secure æ ‡è®°ä¿æŠ¤ Cookie</li><li>ä½¿ç”¨ç°ä»£æ¡†æ¶çš„å†…ç½® XSS ä¿æŠ¤</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¾“å…¥è½¬ä¹‰ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">escapeHTML</span>(<span class="params">str</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> str</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&amp;/g</span>, <span class="string">&#x27;&amp;amp;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&lt;/g</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&gt;/g</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&quot;/g</span>, <span class="string">&#x27;&amp;quot;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&#x27;/g</span>, <span class="string">&#x27;&amp;#039;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CSP ç¤ºä¾‹</span></span><br><span class="line"><span class="comment">// åœ¨ HTTP å¤´ä¸­è®¾ç½®</span></span><br><span class="line"><span class="comment">// Content-Security-Policy: default-src &#x27;self&#x27;; script-src &#x27;self&#x27; https://trusted-cdn.com;</span></span><br></pre></td></tr></table></figure><p><strong>CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰</strong>ï¼š</p><ul><li><strong>é—®é¢˜</strong>ï¼šæ”»å‡»è€…è¯±å¯¼ç”¨æˆ·åœ¨å·²è®¤è¯çš„ç½‘ç«™ä¸Šæ‰§è¡Œéé¢„æœŸæ“ä½œ</li><li><strong>é˜²èŒƒæªæ–½</strong>ï¼š<ul><li>ä½¿ç”¨ CSRF Token</li><li>éªŒè¯ Origin å’Œ Referer å¤´</li><li>ä½¿ç”¨ SameSite Cookie å±æ€§</li><li>å¯¹æ•æ„Ÿæ“ä½œè¦æ±‚é‡æ–°è®¤è¯</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CSRF Token ç¤ºä¾‹</span></span><br><span class="line"><span class="comment">// æœåŠ¡ç«¯ç”Ÿæˆ token å¹¶åœ¨è¡¨å•ä¸­åŒ…å«</span></span><br><span class="line"><span class="keyword">const</span> csrfToken = <span class="title function_">generateRandomToken</span>();</span><br><span class="line">session.<span class="property">csrfToken</span> = csrfToken;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HTML è¡¨å•</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/api/update&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrf_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;csrfToken&#125;&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="comment">&lt;!-- å…¶ä»–è¡¨å•å­—æ®µ --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// æœåŠ¡ç«¯éªŒè¯</span></span><br><span class="line"><span class="language-xml">if (request.body.csrf_token !== session.csrfToken) &#123;</span></span><br><span class="line"><span class="language-xml">  return response.status(403).send(&#x27;CSRF token éªŒè¯å¤±è´¥&#x27;);</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>ç‚¹å‡»åŠ«æŒ</strong>ï¼š</p><ul><li><strong>é—®é¢˜</strong>ï¼šæ”»å‡»è€…å°†é€æ˜çš„ç›®æ ‡ç½‘ç«™è¦†ç›–åœ¨å¦ä¸€ä¸ªç½‘ç«™ä¸Šï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»</li><li><strong>é˜²èŒƒæªæ–½</strong>ï¼š<ul><li>ä½¿ç”¨ X-Frame-Options å¤´</li><li>ä½¿ç”¨ CSP çš„ frame-ancestors æŒ‡ä»¤</li><li>JavaScript æ¡†æ¶é˜²å¾¡</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// X-Frame-Options ç¤ºä¾‹</span></span><br><span class="line"><span class="comment">// åœ¨ HTTP å¤´ä¸­è®¾ç½®</span></span><br><span class="line"><span class="comment">// X-Frame-Options: DENY</span></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line"><span class="comment">// X-Frame-Options: SAMEORIGIN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// CSP frame-ancestors ç¤ºä¾‹</span></span><br><span class="line"><span class="comment">// Content-Security-Policy: frame-ancestors &#x27;none&#x27;;</span></span><br></pre></td></tr></table></figure><p><strong>å…¶ä»–å®‰å…¨é—®é¢˜</strong>ï¼š</p><ul><li><strong>ä¸­é—´äººæ”»å‡»</strong>ï¼šä½¿ç”¨ HTTPS é˜²èŒƒ</li><li><strong>ä¸å®‰å…¨çš„ä¾èµ–</strong>ï¼šå®šæœŸæ›´æ–°ä¾èµ–ï¼Œä½¿ç”¨å®‰å…¨æ‰«æå·¥å…·</li><li><strong>æ•æ„Ÿä¿¡æ¯æ³„éœ²</strong>ï¼šé¿å…åœ¨å‰ç«¯å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡</li><li><strong>æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)</strong>ï¼šéªŒè¯å’Œé™åˆ¶ URLï¼Œä½¿ç”¨ç™½åå•</li><li><strong>æœ¬åœ°å­˜å‚¨å®‰å…¨</strong>ï¼šä¸åœ¨ localStorage&#x2F;sessionStorage ä¸­å­˜å‚¨æ•æ„Ÿæ•°æ®</li></ul><h3 id="20-å¾®å‰ç«¯æ¶æ„çš„åŸç†å’Œå®ç°æ–¹å¼"><a href="#20-å¾®å‰ç«¯æ¶æ„çš„åŸç†å’Œå®ç°æ–¹å¼" class="headerlink" title="20. å¾®å‰ç«¯æ¶æ„çš„åŸç†å’Œå®ç°æ–¹å¼"></a>20. å¾®å‰ç«¯æ¶æ„çš„åŸç†å’Œå®ç°æ–¹å¼</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>å¾®å‰ç«¯æ˜¯ä¸€ç§å°†å‰ç«¯åº”ç”¨åˆ†è§£ä¸ºæ›´å°ã€æ›´æ˜“äºç®¡ç†çš„éƒ¨åˆ†çš„æ¶æ„é£æ ¼ï¼Œæ¯ä¸ªéƒ¨åˆ†å¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚</p><p><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼š</p><ul><li><strong>æŠ€æœ¯æ ˆæ— å…³</strong>ï¼šæ¯ä¸ªå¾®å‰ç«¯å¯ä»¥ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆ</li><li><strong>ç‹¬ç«‹å¼€å‘éƒ¨ç½²</strong>ï¼šå›¢é˜Ÿå¯ä»¥ç‹¬ç«‹å·¥ä½œï¼Œä¸å½±å“å…¶ä»–å›¢é˜Ÿ</li><li><strong>è¿è¡Œæ—¶é›†æˆ</strong>ï¼šå¾®å‰ç«¯åœ¨æµè§ˆå™¨ä¸­ç»„åˆï¼Œè€Œä¸æ˜¯æ„å»ºæ—¶</li><li><strong>éš”ç¦»</strong>ï¼šå¾®å‰ç«¯ä¹‹é—´ä¸åº”ç›¸äº’å½±å“</li></ul><p><strong>å®ç°æ–¹å¼</strong>ï¼š</p><p><strong>1. åŸºäºè·¯ç”±çš„åˆ†å‘</strong>ï¼š</p><ul><li>ä¸åŒè·¯ç”±å¯¹åº”ä¸åŒçš„å¾®åº”ç”¨</li><li>ç®€å•æ˜“å®ç°ï¼Œä½†é¡µé¢é—´é›†æˆåº¦ä½</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®€å•çš„è·¯ç”±åˆ†å‘ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> routes = &#123;</span><br><span class="line">  <span class="string">&#x27;/app1&#x27;</span>: loadApp1,</span><br><span class="line">  <span class="string">&#x27;/app2&#x27;</span>: loadApp2,</span><br><span class="line">  <span class="string">&#x27;/app3&#x27;</span>: loadApp3</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">router</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> path = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>;</span><br><span class="line">  <span class="keyword">const</span> route = <span class="title class_">Object</span>.<span class="title function_">keys</span>(routes).<span class="title function_">find</span>(<span class="function"><span class="params">route</span> =&gt;</span> path.<span class="title function_">startsWith</span>(route));</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (route) &#123;</span><br><span class="line">    routes[route]();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">loadDefaultApp</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;popstate&#x27;</span>, router);</span><br><span class="line"><span class="title function_">router</span>();</span><br></pre></td></tr></table></figure><p><strong>2. ä½¿ç”¨ iframe</strong>ï¼š</p><ul><li>å®Œå…¨éš”ç¦»å„ä¸ªåº”ç”¨</li><li>ä½†å­˜åœ¨é€šä¿¡å›°éš¾ã€æ ·å¼ä¸ä¸€è‡´ç­‰é—®é¢˜</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- iframe é›†æˆç¤ºä¾‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">&quot;micro-frontend&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://app1.example.com&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// æ ¹æ®æŸäº›æ¡ä»¶åˆ‡æ¢ iframe çš„ src</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">loadApp</span>(<span class="params">appUrl</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;micro-frontend&#x27;</span>).<span class="property">src</span> = appUrl;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// åº”ç”¨é—´é€šä¿¡</span></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (event.<span class="property">origin</span> === <span class="string">&#x27;https://app1.example.com&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Received message:&#x27;</span>, event.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>3. Web Components</strong>ï¼š</p><ul><li>ä½¿ç”¨è‡ªå®šä¹‰å…ƒç´ å°è£…å¾®å‰ç«¯</li><li>æä¾›è‰¯å¥½çš„å°è£…æ€§å’Œäº’æ“ä½œæ€§</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Web Components ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MicroApp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HTMLElement</span> &#123;</span><br><span class="line">  <span class="title function_">connectedCallback</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> appName = <span class="variable language_">this</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> appUrl = <span class="variable language_">this</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŠ è½½å¾®åº”ç”¨</span></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">`<span class="subst">$&#123;appUrl&#125;</span>/asset-manifest.json`</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">manifest</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// åŠ è½½ JS å’Œ CSS</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">loadResources</span>(manifest, appUrl);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">loadResources</span>(<span class="params">manifest, baseUrl</span>) &#123;</span><br><span class="line">    <span class="comment">// åŠ è½½ CSS</span></span><br><span class="line">    <span class="keyword">if</span> (manifest.<span class="property">css</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;link&#x27;</span>);</span><br><span class="line">      link.<span class="property">rel</span> = <span class="string">&#x27;stylesheet&#x27;</span>;</span><br><span class="line">      link.<span class="property">href</span> = <span class="string">`<span class="subst">$&#123;baseUrl&#125;</span>/<span class="subst">$&#123;manifest.css&#125;</span>`</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">appendChild</span>(link);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŠ è½½ JS</span></span><br><span class="line">    <span class="keyword">if</span> (manifest.<span class="property">js</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">      script.<span class="property">src</span> = <span class="string">`<span class="subst">$&#123;baseUrl&#125;</span>/<span class="subst">$&#123;manifest.js&#125;</span>`</span>;</span><br><span class="line">      script.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨å¾®åº”ç”¨çš„æŒ‚è½½å‡½æ•°</span></span><br><span class="line">        <span class="variable language_">window</span>[<span class="string">`mount<span class="subst">$&#123;<span class="variable language_">this</span>.getAttribute(<span class="string">&#x27;name&#x27;</span>)&#125;</span>`</span>](<span class="variable language_">this</span>);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">disconnectedCallback</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨å¾®åº”ç”¨çš„å¸è½½å‡½æ•°</span></span><br><span class="line">    <span class="keyword">const</span> appName = <span class="variable language_">this</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>[<span class="string">`unmount<span class="subst">$&#123;appName&#125;</span>`</span>]) &#123;</span><br><span class="line">      <span class="variable language_">window</span>[<span class="string">`unmount<span class="subst">$&#123;appName&#125;</span>`</span>]();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">customElements.<span class="title function_">define</span>(<span class="string">&#x27;micro-app&#x27;</span>, <span class="title class_">MicroApp</span>);</span><br></pre></td></tr></table></figure><p><strong>4. JavaScript æ¨¡å—åŠ è½½</strong>ï¼š</p><ul><li>åŠ¨æ€åŠ è½½ JavaScript æ¨¡å—</li><li>çµæ´»æ€§é«˜ï¼Œä½†éœ€è¦å¤„ç†å¥½ä¾èµ–å’Œå†²çª</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€åŠ è½½æ¨¡å—ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadApp</span>(<span class="params">name, url</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">    script.<span class="property">src</span> = url;</span><br><span class="line">    script.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="variable language_">window</span>[name]);</span><br><span class="line">    &#125;;</span><br><span class="line">    script.<span class="property">onerror</span> = reject;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="title function_">loadApp</span>(<span class="string">&#x27;app1&#x27;</span>, <span class="string">&#x27;https://app1.example.com/bundle.js&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">    app.<span class="title function_">mount</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app1-container&#x27;</span>));</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p><strong>5. ä½¿ç”¨å¾®å‰ç«¯æ¡†æ¶</strong>ï¼š</p><ul><li><strong>single-spa</strong>ï¼šJavaScript å¾®å‰ç«¯æ¡†æ¶</li><li><strong>qiankun</strong>ï¼šåŸºäº single-spa çš„å¢å¼ºæ¡†æ¶</li><li><strong>Module Federation</strong>ï¼šWebpack 5 æä¾›çš„æ¨¡å—è”é‚¦åŠŸèƒ½</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// single-spa ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">import</span> &#123; registerApplication, start &#125; <span class="keyword">from</span> <span class="string">&#x27;single-spa&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œåº”ç”¨</span></span><br><span class="line"><span class="title function_">registerApplication</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;app1&#x27;</span>,</span><br><span class="line">  <span class="attr">app</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;app1&#x27;</span>),</span><br><span class="line">  <span class="attr">activeWhen</span>: <span class="string">&#x27;/app1&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">registerApplication</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;app2&#x27;</span>,</span><br><span class="line">  <span class="attr">app</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;app2&#x27;</span>),</span><br><span class="line">  <span class="attr">activeWhen</span>: <span class="string">&#x27;/app2&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨</span></span><br><span class="line"><span class="title function_">start</span>();</span><br></pre></td></tr></table></figure><p><strong>æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><strong>æ ·å¼éš”ç¦»</strong>ï¼šä½¿ç”¨ CSS Modulesã€CSS-in-JS æˆ– Shadow DOM</li><li><strong>å…±äº«ä¾èµ–</strong>ï¼šä½¿ç”¨ Webpack çš„ Module Federation æˆ– import maps</li><li><strong>é€šä¿¡æœºåˆ¶</strong>ï¼šä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶ã€å‘å¸ƒè®¢é˜…æ¨¡å¼æˆ–å…¨å±€çŠ¶æ€ç®¡ç†</li><li><strong>è®¤è¯æˆæƒ</strong>ï¼šä½¿ç”¨ SSO æˆ– token å…±äº«</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;JavaScript-åŸºç¡€&quot;&gt;&lt;a href=&quot;#JavaScript-åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;JavaScript åŸºç¡€&quot;&gt;&lt;/a&gt;JavaScript åŸºç¡€&lt;/h2&gt;&lt;h3 id=&quot;Javascriptä¸­applyå’Œcallçš„åŒºåˆ«&quot;&gt;&lt;a href=&quot;#Javascriptä¸­applyå’Œcallçš„åŒºåˆ«&quot; class=&quot;headerlink&quot; title=&quot;Javascriptä¸­applyå’Œcallçš„åŒºåˆ«&quot;&gt;&lt;/a&gt;Javascriptä¸­applyå’Œcallçš„åŒºåˆ«&lt;/h3&gt;&lt;p&gt;å‚æ•°ä¼ é€’æ–¹å¼ä¸åŒï¼šcall æ–¹æ³•æ¥å—çš„æ˜¯ä¸€ä¸ªå‚æ•°åˆ—è¡¨ï¼Œè€Œ apply æ–¹æ³•æ¥å—çš„æ˜¯ä¸€ä¸ªå‚æ•°æ•°ç»„ã€‚&lt;br&gt;é€‚ç”¨åœºæ™¯ä¸åŒï¼šå½“å‚æ•°æ•°é‡å›ºå®šæ—¶ï¼Œé€šå¸¸ä½¿ç”¨ callï¼›å½“å‚æ•°æ•°é‡ä¸å›ºå®šæ—¶ï¼Œä½¿ç”¨ apply æ›´ä¸ºæ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;call å’Œ apply éƒ½ç”¨äºæ”¹å˜å‡½æ•°æ‰§è¡Œæ—¶çš„ this æŒ‡å‘ã€‚&lt;/p&gt;
&lt;p&gt;call æ¥å—å‚æ•°åˆ—è¡¨ï¼Œapply æ¥å—å‚æ•°æ•°ç»„ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®å‚æ•°çš„æ•°é‡å’Œå½¢å¼é€‰æ‹©åˆé€‚çš„è°ƒç”¨æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;æŒæ¡ call å’Œ apply çš„ä½¿ç”¨ï¼Œèƒ½å¤Ÿè®©ä½ åœ¨ JavaScript ä¸­æ›´åŠ çµæ´»åœ°æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæå‡ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-è§£é‡Š-JavaScript-ä¸­çš„åŸå‹å’ŒåŸå‹é“¾&quot;&gt;&lt;a href=&quot;#1-è§£é‡Š-JavaScript-ä¸­çš„åŸå‹å’ŒåŸå‹é“¾&quot; class=&quot;headerlink&quot; title=&quot;1. è§£é‡Š JavaScript ä¸­çš„åŸå‹å’ŒåŸå‹é“¾&quot;&gt;&lt;/a&gt;1. è§£é‡Š JavaScript ä¸­çš„åŸå‹å’ŒåŸå‹é“¾&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç­”æ¡ˆ&lt;/strong&gt;ï¼š&lt;br&gt;JavaScript ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŸå‹ï¼ˆprototypeï¼‰ï¼ŒåŸå‹ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡å¯ä»¥ä»åŸå‹ç»§æ‰¿å±æ€§å’Œæ–¹æ³•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå‹&lt;/strong&gt;ï¼šæ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ª &lt;code&gt;prototype&lt;/code&gt; å±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯è¯¥å‡½æ•°çš„å®ä¾‹çš„åŸå‹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸå‹é“¾&lt;/strong&gt;ï¼šå½“è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå¦‚æœå¯¹è±¡æœ¬èº«æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼ŒJavaScript ä¼šæ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥å±æ€§æˆ–åˆ°è¾¾åŸå‹é“¾çš„æœ«ç«¯ï¼ˆ&lt;code&gt;null&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="å‰ç«¯é¢è¯•é¢˜é›†" scheme="http://blog.ypintao.com/categories/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98%E9%9B%86/"/>
    
    
    <category term="å‰ç«¯é¢è¯•é¢˜é›†" scheme="http://blog.ypintao.com/tags/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>reacté‡ç‚¹</title>
    <link href="http://blog.ypintao.com/2021/06/07/%E5%89%8D%E7%AB%AF/react/react%E9%9D%A2%E8%AF%95/"/>
    <id>http://blog.ypintao.com/2021/06/07/%E5%89%8D%E7%AB%AF/react/react%E9%9D%A2%E8%AF%95/</id>
    <published>2021-06-07T04:00:00.000Z</published>
    <updated>2025-09-25T06:56:23.537Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1ã€react-çˆ¶ç»„ä»¶æ€ä¹ˆè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•"><a href="#1ã€react-çˆ¶ç»„ä»¶æ€ä¹ˆè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•" class="headerlink" title="1ã€react çˆ¶ç»„ä»¶æ€ä¹ˆè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•"></a>1ã€react çˆ¶ç»„ä»¶æ€ä¹ˆè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•</h2><p>â€Œå‡½æ•°ç»„ä»¶ä½¿ç”¨ forwardRef+useImperativeHandleâ€Œï¼šå­ç»„ä»¶é€šè¿‡useImperativeHandleæš´éœ²æ–¹æ³•ï¼Œçˆ¶ç»„ä»¶é€šè¿‡refè°ƒç”¨</p><span id="more"></span><h2 id="2ã€æœ‰ç”¨è¿‡workerå—"><a href="#2ã€æœ‰ç”¨è¿‡workerå—" class="headerlink" title="2ã€æœ‰ç”¨è¿‡workerå—"></a>2ã€æœ‰ç”¨è¿‡workerå—</h2><p>Web Workerç”¨äºåœ¨åå°çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œé¿å…é˜»å¡UIæ¸²æŸ“ã€‚å…¸å‹åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š<br>å¤æ‚è®¡ç®—ï¼ˆå¦‚å›¾åƒå¤„ç†ï¼‰<br>å¤§æ•°æ®é‡æ’åº&#x2F;è¿‡æ»¤<br>ä¿æŒé¡µé¢å“åº”æ€§MCP_3</p><h2 id="3ã€æœ‰ç”¨è¿‡é‚£äº›æ‰“åŒ…å·¥å…·"><a href="#3ã€æœ‰ç”¨è¿‡é‚£äº›æ‰“åŒ…å·¥å…·" class="headerlink" title="3ã€æœ‰ç”¨è¿‡é‚£äº›æ‰“åŒ…å·¥å…·"></a>3ã€æœ‰ç”¨è¿‡é‚£äº›æ‰“åŒ…å·¥å…·</h2><p>webpack roolup vite </p><h2 id="4ã€æœ‰å†™è¿‡webpackæ’ä»¶ä¹ˆ"><a href="#4ã€æœ‰å†™è¿‡webpackæ’ä»¶ä¹ˆ" class="headerlink" title="4ã€æœ‰å†™è¿‡webpackæ’ä»¶ä¹ˆ"></a>4ã€æœ‰å†™è¿‡webpackæ’ä»¶ä¹ˆ</h2><p>ç¼–å†™æ’ä»¶éœ€è¦ç†è§£Webpackçš„compilerå’Œcompilationé’©å­ã€‚å…¸å‹ç»“æ„ï¼š</p><h2 id="6ã€åŸå‹å’ŒåŸå‹é“¾"><a href="#6ã€åŸå‹å’ŒåŸå‹é“¾" class="headerlink" title="6ã€åŸå‹å’ŒåŸå‹é“¾"></a>6ã€åŸå‹å’ŒåŸå‹é“¾</h2><p>â€ŒåŸå‹â€Œï¼šæ¯ä¸ªå‡½æ•°åˆ›å»ºçš„prototypeå¯¹è±¡<br>â€ŒåŸå‹é“¾â€Œï¼šå¯¹è±¡é€šè¿‡__proto__é“¾æ¥å½¢æˆçš„ç»§æ‰¿é“¾æ¡<br>è®¿é—®å±æ€§æ—¶æ²¿åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾MCP_3]^</p><h2 id="7ã€ç±»çš„é™æ€æ–¹æ³•å’ŒåŸå‹æ–¹æ³•æœ‰å•¥åŒºåˆ«ï¼Œè®¿é—®æ–¹å¼æœ‰ä»€ä¹ˆä¸åŒ"><a href="#7ã€ç±»çš„é™æ€æ–¹æ³•å’ŒåŸå‹æ–¹æ³•æœ‰å•¥åŒºåˆ«ï¼Œè®¿é—®æ–¹å¼æœ‰ä»€ä¹ˆä¸åŒ" class="headerlink" title="7ã€ç±»çš„é™æ€æ–¹æ³•å’ŒåŸå‹æ–¹æ³•æœ‰å•¥åŒºåˆ«ï¼Œè®¿é—®æ–¹å¼æœ‰ä»€ä¹ˆä¸åŒ"></a>7ã€ç±»çš„é™æ€æ–¹æ³•å’ŒåŸå‹æ–¹æ³•æœ‰å•¥åŒºåˆ«ï¼Œè®¿é—®æ–¹å¼æœ‰ä»€ä¹ˆä¸åŒ</h2><p>é€šè¿‡ç±»åè®¿é—®Class.method() ï¼Œï¼Œ<br>é€šè¿‡å®ä¾‹è®¿é—®instance.method()</p><h2 id="8ã€æœ‰ç”¨è¿‡canvasä¹ˆï¼Œé‚£äº›2dçš„åŠ¨ç”»åº“ã€‚"><a href="#8ã€æœ‰ç”¨è¿‡canvasä¹ˆï¼Œé‚£äº›2dçš„åŠ¨ç”»åº“ã€‚" class="headerlink" title="8ã€æœ‰ç”¨è¿‡canvasä¹ˆï¼Œé‚£äº›2dçš„åŠ¨ç”»åº“ã€‚"></a>8ã€æœ‰ç”¨è¿‡canvasä¹ˆï¼Œé‚£äº›2dçš„åŠ¨ç”»åº“ã€‚</h2><h2 id="9ã€ç§»åŠ¨ç«¯é€‚é…ï¼Œem-rem-vwå’Œvhçš„åŒºåˆ«"><a href="#9ã€ç§»åŠ¨ç«¯é€‚é…ï¼Œem-rem-vwå’Œvhçš„åŒºåˆ«" class="headerlink" title="9ã€ç§»åŠ¨ç«¯é€‚é…ï¼Œem rem vwå’Œvhçš„åŒºåˆ«"></a>9ã€ç§»åŠ¨ç«¯é€‚é…ï¼Œem rem vwå’Œvhçš„åŒºåˆ«</h2><h2 id="10ã€ç§»åŠ¨ç«¯å®‰å“å’Œios-å…¼å®¹ä¸Šæœ‰å“ªäº›ä¸ä¸€æ ·"><a href="#10ã€ç§»åŠ¨ç«¯å®‰å“å’Œios-å…¼å®¹ä¸Šæœ‰å“ªäº›ä¸ä¸€æ ·" class="headerlink" title="10ã€ç§»åŠ¨ç«¯å®‰å“å’Œios å…¼å®¹ä¸Šæœ‰å“ªäº›ä¸ä¸€æ ·"></a>10ã€ç§»åŠ¨ç«¯å®‰å“å’Œios å…¼å®¹ä¸Šæœ‰å“ªäº›ä¸ä¸€æ ·</h2><p>â€Œç‚¹å‡»å»¶è¿Ÿâ€Œï¼šiOSéœ€è¦touch-actionä¼˜åŒ–<br>â€Œæ»šåŠ¨å›å¼¹â€Œï¼šiOSç‰¹æœ‰çš„å¼¹æ€§æ»šåŠ¨æ•ˆæœ<br>â€Œè¾“å…¥æ¡†èšç„¦â€Œï¼šiOSé”®ç›˜å¼¹å‡ºè¡Œä¸ºä¸åŒ<br>â€Œæ—¥æœŸé€‰æ‹©å™¨â€Œï¼šå„ç³»ç»ŸåŸç”Ÿæ§ä»¶æ ·å¼å·®å¼‚å¤§<br>â€Œå®‰å…¨åŒºåŸŸâ€Œï¼šiOSåˆ˜æµ·å±éœ€è¦viewport-fité€‚é…MCP_3]^</p><h2 id="11ã€react-useEffect-ä¾èµ–é¡¹æ•°ç»„ä¸ºç©º-æˆ–è€…ä¸å†™æ•°ç»„æœ‰å•¥åŒºåˆ«"><a href="#11ã€react-useEffect-ä¾èµ–é¡¹æ•°ç»„ä¸ºç©º-æˆ–è€…ä¸å†™æ•°ç»„æœ‰å•¥åŒºåˆ«" class="headerlink" title="11ã€react useEffect ä¾èµ–é¡¹æ•°ç»„ä¸ºç©º æˆ–è€…ä¸å†™æ•°ç»„æœ‰å•¥åŒºåˆ«"></a>11ã€react useEffect ä¾èµ–é¡¹æ•°ç»„ä¸ºç©º æˆ–è€…ä¸å†™æ•°ç»„æœ‰å•¥åŒºåˆ«</h2><p>ç©ºæ•°ç»„[]â€Œï¼šä»…åœ¨æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œå¸è½½æ—¶æ¸…ç†<br>â€Œä¸ä¼ æ•°ç»„â€Œï¼šæ¯æ¬¡æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œ<br>â€Œå«ä¾èµ–é¡¹â€Œï¼šä¾èµ–å˜åŒ–æ—¶æ‰§è¡ŒMCP_3]^</p><h2 id="12ã€reactåˆæˆäº‹ä»¶åŸç†ã€‚"><a href="#12ã€reactåˆæˆäº‹ä»¶åŸç†ã€‚" class="headerlink" title="12ã€reactåˆæˆäº‹ä»¶åŸç†ã€‚"></a>12ã€reactåˆæˆäº‹ä»¶åŸç†ã€‚</h2><p>â€Œäº‹ä»¶å§”æ‰˜â€Œï¼šæ‰€æœ‰äº‹ä»¶å§”æ‰˜åˆ°documentå¤„ç†<br>â€Œç»Ÿä¸€å°è£…â€Œï¼šå¯¹åŸç”Ÿäº‹ä»¶è¿›è¡Œè·¨æµè§ˆå™¨åŒ…è£…<br>â€Œæ€§èƒ½ä¼˜åŒ–â€Œï¼šä½¿ç”¨äº‹ä»¶æ± å¤ç”¨äº‹ä»¶å¯¹è±¡<br>â€Œå¼‚æ­¥å¤„ç†â€Œï¼šæ‰¹é‡æ›´æ–°äº‹ä»¶å¤„ç†MCP_3]^</p><p>ä»€ä¹ˆæ˜¯Reactäº‹ä»¶ï¼Œä»€ä¹ˆæ˜¯åŸç”Ÿäº‹ä»¶ï¼Ÿä¸¤è€…çš„åŒºåˆ«åœ¨å“ªå„¿ï¼Ÿ<br>React äº‹ä»¶: React äº‹ä»¶æ˜¯ç»è¿‡å°è£…å’Œåˆæˆçš„ï¼Œä»¥ä¿è¯åœ¨ä¸åŒæµè§ˆå™¨ä¸Šçš„ä¸€è‡´æ€§ã€‚åœ¨ä½¿ç”¨ React ä¸­çš„äº‹ä»¶å¤„ç†æ—¶ï¼Œä½ ä¼šç»™ JSX å…ƒç´ æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæ¯”å¦‚ onClickã€onChange ç­‰ï¼Œç„¶ååœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­å¤„ç†ç›¸åº”çš„é€»è¾‘ã€‚React äº‹ä»¶çš„å¤„ç†æ–¹å¼æä¾›äº†ä¸€å®šç¨‹åº¦çš„æŠ½è±¡ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°å¤„ç†äº‹ä»¶å’Œè·¨æµè§ˆå™¨çš„å…¼å®¹æ€§ã€‚<br>åŸç”Ÿäº‹ä»¶æ˜¯æŒ‡ç”±æµè§ˆå™¨åŸç”Ÿæä¾›çš„äº‹ä»¶ï¼Œå¦‚ clickã€changeã€mouseover ç­‰ã€‚åœ¨ä¼ ç»Ÿçš„ Web å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ JavaScript ç›´æ¥æ“ä½œ DOM å…ƒç´ å¹¶ä¸ºå…¶ç»‘å®šåŸç”Ÿäº‹ä»¶å¤„ç†ç¨‹åºæ¥å®ç°äº¤äº’è¡Œä¸ºã€‚</p><p>åˆæˆäº‹ä»¶ç³»ç»Ÿï¼šReact äº‹ä»¶æ˜¯ç»è¿‡åˆæˆçš„ï¼ŒReact é€šè¿‡äº‹ä»¶å§”æ´¾ï¼ˆevent delegationï¼‰çš„æ–¹å¼æ¥ç®¡ç†äº‹ä»¶ï¼Œè€Œä¸æ˜¯ç›´æ¥å°†äº‹ä»¶ç»‘å®šåˆ°æ¯ä¸ª DOM å…ƒç´ ä¸Šã€‚è¿™ç§æ–¹å¼å¯ä»¥æé«˜æ€§èƒ½ï¼ŒåŒæ—¶å‡å°‘å†…å­˜å ç”¨ã€‚<br>è·¨æµè§ˆå™¨å…¼å®¹æ€§ï¼šReact äº‹ä»¶å¤„ç†å°è£…äº†åº•å±‚çš„æµè§ˆå™¨å·®å¼‚ï¼Œä½¿å¾—å¼€å‘è€…æ— éœ€å…³å¿ƒä¸åŒæµè§ˆå™¨çš„äº‹ä»¶å…¼å®¹æ€§é—®é¢˜ã€‚<br>äº‹ä»¶å‘½åï¼šReact ä½¿ç”¨é©¼å³°å¼å‘½åæ¥å®šä¹‰äº‹ä»¶åï¼Œå¦‚ onClickã€onChangeï¼Œè€ŒåŸç”Ÿäº‹ä»¶åˆ™ä½¿ç”¨å…¨å°å†™çš„æ–¹å¼ï¼Œå¦‚ clickã€changeã€‚</p><p>React ä¸­çš„äº‹ä»¶å§”æ´¾æ˜¯æŒ‡ React å°†äº‹ä»¶å¤„ç†é€»è¾‘å§”æ‰˜ç»™ç»„ä»¶çš„å…±åŒç¥–å…ˆï¼ˆæ ¹ç»„ä»¶ï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨æ¯ä¸ªç»„ä»¶ä¸Šæ·»åŠ äº‹ä»¶ç›‘å¬å™¨ã€‚è¿™æ„å‘³ç€ React åœ¨æ•´ä¸ªç»„ä»¶æ ‘ä¸­åªæ·»åŠ äº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œè€Œä¸æ˜¯æ¯ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶ç›‘å¬å™¨ã€‚<br>å½“ç”¨æˆ·è§¦å‘äº‹ä»¶æ—¶ï¼ŒReact ä¼šåœ¨ DOM æ ‘ä¸­æ‰¾åˆ°æœ€è¿‘çš„å…±åŒç¥–å…ˆï¼Œå¹¶åœ¨è¯¥èŠ‚ç‚¹ä¸Šè§¦å‘äº‹ä»¶å¤„ç†å‡½æ•°ã€‚ç„¶åï¼ŒReact ä¼šä½¿ç”¨äº‹ä»¶å†’æ³¡ï¼ˆevent bubblingï¼‰çš„æœºåˆ¶å°†äº‹ä»¶ä¼ æ’­åˆ°ç»„ä»¶æ ‘ä¸­çš„æ¯ä¸ªç»„ä»¶ï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚<br>React äº‹ä»¶å§”æ´¾çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š<br>æ€§èƒ½ä¼˜åŒ–ï¼šå‡å°‘äº†äº‹ä»¶ç›‘å¬å™¨çš„æ•°é‡ï¼Œæé«˜äº†æ€§èƒ½ã€‚ç›¸æ¯”æ¯ä¸ªç»„ä»¶éƒ½æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œåªæœ‰ä¸€ä¸ªå…±åŒç¥–å…ˆæ·»åŠ äº‹ä»¶ç›‘å¬å™¨çš„æ–¹å¼æ›´åŠ é«˜æ•ˆã€‚<br>ç®€åŒ–äº‹ä»¶ç®¡ç†ï¼šä¸éœ€è¦ä¸ºæ¯ä¸ªç»„ä»¶éƒ½æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œå‡å°‘äº†äº‹ä»¶ç®¡ç†çš„å¤æ‚æ€§ã€‚å½“ç»„ä»¶è¢«æ·»åŠ ã€ç§»é™¤æˆ–æ›´æ–°æ—¶ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†äº‹ä»¶ç›‘å¬å™¨ã€‚<br>æ›´å°‘çš„å†…å­˜å ç”¨ï¼šåªæœ‰ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå‡å°‘äº†å†…å­˜å ç”¨ã€‚</p><h2 id="15ã€webpack-å…¬å¸ƒå˜é‡-htmlè®¿é—®"><a href="#15ã€webpack-å…¬å¸ƒå˜é‡-htmlè®¿é—®" class="headerlink" title="15ã€webpack å…¬å¸ƒå˜é‡ htmlè®¿é—®"></a>15ã€webpack å…¬å¸ƒå˜é‡ htmlè®¿é—®</h2><p>1ã€ä½¿ç”¨ htmlwebpackPlugin<br>2ã€ç¯å¢ƒå˜é‡æ³¨å…¥<br>3ã€DefinePluginå…¨å±€å˜é‡</p><h2 id="13ã€usecontext-æœ‰ä»€ä¹ˆä½œç”¨å’Œç¼ºç‚¹"><a href="#13ã€usecontext-æœ‰ä»€ä¹ˆä½œç”¨å’Œç¼ºç‚¹" class="headerlink" title="13ã€usecontext,æœ‰ä»€ä¹ˆä½œç”¨å’Œç¼ºç‚¹"></a>13ã€usecontext,æœ‰ä»€ä¹ˆä½œç”¨å’Œç¼ºç‚¹</h2><p>ä¼˜ç‚¹â€Œï¼š<br>è·¨ç»„ä»¶å±‚çº§å…±äº«çŠ¶æ€<br>é¿å…prop drilling<br>â€Œç¼ºç‚¹â€Œï¼š<br>çŠ¶æ€æ›´æ–°ä¼šå¯¼è‡´æ‰€æœ‰æ¶ˆè´¹è€…é‡æ–°æ¸²æŸ“<br>ä¸é€‚åˆé«˜é¢‘æ›´æ–°çš„åœºæ™¯MCP_3]^</p><h2 id="14ã€webpack-æ€ä¹ˆé…ç½®å¤šå…¥å£ã€‚"><a href="#14ã€webpack-æ€ä¹ˆé…ç½®å¤šå…¥å£ã€‚" class="headerlink" title="14ã€webpack æ€ä¹ˆé…ç½®å¤šå…¥å£ã€‚"></a>14ã€webpack æ€ä¹ˆé…ç½®å¤šå…¥å£ã€‚</h2><p>pageså±æ€§</p><h2 id="5ã€reactç»„ä»¶é€»è¾‘å¤ç”¨æœ‰å“ªäº›æ–¹å¼ã€‚"><a href="#5ã€reactç»„ä»¶é€»è¾‘å¤ç”¨æœ‰å“ªäº›æ–¹å¼ã€‚" class="headerlink" title="5ã€reactç»„ä»¶é€»è¾‘å¤ç”¨æœ‰å“ªäº›æ–¹å¼ã€‚"></a>5ã€reactç»„ä»¶é€»è¾‘å¤ç”¨æœ‰å“ªäº›æ–¹å¼ã€‚</h2><p>Reactç»„ä»¶é€»è¾‘å¤ç”¨<br>â€Œè‡ªå®šä¹‰Hooksâ€Œï¼šæå–é€šç”¨é€»è¾‘ä¸ºå¯å¤ç”¨å‡½æ•°<br>â€ŒHOCé«˜é˜¶ç»„ä»¶â€Œï¼šé€šè¿‡ç»„ä»¶åŒ…è£…å¢å¼ºåŠŸèƒ½<br>â€ŒRender Propsâ€Œï¼šé€šè¿‡å‡½æ•°propå…±äº«ä»£ç <br>â€ŒContext APIâ€Œï¼šè·¨å±‚çº§çŠ¶æ€å…±äº«MCP_3]^</p><p>1ã€reactæ€§èƒ½ä¼˜åŒ–<br>1.1ã€useMemo<br>1.2ã€useCallback</p><p>useLayoutEffectä¼šé˜»å¡æµè§ˆå™¨æ¸²æŸ“ï¼ŒuseEffectä¸ä¼š</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1ã€react-çˆ¶ç»„ä»¶æ€ä¹ˆè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•&quot;&gt;&lt;a href=&quot;#1ã€react-çˆ¶ç»„ä»¶æ€ä¹ˆè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;1ã€react çˆ¶ç»„ä»¶æ€ä¹ˆè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•&quot;&gt;&lt;/a&gt;1ã€react çˆ¶ç»„ä»¶æ€ä¹ˆè°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•&lt;/h2&gt;&lt;p&gt;â€Œå‡½æ•°ç»„ä»¶ä½¿ç”¨ forwardRef+useImperativeHandleâ€Œï¼šå­ç»„ä»¶é€šè¿‡useImperativeHandleæš´éœ²æ–¹æ³•ï¼Œçˆ¶ç»„ä»¶é€šè¿‡refè°ƒç”¨&lt;/p&gt;</summary>
    
    
    
    <category term="react" scheme="http://blog.ypintao.com/categories/react/"/>
    
    
    <category term="react" scheme="http://blog.ypintao.com/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>Vue 2 æºç è§£è¯»</title>
    <link href="http://blog.ypintao.com/2021/06/01/%E5%89%8D%E7%AB%AF/vue/vue2%E6%BA%90%E7%A0%81/"/>
    <id>http://blog.ypintao.com/2021/06/01/%E5%89%8D%E7%AB%AF/vue/vue2%E6%BA%90%E7%A0%81/</id>
    <published>2021-06-01T04:00:00.000Z</published>
    <updated>2025-09-25T06:57:09.264Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>Vue 2çš„æºç é‡‡ç”¨å…¸å‹çš„æ¨¡å—åŒ–ç»“æ„ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š</p><ul><li><strong>core</strong>: æ ¸å¿ƒä»£ç ï¼ŒåŒ…å«å“åº”å¼ç³»ç»Ÿã€è™šæ‹ŸDOMã€ç»„ä»¶ç³»ç»Ÿç­‰</li><li><strong>platforms</strong>: å¹³å°ç‰¹å®šä»£ç ï¼ŒåŒ…æ‹¬Webå’ŒWeex</li><li><strong>compiler</strong>: æ¨¡æ¿ç¼–è¯‘å™¨ï¼Œå°†æ¨¡æ¿è½¬æ¢ä¸ºæ¸²æŸ“å‡½æ•°</li><li><strong>server</strong>: æœåŠ¡ç«¯æ¸²æŸ“ç›¸å…³ä»£ç </li><li><strong>sfc</strong>: å•æ–‡ä»¶ç»„ä»¶(.vueæ–‡ä»¶)è§£æå™¨</li><li><strong>shared</strong>: å…±äº«å·¥å…·å‡½æ•°</li></ul><h2 id="ä¸€ã€å“åº”å¼ç³»ç»Ÿ"><a href="#ä¸€ã€å“åº”å¼ç³»ç»Ÿ" class="headerlink" title="ä¸€ã€å“åº”å¼ç³»ç»Ÿ"></a>ä¸€ã€å“åº”å¼ç³»ç»Ÿ</h2><p>Vue 2çš„å“åº”å¼ç³»ç»Ÿæ˜¯æ•´ä¸ªæ¡†æ¶çš„æ ¸å¿ƒï¼Œå®ƒåŸºäºObject.definePropertyå®ç°æ•°æ®åŠ«æŒå’Œå‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚</p><h3 id="1-1-æ•°æ®å“åº”å¼åŸç†"><a href="#1-1-æ•°æ®å“åº”å¼åŸç†" class="headerlink" title="1.1 æ•°æ®å“åº”å¼åŸç†"></a>1.1 æ•°æ®å“åº”å¼åŸç†</h3><span id="more"></span><h4 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h4><p>Observerç±»è´Ÿè´£å°†æ™®é€šJavaScriptå¯¹è±¡è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/observer/index.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span> (<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dep</span> = <span class="keyword">new</span> <span class="title class_">Dep</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vmCount</span> = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœ¨å¯¹è±¡ä¸Šæ·»åŠ __ob__å±æ€§ï¼ŒæŒ‡å‘Observerå®ä¾‹</span></span><br><span class="line">    <span class="title function_">def</span>(value, <span class="string">&#x27;__ob__&#x27;</span>, <span class="variable language_">this</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(value)) &#123;</span><br><span class="line">      <span class="comment">// æ•°ç»„å“åº”å¼å¤„ç†</span></span><br><span class="line">      <span class="keyword">const</span> augment = hasProto</span><br><span class="line">        ? protoAugment</span><br><span class="line">        : copyAugment</span><br><span class="line">      <span class="title function_">augment</span>(value, arrayMethods, arrayKeys)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">observeArray</span>(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å¯¹è±¡å“åº”å¼å¤„ç†</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">walk</span>(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå†å¯¹è±¡çš„æ‰€æœ‰å±æ€§å¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºgetter/setter</span></span><br><span class="line">  <span class="title function_">walk</span> (obj) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="title function_">defineReactive</span>(obj, keys[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå†æ•°ç»„çš„æ¯ä¸€é¡¹å¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºå“åº”å¼</span></span><br><span class="line">  <span class="title function_">observeArray</span> (items) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = items.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">      <span class="title function_">observe</span>(items[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å¯¹è±¡è½¬æ¢ä¸ºå“åº”å¼</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">observe</span> (<span class="params">value, asRootData</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isObject</span>(value) || value <span class="keyword">instanceof</span> <span class="title class_">VNode</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> ob</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">hasOwn</span>(value, <span class="string">&#x27;__ob__&#x27;</span>) &amp;&amp; value.<span class="property">__ob__</span> <span class="keyword">instanceof</span> <span class="title class_">Observer</span>) &#123;</span><br><span class="line">    ob = value.<span class="property">__ob__</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">    shouldObserve &amp;&amp;</span><br><span class="line">    !<span class="title function_">isServerRendering</span>() &amp;&amp;</span><br><span class="line">    (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(value) || <span class="title function_">isPlainObject</span>(value)) &amp;&amp;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">isExtensible</span>(value) &amp;&amp;</span><br><span class="line">    !value.<span class="property">_isVue</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    ob = <span class="keyword">new</span> <span class="title class_">Observer</span>(value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (asRootData &amp;&amp; ob) &#123;</span><br><span class="line">    ob.<span class="property">vmCount</span>++</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ob</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="defineReactive"><a href="#defineReactive" class="headerlink" title="defineReactive"></a>defineReactive</h4><p><code>defineReactive</code>å‡½æ•°ä½¿ç”¨Object.definePropertyå°†å¯¹è±¡å±æ€§è½¬æ¢ä¸ºgetter&#x2F;setterï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/observer/index.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">defineReactive</span> (<span class="params"></span></span><br><span class="line"><span class="params">  obj,</span></span><br><span class="line"><span class="params">  key,</span></span><br><span class="line"><span class="params">  val,</span></span><br><span class="line"><span class="params">  customSetter,</span></span><br><span class="line"><span class="params">  shallow</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ä¸ºæ¯ä¸ªå±æ€§åˆ›å»ºä¸€ä¸ªä¾èµ–æ”¶é›†å™¨</span></span><br><span class="line">  <span class="keyword">const</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> property = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(obj, key)</span><br><span class="line">  <span class="keyword">if</span> (property &amp;&amp; property.<span class="property">configurable</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¼“å­˜åŸæ¥çš„getterå’Œsetter</span></span><br><span class="line">  <span class="keyword">const</span> getter = property &amp;&amp; property.<span class="property">get</span></span><br><span class="line">  <span class="keyword">const</span> setter = property &amp;&amp; property.<span class="property">set</span></span><br><span class="line">  <span class="keyword">if</span> ((!getter || setter) &amp;&amp; <span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">2</span>) &#123;</span><br><span class="line">    val = obj[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€’å½’è§‚å¯Ÿå­å±æ€§</span></span><br><span class="line">  <span class="keyword">let</span> childOb = !shallow &amp;&amp; <span class="title function_">observe</span>(val)</span><br><span class="line">  </span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span> <span class="title function_">reactiveGetter</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = getter ? getter.<span class="title function_">call</span>(obj) : val</span><br><span class="line">      <span class="comment">// ä¾èµ–æ”¶é›†</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) &#123;</span><br><span class="line">        dep.<span class="title function_">depend</span>()</span><br><span class="line">        <span class="keyword">if</span> (childOb) &#123;</span><br><span class="line">          childOb.<span class="property">dep</span>.<span class="title function_">depend</span>()</span><br><span class="line">          <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(value)) &#123;</span><br><span class="line">            <span class="title function_">dependArray</span>(value)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span> <span class="title function_">reactiveSetter</span> (<span class="params">newVal</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = getter ? getter.<span class="title function_">call</span>(obj) : val</span><br><span class="line">      <span class="comment">// å€¼æ²¡æœ‰å˜åŒ–åˆ™ä¸è§¦å‘æ›´æ–°</span></span><br><span class="line">      <span class="keyword">if</span> (newVal === value || (newVal !== newVal &amp;&amp; value !== value)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; customSetter) &#123;</span><br><span class="line">        <span class="title function_">customSetter</span>()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (getter &amp;&amp; !setter) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">if</span> (setter) &#123;</span><br><span class="line">        setter.<span class="title function_">call</span>(obj, newVal)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        val = newVal</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ–°å€¼éœ€è¦é‡æ–°è§‚å¯Ÿ</span></span><br><span class="line">      childOb = !shallow &amp;&amp; <span class="title function_">observe</span>(newVal)</span><br><span class="line">      <span class="comment">// é€šçŸ¥ä¾èµ–æ›´æ–°</span></span><br><span class="line">      dep.<span class="title function_">notify</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-ä¾èµ–æ”¶é›†ä¸æ›´æ–°"><a href="#1-2-ä¾èµ–æ”¶é›†ä¸æ›´æ–°" class="headerlink" title="1.2 ä¾èµ–æ”¶é›†ä¸æ›´æ–°"></a>1.2 ä¾èµ–æ”¶é›†ä¸æ›´æ–°</h3><h4 id="Dep"><a href="#Dep" class="headerlink" title="Dep"></a>Dep</h4><p>Depç±»æ˜¯ä¸€ä¸ªå‘å¸ƒè®¢é˜…ä¸­å¿ƒï¼Œè´Ÿè´£æ”¶é›†ä¾èµ–å’Œé€šçŸ¥æ›´æ–°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/observer/dep.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Dep</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> target</span><br><span class="line">  id</span><br><span class="line">  subs</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">id</span> = uid++</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span> = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ è®¢é˜…è€…</span></span><br><span class="line">  <span class="title function_">addSub</span> (sub) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">push</span>(sub)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç§»é™¤è®¢é˜…è€…</span></span><br><span class="line">  <span class="title function_">removeSub</span> (sub) &#123;</span><br><span class="line">    <span class="title function_">remove</span>(<span class="variable language_">this</span>.<span class="property">subs</span>, sub)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¶é›†ä¾èµ–</span></span><br><span class="line">  <span class="title function_">depend</span> () &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) &#123;</span><br><span class="line">      <span class="title class_">Dep</span>.<span class="property">target</span>.<span class="title function_">addDep</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…æ›´æ–°</span></span><br><span class="line">  <span class="title function_">notify</span> () &#123;</span><br><span class="line">    <span class="comment">// ç¨³å®šè®¢é˜…è€…åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">const</span> subs = <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">slice</span>()</span><br><span class="line">    <span class="comment">// é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = subs.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">      subs[i].<span class="title function_">update</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰æ­£åœ¨è¯„ä¼°çš„Watcher</span></span><br><span class="line"><span class="title class_">Dep</span>.<span class="property">target</span> = <span class="literal">null</span></span><br><span class="line"><span class="keyword">const</span> targetStack = []</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å½“å‰Watcher</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">pushTarget</span> (<span class="params">target</span>) &#123;</span><br><span class="line">  targetStack.<span class="title function_">push</span>(target)</span><br><span class="line">  <span class="title class_">Dep</span>.<span class="property">target</span> = target</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¢å¤ä¹‹å‰çš„Watcher</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">popTarget</span> (<span class="params"></span>) &#123;</span><br><span class="line">  targetStack.<span class="title function_">pop</span>()</span><br><span class="line">  <span class="title class_">Dep</span>.<span class="property">target</span> = targetStack[targetStack.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Watcher"><a href="#Watcher" class="headerlink" title="Watcher"></a>Watcher</h4><p>Watcherç±»æ˜¯ä¾èµ–çš„å…·ä½“å®ç°ï¼Œè´Ÿè´£æ‰§è¡Œæ›´æ–°æ“ä½œï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/observer/watcher.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span> (<span class="params"></span></span><br><span class="line"><span class="params">    vm,</span></span><br><span class="line"><span class="params">    expOrFn,</span></span><br><span class="line"><span class="params">    cb,</span></span><br><span class="line"><span class="params">    options,</span></span><br><span class="line"><span class="params">    isRenderWatcher</span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm</span><br><span class="line">    <span class="keyword">if</span> (isRenderWatcher) &#123;</span><br><span class="line">      vm.<span class="property">_watcher</span> = <span class="variable language_">this</span></span><br><span class="line">    &#125;</span><br><span class="line">    vm.<span class="property">_watchers</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€‰é¡¹</span></span><br><span class="line">    <span class="keyword">if</span> (options) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">deep</span> = !!options.<span class="property">deep</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">user</span> = !!options.<span class="property">user</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">lazy</span> = !!options.<span class="property">lazy</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">sync</span> = !!options.<span class="property">sync</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">before</span> = options.<span class="property">before</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">deep</span> = <span class="variable language_">this</span>.<span class="property">user</span> = <span class="variable language_">this</span>.<span class="property">lazy</span> = <span class="variable language_">this</span>.<span class="property">sync</span> = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cb</span> = cb</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">id</span> = ++uid <span class="comment">// uid for batching</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">active</span> = <span class="literal">true</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="variable language_">this</span>.<span class="property">lazy</span> <span class="comment">// for lazy watchers</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deps</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDeps</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">depIds</span> = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDepIds</span> = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expression</span> = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span></span><br><span class="line">      ? expOrFn.<span class="title function_">toString</span>()</span><br><span class="line">      : <span class="string">&#x27;&#x27;</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment">// è§£æè¡¨è¾¾å¼</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> expOrFn === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">getter</span> = expOrFn</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">getter</span> = <span class="title function_">parsePath</span>(expOrFn)</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">getter</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">getter</span> = noop</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">lazy</span></span><br><span class="line">      ? <span class="literal">undefined</span></span><br><span class="line">      : <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–å€¼å¹¶æ”¶é›†ä¾èµ–</span></span><br><span class="line">  <span class="title function_">get</span> () &#123;</span><br><span class="line">    <span class="title function_">pushTarget</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="keyword">let</span> value</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="variable language_">this</span>.<span class="property">vm</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œgetterï¼Œè§¦å‘ä¾èµ–æ”¶é›†</span></span><br><span class="line">      value = <span class="variable language_">this</span>.<span class="property">getter</span>.<span class="title function_">call</span>(vm, vm)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">user</span>) &#123;</span><br><span class="line">        <span class="title function_">handleError</span>(e, vm, <span class="string">`getter for watcher &quot;<span class="subst">$&#123;<span class="variable language_">this</span>.expression&#125;</span>&quot;`</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> e</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// å¤„ç†æ·±åº¦ç›‘å¬</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">deep</span>) &#123;</span><br><span class="line">        <span class="title function_">traverse</span>(value)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">popTarget</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">cleanupDeps</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ ä¾èµ–</span></span><br><span class="line">  <span class="title function_">addDep</span> (dep) &#123;</span><br><span class="line">    <span class="keyword">const</span> id = dep.<span class="property">id</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">has</span>(id)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">add</span>(id)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newDeps</span>.<span class="title function_">push</span>(dep)</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">depIds</span>.<span class="title function_">has</span>(id)) &#123;</span><br><span class="line">        dep.<span class="title function_">addSub</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…ç†ä¾èµ–</span></span><br><span class="line">  <span class="title function_">cleanupDeps</span> () &#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span></span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      <span class="keyword">const</span> dep = <span class="variable language_">this</span>.<span class="property">deps</span>[i]</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">has</span>(dep.<span class="property">id</span>)) &#123;</span><br><span class="line">        dep.<span class="title function_">removeSub</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> tmp = <span class="variable language_">this</span>.<span class="property">depIds</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">depIds</span> = <span class="variable language_">this</span>.<span class="property">newDepIds</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDepIds</span> = tmp</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">clear</span>()</span><br><span class="line">    tmp = <span class="variable language_">this</span>.<span class="property">deps</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deps</span> = <span class="variable language_">this</span>.<span class="property">newDeps</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDeps</span> = tmp</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDeps</span>.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ›´æ–°</span></span><br><span class="line">  <span class="title function_">update</span> () &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">lazy</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">sync</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">run</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">queueWatcher</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ‰§è¡Œæ›´æ–°</span></span><br><span class="line">  <span class="title function_">run</span> () &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">active</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        value !== <span class="variable language_">this</span>.<span class="property">value</span> ||</span><br><span class="line">        <span class="title function_">isObject</span>(value) ||</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">deep</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®æ–°å€¼</span></span><br><span class="line">        <span class="keyword">const</span> oldValue = <span class="variable language_">this</span>.<span class="property">value</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">user</span>) &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cb</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, value, oldValue)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="title function_">handleError</span>(e, <span class="variable language_">this</span>.<span class="property">vm</span>, <span class="string">`callback for watcher &quot;<span class="subst">$&#123;<span class="variable language_">this</span>.expression&#125;</span>&quot;`</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">cb</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, value, oldValue)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¡ç®—å±æ€§çš„æ±‚å€¼</span></span><br><span class="line">  <span class="title function_">evaluate</span> () &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¶é›†æ‰€æœ‰ä¾èµ–</span></span><br><span class="line">  <span class="title function_">depend</span> () &#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span></span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">deps</span>[i].<span class="title function_">depend</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é”€æ¯</span></span><br><span class="line">  <span class="title function_">teardown</span> () &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">active</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">_isBeingDestroyed</span>) &#123;</span><br><span class="line">        <span class="title function_">remove</span>(<span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">_watchers</span>, <span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span></span><br><span class="line">      <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">deps</span>[i].<span class="title function_">removeSub</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">active</span> = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-æ•°ç»„å“åº”å¼å¤„ç†"><a href="#1-3-æ•°ç»„å“åº”å¼å¤„ç†" class="headerlink" title="1.3 æ•°ç»„å“åº”å¼å¤„ç†"></a>1.3 æ•°ç»„å“åº”å¼å¤„ç†</h3><p>Vue 2å¯¹æ•°ç»„çš„å˜å¼‚æ–¹æ³•è¿›è¡Œäº†ç‰¹æ®Šå¤„ç†ï¼Œä»¥å®ç°æ•°ç»„çš„å“åº”å¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/observer/array.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">import</span> &#123; def &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arrayProto = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„åŸå‹æŒ‡å‘Array.prototype</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> arrayMethods = <span class="title class_">Object</span>.<span class="title function_">create</span>(arrayProto)</span><br><span class="line"></span><br><span class="line"><span class="comment">// éœ€è¦æ‹¦æˆªçš„æ•°ç»„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> methodsToPatch = [</span><br><span class="line">  <span class="string">&#x27;push&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pop&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;shift&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;unshift&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;splice&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;sort&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;reverse&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹¦æˆªæ•°ç»„æ–¹æ³•</span></span><br><span class="line">methodsToPatch.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">method</span>) &#123;</span><br><span class="line">  <span class="comment">// ç¼“å­˜åŸå§‹æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">const</span> original = arrayProto[method]</span><br><span class="line">  <span class="title function_">def</span>(arrayMethods, method, <span class="keyword">function</span> <span class="title function_">mutator</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨åŸå§‹æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">const</span> result = original.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">    <span class="comment">// è·å–Observerå®ä¾‹</span></span><br><span class="line">    <span class="keyword">const</span> ob = <span class="variable language_">this</span>.<span class="property">__ob__</span></span><br><span class="line">    <span class="keyword">let</span> inserted</span><br><span class="line">    <span class="comment">// å¯¹æ–°å¢çš„å…ƒç´ è¿›è¡Œè§‚å¯Ÿ</span></span><br><span class="line">    <span class="keyword">switch</span> (method) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;push&#x27;</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;unshift&#x27;</span>:</span><br><span class="line">        inserted = args</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;splice&#x27;</span>:</span><br><span class="line">        inserted = args.<span class="title function_">slice</span>(<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (inserted) ob.<span class="title function_">observeArray</span>(inserted)</span><br><span class="line">    <span class="comment">// é€šçŸ¥æ›´æ–°</span></span><br><span class="line">    ob.<span class="property">dep</span>.<span class="title function_">notify</span>()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="äºŒã€ç»„ä»¶ç³»ç»Ÿä¸æ¸²æŸ“æœºåˆ¶"><a href="#äºŒã€ç»„ä»¶ç³»ç»Ÿä¸æ¸²æŸ“æœºåˆ¶" class="headerlink" title="äºŒã€ç»„ä»¶ç³»ç»Ÿä¸æ¸²æŸ“æœºåˆ¶"></a>äºŒã€ç»„ä»¶ç³»ç»Ÿä¸æ¸²æŸ“æœºåˆ¶</h2><p>Vue 2çš„ç»„ä»¶ç³»ç»Ÿæ˜¯æ„å»ºç”¨æˆ·ç•Œé¢çš„æ ¸å¿ƒï¼Œå®ƒåŸºäºè™šæ‹ŸDOMå®ç°é«˜æ•ˆçš„æ¸²æŸ“ã€‚</p><h3 id="2-1-Vueå®ä¾‹åˆ›å»º"><a href="#2-1-Vueå®ä¾‹åˆ›å»º" class="headerlink" title="2.1 Vueå®ä¾‹åˆ›å»º"></a>2.1 Vueå®ä¾‹åˆ›å»º</h3><p>Vueå®ä¾‹çš„åˆ›å»ºè¿‡ç¨‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/index.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Vue</span> (<span class="params">options</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span> &amp;&amp;</span><br><span class="line">    !(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">Vue</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(<span class="string">&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_init</span>(options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ··å…¥æ ¸å¿ƒæ–¹æ³•</span></span><br><span class="line"><span class="title function_">initMixin</span>(<span class="title class_">Vue</span>)       <span class="comment">// å®ç° _init æ–¹æ³•</span></span><br><span class="line"><span class="title function_">stateMixin</span>(<span class="title class_">Vue</span>)      <span class="comment">// å®ç° $data, $props, $set, $delete, $watch ç­‰</span></span><br><span class="line"><span class="title function_">eventsMixin</span>(<span class="title class_">Vue</span>)     <span class="comment">// å®ç° $on, $once, $off, $emit ç­‰</span></span><br><span class="line"><span class="title function_">lifecycleMixin</span>(<span class="title class_">Vue</span>)  <span class="comment">// å®ç° _update, $forceUpdate, $destroy ç­‰</span></span><br><span class="line"><span class="title function_">renderMixin</span>(<span class="title class_">Vue</span>)     <span class="comment">// å®ç° $nextTick, _render ç­‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vue</span></span><br></pre></td></tr></table></figure><h4 id="initæ–¹æ³•"><a href="#initæ–¹æ³•" class="headerlink" title="_initæ–¹æ³•"></a>_initæ–¹æ³•</h4><p><code>_init</code>æ–¹æ³•æ˜¯Vueå®ä¾‹åˆå§‹åŒ–çš„å…¥å£ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/init.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">initMixin</span> (<span class="params">Vue</span>) &#123;</span><br><span class="line">  <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_init</span> = <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="variable language_">this</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå¹¶é€‰é¡¹</span></span><br><span class="line">    <span class="keyword">if</span> (options &amp;&amp; options.<span class="property">_isComponent</span>) &#123;</span><br><span class="line">      <span class="comment">// ä¼˜åŒ–å†…éƒ¨ç»„ä»¶å®ä¾‹åŒ–</span></span><br><span class="line">      <span class="title function_">initInternalComponent</span>(vm, options)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      vm.<span class="property">$options</span> = <span class="title function_">mergeOptions</span>(</span><br><span class="line">        <span class="title function_">resolveConstructorOptions</span>(vm.<span class="property">constructor</span>),</span><br><span class="line">        options || &#123;&#125;,</span><br><span class="line">        vm</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">    <span class="title function_">initLifecycle</span>(vm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–äº‹ä»¶</span></span><br><span class="line">    <span class="title function_">initEvents</span>(vm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ¸²æŸ“</span></span><br><span class="line">    <span class="title function_">initRender</span>(vm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è°ƒç”¨beforeCreateé’©å­</span></span><br><span class="line">    <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeCreate&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ³¨å…¥å†…å®¹</span></span><br><span class="line">    <span class="title function_">initInjections</span>(vm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line">    <span class="title function_">initState</span>(vm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æä¾›å†…å®¹</span></span><br><span class="line">    <span class="title function_">initProvide</span>(vm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è°ƒç”¨createdé’©å­</span></span><br><span class="line">    <span class="title function_">callHook</span>(vm, <span class="string">&#x27;created&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰elé€‰é¡¹ï¼Œè‡ªåŠ¨æŒ‚è½½</span></span><br><span class="line">    <span class="keyword">if</span> (vm.<span class="property">$options</span>.<span class="property">el</span>) &#123;</span><br><span class="line">      vm.$mount(vm.<span class="property">$options</span>.<span class="property">el</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-è™šæ‹ŸDOM-VNode"><a href="#2-2-è™šæ‹ŸDOM-VNode" class="headerlink" title="2.2 è™šæ‹ŸDOM (VNode)"></a>2.2 è™šæ‹ŸDOM (VNode)</h3><p>VNodeæ˜¯Vueä¸­è™šæ‹ŸDOMèŠ‚ç‚¹çš„è¡¨ç¤ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/vdom/vnode.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">VNode</span> &#123;</span><br><span class="line">  <span class="attr">tag</span>: string | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">data</span>: <span class="title class_">VNodeData</span> | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">children</span>: ?<span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt;</span><br><span class="line">  <span class="attr">text</span>: string | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">elm</span>: <span class="title class_">Node</span> | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">ns</span>: string | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">context</span>: <span class="title class_">Component</span> | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">key</span>: string | number | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">componentOptions</span>: <span class="title class_">VNodeComponentOptions</span> | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">componentInstance</span>: <span class="title class_">Component</span> | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">parent</span>: <span class="title class_">VNode</span> | <span class="keyword">void</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä»¥ä¸‹æ˜¯ä¸€äº›æ ‡å¿—ä½</span></span><br><span class="line">  <span class="attr">raw</span>: boolean</span><br><span class="line">  <span class="attr">isStatic</span>: boolean</span><br><span class="line">  <span class="attr">isRootInsert</span>: boolean</span><br><span class="line">  <span class="attr">isComment</span>: boolean</span><br><span class="line">  <span class="attr">isCloned</span>: boolean</span><br><span class="line">  <span class="attr">isOnce</span>: boolean</span><br><span class="line">  <span class="attr">asyncFactory</span>: <span class="title class_">Function</span> | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">asyncMeta</span>: <span class="title class_">Object</span> | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">isAsyncPlaceholder</span>: boolean</span><br><span class="line">  <span class="attr">ssrContext</span>: <span class="title class_">Object</span> | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">fnContext</span>: <span class="title class_">Component</span> | <span class="keyword">void</span></span><br><span class="line">  <span class="attr">fnOptions</span>: ?<span class="title class_">ComponentOptions</span></span><br><span class="line">  <span class="attr">fnScopeId</span>: ?string</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span> (<span class="params"></span></span><br><span class="line"><span class="params">    tag?: string,</span></span><br><span class="line"><span class="params">    data?: VNodeData,</span></span><br><span class="line"><span class="params">    children?: ?<span class="built_in">Array</span>&lt;VNode&gt;,</span></span><br><span class="line"><span class="params">    text?: string,</span></span><br><span class="line"><span class="params">    elm?: Node,</span></span><br><span class="line"><span class="params">    context?: Component,</span></span><br><span class="line"><span class="params">    componentOptions?: VNodeComponentOptions,</span></span><br><span class="line"><span class="params">    asyncFactory?: <span class="built_in">Function</span></span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tag</span> = tag</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = data</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">children</span> = children</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">text</span> = text</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">elm</span> = elm</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ns</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span> = context</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fnContext</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fnOptions</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fnScopeId</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = data &amp;&amp; data.<span class="property">key</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">componentOptions</span> = componentOptions</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">componentInstance</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">parent</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">raw</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isStatic</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isRootInsert</span> = <span class="literal">true</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isComment</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isCloned</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isOnce</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">asyncFactory</span> = asyncFactory</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">asyncMeta</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAsyncPlaceholder</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç”¨äºè°ƒè¯•</span></span><br><span class="line">  get <span class="title function_">child</span> (): <span class="title class_">Component</span> | <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">componentInstance</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-æ¸²æŸ“ä¸æ›´æ–°"><a href="#2-3-æ¸²æŸ“ä¸æ›´æ–°" class="headerlink" title="2.3 æ¸²æŸ“ä¸æ›´æ–°"></a>2.3 æ¸²æŸ“ä¸æ›´æ–°</h3><p>Vue 2çš„æ¸²æŸ“å’Œæ›´æ–°è¿‡ç¨‹ä¸»è¦æ¶‰åŠ<code>_render</code>å’Œ<code>_update</code>æ–¹æ³•ï¼š</p><h4 id="renderæ–¹æ³•"><a href="#renderæ–¹æ³•" class="headerlink" title="_renderæ–¹æ³•"></a>_renderæ–¹æ³•</h4><p><code>_render</code>æ–¹æ³•ç”¨äºç”Ÿæˆè™šæ‹ŸDOMï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/render.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_render</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> vm = <span class="variable language_">this</span></span><br><span class="line">  <span class="keyword">const</span> &#123; render, _parentVnode &#125; = vm.<span class="property">$options</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®çˆ¶VNode</span></span><br><span class="line">  <span class="keyword">if</span> (_parentVnode) &#123;</span><br><span class="line">    vm.<span class="property">$scopedSlots</span> = <span class="title function_">normalizeScopedSlots</span>(</span><br><span class="line">      _parentVnode.<span class="property">data</span>.<span class="property">scopedSlots</span>,</span><br><span class="line">      vm.<span class="property">$slots</span>,</span><br><span class="line">      vm.<span class="property">$scopedSlots</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">  vm.<span class="property">$vnode</span> = _parentVnode</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ¸²æŸ“VNode</span></span><br><span class="line">  <span class="keyword">let</span> vnode</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨renderå‡½æ•°ç”ŸæˆVNode</span></span><br><span class="line">    currentRenderingInstance = vm</span><br><span class="line">    vnode = render.<span class="title function_">call</span>(vm.<span class="property">_renderProxy</span>, vm.<span class="property">$createElement</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">handleError</span>(e, vm, <span class="string">`render`</span>)</span><br><span class="line">    <span class="comment">// æ¸²æŸ“é”™è¯¯æ—¶çš„å¤„ç†</span></span><br><span class="line">    vnode = vm.<span class="property">_vnode</span></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    currentRenderingInstance = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¦‚æœè¿”å›æ•°ç»„ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªFragmentèŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode) &amp;&amp; vnode.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    vnode = vnode[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¦‚æœrenderå‡½æ•°å‡ºé”™ï¼Œåˆ›å»ºç©ºVNode</span></span><br><span class="line">  <span class="keyword">if</span> (!(vnode <span class="keyword">instanceof</span> <span class="title class_">VNode</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode)) &#123;</span><br><span class="line">      <span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;Multiple root nodes returned from render function. Render function &#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;should return a single root node.&#x27;</span>,</span><br><span class="line">        vm</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    vnode = <span class="title function_">createEmptyVNode</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®¾ç½®çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">  vnode.<span class="property">parent</span> = _parentVnode</span><br><span class="line">  <span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="updateæ–¹æ³•"><a href="#updateæ–¹æ³•" class="headerlink" title="_updateæ–¹æ³•"></a>_updateæ–¹æ³•</h4><p><code>_update</code>æ–¹æ³•ç”¨äºå°†è™šæ‹ŸDOMæ¸²æŸ“ä¸ºçœŸå®DOMï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/lifecycle.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_update</span> = <span class="keyword">function</span> (<span class="params">vnode, hydrating</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> vm = <span class="variable language_">this</span></span><br><span class="line">  <span class="keyword">const</span> prevEl = vm.<span class="property">$el</span></span><br><span class="line">  <span class="keyword">const</span> prevVnode = vm.<span class="property">_vnode</span></span><br><span class="line">  <span class="keyword">const</span> restoreActiveInstance = <span class="title function_">setActiveInstance</span>(vm)</span><br><span class="line">  </span><br><span class="line">  vm.<span class="property">_vnode</span> = vnode</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é¦–æ¬¡æ¸²æŸ“</span></span><br><span class="line">  <span class="keyword">if</span> (!prevVnode) &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹æ¸²æŸ“</span></span><br><span class="line">    vm.<span class="property">$el</span> = vm.<span class="title function_">__patch__</span>(vm.<span class="property">$el</span>, vnode, hydrating, <span class="literal">false</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ›´æ–°</span></span><br><span class="line">    vm.<span class="property">$el</span> = vm.<span class="title function_">__patch__</span>(prevVnode, vnode)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">restoreActiveInstance</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ›´æ–°__vue__å¼•ç”¨</span></span><br><span class="line">  <span class="keyword">if</span> (prevEl) &#123;</span><br><span class="line">    prevEl.<span class="property">__vue__</span> = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">$el</span>) &#123;</span><br><span class="line">    vm.<span class="property">$el</span>.<span class="property">__vue__</span> = vm</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¦‚æœçˆ¶èŠ‚ç‚¹æ˜¯HOCï¼Œä¹Ÿæ›´æ–°å…¶$el</span></span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">$vnode</span> &amp;&amp; vm.<span class="property">$parent</span> &amp;&amp; vm.<span class="property">$vnode</span> === vm.<span class="property">$parent</span>.<span class="property">_vnode</span>) &#123;</span><br><span class="line">    vm.<span class="property">$parent</span>.<span class="property">$el</span> = vm.<span class="property">$el</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4-Patchç®—æ³•"><a href="#2-4-Patchç®—æ³•" class="headerlink" title="2.4 Patchç®—æ³•"></a>2.4 Patchç®—æ³•</h3><p>Patchç®—æ³•æ˜¯Vue 2ä¸­çš„æ ¸å¿ƒDiffç®—æ³•ï¼Œç”¨äºé«˜æ•ˆæ›´æ–°DOMï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/vdom/patch.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span> (<span class="params">oldVnode, vnode, hydrating, removeOnly</span>) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæ–°VNodeä¸å­˜åœ¨ä½†æ—§VNodeå­˜åœ¨ï¼Œåˆ™é”€æ¯æ—§VNode</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isUndef</span>(vnode)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldVnode)) <span class="title function_">invokeDestroyHook</span>(oldVnode)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> isInitialPatch = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">const</span> insertedVnodeQueue = []</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœæ—§VNodeä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°å…ƒç´ </span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldVnode)) &#123;</span><br><span class="line">    isInitialPatch = <span class="literal">true</span></span><br><span class="line">    <span class="title function_">createElm</span>(vnode, insertedVnodeQueue)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºçœŸå®DOM</span></span><br><span class="line">    <span class="keyword">const</span> isRealElement = <span class="title function_">isDef</span>(oldVnode.<span class="property">nodeType</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸æ˜¯çœŸå®DOMä¸”æ˜¯ç›¸åŒç±»å‹çš„VNode</span></span><br><span class="line">    <span class="keyword">if</span> (!isRealElement &amp;&amp; <span class="title function_">sameVnode</span>(oldVnode, vnode)) &#123;</span><br><span class="line">      <span class="comment">// æ›´æ–°å·²å­˜åœ¨çš„èŠ‚ç‚¹</span></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldVnode, vnode, insertedVnodeQueue, <span class="literal">null</span>, <span class="literal">null</span>, removeOnly)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æ˜¯çœŸå®DOMï¼Œåˆ›å»ºç©ºçš„VNode</span></span><br><span class="line">      <span class="keyword">if</span> (isRealElement) &#123;</span><br><span class="line">        <span class="comment">// æŒ‚è½½åˆ°çœŸå®å…ƒç´ ä¸Š</span></span><br><span class="line">        <span class="keyword">if</span> (oldVnode.<span class="property">nodeType</span> === <span class="number">1</span> &amp;&amp; oldVnode.<span class="title function_">hasAttribute</span>(<span class="variable constant_">SSR_ATTR</span>)) &#123;</span><br><span class="line">          oldVnode.<span class="title function_">removeAttribute</span>(<span class="variable constant_">SSR_ATTR</span>)</span><br><span class="line">          hydrating = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isTrue</span>(hydrating)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">hydrate</span>(oldVnode, vnode, insertedVnodeQueue)) &#123;</span><br><span class="line">            <span class="title function_">invokeInsertHook</span>(vnode, insertedVnodeQueue, <span class="literal">true</span>)</span><br><span class="line">            <span class="keyword">return</span> oldVnode</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸æ˜¯æœåŠ¡ç«¯æ¸²æŸ“æˆ–æ··åˆå¤±è´¥ï¼Œåˆ›å»ºç©ºVNode</span></span><br><span class="line">        oldVnode = <span class="title function_">emptyNodeAt</span>(oldVnode)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ›¿æ¢å·²å­˜åœ¨çš„å…ƒç´ </span></span><br><span class="line">      <span class="keyword">const</span> oldElm = oldVnode.<span class="property">elm</span></span><br><span class="line">      <span class="keyword">const</span> parentElm = nodeOps.<span class="title function_">parentNode</span>(oldElm)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">      <span class="title function_">createElm</span>(</span><br><span class="line">        vnode,</span><br><span class="line">        insertedVnodeQueue,</span><br><span class="line">        parentElm,</span><br><span class="line">        nodeOps.<span class="title function_">nextSibling</span>(oldElm)</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      <span class="comment">// é”€æ¯æ—§èŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isDef</span>(parentElm)) &#123;</span><br><span class="line">        <span class="title function_">removeVnodes</span>([oldVnode], <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldVnode.<span class="property">tag</span>)) &#123;</span><br><span class="line">        <span class="title function_">invokeDestroyHook</span>(oldVnode)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">invokeInsertHook</span>(vnode, insertedVnodeQueue, isInitialPatch)</span><br><span class="line">  <span class="keyword">return</span> vnode.<span class="property">elm</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="patchVnode"><a href="#patchVnode" class="headerlink" title="patchVnode"></a>patchVnode</h4><p><code>patchVnode</code>å‡½æ•°ç”¨äºæ›´æ–°å·²å­˜åœ¨çš„èŠ‚ç‚¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/vdom/patch.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">patchVnode</span> (<span class="params"></span></span><br><span class="line"><span class="params">  oldVnode,</span></span><br><span class="line"><span class="params">  vnode,</span></span><br><span class="line"><span class="params">  insertedVnodeQueue,</span></span><br><span class="line"><span class="params">  ownerArray,</span></span><br><span class="line"><span class="params">  index,</span></span><br><span class="line"><span class="params">  removeOnly</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæ–°æ—§VNodeç›¸åŒï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (oldVnode === vnode) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤ç”¨DOMå…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> elm = vnode.<span class="property">elm</span> = oldVnode.<span class="property">elm</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¼‚æ­¥å ä½ç¬¦</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isTrue</span>(oldVnode.<span class="property">isAsyncPlaceholder</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isDef</span>(vnode.<span class="property">asyncFactory</span>.<span class="property">resolved</span>)) &#123;</span><br><span class="line">      <span class="title function_">hydrate</span>(oldVnode.<span class="property">elm</span>, vnode, insertedVnodeQueue)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      vnode.<span class="property">isAsyncPlaceholder</span> = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é™æ€èŠ‚ç‚¹ä¼˜åŒ–</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isTrue</span>(vnode.<span class="property">isStatic</span>) &amp;&amp;</span><br><span class="line">    <span class="title function_">isTrue</span>(oldVnode.<span class="property">isStatic</span>) &amp;&amp;</span><br><span class="line">    vnode.<span class="property">key</span> === oldVnode.<span class="property">key</span> &amp;&amp;</span><br><span class="line">    (<span class="title function_">isTrue</span>(vnode.<span class="property">isCloned</span>) || <span class="title function_">isTrue</span>(vnode.<span class="property">isOnce</span>))</span><br><span class="line">  ) &#123;</span><br><span class="line">    vnode.<span class="property">componentInstance</span> = oldVnode.<span class="property">componentInstance</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ‰§è¡Œç»„ä»¶prepatché’©å­</span></span><br><span class="line">  <span class="keyword">let</span> i</span><br><span class="line">  <span class="keyword">const</span> data = vnode.<span class="property">data</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isDef</span>(data) &amp;&amp; <span class="title function_">isDef</span>(i = data.<span class="property">hook</span>) &amp;&amp; <span class="title function_">isDef</span>(i = i.<span class="property">prepatch</span>)) &#123;</span><br><span class="line">    <span class="title function_">i</span>(oldVnode, vnode)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–å­èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">const</span> oldCh = oldVnode.<span class="property">children</span></span><br><span class="line">  <span class="keyword">const</span> ch = vnode.<span class="property">children</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ‰§è¡Œæ›´æ–°é’©å­</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isDef</span>(data) &amp;&amp; <span class="title function_">isPatchable</span>(vnode)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; cbs.<span class="property">update</span>.<span class="property">length</span>; ++i) cbs.<span class="property">update</span>[i](oldVnode, vnode)</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isDef</span>(i = data.<span class="property">hook</span>) &amp;&amp; <span class="title function_">isDef</span>(i = i.<span class="property">update</span>)) <span class="title function_">i</span>(oldVnode, vnode)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¦‚æœæ–°VNodeæ²¡æœ‰æ–‡æœ¬</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isUndef</span>(vnode.<span class="property">text</span>)) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ–°æ—§VNodeéƒ½æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldCh) &amp;&amp; <span class="title function_">isDef</span>(ch)) &#123;</span><br><span class="line">      <span class="comment">// æ›´æ–°å­èŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">if</span> (oldCh !== ch) <span class="title function_">updateChildren</span>(elm, oldCh, ch, insertedVnodeQueue, removeOnly)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isDef</span>(ch)) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœåªæœ‰æ–°VNodeæœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldVnode.<span class="property">text</span>)) nodeOps.<span class="title function_">setTextContent</span>(elm, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      <span class="title function_">addVnodes</span>(elm, <span class="literal">null</span>, ch, <span class="number">0</span>, ch.<span class="property">length</span> - <span class="number">1</span>, insertedVnodeQueue)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldCh)) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœåªæœ‰æ—§VNodeæœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">      <span class="title function_">removeVnodes</span>(oldCh, <span class="number">0</span>, oldCh.<span class="property">length</span> - <span class="number">1</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldVnode.<span class="property">text</span>)) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæ—§VNodeæœ‰æ–‡æœ¬ï¼Œæ¸…ç©º</span></span><br><span class="line">      nodeOps.<span class="title function_">setTextContent</span>(elm, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldVnode.<span class="property">text</span> !== vnode.<span class="property">text</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ–‡æœ¬ä¸åŒï¼Œæ›´æ–°æ–‡æœ¬</span></span><br><span class="line">    nodeOps.<span class="title function_">setTextContent</span>(elm, vnode.<span class="property">text</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ‰§è¡Œpostpatché’©å­</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isDef</span>(data)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isDef</span>(i = data.<span class="property">hook</span>) &amp;&amp; <span class="title function_">isDef</span>(i = i.<span class="property">postpatch</span>)) <span class="title function_">i</span>(oldVnode, vnode)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="updateChildren"><a href="#updateChildren" class="headerlink" title="updateChildren"></a>updateChildren</h4><p><code>updateChildren</code>å‡½æ•°æ˜¯Vue 2ä¸­çš„æ ¸å¿ƒDiffç®—æ³•ï¼Œç”¨äºé«˜æ•ˆæ›´æ–°å­èŠ‚ç‚¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/vdom/patch.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateChildren</span> (<span class="params"></span></span><br><span class="line"><span class="params">  parentElm,</span></span><br><span class="line"><span class="params">  oldCh,</span></span><br><span class="line"><span class="params">  newCh,</span></span><br><span class="line"><span class="params">  insertedVnodeQueue,</span></span><br><span class="line"><span class="params">  removeOnly</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> oldStartIdx = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> newStartIdx = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> oldEndIdx = oldCh.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> oldStartVnode = oldCh[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">let</span> oldEndVnode = oldCh[oldEndIdx]</span><br><span class="line">  <span class="keyword">let</span> newEndIdx = newCh.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> newStartVnode = newCh[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">let</span> newEndVnode = newCh[newEndIdx]</span><br><span class="line">  <span class="keyword">let</span> oldKeyToIdx, idxInOld, vnodeToMove, refElm</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ˜¯å¦æ˜¯ç®€å•ç§»åŠ¨</span></span><br><span class="line">  <span class="keyword">const</span> canMove = !removeOnly</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŒç«¯æ¯”è¾ƒç®—æ³•</span></span><br><span class="line">  <span class="keyword">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldStartVnode)) &#123;</span><br><span class="line">      <span class="comment">// æ—§èµ·å§‹èŠ‚ç‚¹ä¸ºç©ºï¼Œç§»åŠ¨æŒ‡é’ˆ</span></span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldEndVnode)) &#123;</span><br><span class="line">      <span class="comment">// æ—§ç»“æŸèŠ‚ç‚¹ä¸ºç©ºï¼Œç§»åŠ¨æŒ‡é’ˆ</span></span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldStartVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="comment">// æ—§èµ·å§‹å’Œæ–°èµ·å§‹èŠ‚ç‚¹ç›¸åŒ</span></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldStartVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldEndVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="comment">// æ—§ç»“æŸå’Œæ–°ç»“æŸèŠ‚ç‚¹ç›¸åŒ</span></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldEndVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">      newEndVnode = newCh[--newEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldStartVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="comment">// æ—§èµ·å§‹å’Œæ–°ç»“æŸèŠ‚ç‚¹ç›¸åŒ</span></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldStartVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)</span><br><span class="line">      <span class="comment">// å°†æ—§èµ·å§‹èŠ‚ç‚¹ç§»åŠ¨åˆ°æœ€å</span></span><br><span class="line">      canMove &amp;&amp; nodeOps.<span class="title function_">insertBefore</span>(parentElm, oldStartVnode.<span class="property">elm</span>, nodeOps.<span class="title function_">nextSibling</span>(oldEndVnode.<span class="property">elm</span>))</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">      newEndVnode = newCh[--newEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldEndVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="comment">// æ—§ç»“æŸå’Œæ–°èµ·å§‹èŠ‚ç‚¹ç›¸åŒ</span></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldEndVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">      <span class="comment">// å°†æ—§ç»“æŸèŠ‚ç‚¹ç§»åŠ¨åˆ°æœ€å‰</span></span><br><span class="line">      canMove &amp;&amp; nodeOps.<span class="title function_">insertBefore</span>(parentElm, oldEndVnode.<span class="property">elm</span>, oldStartVnode.<span class="property">elm</span>)</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ä»¥ä¸Šå››ç§æƒ…å†µéƒ½ä¸æ»¡è¶³</span></span><br><span class="line">      <span class="comment">// åˆ›å»ºkeyåˆ°ç´¢å¼•çš„æ˜ å°„</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldKeyToIdx)) oldKeyToIdx = <span class="title function_">createKeyToOldIdx</span>(oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">      <span class="comment">// åœ¨æ—§å­èŠ‚ç‚¹ä¸­æŸ¥æ‰¾æ–°èµ·å§‹èŠ‚ç‚¹çš„ä½ç½®</span></span><br><span class="line">      idxInOld = <span class="title function_">isDef</span>(newStartVnode.<span class="property">key</span>)</span><br><span class="line">        ? oldKeyToIdx[newStartVnode.<span class="property">key</span>]</span><br><span class="line">        : <span class="title function_">findIdxInOld</span>(newStartVnode, oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// å¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ›å»ºæ–°å…ƒç´ </span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isUndef</span>(idxInOld)) &#123;</span><br><span class="line">        <span class="title function_">createElm</span>(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.<span class="property">elm</span>, <span class="literal">false</span>, newCh, newStartIdx)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°äº†ï¼Œè·å–è¦ç§»åŠ¨çš„èŠ‚ç‚¹</span></span><br><span class="line">        vnodeToMove = oldCh[idxInOld]</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(vnodeToMove, newStartVnode)) &#123;</span><br><span class="line">          <span class="comment">// èŠ‚ç‚¹ç›¸åŒï¼Œè¿›è¡Œpatch</span></span><br><span class="line">          <span class="title function_">patchVnode</span>(vnodeToMove, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">          oldCh[idxInOld] = <span class="literal">undefined</span></span><br><span class="line">          <span class="comment">// ç§»åŠ¨èŠ‚ç‚¹</span></span><br><span class="line">          canMove &amp;&amp; nodeOps.<span class="title function_">insertBefore</span>(parentElm, vnodeToMove.<span class="property">elm</span>, oldStartVnode.<span class="property">elm</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// ç›¸åŒkeyä½†ä¸æ˜¯ç›¸åŒèŠ‚ç‚¹ï¼Œåˆ›å»ºæ–°å…ƒç´ </span></span><br><span class="line">          <span class="title function_">createElm</span>(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.<span class="property">elm</span>, <span class="literal">false</span>, newCh, newStartIdx)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¤„ç†å‰©ä½™èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class="line">    <span class="comment">// æ—§å­èŠ‚ç‚¹å¤„ç†å®Œï¼Œæ·»åŠ å‰©ä½™çš„æ–°å­èŠ‚ç‚¹</span></span><br><span class="line">    refElm = <span class="title function_">isUndef</span>(newCh[newEndIdx + <span class="number">1</span>]) ? <span class="literal">null</span> : newCh[newEndIdx + <span class="number">1</span>].<span class="property">elm</span></span><br><span class="line">    <span class="title function_">addVnodes</span>(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newStartIdx &gt; newEndIdx) &#123;</span><br><span class="line">    <span class="comment">// æ–°å­èŠ‚ç‚¹å¤„ç†å®Œï¼Œç§»é™¤å‰©ä½™çš„æ—§å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="title function_">removeVnodes</span>(oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€ç”Ÿå‘½å‘¨æœŸä¸æŒ‡ä»¤ç³»ç»Ÿ"><a href="#ä¸‰ã€ç”Ÿå‘½å‘¨æœŸä¸æŒ‡ä»¤ç³»ç»Ÿ" class="headerlink" title="ä¸‰ã€ç”Ÿå‘½å‘¨æœŸä¸æŒ‡ä»¤ç³»ç»Ÿ"></a>ä¸‰ã€ç”Ÿå‘½å‘¨æœŸä¸æŒ‡ä»¤ç³»ç»Ÿ</h2><h3 id="3-1-ç”Ÿå‘½å‘¨æœŸé’©å­"><a href="#3-1-ç”Ÿå‘½å‘¨æœŸé’©å­" class="headerlink" title="3.1 ç”Ÿå‘½å‘¨æœŸé’©å­"></a>3.1 ç”Ÿå‘½å‘¨æœŸé’©å­</h3><p>Vue 2çš„ç”Ÿå‘½å‘¨æœŸé’©å­æ˜¯åœ¨ç‰¹å®šé˜¶æ®µè°ƒç”¨çš„å‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/lifecycle.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">callHook</span> (<span class="params">vm, hook</span>) &#123;</span><br><span class="line">  <span class="comment">// ç¦ç”¨ä¾èµ–æ”¶é›†</span></span><br><span class="line">  <span class="title function_">pushTarget</span>()</span><br><span class="line">  <span class="keyword">const</span> handlers = vm.<span class="property">$options</span>[hook]</span><br><span class="line">  <span class="keyword">const</span> info = <span class="string">`<span class="subst">$&#123;hook&#125;</span> hook`</span></span><br><span class="line">  <span class="keyword">if</span> (handlers) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, j = handlers.<span class="property">length</span>; i &lt; j; i++) &#123;</span><br><span class="line">      <span class="title function_">invokeWithErrorHandling</span>(handlers[i], vm, <span class="literal">null</span>, vm, info)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">_hasHookEvent</span>) &#123;</span><br><span class="line">    vm.$emit(<span class="string">&#x27;hook:&#x27;</span> + hook)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">popTarget</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿå‘½å‘¨æœŸé’©å­çš„è°ƒç”¨æ—¶æœºï¼š</p><ol><li><strong>beforeCreate</strong>: åœ¨å®ä¾‹åˆå§‹åŒ–ä¹‹åï¼Œæ•°æ®è§‚æµ‹å’Œäº‹ä»¶é…ç½®ä¹‹å‰</li><li><strong>created</strong>: åœ¨å®ä¾‹åˆ›å»ºå®Œæˆåï¼Œæ•°æ®è§‚æµ‹ã€å±æ€§å’Œæ–¹æ³•çš„è¿ç®—ï¼Œwatch&#x2F;eventäº‹ä»¶å›è°ƒå·²å®Œæˆ</li><li><strong>beforeMount</strong>: åœ¨æŒ‚è½½å¼€å§‹ä¹‹å‰è¢«è°ƒç”¨</li><li><strong>mounted</strong>: åœ¨æŒ‚è½½å®Œæˆåè°ƒç”¨</li><li><strong>beforeUpdate</strong>: æ•°æ®æ›´æ–°æ—¶è°ƒç”¨ï¼Œå‘ç”Ÿåœ¨è™šæ‹ŸDOMé‡æ–°æ¸²æŸ“å’Œæ‰“è¡¥ä¸ä¹‹å‰</li><li><strong>updated</strong>: æ•°æ®æ›´æ”¹å¯¼è‡´çš„è™šæ‹ŸDOMé‡æ–°æ¸²æŸ“å’Œæ‰“è¡¥ä¸ä¹‹åè°ƒç”¨</li><li><strong>beforeDestroy</strong>: å®ä¾‹é”€æ¯ä¹‹å‰è°ƒç”¨</li><li><strong>destroyed</strong>: å®ä¾‹é”€æ¯åè°ƒç”¨</li></ol><h3 id="3-2-æŒ‡ä»¤ç³»ç»Ÿ"><a href="#3-2-æŒ‡ä»¤ç³»ç»Ÿ" class="headerlink" title="3.2 æŒ‡ä»¤ç³»ç»Ÿ"></a>3.2 æŒ‡ä»¤ç³»ç»Ÿ</h3><p>Vue 2çš„æŒ‡ä»¤ç³»ç»Ÿå…è®¸å¼€å‘è€…æ‰©å±•HTMLçš„åŠŸèƒ½ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/vdom/modules/directives.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">create</span>: updateDirectives,</span><br><span class="line">  <span class="attr">update</span>: updateDirectives,</span><br><span class="line">  <span class="attr">destroy</span>: <span class="keyword">function</span> <span class="title function_">unbindDirectives</span> (<span class="params">vnode</span>) &#123;</span><br><span class="line">    <span class="title function_">updateDirectives</span>(vnode, emptyNode)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateDirectives</span> (<span class="params">oldVnode, vnode</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (oldVnode.<span class="property">data</span>.<span class="property">directives</span> || vnode.<span class="property">data</span>.<span class="property">directives</span>) &#123;</span><br><span class="line">    <span class="title function_">_update</span>(oldVnode, vnode)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_update</span> (<span class="params">oldVnode, vnode</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> isCreate = oldVnode === emptyNode</span><br><span class="line">  <span class="keyword">const</span> isDestroy = vnode === emptyNode</span><br><span class="line">  <span class="keyword">const</span> oldDirs = <span class="title function_">normalizeDirectives</span>(oldVnode.<span class="property">data</span>.<span class="property">directives</span>, oldVnode.<span class="property">context</span>)</span><br><span class="line">  <span class="keyword">const</span> newDirs = <span class="title function_">normalizeDirectives</span>(vnode.<span class="property">data</span>.<span class="property">directives</span>, vnode.<span class="property">context</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dirsWithInsert = []</span><br><span class="line">  <span class="keyword">const</span> dirsWithPostpatch = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> key, oldDir, dir</span><br><span class="line">  <span class="keyword">for</span> (key <span class="keyword">in</span> newDirs) &#123;</span><br><span class="line">    oldDir = oldDirs[key]</span><br><span class="line">    dir = newDirs[key]</span><br><span class="line">    <span class="keyword">if</span> (!oldDir) &#123;</span><br><span class="line">      <span class="comment">// æ–°æŒ‡ä»¤ï¼Œè°ƒç”¨bind</span></span><br><span class="line">      <span class="title function_">callHook</span>(dir, <span class="string">&#x27;bind&#x27;</span>, vnode, oldVnode)</span><br><span class="line">      <span class="keyword">if</span> (dir.<span class="property">def</span> &amp;&amp; dir.<span class="property">def</span>.<span class="property">inserted</span>) &#123;</span><br><span class="line">        dirsWithInsert.<span class="title function_">push</span>(dir)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å·²å­˜åœ¨çš„æŒ‡ä»¤ï¼Œè°ƒç”¨update</span></span><br><span class="line">      dir.<span class="property">oldValue</span> = oldDir.<span class="property">value</span></span><br><span class="line">      dir.<span class="property">oldArg</span> = oldDir.<span class="property">arg</span></span><br><span class="line">      <span class="title function_">callHook</span>(dir, <span class="string">&#x27;update&#x27;</span>, vnode, oldVnode)</span><br><span class="line">      <span class="keyword">if</span> (dir.<span class="property">def</span> &amp;&amp; dir.<span class="property">def</span>.<span class="property">componentUpdated</span>) &#123;</span><br><span class="line">        dirsWithPostpatch.<span class="title function_">push</span>(dir)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†éœ€è¦insertedé’©å­çš„æŒ‡ä»¤</span></span><br><span class="line">  <span class="keyword">if</span> (dirsWithInsert.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">callInsert</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dirsWithInsert.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="title function_">callHook</span>(dirsWithInsert[i], <span class="string">&#x27;inserted&#x27;</span>, vnode, oldVnode)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isCreate) &#123;</span><br><span class="line">      <span class="title function_">mergeVNodeHook</span>(vnode, <span class="string">&#x27;insert&#x27;</span>, callInsert)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">callInsert</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†éœ€è¦componentUpdatedé’©å­çš„æŒ‡ä»¤</span></span><br><span class="line">  <span class="keyword">if</span> (dirsWithPostpatch.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="title function_">mergeVNodeHook</span>(vnode, <span class="string">&#x27;postpatch&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dirsWithPostpatch.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="title function_">callHook</span>(dirsWithPostpatch[i], <span class="string">&#x27;componentUpdated&#x27;</span>, vnode, oldVnode)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†éœ€è¦è§£ç»‘çš„æŒ‡ä»¤</span></span><br><span class="line">  <span class="keyword">if</span> (!isCreate) &#123;</span><br><span class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> oldDirs) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!newDirs[key]) &#123;</span><br><span class="line">        <span class="comment">// ä¸å†å­˜åœ¨çš„æŒ‡ä»¤ï¼Œè°ƒç”¨unbind</span></span><br><span class="line">        <span class="title function_">callHook</span>(oldDirs[key], <span class="string">&#x27;unbind&#x27;</span>, oldVnode, oldVnode, isDestroy)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››ã€ç¼–è¯‘å™¨ä¸æ¨¡æ¿è§£æ"><a href="#å››ã€ç¼–è¯‘å™¨ä¸æ¨¡æ¿è§£æ" class="headerlink" title="å››ã€ç¼–è¯‘å™¨ä¸æ¨¡æ¿è§£æ"></a>å››ã€ç¼–è¯‘å™¨ä¸æ¨¡æ¿è§£æ</h2><p>Vue 2çš„ç¼–è¯‘å™¨è´Ÿè´£å°†æ¨¡æ¿è½¬æ¢ä¸ºæ¸²æŸ“å‡½æ•°ã€‚</p><h3 id="4-1-ç¼–è¯‘è¿‡ç¨‹"><a href="#4-1-ç¼–è¯‘è¿‡ç¨‹" class="headerlink" title="4.1 ç¼–è¯‘è¿‡ç¨‹"></a>4.1 ç¼–è¯‘è¿‡ç¨‹</h3><p>ç¼–è¯‘è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬è§£æ(parse)ã€ä¼˜åŒ–(optimize)å’Œç”Ÿæˆ(generate)ä¸‰ä¸ªé˜¶æ®µï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/compiler/index.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">compile</span> (<span class="params"></span></span><br><span class="line"><span class="params">  template,</span></span><br><span class="line"><span class="params">  options</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> finalOptions = <span class="title class_">Object</span>.<span class="title function_">create</span>(baseOptions)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆå¹¶é€‰é¡¹</span></span><br><span class="line">  <span class="keyword">if</span> (options) &#123;</span><br><span class="line">    <span class="comment">// åˆå¹¶è‡ªå®šä¹‰æ¨¡å—</span></span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">modules</span>) &#123;</span><br><span class="line">      finalOptions.<span class="property">modules</span> =</span><br><span class="line">        (baseOptions.<span class="property">modules</span> || []).<span class="title function_">concat</span>(options.<span class="property">modules</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆå¹¶æŒ‡ä»¤</span></span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">directives</span>) &#123;</span><br><span class="line">      finalOptions.<span class="property">directives</span> = <span class="title function_">extend</span>(</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">create</span>(baseOptions.<span class="property">directives</span> || <span class="literal">null</span>),</span><br><span class="line">        options.<span class="property">directives</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤åˆ¶å…¶ä»–é€‰é¡¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> options) &#123;</span><br><span class="line">      <span class="keyword">if</span> (key !== <span class="string">&#x27;modules&#x27;</span> &amp;&amp; key !== <span class="string">&#x27;directives&#x27;</span>) &#123;</span><br><span class="line">        finalOptions[key] = options[key]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¼–è¯‘æ¨¡æ¿</span></span><br><span class="line">  <span class="keyword">const</span> compiled = <span class="title function_">baseCompile</span>(template.<span class="title function_">trim</span>(), finalOptions)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ£€æŸ¥é”™è¯¯</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_">detectErrors</span>(compiled.<span class="property">ast</span>, warn)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  compiled.<span class="property">errors</span> = errors</span><br><span class="line">  compiled.<span class="property">tips</span> = tips</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> compiled</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºç¡€ç¼–è¯‘å‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">baseCompile</span> (<span class="params"></span></span><br><span class="line"><span class="params">  template,</span></span><br><span class="line"><span class="params">  options</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// è§£ææ¨¡æ¿ä¸ºAST</span></span><br><span class="line">  <span class="keyword">const</span> ast = <span class="title function_">parse</span>(template.<span class="title function_">trim</span>(), options)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¼˜åŒ–AST</span></span><br><span class="line">  <span class="keyword">if</span> (options.<span class="property">optimize</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="title function_">optimize</span>(ast, options)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç”Ÿæˆä»£ç </span></span><br><span class="line">  <span class="keyword">const</span> code = <span class="title function_">generate</span>(ast, options)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ast,</span><br><span class="line">    <span class="attr">render</span>: code.<span class="property">render</span>,</span><br><span class="line">    <span class="attr">staticRenderFns</span>: code.<span class="property">staticRenderFns</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-è§£æ-Parse"><a href="#4-2-è§£æ-Parse" class="headerlink" title="4.2 è§£æ(Parse)"></a>4.2 è§£æ(Parse)</h3><p>è§£æé˜¶æ®µå°†æ¨¡æ¿å­—ç¬¦ä¸²è½¬æ¢ä¸ºæŠ½è±¡è¯­æ³•æ ‘(AST)ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/compiler/parser/index.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">parse</span> (<span class="params"></span></span><br><span class="line"><span class="params">  template,</span></span><br><span class="line"><span class="params">  options</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// è§£æé€‰é¡¹</span></span><br><span class="line">  <span class="keyword">const</span> stack = []</span><br><span class="line">  <span class="keyword">let</span> root</span><br><span class="line">  <span class="keyword">let</span> currentParent</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// HTMLè§£æå™¨</span></span><br><span class="line">  <span class="title function_">parseHTML</span>(template, &#123;</span><br><span class="line">    <span class="title function_">start</span> (tag, attrs, unary, start, end) &#123;</span><br><span class="line">      <span class="comment">// å¤„ç†å¼€å§‹æ ‡ç­¾</span></span><br><span class="line">      <span class="keyword">const</span> element = <span class="title function_">createASTElement</span>(tag, attrs, currentParent)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// å¤„ç†æŒ‡ä»¤</span></span><br><span class="line">      <span class="title function_">processFor</span>(element)</span><br><span class="line">      <span class="title function_">processIf</span>(element)</span><br><span class="line">      <span class="title function_">processOnce</span>(element)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ ‘ç®¡ç†</span></span><br><span class="line">      <span class="keyword">if</span> (!root) &#123;</span><br><span class="line">        root = element</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (currentParent &amp;&amp; !element.<span class="property">forbidden</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (element.<span class="property">elseif</span> || element.<span class="property">else</span>) &#123;</span><br><span class="line">          <span class="title function_">processIfConditions</span>(element, currentParent)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (element.<span class="property">slotScope</span>) &#123;</span><br><span class="line">            <span class="comment">// ä½œç”¨åŸŸæ’æ§½</span></span><br><span class="line">            <span class="keyword">const</span> name = element.<span class="property">slotTarget</span> || <span class="string">&#x27;&quot;default&quot;&#x27;</span></span><br><span class="line">            ;(currentParent.<span class="property">scopedSlots</span> || (currentParent.<span class="property">scopedSlots</span> = &#123;&#125;))[name] = element</span><br><span class="line">          &#125;</span><br><span class="line">          currentParent.<span class="property">children</span>.<span class="title function_">push</span>(element)</span><br><span class="line">          element.<span class="property">parent</span> = currentParent</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// éè‡ªé—­åˆæ ‡ç­¾å…¥æ ˆ</span></span><br><span class="line">      <span class="keyword">if</span> (!unary) &#123;</span><br><span class="line">        currentParent = element</span><br><span class="line">        stack.<span class="title function_">push</span>(element)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">closeElement</span>(element)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">end</span> (tag, start, end) &#123;</span><br><span class="line">      <span class="comment">// å¤„ç†ç»“æŸæ ‡ç­¾</span></span><br><span class="line">      <span class="keyword">const</span> element = stack[stack.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">      <span class="comment">// å¼¹å‡ºæ ˆ</span></span><br><span class="line">      stack.<span class="property">length</span> -= <span class="number">1</span></span><br><span class="line">      currentParent = stack[stack.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">      <span class="title function_">closeElement</span>(element)</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">chars</span> (text, start, end) &#123;</span><br><span class="line">      <span class="comment">// å¤„ç†æ–‡æœ¬å†…å®¹</span></span><br><span class="line">      <span class="keyword">if</span> (!currentParent) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> children = currentParent.<span class="property">children</span></span><br><span class="line">      <span class="keyword">if</span> (text) &#123;</span><br><span class="line">        <span class="keyword">let</span> res</span><br><span class="line">        <span class="keyword">let</span> child</span><br><span class="line">        <span class="keyword">if</span> (text !== <span class="string">&#x27; &#x27;</span> &amp;&amp; (res = <span class="title function_">parseText</span>(text, delimiters))) &#123;</span><br><span class="line">          <span class="comment">// å¸¦è¡¨è¾¾å¼çš„æ–‡æœ¬</span></span><br><span class="line">          child = &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">expression</span>: res.<span class="property">expression</span>,</span><br><span class="line">            <span class="attr">tokens</span>: res.<span class="property">tokens</span>,</span><br><span class="line">            text</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (text !== <span class="string">&#x27; &#x27;</span> || !children.<span class="property">length</span> || children[children.<span class="property">length</span> - <span class="number">1</span>].<span class="property">text</span> !== <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">          <span class="comment">// çº¯æ–‡æœ¬</span></span><br><span class="line">          child = &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="number">3</span>,</span><br><span class="line">            text</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (child) &#123;</span><br><span class="line">          children.<span class="title function_">push</span>(child)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">comment</span> (text, start, end) &#123;</span><br><span class="line">      <span class="comment">// å¤„ç†æ³¨é‡Š</span></span><br><span class="line">      <span class="keyword">if</span> (currentParent) &#123;</span><br><span class="line">        <span class="keyword">const</span> child = &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="number">3</span>,</span><br><span class="line">          text,</span><br><span class="line">          <span class="attr">isComment</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        currentParent.<span class="property">children</span>.<span class="title function_">push</span>(child)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-ä¼˜åŒ–-Optimize"><a href="#4-3-ä¼˜åŒ–-Optimize" class="headerlink" title="4.3 ä¼˜åŒ–(Optimize)"></a>4.3 ä¼˜åŒ–(Optimize)</h3><p>ä¼˜åŒ–é˜¶æ®µæ ‡è®°é™æ€èŠ‚ç‚¹ï¼Œæé«˜æ¸²æŸ“æ€§èƒ½ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/compiler/optimizer.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">optimize</span> (<span class="params">root, options</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!root) <span class="keyword">return</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ ‡è®°é™æ€èŠ‚ç‚¹</span></span><br><span class="line">  <span class="title function_">markStatic</span>(root)</span><br><span class="line">  <span class="comment">// æ ‡è®°é™æ€æ ¹èŠ‚ç‚¹</span></span><br><span class="line">  <span class="title function_">markStaticRoots</span>(root, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">markStatic</span> (<span class="params">node</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦é™æ€</span></span><br><span class="line">  node.<span class="property">static</span> = <span class="title function_">isStatic</span>(node)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (node.<span class="property">type</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// ä¸è¦å°†ç»„ä»¶æ’æ§½å†…å®¹æ ‡è®°ä¸ºé™æ€</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !<span class="title function_">isPlatformReservedTag</span>(node.<span class="property">tag</span>) &amp;&amp;</span><br><span class="line">      node.<span class="property">tag</span> !== <span class="string">&#x27;slot&#x27;</span> &amp;&amp;</span><br><span class="line">      node.<span class="property">attrsMap</span>[<span class="string">&#x27;inline-template&#x27;</span>] == <span class="literal">null</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€’å½’å¤„ç†å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = node.<span class="property">children</span>.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> child = node.<span class="property">children</span>[i]</span><br><span class="line">      <span class="title function_">markStatic</span>(child)</span><br><span class="line">      <span class="comment">// å¦‚æœå­èŠ‚ç‚¹ä¸æ˜¯é™æ€çš„ï¼Œçˆ¶èŠ‚ç‚¹ä¹Ÿä¸æ˜¯</span></span><br><span class="line">      <span class="keyword">if</span> (!child.<span class="property">static</span>) &#123;</span><br><span class="line">        node.<span class="property">static</span> = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†æ¡ä»¶èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (node.<span class="property">ifConditions</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>, l = node.<span class="property">ifConditions</span>.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> block = node.<span class="property">ifConditions</span>[i].<span class="property">block</span></span><br><span class="line">        <span class="title function_">markStatic</span>(block)</span><br><span class="line">        <span class="keyword">if</span> (!block.<span class="property">static</span>) &#123;</span><br><span class="line">          node.<span class="property">static</span> = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">markStaticRoots</span> (<span class="params">node, isInFor</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (node.<span class="property">type</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// é™æ€èŠ‚ç‚¹æˆ–æœ‰v-onceæŒ‡ä»¤</span></span><br><span class="line">    <span class="keyword">if</span> (node.<span class="property">static</span> || node.<span class="property">once</span>) &#123;</span><br><span class="line">      node.<span class="property">staticInFor</span> = isInFor</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹äºæœ‰å­èŠ‚ç‚¹ä¸”å­èŠ‚ç‚¹ä¸åªæ˜¯æ–‡æœ¬çš„é™æ€èŠ‚ç‚¹ï¼Œæ ‡è®°ä¸ºé™æ€æ ¹</span></span><br><span class="line">    <span class="keyword">if</span> (node.<span class="property">static</span> &amp;&amp; node.<span class="property">children</span>.<span class="property">length</span> &amp;&amp; !(</span><br><span class="line">      node.<span class="property">children</span>.<span class="property">length</span> === <span class="number">1</span> &amp;&amp;</span><br><span class="line">      node.<span class="property">children</span>[<span class="number">0</span>].<span class="property">type</span> === <span class="number">3</span></span><br><span class="line">    )) &#123;</span><br><span class="line">      node.<span class="property">staticRoot</span> = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      node.<span class="property">staticRoot</span> = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€’å½’å¤„ç†å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (node.<span class="property">children</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = node.<span class="property">children</span>.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">        <span class="title function_">markStaticRoots</span>(node.<span class="property">children</span>[i], isInFor || !!node.<span class="property">for</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†æ¡ä»¶èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (node.<span class="property">ifConditions</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>, l = node.<span class="property">ifConditions</span>.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">        <span class="title function_">markStaticRoots</span>(node.<span class="property">ifConditions</span>[i].<span class="property">block</span>, isInFor)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4-ç”Ÿæˆ-Generate"><a href="#4-4-ç”Ÿæˆ-Generate" class="headerlink" title="4.4 ç”Ÿæˆ(Generate)"></a>4.4 ç”Ÿæˆ(Generate)</h3><p>ç”Ÿæˆé˜¶æ®µå°†ASTè½¬æ¢ä¸ºæ¸²æŸ“å‡½æ•°ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/compiler/codegen/index.js (ç®€åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">generate</span> (<span class="params"></span></span><br><span class="line"><span class="params">  ast,</span></span><br><span class="line"><span class="params">  options</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> state = <span class="keyword">new</span> <span class="title class_">CodegenState</span>(options)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ ¹æ®ASTç”Ÿæˆä»£ç </span></span><br><span class="line">  <span class="keyword">const</span> code = ast ? <span class="title function_">genElement</span>(ast, state) : <span class="string">&#x27;_c(&quot;div&quot;)&#x27;</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="string">`with(this)&#123;return <span class="subst">$&#123;code&#125;</span>&#125;`</span>,</span><br><span class="line">    <span class="attr">staticRenderFns</span>: state.<span class="property">staticRenderFns</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">genElement</span> (<span class="params">el, state</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (el.<span class="property">parent</span>) &#123;</span><br><span class="line">    el.<span class="property">pre</span> = el.<span class="property">pre</span> || el.<span class="property">parent</span>.<span class="property">pre</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†é™æ€æ ¹èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (el.<span class="property">staticRoot</span> &amp;&amp; !el.<span class="property">staticProcessed</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genStatic</span>(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">once</span> &amp;&amp; !el.<span class="property">onceProcessed</span>) &#123;</span><br><span class="line">    <span class="comment">// v-once</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genOnce</span>(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">for</span> &amp;&amp; !el.<span class="property">forProcessed</span>) &#123;</span><br><span class="line">    <span class="comment">// v-for</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genFor</span>(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">if</span> &amp;&amp; !el.<span class="property">ifProcessed</span>) &#123;</span><br><span class="line">    <span class="comment">// v-if</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genIf</span>(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">tag</span> === <span class="string">&#x27;template&#x27;</span> &amp;&amp; !el.<span class="property">slotTarget</span> &amp;&amp; !state.<span class="property">pre</span>) &#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ¿</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genChildren</span>(el, state) || <span class="string">&#x27;void 0&#x27;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">tag</span> === <span class="string">&#x27;slot&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// æ’æ§½</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genSlot</span>(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ç»„ä»¶æˆ–å…ƒç´ </span></span><br><span class="line">    <span class="keyword">let</span> code</span><br><span class="line">    <span class="keyword">if</span> (el.<span class="property">component</span>) &#123;</span><br><span class="line">      <span class="comment">// ç»„ä»¶</span></span><br><span class="line">      code = <span class="title function_">genComponent</span>(el.<span class="property">component</span>, el, state)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> data</span><br><span class="line">      <span class="keyword">if</span> (!el.<span class="property">plain</span> || (el.<span class="property">pre</span> &amp;&amp; state.<span class="title function_">maybeComponent</span>(el))) &#123;</span><br><span class="line">        <span class="comment">// ç”Ÿæˆå…ƒç´ æ•°æ®</span></span><br><span class="line">        data = <span class="title function_">genData</span>(el, state)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> children = el.<span class="property">inlineTemplate</span> ? <span class="literal">null</span> : <span class="title function_">genChildren</span>(el, state, <span class="literal">true</span>)</span><br><span class="line">      code = <span class="string">`_c(&#x27;<span class="subst">$&#123;el.tag&#125;</span>&#x27;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        data ? <span class="string">`,<span class="subst">$&#123;data&#125;</span>`</span> : <span class="string">&#x27;&#x27;</span> // æ•°æ®</span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;</span><span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        children ? <span class="string">`,<span class="subst">$&#123;children&#125;</span>`</span> : <span class="string">&#x27;&#x27;</span> // å­èŠ‚ç‚¹</span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;</span>)`</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¨¡å—è½¬æ¢</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; state.<span class="property">transforms</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      code = state.<span class="property">transforms</span>[i](el, code)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Vue 2æºç çš„æ ¸å¿ƒäº®ç‚¹ï¼š</p><ol><li><strong>å“åº”å¼ç³»ç»Ÿ</strong>ï¼šåŸºäºObject.definePropertyçš„æ•°æ®åŠ«æŒå’Œå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œå®ç°æ•°æ®ä¸è§†å›¾çš„è‡ªåŠ¨åŒæ­¥</li><li><strong>è™šæ‹ŸDOM</strong>ï¼šé€šè¿‡JavaScriptå¯¹è±¡è¡¨ç¤ºDOMç»“æ„ï¼Œé…åˆé«˜æ•ˆçš„Diffç®—æ³•å®ç°æœ€å°åŒ–DOMæ“ä½œ</li><li><strong>ç»„ä»¶ç³»ç»Ÿ</strong>ï¼šç»„ä»¶æ˜¯Vueçš„æ ¸å¿ƒæŠ½è±¡ï¼Œæä¾›äº†ç»„åˆã€å¤ç”¨å’Œå°è£…çš„èƒ½åŠ›</li><li><strong>ç¼–è¯‘ç³»ç»Ÿ</strong>ï¼šå°†æ¨¡æ¿ç¼–è¯‘ä¸ºæ¸²æŸ“å‡½æ•°ï¼Œæ”¯æŒæŒ‡ä»¤ã€æ’å€¼ç­‰ç‰¹æ€§</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šæä¾›å®Œæ•´çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œæ–¹ä¾¿å¼€å‘è€…åœ¨ä¸åŒé˜¶æ®µæ‰§è¡Œé€»è¾‘</li></ol><p>Vue 2çš„æºç è®¾è®¡ä½“ç°äº†ä¼˜ç§€çš„å‰ç«¯æ¡†æ¶æ¶æ„æ€æƒ³ï¼Œé€šè¿‡æ·±å…¥ç†è§£å…¶å®ç°åŸç†ï¼Œå¯ä»¥æ›´å¥½åœ°ä½¿ç”¨Vueè¿›è¡Œå¼€å‘ï¼Œä¹Ÿèƒ½å­¦ä¹ åˆ°å¾ˆå¤šå‰ç«¯å·¥ç¨‹åŒ–çš„æœ€ä½³å®è·µã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ç›®å½•ç»“æ„&quot;&gt;&lt;a href=&quot;#ç›®å½•ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;ç›®å½•ç»“æ„&quot;&gt;&lt;/a&gt;ç›®å½•ç»“æ„&lt;/h2&gt;&lt;p&gt;Vue 2çš„æºç é‡‡ç”¨å…¸å‹çš„æ¨¡å—åŒ–ç»“æ„ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;core&lt;/strong&gt;: æ ¸å¿ƒä»£ç ï¼ŒåŒ…å«å“åº”å¼ç³»ç»Ÿã€è™šæ‹ŸDOMã€ç»„ä»¶ç³»ç»Ÿç­‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;platforms&lt;/strong&gt;: å¹³å°ç‰¹å®šä»£ç ï¼ŒåŒ…æ‹¬Webå’ŒWeex&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;compiler&lt;/strong&gt;: æ¨¡æ¿ç¼–è¯‘å™¨ï¼Œå°†æ¨¡æ¿è½¬æ¢ä¸ºæ¸²æŸ“å‡½æ•°&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;server&lt;/strong&gt;: æœåŠ¡ç«¯æ¸²æŸ“ç›¸å…³ä»£ç &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;sfc&lt;/strong&gt;: å•æ–‡ä»¶ç»„ä»¶(.vueæ–‡ä»¶)è§£æå™¨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;shared&lt;/strong&gt;: å…±äº«å·¥å…·å‡½æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;ä¸€ã€å“åº”å¼ç³»ç»Ÿ&quot;&gt;&lt;a href=&quot;#ä¸€ã€å“åº”å¼ç³»ç»Ÿ&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€å“åº”å¼ç³»ç»Ÿ&quot;&gt;&lt;/a&gt;ä¸€ã€å“åº”å¼ç³»ç»Ÿ&lt;/h2&gt;&lt;p&gt;Vue 2çš„å“åº”å¼ç³»ç»Ÿæ˜¯æ•´ä¸ªæ¡†æ¶çš„æ ¸å¿ƒï¼Œå®ƒåŸºäºObject.definePropertyå®ç°æ•°æ®åŠ«æŒå’Œå‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-1-æ•°æ®å“åº”å¼åŸç†&quot;&gt;&lt;a href=&quot;#1-1-æ•°æ®å“åº”å¼åŸç†&quot; class=&quot;headerlink&quot; title=&quot;1.1 æ•°æ®å“åº”å¼åŸç†&quot;&gt;&lt;/a&gt;1.1 æ•°æ®å“åº”å¼åŸç†&lt;/h3&gt;</summary>
    
    
    
    <category term="vue2" scheme="http://blog.ypintao.com/categories/vue2/"/>
    
    
    <category term="vue2" scheme="http://blog.ypintao.com/tags/vue2/"/>
    
  </entry>
  
</feed>
