<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>wustxing&#39;s blog</title>
  
  <subtitle>æ˜Ÿçš„åšå®¢</subtitle>
  <link href="http://blog.ypintao.com/atom.xml" rel="self"/>
  
  <link href="http://blog.ypintao.com/"/>
  <updated>2025-12-18T15:25:48.330Z</updated>
  <id>http://blog.ypintao.com/</id>
  
  <author>
    <name>wustxing</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ–‡ä»¶èœå•æ˜¾ç¤º</title>
    <link href="http://blog.ypintao.com/2025/12/18/%E5%89%8D%E7%AB%AF/electron/%E6%96%87%E4%BB%B6%E8%8F%9C%E5%8D%95%E6%98%BE%E7%A4%BA/"/>
    <id>http://blog.ypintao.com/2025/12/18/%E5%89%8D%E7%AB%AF/electron/%E6%96%87%E4%BB%B6%E8%8F%9C%E5%8D%95%E6%98%BE%E7%A4%BA/</id>
    <published>2025-12-18T15:25:27.246Z</published>
    <updated>2025-12-18T15:25:48.330Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ä¸“ä¸šçš„éœ€æ±‚ã€‚è¦å°†ä¸€ä¸ªæ¶‰åŠ Main&#x2F;Preload&#x2F;Renderer ä¸‰ç«¯çš„å¤æ‚ä¸šåŠ¡å°è£…æˆä¸€ä¸ªâ€œå¼€ç®±å³ç”¨â€çš„åº“ï¼Œæˆ‘ä»¬éœ€è¦éµå¾ª <strong>â€œå…³æ³¨ç‚¹åˆ†ç¦»â€</strong> å’Œ <strong>â€œä¾èµ–æ³¨å…¥â€</strong> çš„åŸåˆ™ã€‚</p><p>ä¸ºäº†æ»¡è¶³â€œå°è£…æˆåº“â€ä¸”â€œå‚è€ƒ VS Codeâ€çš„è¦æ±‚ï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ªåä¸º <strong><code>electron-tree-explorer</code></strong> çš„æœ¬åœ°åº“ç»“æ„ã€‚ä½ å¯ä»¥ç›´æ¥å°†å…¶è§†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ npm åŒ…æ¥ç»´æŠ¤ã€‚</p><h3 id="ğŸ“š-åº“çš„è®¾è®¡æ¶æ„"><a href="#ğŸ“š-åº“çš„è®¾è®¡æ¶æ„" class="headerlink" title="ğŸ“š åº“çš„è®¾è®¡æ¶æ„"></a>ğŸ“š åº“çš„è®¾è®¡æ¶æ„</h3><p>è¿™ä¸ªåº“å°†åŒ…å«ä¸‰ä¸ªå¯¼å‡ºå…¥å£ï¼š</p><ol><li><strong><code>main</code></strong>: æä¾›ç»™ Electron ä¸»è¿›ç¨‹æ³¨å†Œ IPC ç›‘å¬å™¨ã€‚</li><li><strong><code>preload</code></strong>: æä¾›ç»™ Preload è„šæœ¬æš´éœ² APIã€‚</li><li><strong><code>renderer</code></strong>: æä¾› Vue ç»„ä»¶ (<code>FileExplorer</code>) å’Œ CSSã€‚</li></ol><hr><h3 id="ğŸš€-1-æ ¸å¿ƒç±»å‹å®šä¹‰-types-ts"><a href="#ğŸš€-1-æ ¸å¿ƒç±»å‹å®šä¹‰-types-ts" class="headerlink" title="ğŸš€ 1. æ ¸å¿ƒç±»å‹å®šä¹‰ (types.ts)"></a>ğŸš€ 1. æ ¸å¿ƒç±»å‹å®šä¹‰ (<code>types.ts</code>)</h3><p>é¦–å…ˆå®šä¹‰é€šä¿¡åè®®ï¼Œä¿è¯å‰åç«¯ç±»å‹ä¸€è‡´ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/electron-tree-explorer/src/types.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FileNode</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">path</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;file&#x27;</span> | <span class="string">&#x27;directory&#x27;</span></span><br><span class="line">  <span class="attr">children</span>?: <span class="title class_">FileNode</span>[] <span class="comment">// å¦‚æœå·²åŠ è½½ï¼Œåˆ™æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">  <span class="attr">isExpanded</span>?: <span class="built_in">boolean</span>  <span class="comment">// UIçŠ¶æ€</span></span><br><span class="line">  <span class="attr">isEditing</span>?: <span class="built_in">boolean</span>   <span class="comment">// æ˜¯å¦æ­£åœ¨é‡å‘½å/æ–°å»º</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ExplorerEvents</span> = </span><br><span class="line">  | <span class="string">&#x27;ete:read-dir&#x27;</span></span><br><span class="line">  | <span class="string">&#x27;ete:create&#x27;</span></span><br><span class="line">  | <span class="string">&#x27;ete:rename&#x27;</span></span><br><span class="line">  | <span class="string">&#x27;ete:delete&#x27;</span></span><br><span class="line">  | <span class="string">&#x27;ete:open-file&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CreatePayload</span> &#123;</span><br><span class="line">  <span class="attr">basePath</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;file&#x27;</span> | <span class="string">&#x27;directory&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ğŸ—ï¸-2-ä¸»è¿›ç¨‹é€»è¾‘-main-ts"><a href="#ğŸ—ï¸-2-ä¸»è¿›ç¨‹é€»è¾‘-main-ts" class="headerlink" title="ğŸ—ï¸ 2. ä¸»è¿›ç¨‹é€»è¾‘ (main.ts)"></a>ğŸ—ï¸ 2. ä¸»è¿›ç¨‹é€»è¾‘ (<code>main.ts</code>)</h3><p>è¿™é‡Œå°è£…äº†æ‰€æœ‰ <code>fs</code> æ“ä½œã€‚ä¸ºäº†å®‰å…¨ï¼Œæˆ‘ä»¬ä¸ç›´æ¥æš´éœ² <code>fs</code>ï¼Œè€Œæ˜¯æš´éœ²ä¸šåŠ¡æ–¹æ³•ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/electron-tree-explorer/src/main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; ipcMain, shell &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs-extra&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FileNode</span>, <span class="title class_">CreatePayload</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">FileExplorerServer</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">registerHandlers</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">registerHandlers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 1. è¯»å–ç›®å½• (æ‡’åŠ è½½æ¨¡å¼)</span></span><br><span class="line">    ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;ete:read-dir&#x27;</span>, <span class="title function_">async</span> (_, <span class="attr">dirPath</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">FileNode</span>[]&gt; =&gt; &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> names = <span class="keyword">await</span> fs.<span class="title function_">readdir</span>(dirPath)</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">nodes</span>: <span class="title class_">FileNode</span>[] = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> name <span class="keyword">of</span> names) &#123;</span><br><span class="line">          <span class="comment">// è¿‡æ»¤éšè—æ–‡ä»¶</span></span><br><span class="line">          <span class="keyword">if</span> (name.<span class="title function_">startsWith</span>(<span class="string">&#x27;.&#x27;</span>)) <span class="keyword">continue</span></span><br><span class="line">          </span><br><span class="line">          <span class="keyword">const</span> fullPath = path.<span class="title function_">join</span>(dirPath, name)</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> stats = <span class="keyword">await</span> fs.<span class="title function_">stat</span>(fullPath)</span><br><span class="line">            nodes.<span class="title function_">push</span>(&#123;</span><br><span class="line">              name,</span><br><span class="line">              <span class="attr">path</span>: fullPath,</span><br><span class="line">              <span class="attr">type</span>: stats.<span class="title function_">isDirectory</span>() ? <span class="string">&#x27;directory&#x27;</span> : <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">              <span class="attr">children</span>: <span class="literal">undefined</span> <span class="comment">// æ‡’åŠ è½½ï¼Œåˆå§‹ä¸ºç©º</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123; <span class="comment">/* ignore errors */</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ’åºï¼šæ–‡ä»¶å¤¹åœ¨å‰</span></span><br><span class="line">        <span class="keyword">return</span> nodes.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (a.<span class="property">type</span> === b.<span class="property">type</span>) <span class="keyword">return</span> a.<span class="property">name</span>.<span class="title function_">localeCompare</span>(b.<span class="property">name</span>)</span><br><span class="line">          <span class="keyword">return</span> a.<span class="property">type</span> === <span class="string">&#x27;directory&#x27;</span> ? -<span class="number">1</span> : <span class="number">1</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Read dir failed:&#x27;</span>, error)</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. åˆ›å»ºæ–‡ä»¶/æ–‡ä»¶å¤¹</span></span><br><span class="line">    ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;ete:create&#x27;</span>, <span class="title function_">async</span> (_, &#123; basePath, name, <span class="keyword">type</span> &#125;: <span class="title class_">CreatePayload</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> targetPath = path.<span class="title function_">join</span>(basePath, name)</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">await</span> fs.<span class="title function_">pathExists</span>(targetPath)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Exist&#x27;</span>)</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">&#x27;directory&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">await</span> fs.<span class="title function_">ensureDir</span>(targetPath)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> fs.<span class="title function_">ensureFile</span>(targetPath)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> targetPath</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. é‡å‘½å</span></span><br><span class="line">    ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;ete:rename&#x27;</span>, <span class="title function_">async</span> (_, &#123; oldPath, newName &#125;) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> dir = path.<span class="title function_">dirname</span>(oldPath)</span><br><span class="line">      <span class="keyword">const</span> newPath = path.<span class="title function_">join</span>(dir, newName)</span><br><span class="line">      <span class="keyword">await</span> fs.<span class="title function_">rename</span>(oldPath, newPath)</span><br><span class="line">      <span class="keyword">return</span> newPath</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. åˆ é™¤ (ç§»å…¥å›æ”¶ç«™)</span></span><br><span class="line">    ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;ete:delete&#x27;</span>, <span class="title function_">async</span> (_, <span class="attr">filePath</span>: <span class="built_in">string</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">await</span> shell.<span class="title function_">trashedItem</span>(filePath)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. æ‰“å¼€æ–‡ä»¶ (ä½¿ç”¨é»˜è®¤åº”ç”¨)</span></span><br><span class="line">    ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;ete:open-file&#x27;</span>, <span class="title function_">async</span> (_, <span class="attr">filePath</span>: <span class="built_in">string</span>) =&gt; &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœéœ€è¦ç¼–è¾‘å™¨æ‰“å¼€ï¼Œè¿™é‡Œä¸å¤„ç†ï¼Œç”±å‰ç«¯ emit äº‹ä»¶ç»™ä¸»åº”ç”¨</span></span><br><span class="line">      <span class="comment">// è¿™é‡Œåªæ¼”ç¤ºç”¨ç³»ç»Ÿé»˜è®¤ç¨‹åºæ‰“å¼€</span></span><br><span class="line">      shell.<span class="title function_">openPath</span>(filePath) </span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å‡ºå•ä¾‹åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">registerFileExplorer</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">FileExplorerServer</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ğŸŒ‰-3-Preload-æ¡¥æ¥-preload-ts"><a href="#ğŸŒ‰-3-Preload-æ¡¥æ¥-preload-ts" class="headerlink" title="ğŸŒ‰ 3. Preload æ¡¥æ¥ (preload.ts)"></a>ğŸŒ‰ 3. Preload æ¡¥æ¥ (<code>preload.ts</code>)</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/electron-tree-explorer/src/preload.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; ipcRenderer, contextBridge &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CreatePayload</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api = &#123;</span><br><span class="line">  <span class="attr">readDir</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;ete:read-dir&#x27;</span>, path),</span><br><span class="line">  <span class="attr">create</span>: <span class="function">(<span class="params"><span class="attr">payload</span>: <span class="title class_">CreatePayload</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;ete:create&#x27;</span>, payload),</span><br><span class="line">  <span class="attr">rename</span>: <span class="function">(<span class="params"><span class="attr">oldPath</span>: <span class="built_in">string</span>, <span class="attr">newName</span>: <span class="built_in">string</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;ete:rename&#x27;</span>, &#123; oldPath, newName &#125;),</span><br><span class="line">  <span class="attr">delete</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;ete:delete&#x27;</span>, path),</span><br><span class="line">  <span class="attr">openFile</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;ete:open-file&#x27;</span>, path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¾›ä¸»é¡¹ç›®è°ƒç”¨</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">exposeExplorerAPI</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">contextIsolated</span>) &#123;</span><br><span class="line">    contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&#x27;fileExplorerAPI&#x27;</span>, api)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">fileExplorerAPI</span> = api</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ğŸ¨-4-Renderer-ç»„ä»¶-Vue"><a href="#ğŸ¨-4-Renderer-ç»„ä»¶-Vue" class="headerlink" title="ğŸ¨ 4. Renderer ç»„ä»¶ (Vue)"></a>ğŸ¨ 4. Renderer ç»„ä»¶ (Vue)</h3><p>è¿™é‡Œæ˜¯é€»è¾‘æœ€å¤æ‚çš„åœ°æ–¹ã€‚ä¸ºäº†å°è£…æ€§ï¼Œæˆ‘ä»¬å°† ContextMenu å’Œ TreeItem éƒ½é›†æˆåœ¨ä¸€èµ·ã€‚</p><h4 id="4-1-æ ‘èŠ‚ç‚¹ç»„ä»¶-TreeItem-vue"><a href="#4-1-æ ‘èŠ‚ç‚¹ç»„ä»¶-TreeItem-vue" class="headerlink" title="4.1 æ ‘èŠ‚ç‚¹ç»„ä»¶ (TreeItem.vue)"></a>4.1 æ ‘èŠ‚ç‚¹ç»„ä»¶ (<code>TreeItem.vue</code>)</h4><p>å¤„ç†é€’å½’æ¸²æŸ“ã€é‡å‘½åè¾“å…¥æ¡†ã€å³é”®èœå•äº‹ä»¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;ete-node&quot;&gt;</span><br><span class="line">    &lt;!-- èŠ‚ç‚¹è¡Œ --&gt;</span><br><span class="line">    &lt;div </span><br><span class="line">      class=&quot;ete-label&quot;</span><br><span class="line">      :class=&quot;&#123; &#x27;selected&#x27;: isSelected &#125;&quot;</span><br><span class="line">      :style=&quot;&#123; paddingLeft: `$&#123;depth * 12 + 10&#125;px` &#125;&quot;</span><br><span class="line">      @click=&quot;onLeftClick&quot;</span><br><span class="line">      @contextmenu.prevent=&quot;onRightClick&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- ç®­å¤´ --&gt;</span><br><span class="line">      &lt;span class=&quot;ete-arrow&quot; :class=&quot;&#123; &#x27;open&#x27;: isOpen, &#x27;hidden&#x27;: node.type === &#x27;file&#x27; &#125;&quot;&gt;</span><br><span class="line">        â–¶</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- å›¾æ ‡ --&gt;</span><br><span class="line">      &lt;span class=&quot;ete-icon&quot;&gt;&#123;&#123; node.type === &#x27;directory&#x27; ? &#x27;ğŸ“&#x27; : &#x27;ğŸ“„&#x27; &#125;&#125;&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- æ­£å¸¸åç§° --&gt;</span><br><span class="line">      &lt;span v-if=&quot;!isRenaming&quot; class=&quot;ete-name&quot;&gt;&#123;&#123; node.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- é‡å‘½å/æ–°å»º è¾“å…¥æ¡† --&gt;</span><br><span class="line">      &lt;input </span><br><span class="line">        v-else</span><br><span class="line">        ref=&quot;inputRef&quot;</span><br><span class="line">        v-model=&quot;editName&quot;</span><br><span class="line">        class=&quot;ete-input&quot;</span><br><span class="line">        @blur=&quot;confirmEdit&quot;</span><br><span class="line">        @keydown.enter=&quot;confirmEdit&quot;</span><br><span class="line">        @keydown.esc=&quot;cancelEdit&quot;</span><br><span class="line">        @click.stop</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- å­èŠ‚ç‚¹é€’å½’ --&gt;</span><br><span class="line">    &lt;div v-if=&quot;node.type === &#x27;directory&#x27; &amp;&amp; isOpen&quot;&gt;</span><br><span class="line">      &lt;TreeItem </span><br><span class="line">        v-for=&quot;child in node.children&quot; </span><br><span class="line">        :key=&quot;child.path&quot;</span><br><span class="line">        :node=&quot;child&quot;</span><br><span class="line">        :depth=&quot;depth + 1&quot;</span><br><span class="line">        :selectedPath=&quot;selectedPath&quot;</span><br><span class="line">        @select=&quot;$emit(&#x27;select&#x27;, $event)&quot;</span><br><span class="line">        @context=&quot;$emit(&#x27;context&#x27;, $event)&quot;</span><br><span class="line">        @refresh=&quot;$emit(&#x27;refresh&#x27;, node)&quot; </span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, nextTick, watch, toRef &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; FileNode &#125; from &#x27;./types&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps&lt;&#123;</span><br><span class="line">  node: FileNode</span><br><span class="line">  depth: number</span><br><span class="line">  selectedPath: string</span><br><span class="line">&#125;&gt;()</span><br><span class="line"></span><br><span class="line">const emit = defineEmits([&#x27;select&#x27;, &#x27;context&#x27;, &#x27;refresh&#x27;])</span><br><span class="line"></span><br><span class="line">const isOpen = ref(false)</span><br><span class="line">const isRenaming = ref(false)</span><br><span class="line">const editName = ref(&#x27;&#x27;)</span><br><span class="line">const inputRef = ref&lt;HTMLInputElement&gt;()</span><br><span class="line"></span><br><span class="line">// ç›‘å¬å¤–éƒ¨æ§åˆ¶çš„ç¼–è¾‘çŠ¶æ€ (ç”¨äºæ–°å»º)</span><br><span class="line">watch(() =&gt; props.node.isEditing, (val) =&gt; &#123;</span><br><span class="line">  if (val) startEdit()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const isSelected = toRef(() =&gt; props.selectedPath === props.node.path)</span><br><span class="line"></span><br><span class="line">// åŠ è½½å­ç›®å½•</span><br><span class="line">const loadChildren = async () =&gt; &#123;</span><br><span class="line">  if (props.node.children) return // å·²åŠ è½½è¿‡</span><br><span class="line">  // @ts-ignore</span><br><span class="line">  const children = await window.fileExplorerAPI.readDir(props.node.path)</span><br><span class="line">  props.node.children = children</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const onLeftClick = async () =&gt; &#123;</span><br><span class="line">  emit(&#x27;select&#x27;, props.node)</span><br><span class="line">  if (props.node.type === &#x27;directory&#x27;) &#123;</span><br><span class="line">    isOpen.value = !isOpen.value</span><br><span class="line">    if (isOpen.value) await loadChildren()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const onRightClick = (e: MouseEvent) =&gt; &#123;</span><br><span class="line">  emit(&#x27;select&#x27;, props.node) // å³é”®åŒæ—¶ä¹Ÿé€‰ä¸­</span><br><span class="line">  emit(&#x27;context&#x27;, &#123; event: e, node: props.node &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// === ç¼–è¾‘é€»è¾‘ ===</span><br><span class="line">const startEdit = () =&gt; &#123;</span><br><span class="line">  isRenaming.value = true</span><br><span class="line">  editName.value = props.node.name</span><br><span class="line">  nextTick(() =&gt; inputRef.value?.focus())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const confirmEdit = async () =&gt; &#123;</span><br><span class="line">  if (!isRenaming.value) return</span><br><span class="line">  isRenaming.value = false</span><br><span class="line">  </span><br><span class="line">  if (!editName.value || editName.value === props.node.name) &#123;</span><br><span class="line">    if (props.node.name === &#x27;&#x27;) &#123;</span><br><span class="line">      // å¦‚æœæ˜¯æ–°å»ºæ–‡ä»¶ä¸”åå­—ä¸ºç©ºï¼Œè§¦å‘åˆ·æ–°çˆ¶çº§ä»¥ç§»é™¤ä¸´æ—¶èŠ‚ç‚¹</span><br><span class="line">       emit(&#x27;refresh&#x27;, null) </span><br><span class="line">    &#125;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    if (props.node.path.endsWith(&#x27;__temp__&#x27;)) &#123;</span><br><span class="line">      // æ–°å»ºé€»è¾‘</span><br><span class="line">      const basePath = props.node.path.replace(&#x27;__temp__&#x27;, &#x27;&#x27;)</span><br><span class="line">      // @ts-ignore</span><br><span class="line">      await window.fileExplorerAPI.create(&#123;</span><br><span class="line">        basePath,</span><br><span class="line">        name: editName.value,</span><br><span class="line">        type: props.node.type</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // é‡å‘½åé€»è¾‘</span><br><span class="line">      // @ts-ignore</span><br><span class="line">      await window.fileExplorerAPI.rename(props.node.path, editName.value)</span><br><span class="line">    &#125;</span><br><span class="line">    // æˆåŠŸåè¯·æ±‚çˆ¶çº§åˆ·æ–°</span><br><span class="line">    emit(&#x27;refresh&#x27;, &#x27;parent&#x27;) </span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    alert(&#x27;æ“ä½œå¤±è´¥: &#x27; + e)</span><br><span class="line">    // å¤±è´¥å¦‚æœæ˜¯æ–°å»ºï¼Œéœ€è¦ç§»é™¤</span><br><span class="line">    if (props.node.path.endsWith(&#x27;__temp__&#x27;)) emit(&#x27;refresh&#x27;, null)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const cancelEdit = () =&gt; &#123;</span><br><span class="line">  isRenaming.value = false</span><br><span class="line">  if (props.node.path.endsWith(&#x27;__temp__&#x27;)) emit(&#x27;refresh&#x27;, null)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defineExpose(&#123; startEdit &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">/* åŒ…å« VS Code é£æ ¼çš„åŸºç¡€æ ·å¼ */</span><br><span class="line">.ete-label &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  height: 22px;</span><br><span class="line">  color: #cccccc;</span><br><span class="line">  font-size: 13px;</span><br><span class="line">  user-select: none;</span><br><span class="line">  border: 1px solid transparent;</span><br><span class="line">&#125;</span><br><span class="line">.ete-label:hover &#123; background-color: #2a2d2e; &#125;</span><br><span class="line">.ete-label.selected &#123; background-color: #37373d; color: #fff; &#125;</span><br><span class="line"></span><br><span class="line">.ete-arrow &#123;</span><br><span class="line">  font-size: 10px; margin-right: 4px; transition: transform 0.1s;</span><br><span class="line">  color: #999;</span><br><span class="line">  width: 14px; text-align: center;</span><br><span class="line">&#125;</span><br><span class="line">.ete-arrow.open &#123; transform: rotate(90deg); &#125;</span><br><span class="line">.ete-arrow.hidden &#123; visibility: hidden; &#125;</span><br><span class="line"></span><br><span class="line">.ete-icon &#123; margin-right: 6px; &#125;</span><br><span class="line">.ete-input &#123;</span><br><span class="line">  background: #3c3c3c; color: white; border: 1px solid #007fd4;</span><br><span class="line">  outline: none; height: 20px; width: 100%;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="4-2-ä¸»å…¥å£ç»„ä»¶-FileExplorer-vue"><a href="#4-2-ä¸»å…¥å£ç»„ä»¶-FileExplorer-vue" class="headerlink" title="4.2 ä¸»å…¥å£ç»„ä»¶ (FileExplorer.vue)"></a>4.2 ä¸»å…¥å£ç»„ä»¶ (<code>FileExplorer.vue</code>)</h4><p>è´Ÿè´£ç®¡ç†æ ¹èŠ‚ç‚¹ã€å³é”®èœå•çš„æ˜¾ç¤ºä¸éšè—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;ete-container&quot; @click=&quot;selectedPath = &#x27;&#x27;&quot; @contextmenu.prevent=&quot;onRootContext&quot;&gt;</span><br><span class="line">    &lt;!-- é€’å½’æ ‘ --&gt;</span><br><span class="line">    &lt;TreeItem </span><br><span class="line">      v-for=&quot;node in tree&quot; </span><br><span class="line">      :key=&quot;node.path&quot;</span><br><span class="line">      ref=&quot;itemRefs&quot;</span><br><span class="line">      :node=&quot;node&quot; </span><br><span class="line">      :depth=&quot;0&quot;</span><br><span class="line">      :selectedPath=&quot;selectedPath&quot;</span><br><span class="line">      @select=&quot;onSelect&quot;</span><br><span class="line">      @context=&quot;onContext&quot;</span><br><span class="line">      @refresh=&quot;refreshNode&quot;</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- å³é”®èœå• --&gt;</span><br><span class="line">    &lt;div v-if=&quot;menu.visible&quot; class=&quot;ete-context-menu&quot; :style=&quot;&#123; top: menu.y + &#x27;px&#x27;, left: menu.x + &#x27;px&#x27; &#125;&quot;&gt;</span><br><span class="line">      &lt;div @click=&quot;handleAction(&#x27;new_file&#x27;)&quot;&gt;æ–°å»ºæ–‡ä»¶&lt;/div&gt;</span><br><span class="line">      &lt;div @click=&quot;handleAction(&#x27;new_folder&#x27;)&quot;&gt;æ–°å»ºæ–‡ä»¶å¤¹&lt;/div&gt;</span><br><span class="line">      &lt;div @click=&quot;handleAction(&#x27;rename&#x27;)&quot;&gt;é‡å‘½å&lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;ete-divider&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;div @click=&quot;handleAction(&#x27;delete&#x27;)&quot; class=&quot;ete-danger&quot;&gt;åˆ é™¤&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, onMounted, reactive, nextTick &#125; from &#x27;vue&#x27;</span><br><span class="line">import TreeItem from &#x27;./TreeItem.vue&#x27;</span><br><span class="line">import &#123; FileNode &#125; from &#x27;./types&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps&lt;&#123; rootPath: string &#125;&gt;()</span><br><span class="line">const emit = defineEmits([&#x27;open-file&#x27;])</span><br><span class="line"></span><br><span class="line">const tree = ref&lt;FileNode[]&gt;([])</span><br><span class="line">const selectedPath = ref(&#x27;&#x27;)</span><br><span class="line">const itemRefs = ref([]) // ç”¨äºè·å–å­ç»„ä»¶å®ä¾‹è°ƒç”¨ startEdit</span><br><span class="line"></span><br><span class="line">const menu = reactive(&#123; visible: false, x: 0, y: 0, targetNode: null as FileNode | null &#125;)</span><br><span class="line"></span><br><span class="line">// åˆå§‹åŒ–</span><br><span class="line">onMounted(async () =&gt; &#123;</span><br><span class="line">  await loadRoot()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const loadRoot = async () =&gt; &#123;</span><br><span class="line">  if (!props.rootPath) return</span><br><span class="line">  // @ts-ignore</span><br><span class="line">  tree.value = await window.fileExplorerAPI.readDir(props.rootPath)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const onSelect = (node: FileNode) =&gt; &#123;</span><br><span class="line">  selectedPath.value = node.path</span><br><span class="line">  if (node.type === &#x27;file&#x27;) emit(&#x27;open-file&#x27;, node.path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const onContext = (&#123; event, node &#125;: any) =&gt; &#123;</span><br><span class="line">  menu.visible = true</span><br><span class="line">  menu.x = event.clientX</span><br><span class="line">  menu.y = event.clientY</span><br><span class="line">  menu.targetNode = node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const onRootContext = (event: MouseEvent) =&gt; &#123;</span><br><span class="line">  // ç©ºç™½å¤„å³é”®</span><br><span class="line">  menu.visible = true</span><br><span class="line">  menu.x = event.clientX</span><br><span class="line">  menu.y = event.clientY</span><br><span class="line">  menu.targetNode = null // null ä»£è¡¨æ ¹ç›®å½•</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// åˆ·æ–°é€»è¾‘ï¼šå¦‚æœæ˜¯ &#x27;parent&#x27;ï¼Œè¯´æ˜å­èŠ‚ç‚¹æœ‰å˜åŠ¨ï¼Œè¿™é‡Œç®€å•å¤„ç†ï¼Œé‡æ–°åŠ è½½æ•´ä¸ªçˆ¶èŠ‚ç‚¹</span><br><span class="line">// åœ¨ç”Ÿäº§çº§åº“ä¸­ï¼Œåº”è¯¥é€šè¿‡ path æ‰¾åˆ°çˆ¶èŠ‚ç‚¹å¹¶åªåˆ·æ–°å®ƒ</span><br><span class="line">const refreshNode = () =&gt; &#123;</span><br><span class="line">  // ç®€å•å®ç°ï¼šå…¨é‡åˆ·æ–°æ ¹ç›®å½• (ä¼˜åŒ–ç‚¹ï¼šæ ¹æ® path å±€éƒ¨åˆ·æ–°)</span><br><span class="line">  loadRoot()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const handleAction = async (action: string) =&gt; &#123;</span><br><span class="line">  menu.visible = false</span><br><span class="line">  const target = menu.targetNode</span><br><span class="line">  </span><br><span class="line">  if (action === &#x27;delete&#x27;) &#123;</span><br><span class="line">    if (!target) return</span><br><span class="line">    if (confirm(`åˆ é™¤ $&#123;target.name&#125;?`)) &#123;</span><br><span class="line">      // @ts-ignore</span><br><span class="line">      await window.fileExplorerAPI.delete(target.path)</span><br><span class="line">      loadRoot()</span><br><span class="line">    &#125;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (action === &#x27;rename&#x27;) &#123;</span><br><span class="line">    if (!target) return</span><br><span class="line">    // æ‰¾åˆ°å¯¹åº”çš„ç»„ä»¶å®ä¾‹è°ƒç”¨ startEdit</span><br><span class="line">    // å®é™…åº“ä¸­ä¸€èˆ¬ä½¿ç”¨ bus æˆ– provide/inject æ¥æ§åˆ¶ç¼–è¾‘çŠ¶æ€</span><br><span class="line">    target.isEditing = true </span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (action === &#x27;new_file&#x27; || action === &#x27;new_folder&#x27;) &#123;</span><br><span class="line">    // 1. ç¡®å®šæ’å…¥ä½ç½®ï¼ˆå½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œæˆ–è€…å½“å‰æ–‡ä»¶åŒçº§ï¼Œæˆ–è€…æ ¹ç›®å½•ï¼‰</span><br><span class="line">    let insertList = tree.value</span><br><span class="line">    let basePath = props.rootPath</span><br><span class="line">    </span><br><span class="line">    if (target) &#123;</span><br><span class="line">       if (target.type === &#x27;directory&#x27;) &#123;</span><br><span class="line">         // æ’å…¥åˆ°è¯¥æ–‡ä»¶å¤¹å†…éƒ¨ï¼ˆéœ€è¦å…ˆå±•å¼€ï¼‰</span><br><span class="line">         if (!target.children) target.children = []</span><br><span class="line">         insertList = target.children</span><br><span class="line">         basePath = target.path</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">         // æ’å…¥åˆ°åŒçº§ (è¿™é‡Œç®€åŒ–ï¼Œæš‚æ—¶åªæ”¯æŒæ ¹ç›®å½•æˆ–è€…æ–‡ä»¶å¤¹å†…)</span><br><span class="line">         // å®é™…éœ€è¦é€’å½’æŸ¥æ‰¾ parent</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 2. æ’å…¥ä¸´æ—¶èŠ‚ç‚¹</span><br><span class="line">    const tempNode: FileNode = &#123;</span><br><span class="line">      name: &#x27;&#x27;,</span><br><span class="line">      path: basePath + &#x27;/__temp__&#x27;, // ç‰¹æ®Šæ ‡è®°</span><br><span class="line">      type: action === &#x27;new_file&#x27; ? &#x27;file&#x27; : &#x27;directory&#x27;,</span><br><span class="line">      isEditing: true</span><br><span class="line">    &#125;</span><br><span class="line">    insertList.unshift(tempNode)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç‚¹å‡»ç©ºç™½å…³é—­èœå•</span><br><span class="line">window.addEventListener(&#x27;click&#x27;, () =&gt; &#123; menu.visible = false &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.ete-container &#123;</span><br><span class="line">  height: 100%; overflow-y: auto; background: #252526; color: #ccc;</span><br><span class="line">  font-family: &#x27;Segoe UI&#x27;, sans-serif;</span><br><span class="line">&#125;</span><br><span class="line">.ete-context-menu &#123;</span><br><span class="line">  position: fixed; background: #333; border: 1px solid #454545;</span><br><span class="line">  box-shadow: 0 2px 8px rgba(0,0,0,0.3); z-index: 9999;</span><br><span class="line">  min-width: 120px; padding: 4px 0;</span><br><span class="line">&#125;</span><br><span class="line">.ete-context-menu div &#123;</span><br><span class="line">  padding: 6px 16px; cursor: pointer; font-size: 13px;</span><br><span class="line">&#125;</span><br><span class="line">.ete-context-menu div:hover &#123; background: #094771; color: white; &#125;</span><br><span class="line">.ete-divider &#123; height: 1px; background: #454545; margin: 4px 0; padding: 0 !important; &#125;</span><br><span class="line">.ete-danger:hover &#123; background: #800000 !important; &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="ğŸ“¦-5-å¦‚ä½•åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨"><a href="#ğŸ“¦-5-å¦‚ä½•åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨" class="headerlink" title="ğŸ“¦ 5. å¦‚ä½•åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨"></a>ğŸ“¦ 5. å¦‚ä½•åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨</h3><p>ç°åœ¨ä½ å·²ç»æœ‰äº†ä¸€ä¸ªåä¸º <code>electron-tree-explorer</code> çš„æœ¬åœ°åº“ï¼ˆæ–‡ä»¶å¤¹ï¼‰ã€‚</p><h4 id="æ­¥éª¤-1-æ³¨å†Œä¸»è¿›ç¨‹"><a href="#æ­¥éª¤-1-æ³¨å†Œä¸»è¿›ç¨‹" class="headerlink" title="æ­¥éª¤ 1: æ³¨å†Œä¸»è¿›ç¨‹"></a>æ­¥éª¤ 1: æ³¨å†Œä¸»è¿›ç¨‹</h4><p>åœ¨ <code>src/main/index.ts</code> ä¸­ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; registerFileExplorer &#125; <span class="keyword">from</span> <span class="string">&#x27;../packages/electron-tree-explorer/src/main&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ app.whenReady() ä¹‹å</span></span><br><span class="line"><span class="title function_">registerFileExplorer</span>()</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤-2-æ³¨å†Œ-Preload"><a href="#æ­¥éª¤-2-æ³¨å†Œ-Preload" class="headerlink" title="æ­¥éª¤ 2: æ³¨å†Œ Preload"></a>æ­¥éª¤ 2: æ³¨å†Œ Preload</h4><p>åœ¨ <code>src/preload/index.ts</code> ä¸­ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; exposeExplorerAPI &#125; <span class="keyword">from</span> <span class="string">&#x27;../packages/electron-tree-explorer/src/preload&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">exposeExplorerAPI</span>()</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤-3-åœ¨-Vue-ä¸­ä½¿ç”¨"><a href="#æ­¥éª¤-3-åœ¨-Vue-ä¸­ä½¿ç”¨" class="headerlink" title="æ­¥éª¤ 3: åœ¨ Vue ä¸­ä½¿ç”¨"></a>æ­¥éª¤ 3: åœ¨ Vue ä¸­ä½¿ç”¨</h4><p>åœ¨ä½ çš„ä¸šåŠ¡é¡µé¢ (æ¯”å¦‚ <code>Sidebar.vue</code>):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;sidebar&quot;&gt;</span><br><span class="line">    &lt;FileExplorer </span><br><span class="line">      root-path=&quot;D:/MyProject&quot; </span><br><span class="line">      @open-file=&quot;handleOpenFile&quot; </span><br><span class="line">    /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import FileExplorer from &#x27;../packages/electron-tree-explorer/src/FileExplorer.vue&#x27;</span><br><span class="line"></span><br><span class="line">const handleOpenFile = (path: string) =&gt; &#123;</span><br><span class="line">  console.log(&#x27;ç”¨æˆ·è¯·æ±‚æ‰“å¼€æ–‡ä»¶:&#x27;, path)</span><br><span class="line">  // è¿™é‡Œè°ƒç”¨ä½ è‡ªå·±çš„ Tab ç³»ç»Ÿæ‰“å¼€æ–‡ä»¶</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="âœ…-æ–¹æ¡ˆäº®ç‚¹"><a href="#âœ…-æ–¹æ¡ˆäº®ç‚¹" class="headerlink" title="âœ… æ–¹æ¡ˆäº®ç‚¹"></a>âœ… æ–¹æ¡ˆäº®ç‚¹</h3><ol><li><strong>é«˜åº¦å°è£…</strong>ï¼šä¸»é¡¹ç›®ä¸éœ€è¦å…³å¿ƒ <code>fs.readdir</code> æ€ä¹ˆå†™ï¼Œä¹Ÿä¸éœ€è¦å†™ CSSã€‚</li><li><strong>å®‰å…¨</strong>ï¼šé€šè¿‡ <code>contextBridge</code> åªæš´éœ²äº† 5 ä¸ªå¿…è¦çš„ APIï¼Œæ²¡æœ‰æš´éœ²æ•´ä¸ª <code>fs</code> æ¨¡å—ã€‚</li><li><strong>VS Code ä½“éªŒ</strong>ï¼š<ul><li><strong>æ‡’åŠ è½½</strong>ï¼šåªæœ‰ç‚¹å¼€æ–‡ä»¶å¤¹æ‰è¯»å–å­ç›®å½•ï¼Œæ€§èƒ½å¥½ã€‚</li><li><strong>å†…è”é‡å‘½å</strong>ï¼šä¸æ˜¯å¼¹çª—ï¼Œè€Œæ˜¯ç›´æ¥åœ¨æ ‘ä¸Šå˜æˆè¾“å…¥æ¡†ã€‚</li><li><strong>å³é”®èœå•</strong>ï¼šè‡ªå®šä¹‰ DOM èœå•ï¼Œæ ·å¼ç»Ÿä¸€ã€‚</li></ul></li><li><strong>å¯æ‰©å±•</strong>ï¼šå¦‚æœä½ æƒ³å‘åŒ…ï¼Œåªéœ€è¦æŠŠ <code>packages/electron-tree-explorer</code> ç”¨ <code>tsup</code> æ‰“åŒ…ï¼Œå¹¶åœ¨ <code>package.json</code> å®šä¹‰ <code>exports</code> å³å¯ã€‚</li></ol><p>å¦‚æœä½ çš„æ–‡ä»¶ç›®å½•ç»“æ„æˆ–è€… CSS æ ·å¼æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œç›´æ¥ä¿®æ”¹è¿™ä¸ª <code>packages</code> ç›®å½•ä¸‹çš„æ–‡ä»¶å³å¯ï¼Œä¸ä¼šæ±¡æŸ“ä½ çš„ä¸šåŠ¡ä»£ç ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªéå¸¸ä¸“ä¸šçš„éœ€æ±‚ã€‚è¦å°†ä¸€ä¸ªæ¶‰åŠ Main&amp;#x2F;Preload&amp;#x2F;Renderer ä¸‰ç«¯çš„å¤æ‚ä¸šåŠ¡å°è£…æˆä¸€ä¸ªâ€œå¼€ç®±å³ç”¨â€çš„åº“ï¼Œæˆ‘ä»¬éœ€è¦éµå¾ª &lt;strong&gt;â€œå…³æ³¨ç‚¹åˆ†ç¦»â€&lt;/strong&gt; å’Œ &lt;strong&gt;â€œä¾èµ–æ³¨å…¥â€&lt;/strong&gt; çš„åŸåˆ™ã€‚&lt;/p</summary>
      
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>æ–‡ä»¶æ¯”å¯¹æ ‡çº¢æ˜¾ç¤º</title>
    <link href="http://blog.ypintao.com/2025/12/17/%E5%89%8D%E7%AB%AF/electron/%E6%96%87%E4%BB%B6%E6%AF%94%E5%AF%B9%E6%A0%87%E7%BA%A2%E6%98%BE%E7%A4%BA/"/>
    <id>http://blog.ypintao.com/2025/12/17/%E5%89%8D%E7%AB%AF/electron/%E6%96%87%E4%BB%B6%E6%AF%94%E5%AF%B9%E6%A0%87%E7%BA%A2%E6%98%BE%E7%A4%BA/</id>
    <published>2025-12-17T15:42:43.979Z</published>
    <updated>2025-12-17T15:43:56.808Z</updated>
    
    <content type="html"><![CDATA[<p>æ—¢ç„¶ä½ å·²ç»æœ‰äº†å·¥ç¨‹æ–‡ä»¶çš„ç»“æ„æ•°æ®ï¼ˆæ¯”å¦‚æ˜¯ä» <code>project.config.json</code> è¯»å–å‡ºæ¥çš„æ ‘å½¢ç»“æ„ï¼‰ï¼Œç°åœ¨çš„æ ¸å¿ƒä»»åŠ¡æ˜¯ï¼š<strong>éªŒè¯è¿™äº›è·¯å¾„åœ¨ç£ç›˜ä¸Šæ˜¯å¦çœŸçš„å­˜åœ¨</strong>ï¼Œå¹¶æ ¹æ®ç»“æœæ›´æ–° UIã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ <strong>â€œå…ƒæ•°æ®â€ vs â€œç‰©ç†æ•°æ®â€</strong> çš„æ ¡éªŒåœºæ™¯ã€‚</p><p>ä¸ºäº†ä¿è¯æ€§èƒ½ï¼ˆé¿å…æˆç™¾ä¸Šåƒæ¬¡ IPC é€šä¿¡ï¼‰ï¼Œæˆ‘ä»¬åº”è¯¥é‡‡ç”¨ <strong>â€œæ‰¹é‡æ ¡éªŒâ€</strong> çš„ç­–ç•¥ã€‚</p><span id="more"></span><h3 id="1-åç«¯ï¼šæ‰¹é‡è·¯å¾„æ ¡éªŒ-src-main-ipc-fs-ipc-ts"><a href="#1-åç«¯ï¼šæ‰¹é‡è·¯å¾„æ ¡éªŒ-src-main-ipc-fs-ipc-ts" class="headerlink" title="1. åç«¯ï¼šæ‰¹é‡è·¯å¾„æ ¡éªŒ (src/main/ipc/fs-ipc.ts)"></a>1. åç«¯ï¼šæ‰¹é‡è·¯å¾„æ ¡éªŒ (<code>src/main/ipc/fs-ipc.ts</code>)</h3><p>ä¸è¦ä¸€ä¸ªä¸€ä¸ªæ–‡ä»¶å»è°ƒ <code>fs.existsSync</code>ï¼Œé‚£æ · UI ä¼šå¡é¡¿ã€‚æˆ‘ä»¬è¦æä¾›ä¸€ä¸ªæ¥å£ï¼Œå‰ç«¯ä¼ ä¸€ä¸ªè·¯å¾„æ•°ç»„ï¼Œåç«¯è¿”å›ä¸€ä¸ªçŠ¶æ€ Mapã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main/ipc/fs-ipc.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; ipcMain &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs-extra&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupFsIPC</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ... ä¹‹å‰çš„ä»£ç  ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// âœ… æ–°å¢ï¼šæ‰¹é‡æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">  <span class="comment">// å‚æ•°ï¼špaths: string[]</span></span><br><span class="line">  <span class="comment">// è¿”å›ï¼šRecord&lt;string, boolean&gt;  &#123; &quot;/path/to/a&quot;: true, &quot;/path/to/b&quot;: false &#125;</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;fs-check-paths-batch&#x27;</span>, <span class="title function_">async</span> (_, <span class="attr">paths</span>: <span class="built_in">string</span>[]) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">boolean</span>&gt; = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨ Promise.all å¹¶è¡Œæ£€æŸ¥ï¼Œæ€§èƒ½æœ€é«˜</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(paths.<span class="title function_">map</span>(<span class="title function_">async</span> (p) =&gt; &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// access æ¯” exists æ›´æ¨èï¼Œå› ä¸ºå®ƒä¸ä¼šé˜»å¡äº‹ä»¶å¾ªç¯</span></span><br><span class="line">        <span class="keyword">await</span> fs.<span class="title function_">access</span>(p)</span><br><span class="line">        result[p] = <span class="literal">true</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        result[p] = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-Preload-æš´éœ²-API-src-preload-index-ts"><a href="#2-Preload-æš´éœ²-API-src-preload-index-ts" class="headerlink" title="2. Preload æš´éœ² API (src/preload/index.ts)"></a>2. Preload æš´éœ² API (<code>src/preload/index.ts</code>)</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/preload/index.ts</span></span><br><span class="line"><span class="keyword">const</span> fsAPI = &#123;</span><br><span class="line">  <span class="comment">// ... ä¹‹å‰çš„ API ...</span></span><br><span class="line">  <span class="attr">checkPathsBatch</span>: <span class="function">(<span class="params"><span class="attr">paths</span>: <span class="built_in">string</span>[]</span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;fs-check-paths-batch&#x27;</span>, paths)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><hr><h3 id="3-å‰ç«¯ï¼šé€’å½’ç»„ä»¶å®ç°-FileTreeItem-vue"><a href="#3-å‰ç«¯ï¼šé€’å½’ç»„ä»¶å®ç°-FileTreeItem-vue" class="headerlink" title="3. å‰ç«¯ï¼šé€’å½’ç»„ä»¶å®ç° (FileTreeItem.vue)"></a>3. å‰ç«¯ï¼šé€’å½’ç»„ä»¶å®ç° (<code>FileTreeItem.vue</code>)</h3><p>æˆ‘ä»¬éœ€è¦ä¿®æ”¹ç»„ä»¶ï¼Œæ¥æ”¶ä¸€ä¸ªå…¨å±€çš„ <code>fileStatusMap</code>ï¼ˆè®°å½•è°å­˜åœ¨ï¼Œè°ä¸å­˜åœ¨ï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- src/components/explorer/FileTreeItem.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;tree-node&quot;&gt;</span><br><span class="line">    &lt;div </span><br><span class="line">      class=&quot;item-label&quot;</span><br><span class="line">      :class=&quot;&#123; </span><br><span class="line">        &#x27;selected&#x27;: isSelected,</span><br><span class="line">        &#x27;missing&#x27;: isMissing // ğŸ”´ å…³é”®æ ·å¼ï¼šä¸å­˜åœ¨æ ‡çº¢</span><br><span class="line">      &#125;&quot;</span><br><span class="line">      :style=&quot;&#123; paddingLeft: `$&#123;depth * 16 + 8&#125;px` &#125;&quot;</span><br><span class="line">      @click.stop=&quot;handleClick&quot;</span><br><span class="line">      @contextmenu.stop=&quot;handleRightClick&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- å›¾æ ‡ï¼šå¦‚æœä¸¢å¤±æ˜¾ç¤ºè­¦å‘Šï¼Œå¦åˆ™æ˜¾ç¤ºæ­£å¸¸çš„æ–‡ä»¶å¤¹/æ–‡ä»¶å›¾æ ‡ --&gt;</span><br><span class="line">      &lt;span class=&quot;icon&quot;&gt;</span><br><span class="line">        &lt;template v-if=&quot;isMissing&quot;&gt;âš ï¸&lt;/template&gt;</span><br><span class="line">        &lt;template v-else&gt;</span><br><span class="line">            &#123;&#123; node.type === &#x27;directory&#x27; ? (isOpen ? &#x27;ğŸ“‚&#x27; : &#x27;ğŸ“&#x27;) : &#x27;ğŸ“„&#x27; &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;span class=&quot;name&quot;&gt;&#123;&#123; node.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;span v-if=&quot;isMissing&quot; class=&quot;missing-tag&quot;&gt;(å·²åˆ é™¤)&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- é€’å½’æ¸²æŸ“ --&gt;</span><br><span class="line">    &lt;div v-if=&quot;node.type === &#x27;directory&#x27; &amp;&amp; isOpen&quot;&gt;</span><br><span class="line">      &lt;FileTreeItem </span><br><span class="line">        v-for=&quot;child in node.children&quot; </span><br><span class="line">        :key=&quot;child.path&quot;</span><br><span class="line">        :node=&quot;child&quot;</span><br><span class="line">        :depth=&quot;depth + 1&quot;</span><br><span class="line">        :selectedPath=&quot;selectedPath&quot;</span><br><span class="line">        :statusMap=&quot;statusMap&quot; </span><br><span class="line">        @select=&quot;$emit(&#x27;select&#x27;, $event)&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, computed &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps&lt;&#123;</span><br><span class="line">  node: any</span><br><span class="line">  depth: number</span><br><span class="line">  selectedPath: string</span><br><span class="line">  // æ¥æ”¶çˆ¶ç»„ä»¶ä¼ ä¸‹æ¥çš„çŠ¶æ€è¡¨ &#123; &quot;path&quot;: true/false &#125;</span><br><span class="line">  statusMap: Record&lt;string, boolean&gt; </span><br><span class="line">&#125;&gt;()</span><br><span class="line"></span><br><span class="line">const emit = defineEmits([&#x27;select&#x27;])</span><br><span class="line"></span><br><span class="line">const isOpen = ref(false)</span><br><span class="line"></span><br><span class="line">const isSelected = computed(() =&gt; props.selectedPath === props.node.path)</span><br><span class="line"></span><br><span class="line">// âš ï¸ æ ¸å¿ƒåˆ¤æ–­ï¼šå¦‚æœ map é‡Œæ˜¾å¼è®°ä¸º falseï¼Œåˆ™è§†ä¸ºä¸¢å¤±</span><br><span class="line">// (å¦‚æœ map é‡Œæ²¡æœ‰è¿™ä¸ª keyï¼Œé€šå¸¸è§†ä½œè¿˜æ²¡åŠ è½½å®Œï¼Œæš‚ä¸æ ‡çº¢ï¼Œæˆ–è€…é»˜è®¤ä¸º true)</span><br><span class="line">const isMissing = computed(() =&gt; &#123;</span><br><span class="line">    return props.statusMap[props.node.path] === false</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const handleClick = () =&gt; &#123;</span><br><span class="line">  // ğŸš« æ ¸å¿ƒé€»è¾‘ï¼šä¸å­˜åœ¨åˆ™ç¦æ­¢ç‚¹å‡»ï¼ˆæˆ–è€…åªèƒ½è§¦å‘ç‰¹å®šé€»è¾‘ï¼‰</span><br><span class="line">  if (isMissing.value) &#123;</span><br><span class="line">    console.warn(&#x27;æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰“å¼€&#x27;)</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (props.node.type === &#x27;directory&#x27;) &#123;</span><br><span class="line">    isOpen.value = !isOpen.value</span><br><span class="line">  &#125;</span><br><span class="line">  emit(&#x27;select&#x27;, props.node)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const handleRightClick = () =&gt; &#123;</span><br><span class="line">    // å³ä½¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé€šå¸¸ä¹Ÿå…è®¸å³é”®ï¼Œä»¥ä¾¿ç”¨æˆ·é€‰æ‹© &quot;ä»åˆ—è¡¨ä¸­åˆ é™¤&quot;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.item-label &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  padding: 4px 0;</span><br><span class="line">  color: #ccc;</span><br><span class="line">  user-select: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* æ­£å¸¸çŠ¶æ€ hover */</span><br><span class="line">.item-label:hover:not(.missing) &#123; background-color: #2a2d2e; &#125;</span><br><span class="line">.item-label.selected &#123; background-color: #37373d; color: white; &#125;</span><br><span class="line"></span><br><span class="line">/* ğŸ”´ ä¸¢å¤±æ–‡ä»¶æ ·å¼ */</span><br><span class="line">.item-label.missing &#123;</span><br><span class="line">  color: #e51400; /* é²œè‰³çš„çº¢ */</span><br><span class="line">  opacity: 0.8;</span><br><span class="line">  cursor: not-allowed; /* ç¦æ­¢æ‰‹åŠ¿ */</span><br><span class="line">&#125;</span><br><span class="line">.item-label.missing:hover &#123;</span><br><span class="line">  background-color: rgba(229, 20, 0, 0.1); /* çº¢è‰²èƒŒæ™¯å¾®å…‰ */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.icon &#123; margin-right: 6px; width: 16px; text-align: center; &#125;</span><br><span class="line">.missing-tag &#123; font-size: 10px; margin-left: 8px; opacity: 0.7; &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="4-å‰ç«¯ï¼šçˆ¶ç»„ä»¶é€»è¾‘-ProjectExplorer-vue"><a href="#4-å‰ç«¯ï¼šçˆ¶ç»„ä»¶é€»è¾‘-ProjectExplorer-vue" class="headerlink" title="4. å‰ç«¯ï¼šçˆ¶ç»„ä»¶é€»è¾‘ (ProjectExplorer.vue)"></a>4. å‰ç«¯ï¼šçˆ¶ç»„ä»¶é€»è¾‘ (<code>ProjectExplorer.vue</code>)</h3><p>åœ¨è¿™é‡Œæˆ‘ä»¬å°†æ ‘å½¢æ•°æ®æ‹å¹³ï¼Œæ‰¹é‡å‘é€ç»™åç«¯æ ¡éªŒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- src/components/explorer/ProjectExplorer.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;explorer&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;toolbar&quot;&gt;</span><br><span class="line">        &lt;button @click=&quot;validateFiles&quot;&gt;ğŸ”„ åˆ·æ–°çŠ¶æ€&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;div class=&quot;tree-container&quot;&gt;</span><br><span class="line">      &lt;FileTreeItem </span><br><span class="line">        v-for=&quot;node in projectData&quot; </span><br><span class="line">        :key=&quot;node.path&quot;</span><br><span class="line">        :node=&quot;node&quot;</span><br><span class="line">        :depth=&quot;0&quot;</span><br><span class="line">        :selectedPath=&quot;selectedPath&quot;</span><br><span class="line">        :statusMap=&quot;fileStatusMap&quot; </span><br><span class="line">        @select=&quot;handleSelect&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, onMounted, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">import FileTreeItem from &#x27;./FileTreeItem.vue&#x27;</span><br><span class="line"></span><br><span class="line">// å‡è®¾è¿™æ˜¯ä½ ä» project.config.json è¯»å‡ºæ¥çš„åŸå§‹æ•°æ®</span><br><span class="line">const projectData = ref&lt;any[]&gt;([</span><br><span class="line">    // ç¤ºä¾‹æ•°æ®</span><br><span class="line">    &#123; </span><br><span class="line">        name: &#x27;src&#x27;, path: &#x27;D:/project/src&#x27;, type: &#x27;directory&#x27;, </span><br><span class="line">        children: [</span><br><span class="line">            &#123; name: &#x27;main.ts&#x27;, path: &#x27;D:/project/src/main.ts&#x27;, type: &#x27;file&#x27; &#125;,</span><br><span class="line">            &#123; name: &#x27;deleted.ts&#x27;, path: &#x27;D:/project/src/deleted.ts&#x27;, type: &#x27;file&#x27; &#125; // å‡è®¾è¿™ä¸ªæ–‡ä»¶è¢«åˆ äº†</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">const selectedPath = ref(&#x27;&#x27;)</span><br><span class="line">const fileStatusMap = ref&lt;Record&lt;string, boolean&gt;&gt;(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">// === æ ¸å¿ƒå·¥å…·ï¼šæ‹å¹³æ ‘ç»“æ„è·å–æ‰€æœ‰è·¯å¾„ ===</span><br><span class="line">const getAllPaths = (nodes: any[]): string[] =&gt; &#123;</span><br><span class="line">  let paths: string[] = []</span><br><span class="line">  for (const node of nodes) &#123;</span><br><span class="line">    paths.push(node.path)</span><br><span class="line">    if (node.children) &#123;</span><br><span class="line">      paths = paths.concat(getAllPaths(node.children))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return paths</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// === æ ¸å¿ƒé€»è¾‘ï¼šæ‰¹é‡æ ¡éªŒ ===</span><br><span class="line">const validateFiles = async () =&gt; &#123;</span><br><span class="line">  if (projectData.value.length === 0) return</span><br><span class="line"></span><br><span class="line">  // 1. æå–æ‰€æœ‰è·¯å¾„</span><br><span class="line">  const allPaths = getAllPaths(projectData.value)</span><br><span class="line">  </span><br><span class="line">  // 2. å‘é€ç»™ä¸»è¿›ç¨‹æ‰¹é‡æ£€æŸ¥</span><br><span class="line">  console.log(&#x27;æ­£åœ¨æ ¡éªŒæ–‡ä»¶æ•°é‡:&#x27;, allPaths.length)</span><br><span class="line">  const result = await window.fsAPI.checkPathsBatch(allPaths)</span><br><span class="line">  </span><br><span class="line">  // 3. æ›´æ–°çŠ¶æ€ Map</span><br><span class="line">  fileStatusMap.value = result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// åˆå§‹åŒ–æ—¶æ ¡éªŒä¸€æ¬¡</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  validateFiles()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// ç›‘å¬æ•°æ®å˜åŒ–ï¼ˆå¦‚æœå·¥ç¨‹æ–‡ä»¶å˜äº†ï¼Œé‡æ–°æ ¡éªŒï¼‰</span><br><span class="line">watch(projectData, () =&gt; &#123;</span><br><span class="line">    validateFiles()</span><br><span class="line">&#125;, &#123; deep: true &#125;)</span><br><span class="line"></span><br><span class="line">const handleSelect = (node: any) =&gt; &#123;</span><br><span class="line">    selectedPath.value = node.path</span><br><span class="line">    // æ‰“å¼€æ–‡ä»¶é€»è¾‘...</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ¡ˆæ€»ç»“"><a href="#æ–¹æ¡ˆæ€»ç»“" class="headerlink" title="æ–¹æ¡ˆæ€»ç»“"></a>æ–¹æ¡ˆæ€»ç»“</h3><ol><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé€šè¿‡ <code>getAllPaths</code> å°†æ ‘æ‹å¹³ï¼Œåªéœ€ <strong>ä¸€æ¬¡ IPC è°ƒç”¨</strong> å³å¯éªŒè¯æ•´ä¸ªå·¥ç¨‹æˆç™¾ä¸Šåƒä¸ªæ–‡ä»¶çš„çŠ¶æ€ï¼Œä¸ä¼šå¡é¡¿ã€‚</li><li><strong>çŠ¶æ€é©±åŠ¨ UI</strong>ï¼šä½¿ç”¨ <code>fileStatusMap</code> ä¼ é€’ç»™æ‰€æœ‰å­ç»„ä»¶ã€‚Vue çš„å“åº”å¼ç³»ç»Ÿä¼šè‡ªåŠ¨æŠŠçŠ¶æ€ä¸º <code>false</code> çš„èŠ‚ç‚¹æ¸²æŸ“æˆçº¢è‰²ã€‚</li><li><strong>äº¤äº’æ§åˆ¶</strong>ï¼šåœ¨å­ç»„ä»¶å†…éƒ¨æ‹¦æˆª <code>handleClick</code>ï¼Œå¦‚æœ <code>isMissing</code> ä¸ºçœŸï¼Œç›´æ¥ <code>return</code>ï¼Œå®ç°äº†â€œä¸èƒ½ç‚¹å‡»â€ã€‚</li></ol><p>è¿™å®Œå…¨ç¬¦åˆä½ çš„éœ€æ±‚ã€‚ä½ å¯ä»¥ç›´æ¥æŠŠè¿™æ®µæ ·å¼å’Œé€»è¾‘è´´è¿›ä½ ç°æœ‰çš„å·¦ä¾§èœå•ç»„ä»¶ä¸­ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ—¢ç„¶ä½ å·²ç»æœ‰äº†å·¥ç¨‹æ–‡ä»¶çš„ç»“æ„æ•°æ®ï¼ˆæ¯”å¦‚æ˜¯ä» &lt;code&gt;project.config.json&lt;/code&gt; è¯»å–å‡ºæ¥çš„æ ‘å½¢ç»“æ„ï¼‰ï¼Œç°åœ¨çš„æ ¸å¿ƒä»»åŠ¡æ˜¯ï¼š&lt;strong&gt;éªŒè¯è¿™äº›è·¯å¾„åœ¨ç£ç›˜ä¸Šæ˜¯å¦çœŸçš„å­˜åœ¨&lt;/strong&gt;ï¼Œå¹¶æ ¹æ®ç»“æœæ›´æ–° UIã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ &lt;strong&gt;â€œå…ƒæ•°æ®â€ vs â€œç‰©ç†æ•°æ®â€&lt;/strong&gt; çš„æ ¡éªŒåœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯æ€§èƒ½ï¼ˆé¿å…æˆç™¾ä¸Šåƒæ¬¡ IPC é€šä¿¡ï¼‰ï¼Œæˆ‘ä»¬åº”è¯¥é‡‡ç”¨ &lt;strong&gt;â€œæ‰¹é‡æ ¡éªŒâ€&lt;/strong&gt; çš„ç­–ç•¥ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>electron-vite IDEå·¦ä¾§è¯»å–å·¥ç¨‹æ–‡ä»¶</title>
    <link href="http://blog.ypintao.com/2025/12/17/%E5%89%8D%E7%AB%AF/electron/IDE%E5%B7%A6%E4%BE%A7%E8%AF%BB%E5%8F%96%E5%B7%A5%E7%A8%8B%E6%96%87%E4%BB%B6/"/>
    <id>http://blog.ypintao.com/2025/12/17/%E5%89%8D%E7%AB%AF/electron/IDE%E5%B7%A6%E4%BE%A7%E8%AF%BB%E5%8F%96%E5%B7%A5%E7%A8%8B%E6%96%87%E4%BB%B6/</id>
    <published>2025-12-17T15:30:04.028Z</published>
    <updated>2025-12-17T15:43:00.657Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç¡¬æ ¸ä¸”å®ç”¨çš„éœ€æ±‚ã€‚è¦å®ç°ç±»ä¼¼ VS Code &#x2F; Visual Studio çš„å·¥ç¨‹æ–‡ä»¶èµ„æºç®¡ç†å™¨ï¼Œæˆ‘ä»¬éœ€è¦æ‰“é€š Electron çš„ <strong>Main Process (Node.js fs èƒ½åŠ›)</strong> å’Œ <strong>Renderer Process (Vue ç»„ä»¶äº¤äº’)</strong>ã€‚</p><p>ç”±äºä»£ç é‡è¾ƒå¤§ï¼Œæˆ‘å°†åˆ†ä¸º <strong>åç«¯ (IPC&#x2F;Node)</strong> å’Œ <strong>å‰ç«¯ (Vue ç»„ä»¶)</strong> ä¸¤éƒ¨åˆ†æ¥æ„å»ºã€‚</p><span id="more"></span><h3 id="æ ¸å¿ƒåŠŸèƒ½è§„åˆ’"><a href="#æ ¸å¿ƒåŠŸèƒ½è§„åˆ’" class="headerlink" title="æ ¸å¿ƒåŠŸèƒ½è§„åˆ’"></a>æ ¸å¿ƒåŠŸèƒ½è§„åˆ’</h3><ol><li><strong>å·¥ç¨‹å…ƒæ•°æ®</strong>ï¼šåœ¨æ ¹ç›®å½•ç»´æŠ¤ä¸€ä¸ª <code>project.config.json</code>ã€‚</li><li><strong>æ–‡ä»¶æ ‘ç”Ÿæˆ</strong>ï¼šé€’å½’è¯»å–æ–‡ä»¶å¤¹ç»“æ„ï¼Œè¿‡æ»¤ <code>node_modules</code> ç­‰ã€‚</li><li><strong>CRUD æ“ä½œ</strong>ï¼šè¯»å–å†…å®¹ã€æ–°å»ºæ–‡ä»¶&#x2F;æ–‡ä»¶å¤¹ã€é‡å‘½åã€åˆ é™¤ã€‚</li><li><strong>UI äº¤äº’</strong>ï¼šé€’å½’æ ‘ç»„ä»¶ + å³é”®èœå•ã€‚</li></ol><hr><h3 id="ç¬¬ä¸€éƒ¨åˆ†ï¼šåç«¯é€»è¾‘-Node-js-IPC"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼šåç«¯é€»è¾‘-Node-js-IPC" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼šåç«¯é€»è¾‘ (Node.js + IPC)"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼šåç«¯é€»è¾‘ (Node.js + IPC)</h3><p>æˆ‘ä»¬ç»§ç»­æ²¿ç”¨æ¨¡å—åŒ–çš„æ€è·¯ï¼Œæ–°å»º <code>src/main/ipc/fs-ipc.ts</code>ã€‚</p><h4 id="1-å®šä¹‰ç±»å‹ä¸-IPC-é€»è¾‘"><a href="#1-å®šä¹‰ç±»å‹ä¸-IPC-é€»è¾‘" class="headerlink" title="1. å®šä¹‰ç±»å‹ä¸ IPC é€»è¾‘"></a>1. å®šä¹‰ç±»å‹ä¸ IPC é€»è¾‘</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main/ipc/fs-ipc.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; ipcMain, dialog, <span class="title class_">BrowserWindow</span>, shell &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs-extra&#x27;</span> <span class="comment">// å»ºè®®å®‰è£… fs-extra: npm install fs-extra @types/fs-extra</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æ–‡ä»¶èŠ‚ç‚¹ç±»å‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FileNode</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">path</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;file&#x27;</span> | <span class="string">&#x27;directory&#x27;</span></span><br><span class="line">  <span class="attr">children</span>?: <span class="title class_">FileNode</span>[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿½ç•¥åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">IGNORE_LIST</span> = [<span class="string">&#x27;.git&#x27;</span>, <span class="string">&#x27;node_modules&#x27;</span>, <span class="string">&#x27;.DS_Store&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’æ„å»ºæ–‡ä»¶æ ‘</span></span><br><span class="line"><span class="keyword">const</span> buildFileTree = (<span class="attr">dirPath</span>: <span class="built_in">string</span>): <span class="title class_">FileNode</span>[] =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> stats = fs.<span class="title function_">statSync</span>(dirPath)</span><br><span class="line">  <span class="keyword">if</span> (!stats.<span class="title function_">isDirectory</span>()) <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> children = fs.<span class="title function_">readdirSync</span>(dirPath)</span><br><span class="line">    .<span class="title function_">filter</span>(<span class="function"><span class="params">name</span> =&gt;</span> !<span class="variable constant_">IGNORE_LIST</span>.<span class="title function_">includes</span>(name))</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> fullPath = path.<span class="title function_">join</span>(dirPath, name)</span><br><span class="line">      <span class="keyword">const</span> fileStats = fs.<span class="title function_">statSync</span>(fullPath)</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> <span class="attr">node</span>: <span class="title class_">FileNode</span> = &#123;</span><br><span class="line">        name,</span><br><span class="line">        <span class="attr">path</span>: fullPath,</span><br><span class="line">        <span class="attr">type</span>: fileStats.<span class="title function_">isDirectory</span>() ? <span class="string">&#x27;directory&#x27;</span> : <span class="string">&#x27;file&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (node.<span class="property">type</span> === <span class="string">&#x27;directory&#x27;</span>) &#123;</span><br><span class="line">        node.<span class="property">children</span> = <span class="title function_">buildFileTree</span>(fullPath)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> node</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ’åºï¼šæ–‡ä»¶å¤¹åœ¨å‰ï¼Œæ–‡ä»¶åœ¨å</span></span><br><span class="line">  <span class="keyword">return</span> children.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (a.<span class="property">type</span> === b.<span class="property">type</span>) <span class="keyword">return</span> a.<span class="property">name</span>.<span class="title function_">localeCompare</span>(b.<span class="property">name</span>)</span><br><span class="line">    <span class="keyword">return</span> a.<span class="property">type</span> === <span class="string">&#x27;directory&#x27;</span> ? -<span class="number">1</span> : <span class="number">1</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupFsIPC</span>(<span class="params"></span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 1. æ‰“å¼€å·¥ç¨‹ç›®å½•</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;fs-open-project-dialog&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; canceled, filePaths &#125; = <span class="keyword">await</span> dialog.<span class="title function_">showOpenDialog</span>(&#123;</span><br><span class="line">      <span class="attr">properties</span>: [<span class="string">&#x27;openDirectory&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (canceled) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    <span class="keyword">return</span> filePaths[<span class="number">0</span>]</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. è¯»å–æ•´ä¸ªå·¥ç¨‹ç»“æ„</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;fs-read-project-tree&#x27;</span>, <span class="title function_">async</span> (_, <span class="attr">rootPath</span>: <span class="built_in">string</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(rootPath)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Path not found&#x27;</span>)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// è¯»å–æˆ–åˆ›å»ºå·¥ç¨‹é…ç½®æ–‡ä»¶</span></span><br><span class="line">      <span class="keyword">const</span> configPath = path.<span class="title function_">join</span>(rootPath, <span class="string">&#x27;project.config.json&#x27;</span>)</span><br><span class="line">      <span class="keyword">let</span> projectInfo = &#123; <span class="attr">name</span>: path.<span class="title function_">basename</span>(rootPath), <span class="attr">version</span>: <span class="string">&#x27;1.0.0&#x27;</span> &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(configPath)) &#123;</span><br><span class="line">        projectInfo = <span class="keyword">await</span> fs.<span class="title function_">readJson</span>(configPath)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> fs.<span class="title function_">writeJson</span>(configPath, projectInfo, &#123; <span class="attr">spaces</span>: <span class="number">2</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> tree = <span class="title function_">buildFileTree</span>(rootPath)</span><br><span class="line">      <span class="keyword">return</span> &#123; tree, projectInfo &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line">      <span class="keyword">throw</span> error</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. è¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;fs-read-file&#x27;</span>, <span class="title function_">async</span> (_, <span class="attr">filePath</span>: <span class="built_in">string</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> fs.<span class="title function_">readFile</span>(filePath, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. ä¿å­˜æ–‡ä»¶</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;fs-save-file&#x27;</span>, <span class="title function_">async</span> (_, &#123; filePath, content &#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> fs.<span class="title function_">writeFile</span>(filePath, content, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5. åˆ›å»ºæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;fs-create-entry&#x27;</span>, <span class="title function_">async</span> (_, &#123; parentPath, name, <span class="keyword">type</span> &#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> fullPath = path.<span class="title function_">join</span>(parentPath, name)</span><br><span class="line">    <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(fullPath)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;File already exists&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">&#x27;directory&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> fs.<span class="title function_">ensureDir</span>(fullPath)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> fs.<span class="title function_">ensureFile</span>(fullPath)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fullPath</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 6. åˆ é™¤</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;fs-delete-entry&#x27;</span>, <span class="title function_">async</span> (_, <span class="attr">filePath</span>: <span class="built_in">string</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ç§»å…¥å›æ”¶ç«™ (æ¯”ç›´æ¥åˆ é™¤æ›´å®‰å…¨)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> shell.<span class="title function_">trashedItem</span>(filePath)</span><br><span class="line">    <span class="comment">// æˆ–è€…ç›´æ¥åˆ é™¤: await fs.remove(filePath)</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è®°å¾—åœ¨ <code>src/main/index.ts</code> ä¸­è°ƒç”¨ <code>setupFsIPC()</code>ã€‚</strong></p><hr><h3 id="ç¬¬äºŒéƒ¨åˆ†ï¼šPreload-æš´éœ²-API"><a href="#ç¬¬äºŒéƒ¨åˆ†ï¼šPreload-æš´éœ²-API" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†ï¼šPreload æš´éœ² API"></a>ç¬¬äºŒéƒ¨åˆ†ï¼šPreload æš´éœ² API</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/preload/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; contextBridge, ipcRenderer &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fsAPI = &#123;</span><br><span class="line">  <span class="attr">openProject</span>: <span class="function">() =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;fs-open-project-dialog&#x27;</span>),</span><br><span class="line">  <span class="attr">readProjectTree</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;fs-read-project-tree&#x27;</span>, path),</span><br><span class="line">  <span class="attr">readFile</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;fs-read-file&#x27;</span>, path),</span><br><span class="line">  <span class="attr">saveFile</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span>, <span class="attr">content</span>: <span class="built_in">string</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;fs-save-file&#x27;</span>, &#123; <span class="attr">filePath</span>: path, content &#125;),</span><br><span class="line">  <span class="attr">createEntry</span>: <span class="function">(<span class="params"><span class="attr">parentPath</span>: <span class="built_in">string</span>, <span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">type</span>: <span class="string">&#x27;file&#x27;</span> | <span class="string">&#x27;directory&#x27;</span></span>) =&gt;</span> </span><br><span class="line">    ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;fs-create-entry&#x27;</span>, &#123; parentPath, name, <span class="keyword">type</span> &#125;),</span><br><span class="line">  <span class="attr">deleteEntry</span>: <span class="function">(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>) =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;fs-delete-entry&#x27;</span>, path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">contextIsolated</span>) &#123;</span><br><span class="line">  contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&#x27;fsAPI&#x27;</span>, fsAPI)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">fsAPI</span> = fsAPI</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ç¬¬ä¸‰éƒ¨åˆ†ï¼šå‰ç«¯-Vue-ç»„ä»¶-é€’å½’æ ‘-å³é”®èœå•"><a href="#ç¬¬ä¸‰éƒ¨åˆ†ï¼šå‰ç«¯-Vue-ç»„ä»¶-é€’å½’æ ‘-å³é”®èœå•" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ†ï¼šå‰ç«¯ Vue ç»„ä»¶ (é€’å½’æ ‘ + å³é”®èœå•)"></a>ç¬¬ä¸‰éƒ¨åˆ†ï¼šå‰ç«¯ Vue ç»„ä»¶ (é€’å½’æ ‘ + å³é”®èœå•)</h3><p>æˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªç»„ä»¶ï¼š</p><ol><li><code>FileTreeItem.vue</code>: é€’å½’æ¸²æŸ“å•ä¸ªèŠ‚ç‚¹ã€‚</li><li><code>ProjectExplorer.vue</code>: å®¹å™¨ï¼Œå¤„ç†å³é”®èœå•é€»è¾‘ã€‚</li></ol><h4 id="1-é€’å½’å­ç»„ä»¶-src-components-explorer-FileTreeItem-vue"><a href="#1-é€’å½’å­ç»„ä»¶-src-components-explorer-FileTreeItem-vue" class="headerlink" title="1. é€’å½’å­ç»„ä»¶ src/components/explorer/FileTreeItem.vue"></a>1. é€’å½’å­ç»„ä»¶ <code>src/components/explorer/FileTreeItem.vue</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;tree-item&quot;&gt;</span><br><span class="line">    &lt;!-- å½“å‰è¡Œå†…å®¹ --&gt;</span><br><span class="line">    &lt;div </span><br><span class="line">      class=&quot;item-label&quot; </span><br><span class="line">      :class=&quot;&#123; selected: isSelected &#125;&quot;</span><br><span class="line">      :style=&quot;&#123; paddingLeft: `$&#123;depth * 16 + 8&#125;px` &#125;&quot;</span><br><span class="line">      @click.stop=&quot;onLeftClick&quot;</span><br><span class="line">      @contextmenu.prevent.stop=&quot;onRightClick&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- å›¾æ ‡ (å¯ç”¨ iconify æˆ– svg æ›¿æ¢) --&gt;</span><br><span class="line">      &lt;span class=&quot;icon&quot;&gt;&#123;&#123; node.type === &#x27;directory&#x27; ? (isOpen ? &#x27;ğŸ“‚&#x27; : &#x27;ğŸ“&#x27;) : &#x27;ğŸ“„&#x27; &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;span class=&quot;name&quot;&gt;&#123;&#123; node.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- é€’å½’æ¸²æŸ“å­èŠ‚ç‚¹ --&gt;</span><br><span class="line">    &lt;div v-if=&quot;node.type === &#x27;directory&#x27; &amp;&amp; isOpen&quot;&gt;</span><br><span class="line">      &lt;FileTreeItem </span><br><span class="line">        v-for=&quot;child in node.children&quot; </span><br><span class="line">        :key=&quot;child.path&quot;</span><br><span class="line">        :node=&quot;child&quot;</span><br><span class="line">        :depth=&quot;depth + 1&quot;</span><br><span class="line">        :selectedPath=&quot;selectedPath&quot;</span><br><span class="line">        @select=&quot;$emit(&#x27;select&#x27;, $event)&quot;</span><br><span class="line">        @context-menu=&quot;$emit(&#x27;context-menu&#x27;, $event)&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps&lt;&#123;</span><br><span class="line">  node: any</span><br><span class="line">  depth: number</span><br><span class="line">  selectedPath: string</span><br><span class="line">&#125;&gt;()</span><br><span class="line"></span><br><span class="line">const emit = defineEmits([&#x27;select&#x27;, &#x27;context-menu&#x27;])</span><br><span class="line"></span><br><span class="line">const isOpen = ref(false)</span><br><span class="line"></span><br><span class="line">// è®¡ç®—æ˜¯å¦è¢«é€‰ä¸­</span><br><span class="line">const isSelected = computed(() =&gt; props.selectedPath === props.node.path)</span><br><span class="line"></span><br><span class="line">const onLeftClick = () =&gt; &#123;</span><br><span class="line">  if (props.node.type === &#x27;directory&#x27;) &#123;</span><br><span class="line">    isOpen.value = !isOpen.value</span><br><span class="line">  &#125;</span><br><span class="line">  emit(&#x27;select&#x27;, props.node)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const onRightClick = (event: MouseEvent) =&gt; &#123;</span><br><span class="line">  // å°†äº‹ä»¶å’Œå½“å‰èŠ‚ç‚¹ä¿¡æ¯å‘ä¸ŠæŠ›å‡º</span><br><span class="line">  emit(&#x27;context-menu&#x27;, &#123; event, node: props.node &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.item-label &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  padding: 4px 0;</span><br><span class="line">  user-select: none;</span><br><span class="line">  color: #ccc;</span><br><span class="line">&#125;</span><br><span class="line">.item-label:hover &#123; background-color: #2a2d2e; &#125;</span><br><span class="line">.item-label.selected &#123; background-color: #37373d; color: white; &#125;</span><br><span class="line">.icon &#123; margin-right: 6px; font-size: 14px; &#125;</span><br><span class="line">.name &#123; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="2-ä¸»å®¹å™¨ç»„ä»¶-src-components-explorer-ProjectExplorer-vue"><a href="#2-ä¸»å®¹å™¨ç»„ä»¶-src-components-explorer-ProjectExplorer-vue" class="headerlink" title="2. ä¸»å®¹å™¨ç»„ä»¶ src/components/explorer/ProjectExplorer.vue"></a>2. ä¸»å®¹å™¨ç»„ä»¶ <code>src/components/explorer/ProjectExplorer.vue</code></h4><p>è¿™é‡ŒåŒ…å«äº†<strong>æ ¸å¿ƒä¸šåŠ¡é€»è¾‘</strong>ï¼šåŠ è½½å·¥ç¨‹ã€å³é”®èœå•ã€åˆ›å»º&#x2F;åˆ é™¤æ–‡ä»¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;explorer-container&quot;&gt;</span><br><span class="line">    &lt;!-- é¡¶éƒ¨å·¥å…·æ  --&gt;</span><br><span class="line">    &lt;div class=&quot;toolbar&quot;&gt;</span><br><span class="line">      &lt;span&gt;&#123;&#123; projectName || &#x27;æœªæ‰“å¼€å·¥ç¨‹&#x27; &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;button @click=&quot;openProject&quot; class=&quot;icon-btn&quot;&gt;ğŸ“‚&lt;/button&gt;</span><br><span class="line">      &lt;button @click=&quot;refreshTree&quot; class=&quot;icon-btn&quot; v-if=&quot;projectPath&quot;&gt;ğŸ”„&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- æ–‡ä»¶æ ‘åŒºåŸŸ --&gt;</span><br><span class="line">    &lt;div class=&quot;tree-content&quot; @contextmenu.prevent=&quot;onEmptyAreaRightClick&quot;&gt;</span><br><span class="line">      &lt;FileTreeItem </span><br><span class="line">        v-for=&quot;node in fileTree&quot; </span><br><span class="line">        :key=&quot;node.path&quot;</span><br><span class="line">        :node=&quot;node&quot;</span><br><span class="line">        :depth=&quot;0&quot;</span><br><span class="line">        :selectedPath=&quot;selectedPath&quot;</span><br><span class="line">        @select=&quot;onFileSelect&quot;</span><br><span class="line">        @context-menu=&quot;handleContextMenu&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- è‡ªå®šä¹‰å³é”®èœå• --&gt;</span><br><span class="line">    &lt;div </span><br><span class="line">      v-if=&quot;contextMenu.visible&quot; </span><br><span class="line">      class=&quot;context-menu&quot;</span><br><span class="line">      :style=&quot;&#123; top: `$&#123;contextMenu.y&#125;px`, left: `$&#123;contextMenu.x&#125;px` &#125;&quot;</span><br><span class="line">      @blur=&quot;closeContextMenu&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div class=&quot;menu-item disabled&quot;&gt;&#123;&#123; contextMenu.targetName &#125;&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;divider&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;menu-item&quot; @click=&quot;createNew(&#x27;file&#x27;)&quot;&gt;ğŸ“„ æ–°å»ºæ–‡ä»¶&lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;menu-item&quot; @click=&quot;createNew(&#x27;directory&#x27;)&quot;&gt;ğŸ“ æ–°å»ºæ–‡ä»¶å¤¹&lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;divider&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;menu-item delete&quot; @click=&quot;deleteItem&quot;&gt;ğŸ—‘ åˆ é™¤&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, reactive, onMounted, onUnmounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import FileTreeItem from &#x27;./FileTreeItem.vue&#x27;</span><br><span class="line"></span><br><span class="line">// çŠ¶æ€</span><br><span class="line">const projectPath = ref(&#x27;&#x27;)</span><br><span class="line">const projectName = ref(&#x27;&#x27;)</span><br><span class="line">const fileTree = ref&lt;any[]&gt;([])</span><br><span class="line">const selectedPath = ref(&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line">// å³é”®èœå•çŠ¶æ€</span><br><span class="line">const contextMenu = reactive(&#123;</span><br><span class="line">  visible: false,</span><br><span class="line">  x: 0,</span><br><span class="line">  y: 0,</span><br><span class="line">  targetNode: null as any | null, // å³é”®ç‚¹å‡»çš„èŠ‚ç‚¹</span><br><span class="line">  targetName: &#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// === 1. æ‰“å¼€å·¥ç¨‹ ===</span><br><span class="line">const openProject = async () =&gt; &#123;</span><br><span class="line">  const path = await window.fsAPI.openProject()</span><br><span class="line">  if (path) &#123;</span><br><span class="line">    projectPath.value = path</span><br><span class="line">    await loadTree()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// === 2. åŠ è½½æ–‡ä»¶æ ‘ ===</span><br><span class="line">const loadTree = async () =&gt; &#123;</span><br><span class="line">  if (!projectPath.value) return</span><br><span class="line">  const &#123; tree, projectInfo &#125; = await window.fsAPI.readProjectTree(projectPath.value)</span><br><span class="line">  fileTree.value = tree</span><br><span class="line">  projectName.value = projectInfo.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const refreshTree = () =&gt; loadTree()</span><br><span class="line"></span><br><span class="line">// === 3. æ–‡ä»¶é€‰æ‹© ===</span><br><span class="line">const onFileSelect = async (node: any) =&gt; &#123;</span><br><span class="line">  selectedPath.value = node.path</span><br><span class="line">  if (node.type === &#x27;file&#x27;) &#123;</span><br><span class="line">    // TODO: è¿™é‡Œå¯ä»¥è°ƒç”¨ Dockview æˆ– EventBus æ‰“å¼€æ–‡ä»¶ç¼–è¾‘å™¨</span><br><span class="line">    // const content = await window.fsAPI.readFile(node.path)</span><br><span class="line">    console.log(&#x27;æ‰“å¼€æ–‡ä»¶:&#x27;, node.path)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// === 4. å³é”®èœå•å¤„ç† ===</span><br><span class="line">const handleContextMenu = (&#123; event, node &#125;: any) =&gt; &#123;</span><br><span class="line">  showMenu(event, node)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const onEmptyAreaRightClick = (event: MouseEvent) =&gt; &#123;</span><br><span class="line">  // åœ¨ç©ºç™½å¤„ç‚¹å‡»ï¼Œè§†ä½œåœ¨æ ¹ç›®å½•æ“ä½œ</span><br><span class="line">  showMenu(event, &#123; </span><br><span class="line">    path: projectPath.value, </span><br><span class="line">    type: &#x27;directory&#x27;, </span><br><span class="line">    name: &#x27;æ ¹ç›®å½•&#x27; </span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const showMenu = (event: MouseEvent, node: any) =&gt; &#123;</span><br><span class="line">  contextMenu.visible = true</span><br><span class="line">  contextMenu.x = event.clientX</span><br><span class="line">  contextMenu.y = event.clientY</span><br><span class="line">  contextMenu.targetNode = node</span><br><span class="line">  contextMenu.targetName = node.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const closeContextMenu = () =&gt; &#123;</span><br><span class="line">  contextMenu.visible = false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// === 5. åˆ›å»ºæ–‡ä»¶/æ–‡ä»¶å¤¹ ===</span><br><span class="line">const createNew = async (type: &#x27;file&#x27; | &#x27;directory&#x27;) =&gt; &#123;</span><br><span class="line">  closeContextMenu()</span><br><span class="line">  if (!contextMenu.targetNode) return</span><br><span class="line"></span><br><span class="line">  // ç¡®å®šçˆ¶ç›®å½• (å¦‚æœæ˜¯æ–‡ä»¶ï¼Œåˆ™åœ¨åŒçº§åˆ›å»ºï¼›å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œåˆ™åœ¨å†…éƒ¨åˆ›å»º)</span><br><span class="line">  const parentPath = contextMenu.targetNode.type === &#x27;directory&#x27; </span><br><span class="line">    ? contextMenu.targetNode.path </span><br><span class="line">    : contextMenu.targetNode.path.replace(/[\\/][^\\/]+$/, &#x27;&#x27;) // è·å–çˆ¶çº§è·¯å¾„</span><br><span class="line">  </span><br><span class="line">  // ç®€å•èµ·è§ï¼Œè¿™é‡Œç”¨ promptï¼Œå®é™…å¯ä»¥ç”¨ Modal å¼¹çª—</span><br><span class="line">  const name = prompt(`è¯·è¾“å…¥$&#123;type === &#x27;file&#x27; ? &#x27;æ–‡ä»¶&#x27; : &#x27;æ–‡ä»¶å¤¹&#x27;&#125;åç§°:`)</span><br><span class="line">  if (!name) return</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    await window.fsAPI.createEntry(parentPath, name, type)</span><br><span class="line">    await refreshTree() // åˆ·æ–°æ ‘</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    alert(&#x27;åˆ›å»ºå¤±è´¥: &#x27; + e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// === 6. åˆ é™¤ ===</span><br><span class="line">const deleteItem = async () =&gt; &#123;</span><br><span class="line">  closeContextMenu()</span><br><span class="line">  const node = contextMenu.targetNode</span><br><span class="line">  if (!node || node.path === projectPath.value) return</span><br><span class="line"></span><br><span class="line">  if (!confirm(`ç¡®å®šè¦åˆ é™¤ $&#123;node.name&#125; å—ï¼Ÿ`)) return</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    await window.fsAPI.deleteEntry(node.path)</span><br><span class="line">    await refreshTree()</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    alert(&#x27;åˆ é™¤å¤±è´¥&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•</span><br><span class="line">const onClickOutside = () =&gt; closeContextMenu()</span><br><span class="line">onMounted(() =&gt; window.addEventListener(&#x27;click&#x27;, onClickOutside))</span><br><span class="line">onUnmounted(() =&gt; window.removeEventListener(&#x27;click&#x27;, onClickOutside))</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.explorer-container &#123;</span><br><span class="line">  height: 100%;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  background-color: #1e1e1e;</span><br><span class="line">  color: #ccc;</span><br><span class="line">  font-family: &#x27;Segoe UI&#x27;, sans-serif;</span><br><span class="line">  user-select: none;</span><br><span class="line">&#125;</span><br><span class="line">.toolbar &#123;</span><br><span class="line">  padding: 8px;</span><br><span class="line">  background-color: #252526;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  align-items: center;</span><br><span class="line">  font-size: 12px;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">&#125;</span><br><span class="line">.icon-btn &#123;</span><br><span class="line">  background: none; border: none; cursor: pointer; color: #ccc;</span><br><span class="line">&#125;</span><br><span class="line">.icon-btn:hover &#123; color: white; &#125;</span><br><span class="line">.tree-content &#123;</span><br><span class="line">  flex: 1;</span><br><span class="line">  overflow-y: auto;</span><br><span class="line">  padding-top: 4px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* å³é”®èœå•æ ·å¼ */</span><br><span class="line">.context-menu &#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">  background: #252526;</span><br><span class="line">  border: 1px solid #454545;</span><br><span class="line">  box-shadow: 0 4px 6px rgba(0,0,0,0.3);</span><br><span class="line">  min-width: 150px;</span><br><span class="line">  z-index: 9999;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">  padding: 4px 0;</span><br><span class="line">&#125;</span><br><span class="line">.menu-item &#123;</span><br><span class="line">  padding: 6px 12px;</span><br><span class="line">  font-size: 13px;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  color: #cccccc;</span><br><span class="line">&#125;</span><br><span class="line">.menu-item:hover:not(.disabled) &#123;</span><br><span class="line">  background-color: #094771;</span><br><span class="line">  color: white;</span><br><span class="line">&#125;</span><br><span class="line">.menu-item.disabled &#123;</span><br><span class="line">  color: #666;</span><br><span class="line">  cursor: default;</span><br><span class="line">  font-size: 12px;</span><br><span class="line">  border-bottom: 1px solid #333;</span><br><span class="line">&#125;</span><br><span class="line">.menu-item.delete:hover &#123;</span><br><span class="line">  background-color: #710909;</span><br><span class="line">&#125;</span><br><span class="line">.divider &#123;</span><br><span class="line">  height: 1px;</span><br><span class="line">  background-color: #454545;</span><br><span class="line">  margin: 4px 0;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="å¦‚ä½•é›†æˆåˆ°ä½ çš„-Dockview"><a href="#å¦‚ä½•é›†æˆåˆ°ä½ çš„-Dockview" class="headerlink" title="å¦‚ä½•é›†æˆåˆ°ä½ çš„ Dockview"></a>å¦‚ä½•é›†æˆåˆ°ä½ çš„ Dockview</h3><p>ä½ å¯ä»¥å°† <code>ProjectExplorer.vue</code> ä½œä¸ºä¸€ä¸ª Panel æ”¾å…¥ Dockview çš„ä¾§è¾¹æ ï¼ˆå¦‚æœä½ çš„å¸ƒå±€æ”¯æŒä¾§è¾¹æ ï¼‰ï¼Œæˆ–è€…ä½œä¸ºä¸€ä¸ªæ™®é€šçš„ Panelã€‚</p><p><strong>å…³é”®çš„è”åŠ¨ç‚¹ï¼š</strong></p><ol><li><p><strong>æ–‡ä»¶ç‚¹å‡»</strong>ï¼š</p><ul><li>åœ¨ <code>onFileSelect</code> ä¸­ï¼Œè·å–åˆ° <code>node.path</code>ã€‚</li><li>è°ƒç”¨æˆ‘ä»¬ä¹‹å‰å®ç°çš„ <code>tab-manager</code> -&gt; <code>findAndActivateTab(node.path)</code>ã€‚</li><li>å¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™è¯»å–æ–‡ä»¶å†…å®¹ (<code>window.fsAPI.readFile(node.path)</code>)ï¼Œç„¶å <code>dockAPI.addPanel</code> åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼–è¾‘å™¨ Tabï¼ŒID ä½¿ç”¨æ–‡ä»¶è·¯å¾„ï¼ˆç¡®ä¿å”¯ä¸€ï¼‰ã€‚</li></ul></li><li><p><strong>å³é”®åˆ›å»º</strong>ï¼š</p><ul><li>åˆ›å»ºæ–‡ä»¶æˆåŠŸåï¼Œå¯ä»¥è‡ªåŠ¨è§¦å‘ä¸€æ¬¡â€œæ‰“å¼€æ–‡ä»¶â€çš„æ“ä½œï¼Œä½“éªŒä¼šæ›´å¥½ã€‚</li></ul></li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸ª Demo å®ç°äº†ï¼š</p><ol><li><strong>Node.js å±‚</strong>ï¼šå®‰å…¨çš„ <code>fs</code> å°è£…ï¼Œåªæš´éœ²å¿…è¦æ¥å£ã€‚</li><li><strong>æ•°æ®å±‚</strong>ï¼šç®€å•çš„ <code>project.config.json</code> è¯»å†™ã€‚</li><li><strong>UI å±‚</strong>ï¼šé€’å½’æ–‡ä»¶æ ‘ï¼Œæ”¯æŒæ— é™å±‚çº§ã€‚</li><li><strong>äº¤äº’</strong>ï¼šVS Code é£æ ¼çš„å³é”®èœå•ï¼Œæ”¯æŒæ–°å»ºå’Œåˆ é™¤ã€‚</li></ol><p>è¿™åŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªè½»é‡çº§ IDE èµ„æºç®¡ç†å™¨çš„é›å½¢äº†ã€‚ä½ å¯ä»¥æŠŠ <code>ProjectExplorer.vue</code> å¤åˆ¶è¿›å»ç›´æ¥è¿è¡Œã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªéå¸¸ç¡¬æ ¸ä¸”å®ç”¨çš„éœ€æ±‚ã€‚è¦å®ç°ç±»ä¼¼ VS Code &amp;#x2F; Visual Studio çš„å·¥ç¨‹æ–‡ä»¶èµ„æºç®¡ç†å™¨ï¼Œæˆ‘ä»¬éœ€è¦æ‰“é€š Electron çš„ &lt;strong&gt;Main Process (Node.js fs èƒ½åŠ›)&lt;/strong&gt; å’Œ &lt;strong&gt;Renderer Process (Vue ç»„ä»¶äº¤äº’)&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºä»£ç é‡è¾ƒå¤§ï¼Œæˆ‘å°†åˆ†ä¸º &lt;strong&gt;åç«¯ (IPC&amp;#x2F;Node)&lt;/strong&gt; å’Œ &lt;strong&gt;å‰ç«¯ (Vue ç»„ä»¶)&lt;/strong&gt; ä¸¤éƒ¨åˆ†æ¥æ„å»ºã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>å¤šçª—å£äº‹ä»¶æ€»çº¿æ€ä¹ˆå¤„ç†</title>
    <link href="http://blog.ypintao.com/2025/12/16/%E5%89%8D%E7%AB%AF/electron/%E5%A4%9A%E7%AA%97%E5%8F%A3%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86/"/>
    <id>http://blog.ypintao.com/2025/12/16/%E5%89%8D%E7%AB%AF/electron/%E5%A4%9A%E7%AA%97%E5%8F%A3%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86/</id>
    <published>2025-12-16T13:52:57.677Z</published>
    <updated>2025-12-16T15:04:31.801Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>æˆ‘ç°åœ¨åšçš„æ˜¯å¤šçª—å£åº”ç”¨ï¼ˆåŸºäºelectron-vite,vue3,å’Œdokeviewï¼‰ï¼Œç°åœ¨æœ‰ä¸€ä¸ªåœºæ™¯ï¼šæˆ‘ä»¬åŸé¡¹ç›®é‡Œé¢å¤šå‡ºåœ°æ–¹ä½¿ç”¨çš„äº‹ä»¶æ€»çº¿æ¨¡å¼ï¼Œåœ¨ç»„ä»¶æŒ‚è½½çš„æ—¶å€™æ³¨å†Œäº‹ä»¶ï¼Œåœ¨ç»„ä»¶é”€æ¯çš„æ—¶å€™offäº‹ä»¶ï¼Œç°åœ¨æ”¹æˆå¤šçª—å£åº”ç”¨åï¼Œå°±å‡ºç°äº†æ‰“å¼€äº†å¤šä¸ªæ³¨å†Œäº‹ä»¶çš„çª—å£ï¼Œäº‹ä»¶è§¦å‘çš„æ—¶å€™ä¼šè§¦å‘å¤šæ¬¡ï¼Œäº‹ä»¶å…³é—­çš„æ—¶å€™å°±å…¨éƒ½å…³é—­äº†ã€‚è¿™ç§æƒ…å†µ æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ</p><span id="more"></span><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„æ¶æ„æ¼”è¿›é—®é¢˜ã€‚å½“ä½ ä»â€œå•é¡µé¢åº”ç”¨ (SPA)â€è½¬å˜ä¸ºâ€œå¤šçª—å£åº”ç”¨ (Multi-Window)â€æ—¶ï¼Œä¼ ç»Ÿçš„äº‹ä»¶æ€»çº¿ï¼ˆEventBusï¼‰æ¨¡å¼å¦‚æœä¸åŠ æ”¹é€ ï¼Œå¿…ç„¶ä¼šé‡åˆ°**â€œå¹¿æ’­é£æš´â€<strong>ï¼ˆè§¦å‘å¤šæ¬¡ï¼‰å’Œ</strong>â€œè¯¯æ€â€**ï¼ˆå…³ä¸€ä¸ªå…¨å…³äº†ï¼‰çš„é—®é¢˜ã€‚</p><h3 id="é—®é¢˜æ ¹æºåˆ†æ"><a href="#é—®é¢˜æ ¹æºåˆ†æ" class="headerlink" title="é—®é¢˜æ ¹æºåˆ†æ"></a>é—®é¢˜æ ¹æºåˆ†æ</h3><ol><li><p><strong>è§¦å‘å¤šæ¬¡ (Broadcast Storm)</strong>ï¼š</p><ul><li>å¦‚æœä½ çš„äº‹ä»¶æ€»çº¿æ˜¯åŸºäº IPCï¼ˆ<code>ipcRenderer</code>ï¼‰æˆ– <code>BroadcastChannel</code> çš„ï¼Œæ¶ˆæ¯æ˜¯å¹¿æ’­çš„ã€‚</li><li>ä½ æœ‰ 3 ä¸ªçª—å£ï¼Œæ¯ä¸ªçª—å£é‡Œçš„ç»„ä»¶éƒ½ç›‘å¬äº† <code>refresh-data</code>ã€‚</li><li>å½“ä¸€ä¸ªäº‹ä»¶å‘å‡ºæ—¶ï¼Œ3 ä¸ªçª—å£éƒ½æ”¶åˆ°äº†ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œäº† 3 æ¬¡ã€‚</li><li><em>ä½†åœ¨æ—§çš„å•é¡µåº”ç”¨æ€ç»´é‡Œï¼Œé€šå¸¸é¢„æœŸæ˜¯è°å‘å‡ºçš„ï¼Œæˆ–è€…è°åœ¨å½“å‰è§†é‡é‡Œï¼Œè°æ‰å“åº”ã€‚</em></li></ul></li><li><p><strong>å…¨éƒ½ä¸è§¦å‘äº† (Premature Unsubscription)</strong>ï¼š</p><ul><li>è¿™æ˜¯æœ€å¸¸è§çš„é—®é¢˜ã€‚ä½ çš„ä»£ç å¯èƒ½å†™çš„æ˜¯ <code>bus.off(&#39;event-name&#39;)</code>ã€‚</li><li>è¿™ä¼šç§»é™¤<strong>è¯¥äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨</strong>ã€‚</li><li>åœ¨å¤šçª—å£ï¼ˆæˆ–åŒä¸€çª—å£å¤š Tabï¼‰åœºæ™¯ä¸‹ï¼Œçª—å£ A é”€æ¯ç»„ä»¶æ—¶è°ƒç”¨äº† <code>off</code>ï¼Œç»“æœæŠŠçª—å£ Bï¼ˆç”šè‡³åŒçª—å£ä¸‹çš„ Tab Bï¼‰æ­£åœ¨ç”¨çš„ç›‘å¬å™¨ä¹Ÿç»™åˆ æ‰äº†ã€‚</li></ul></li></ol><hr><h3 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ä½ éœ€è¦å°†äº‹ä»¶æ€»çº¿å‡çº§ä¸º <strong>â€œå¤šçº§åˆ†å‘ç­–ç•¥â€</strong>ã€‚æˆ‘ä»¬éœ€è¦æ˜ç¡®åŒºåˆ†ï¼š<strong>è¿™æ˜¯ç»™è°çš„æ¶ˆæ¯ï¼Ÿ</strong></p><p>æˆ‘ä¸ºä½ æä¾›ä¸€å¥— <strong>â€œå¸¦ä½œç”¨åŸŸçš„åˆ†å¸ƒå¼äº‹ä»¶æ€»çº¿â€</strong> è§£å†³æ–¹æ¡ˆã€‚</p><h4 id="æ ¸å¿ƒç­–ç•¥"><a href="#æ ¸å¿ƒç­–ç•¥" class="headerlink" title="æ ¸å¿ƒç­–ç•¥"></a>æ ¸å¿ƒç­–ç•¥</h4><ol><li><strong>ç²¾ç¡®é”€æ¯</strong>ï¼šç»å¯¹ç¦æ­¢ä½¿ç”¨ <code>bus.off(&#39;name&#39;)</code>ï¼ˆæ¸…ç©ºæ‰€æœ‰ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨ <code>bus.off(&#39;name&#39;, handler)</code>ï¼ˆåªç§»é™¤å½“å‰å‡½æ•°çš„å¼•ç”¨ï¼‰ã€‚</li><li><strong>ä½œç”¨åŸŸåŒºåˆ† (Scoping)</strong>ï¼š<ul><li><strong>Local (æœ¬åœ°)</strong>ï¼šåªåœ¨å½“å‰çª—å£&#x2F;å½“å‰ç»„ä»¶å†…ç”Ÿæ•ˆï¼ˆä½¿ç”¨ <code>mitt</code> æˆ–ç®€å•çš„å›è°ƒï¼‰ã€‚</li><li><strong>Global (å…¨å±€)</strong>ï¼šæ‰€æœ‰çª—å£éƒ½ç”Ÿæ•ˆï¼ˆä¾‹å¦‚ï¼šç”¨æˆ·é€€å‡ºç™»å½•ï¼‰ã€‚</li><li><strong>Targeted (å®šå‘)</strong>ï¼šåªå‘ç»™ç‰¹å®šçš„ <code>panelId</code> æˆ– <code>windowId</code>ï¼ˆä¾‹å¦‚ï¼šåˆ·æ–°è¡¨æ ¼ï¼Œåªåˆ·æ–° ID ä¸º <code>user-table</code> çš„é‚£ä¸ªï¼‰ã€‚</li></ul></li></ol><hr><h3 id="ä»£ç å®ç°ï¼šDistributedEventBus"><a href="#ä»£ç å®ç°ï¼šDistributedEventBus" class="headerlink" title="ä»£ç å®ç°ï¼šDistributedEventBus"></a>ä»£ç å®ç°ï¼š<code>DistributedEventBus</code></h3><p>æˆ‘ä»¬å°†å°è£…ä¸€ä¸ªæ™ºèƒ½çš„ EventBusï¼Œå®ƒåº•å±‚ç»“åˆäº† <code>mitt</code> (æœ¬åœ°) å’Œ <code>BroadcastChannel</code> (è·¨çª—å£)ã€‚</p><h4 id="1-å·¥å…·ç±»å°è£…-src-utils-event-bus-ts"><a href="#1-å·¥å…·ç±»å°è£…-src-utils-event-bus-ts" class="headerlink" title="1. å·¥å…·ç±»å°è£… (src/utils/event-bus.ts)"></a>1. å·¥å…·ç±»å°è£… (<code>src/utils/event-bus.ts</code>)</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mitt, &#123; <span class="title class_">Handler</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;mitt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æ¶ˆæ¯ç»“æ„</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">BusPayload</span> = &#123;</span><br><span class="line">  <span class="attr">event</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">data</span>: <span class="built_in">any</span></span><br><span class="line">  <span class="attr">targetId</span>?: <span class="built_in">string</span> <span class="comment">// æŒ‡å®šæ¥æ”¶ç›®æ ‡çš„ ID (PanelId æˆ– WindowId)</span></span><br><span class="line">  <span class="attr">sourceId</span>?: <span class="built_in">string</span> <span class="comment">// å‘é€è€…çš„ ID</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">DistributedEventBus</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> localBus = <span class="title function_">mitt</span>() <span class="comment">// æœ¬åœ°äº‹ä»¶ä¸­å¿ƒ</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">channel</span>: <span class="title class_">BroadcastChannel</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">myId</span>: <span class="built_in">string</span> <span class="comment">// å½“å‰å®ä¾‹/çª—å£çš„ ID</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">channelName</span>: <span class="built_in">string</span> = <span class="string">&#x27;app-global-bus&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="comment">// ç”Ÿæˆæˆ–è·å–å½“å‰ç¯å¢ƒ ID (å¯ä»¥ä½¿ç”¨ä¹‹å‰ Pinia æ’ä»¶é‡Œçš„ generateId é€»è¾‘)</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">myId</span> = <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substr</span>(<span class="number">2</span>, <span class="number">9</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. åˆå§‹åŒ–è·¨çª—å£é€šé“</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">channel</span> = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(channelName)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç›‘å¬æ¥è‡ªå…¶ä»–çª—å£çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">channel</span>.<span class="property">onmessage</span> = <span class="function">(<span class="params"><span class="attr">msg</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">BusPayload</span>&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; event, data, targetId, sourceId &#125; = msg.<span class="property">data</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// A. å¦‚æœæŒ‡å®šäº† targetIdï¼Œä¸”ä¸æ˜¯å‘ç»™æˆ‘çš„ -&gt; å¿½ç•¥</span></span><br><span class="line">      <span class="comment">// (è¿™é‡Œå‡è®¾ myId æ˜¯çª—å£IDï¼Œæˆ–è€…æ˜¯ä½ ä¼ å…¥çš„ panelId)</span></span><br><span class="line">      <span class="keyword">if</span> (targetId &amp;&amp; targetId !== <span class="variable language_">this</span>.<span class="property">myId</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// B. è§¦å‘æœ¬åœ°ç›‘å¬å™¨</span></span><br><span class="line">      <span class="comment">// æ³¨æ„ï¼šæˆ‘ä»¬åœ¨æœ¬åœ°è§¦å‘æ—¶ï¼Œæ ‡è®°å®ƒæ¥è‡ª&quot;å¤–éƒ¨&quot;ï¼Œé¿å…æ­»å¾ªç¯</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">localBus</span>.<span class="title function_">emit</span>(event, &#123; ...data, <span class="attr">_fromRemote</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ³¨å†Œç›‘å¬ (ç”¨æ³•å’Œä»¥å‰ä¸€æ ·)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">on</span>(<span class="params"><span class="attr">event</span>: <span class="built_in">string</span>, <span class="attr">handler</span>: <span class="title class_">Handler</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">localBus</span>.<span class="title function_">on</span>(event, handler)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç§»é™¤ç›‘å¬ (å¿…é¡»ä¼ å…¥ handler å¼•ç”¨ï¼)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">off</span>(<span class="params"><span class="attr">event</span>: <span class="built_in">string</span>, <span class="attr">handler</span>: <span class="title class_">Handler</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">localBus</span>.<span class="title function_">off</span>(event, handler)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å‘é€äº‹ä»¶</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> event äº‹ä»¶å</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> data æ•°æ®</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> scope å‘é€èŒƒå›´</span></span><br><span class="line"><span class="comment">   *    - &#x27;local&#x27;: åªåœ¨å½“å‰çª—å£è§¦å‘ (é»˜è®¤)</span></span><br><span class="line"><span class="comment">   *    - &#x27;global&#x27;: æ‰€æœ‰çª—å£éƒ½è§¦å‘</span></span><br><span class="line"><span class="comment">   *    - string: æŒ‡å®š ID (åªå‘ç»™ç‰¹å®š ID çš„å®ä¾‹)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">emit</span>(<span class="params"><span class="attr">event</span>: <span class="built_in">string</span>, <span class="attr">data</span>: <span class="built_in">any</span> = &#123;&#125;, <span class="attr">scope</span>: <span class="string">&#x27;local&#x27;</span> | <span class="string">&#x27;global&#x27;</span> | <span class="built_in">string</span> = <span class="string">&#x27;local&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 1. æ€»æ˜¯è§¦å‘æœ¬åœ° (é™¤éæœ‰ç‰¹æ®Šéœ€æ±‚)</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">localBus</span>.<span class="title function_">emit</span>(event, data)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. æ ¹æ®èŒƒå›´å†³å®šæ˜¯å¦å¹¿æ’­</span></span><br><span class="line">    <span class="keyword">if</span> (scope === <span class="string">&#x27;local&#x27;</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æ„é€ å¹¿æ’­åŒ…</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">payload</span>: <span class="title class_">BusPayload</span> = &#123;</span><br><span class="line">      event,</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">sourceId</span>: <span class="variable language_">this</span>.<span class="property">myId</span>,</span><br><span class="line">      <span class="attr">targetId</span>: scope === <span class="string">&#x27;global&#x27;</span> ? <span class="literal">undefined</span> : scope <span class="comment">// å¦‚æœæ˜¯ global åˆ™ targetId ä¸ºç©º</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">channel</span>.<span class="title function_">postMessage</span>(payload)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®¾ç½®å½“å‰å®ä¾‹çš„ ID (ç”¨äº Dockview çš„ Panel ID ç»‘å®š)</span></span><br><span class="line">  <span class="title function_">setId</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">myId</span> = id</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">destroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">localBus</span>.<span class="property">all</span>.<span class="title function_">clear</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">channel</span>.<span class="title function_">close</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å‡ºå•ä¾‹ (æˆ–è€…åœ¨ç»„ä»¶é‡Œ new)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> bus = <span class="keyword">new</span> <span class="title class_">DistributedEventBus</span>()</span><br></pre></td></tr></table></figure><hr><h4 id="2-åœ¨-Vue-ç»„ä»¶ä¸­å¦‚ä½•æ­£ç¡®ä½¿ç”¨-è§£å†³â€œå…¨å…³é—­â€é—®é¢˜"><a href="#2-åœ¨-Vue-ç»„ä»¶ä¸­å¦‚ä½•æ­£ç¡®ä½¿ç”¨-è§£å†³â€œå…¨å…³é—­â€é—®é¢˜" class="headerlink" title="2. åœ¨ Vue ç»„ä»¶ä¸­å¦‚ä½•æ­£ç¡®ä½¿ç”¨ (è§£å†³â€œå…¨å…³é—­â€é—®é¢˜)"></a>2. åœ¨ Vue ç»„ä»¶ä¸­å¦‚ä½•æ­£ç¡®ä½¿ç”¨ (è§£å†³â€œå…¨å…³é—­â€é—®é¢˜)</h4><p>å…³é”®åœ¨äºï¼š<strong>åœ¨ <code>onUnmounted</code> æ—¶ï¼Œåªç§»é™¤è‡ªå·±çš„é‚£ä¸ªå›è°ƒå‡½æ•°</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; onMounted, onUnmounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; bus &#125; from &#x27;./utils/event-bus&#x27;</span><br><span class="line"></span><br><span class="line">// å‡è®¾è¿™æ˜¯ Dockview é‡Œçš„ä¸€ä¸ª Panel</span><br><span class="line">const props = defineProps&lt;&#123; params: any &#125;&gt;()</span><br><span class="line">const myPanelId = props.params.api.id</span><br><span class="line"></span><br><span class="line">// 1. è®¾ç½® IDï¼Œä»¥ä¾¿èƒ½æ¥æ”¶å®šå‘æ¶ˆæ¯</span><br><span class="line">bus.setId(myPanelId)</span><br><span class="line"></span><br><span class="line">// 2. å®šä¹‰å¤„ç†å‡½æ•° (å¿…é¡»æå–å‡ºæ¥ï¼Œä¸èƒ½å†™åŒ¿åå‡½æ•°ï¼)</span><br><span class="line">// âŒ é”™è¯¯ï¼šbus.on(&#x27;refresh&#x27;, () =&gt; &#123; ... &#125;)  &lt;- åŒ¿åå‡½æ•°æ²¡æ³•ç²¾ç¡®ç§»é™¤</span><br><span class="line">// âœ… æ­£ç¡®ï¼š</span><br><span class="line">const handleRefresh = (data: any) =&gt; &#123;</span><br><span class="line">  console.log(`[$&#123;myPanelId&#125;] æ”¶åˆ°åˆ·æ–°è¯·æ±‚:`, data)</span><br><span class="line">  // ä¸šåŠ¡é€»è¾‘...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  // æ³¨å†Œ</span><br><span class="line">  bus.on(&#x27;refresh-grid&#x27;, handleRefresh)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">onUnmounted(() =&gt; &#123;</span><br><span class="line">  // 3. é”€æ¯æ—¶ï¼Œåªç§»é™¤å½“å‰çš„ handleRefresh</span><br><span class="line">  // è¿™æ ·ç»å¯¹ä¸ä¼šå½±å“å…¶ä»–çª—å£æˆ– Tab çš„ &#x27;refresh-grid&#x27; ç›‘å¬</span><br><span class="line">  bus.off(&#x27;refresh-grid&#x27;, handleRefresh)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// --- è§¦å‘ç¤ºä¾‹ ---</span><br><span class="line"></span><br><span class="line">const triggerLocal = () =&gt; &#123;</span><br><span class="line">  // åªåˆ·æ–°æˆ‘è‡ªå·±è¿™ä¸ªçª—å£/Tab</span><br><span class="line">  bus.emit(&#x27;refresh-grid&#x27;, &#123; page: 1 &#125;, &#x27;local&#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const triggerGlobal = () =&gt; &#123;</span><br><span class="line">  // åˆ·æ–°æ‰€æœ‰æ‰“å¼€è¿™ä¸ªé¡µé¢çš„çª—å£ (æ¯”å¦‚ç”¨æˆ·ä¿®æ”¹äº†å…¨å±€é…ç½®)</span><br><span class="line">  bus.emit(&#x27;refresh-grid&#x27;, &#123; theme: &#x27;dark&#x27; &#125;, &#x27;global&#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const triggerTarget = () =&gt; &#123;</span><br><span class="line">  // å‡è®¾ä½ æƒ³åˆ·æ–° ID ä¸º &#x27;user-list-panel&#x27; çš„é‚£ä¸ª Tab (æ— è®ºå®ƒåœ¨å“ªä¸ªçª—å£)</span><br><span class="line">  bus.emit(&#x27;refresh-grid&#x27;, &#123; reload: true &#125;, &#x27;user-list-panel&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="æ–¹æ¡ˆä¼˜ç¼ºç‚¹æ€»ç»“"><a href="#æ–¹æ¡ˆä¼˜ç¼ºç‚¹æ€»ç»“" class="headerlink" title="æ–¹æ¡ˆä¼˜ç¼ºç‚¹æ€»ç»“"></a>æ–¹æ¡ˆä¼˜ç¼ºç‚¹æ€»ç»“</h3><ol><li><p><strong>è§£å†³â€œè§¦å‘å¤šæ¬¡â€</strong>ï¼š</p><ul><li>é»˜è®¤ <code>scope: &#39;local&#39;</code>ï¼šå¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ï¼ˆæ¯”å¦‚ç‚¹å‡»æŒ‰é’®åˆ·æ–°å½“å‰è¡¨æ ¼ï¼‰åªéœ€è¦æœ¬åœ°è§¦å‘ã€‚æ—§ä»£ç å¦‚æœä¸æ”¹ï¼Œé»˜è®¤å°±æ˜¯ Localï¼Œè¡Œä¸ºå’Œå•é¡µåº”ç”¨ä¸€è‡´ï¼Œä¸ä¼šå¹¿æ’­é£æš´ã€‚</li><li>éœ€è¦åŒæ­¥æ—¶æ˜¾å¼ç”¨ <code>&#39;global&#39;</code>ã€‚</li></ul></li><li><p><strong>è§£å†³â€œå…¨éƒ¨å…³é—­â€</strong>ï¼š</p><ul><li>å¼ºåˆ¶è¦æ±‚ä¼ å…¥ <code>handler</code> è¿›è¡Œ <code>off</code>ã€‚è¿™æ˜¯ç¼–ç¨‹ä¹ æƒ¯çš„çŸ«æ­£ã€‚</li><li><code>mitt</code> åº“æœ¬èº«å°±æ”¯æŒç²¾ç¡®ç§»é™¤ã€‚</li></ul></li><li><p><strong>é€‚é… Dockview</strong>ï¼š</p><ul><li>é€šè¿‡ <code>setId(panelId)</code>ï¼Œå®ç°äº†åŸºäº <strong>Panel ID</strong> çš„å®šå‘é€šä¿¡ã€‚</li><li>ä½ å¯ä»¥å®ç°ï¼šâ€œåœ¨çª—å£ A ç‚¹å‡»ä¿å­˜ï¼Œè‡ªåŠ¨åˆ·æ–°çª—å£ B é‡Œçš„åˆ—è¡¨â€è¿™ç§é«˜çº§åŠŸèƒ½ã€‚</li></ul></li></ol><h3 id="è¿ç§»å»ºè®®"><a href="#è¿ç§»å»ºè®®" class="headerlink" title="è¿ç§»å»ºè®®"></a>è¿ç§»å»ºè®®</h3><p>ä½ ç°åœ¨çš„é¡¹ç›®é‡Œå¯èƒ½å……æ–¥ç€ <code>bus.emit</code> å’Œ <code>bus.off</code>ã€‚</p><ol><li><strong>æœç´¢æ›¿æ¢</strong>ï¼šæŠŠå¼•å…¥çš„è€ EventBus æ¢æˆè¿™ä¸ªæ–°çš„ <code>DistributedEventBus</code>ã€‚</li><li><strong>é»˜è®¤è¡Œä¸º</strong>ï¼šç”±äºé»˜è®¤æ˜¯ <code>&#39;local&#39;</code>ï¼Œä½ ç›´æ¥æ›¿æ¢åï¼Œå¤§éƒ¨åˆ†åŠŸèƒ½ä¼šæ¢å¤æ­£å¸¸ï¼ˆä¸å†ä¹±å¹¿æ’­ï¼‰ã€‚</li><li><strong>ä¿®å¤é”€æ¯é€»è¾‘</strong>ï¼šä½ éœ€è¦äººå·¥æ£€æŸ¥æ‰€æœ‰ <code>onUnmounted</code> æˆ– <code>beforeDestroy</code>ï¼ŒæŠŠ <code>bus.off(&#39;event&#39;)</code> æ”¹æˆ <code>bus.off(&#39;event&#39;, myHandler)</code>ã€‚<ul><li><em>å¦‚æœè€ä»£ç å…¨æ˜¯åŒ¿åå‡½æ•°æ€ä¹ˆåŠï¼Ÿ</em></li><li><strong>ä¸´æ—¶è¡¥æ•‘</strong>ï¼šåœ¨ <code>DistributedEventBus</code> é‡Œç»´æŠ¤ä¸€ä¸ª <code>Map&lt;PanelId, List&lt;Handler&gt;&gt;</code>ï¼Œåœ¨ç»„ä»¶é”€æ¯æ—¶è°ƒç”¨ <code>bus.clearCurrentScope()</code>ã€‚ä½†è¿™æ¯”è¾ƒå¤æ‚ï¼Œæ¨èè¿˜æ˜¯é‡æ„ä¸ºå‘½åå‡½æ•°ã€‚</li></ul></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;é—®é¢˜&quot;&gt;&lt;a href=&quot;#é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜&quot;&gt;&lt;/a&gt;é—®é¢˜&lt;/h2&gt;&lt;p&gt;æˆ‘ç°åœ¨åšçš„æ˜¯å¤šçª—å£åº”ç”¨ï¼ˆåŸºäºelectron-vite,vue3,å’Œdokeviewï¼‰ï¼Œç°åœ¨æœ‰ä¸€ä¸ªåœºæ™¯ï¼šæˆ‘ä»¬åŸé¡¹ç›®é‡Œé¢å¤šå‡ºåœ°æ–¹ä½¿ç”¨çš„äº‹ä»¶æ€»çº¿æ¨¡å¼ï¼Œåœ¨ç»„ä»¶æŒ‚è½½çš„æ—¶å€™æ³¨å†Œäº‹ä»¶ï¼Œåœ¨ç»„ä»¶é”€æ¯çš„æ—¶å€™offäº‹ä»¶ï¼Œç°åœ¨æ”¹æˆå¤šçª—å£åº”ç”¨åï¼Œå°±å‡ºç°äº†æ‰“å¼€äº†å¤šä¸ªæ³¨å†Œäº‹ä»¶çš„çª—å£ï¼Œäº‹ä»¶è§¦å‘çš„æ—¶å€™ä¼šè§¦å‘å¤šæ¬¡ï¼Œäº‹ä»¶å…³é—­çš„æ—¶å€™å°±å…¨éƒ½å…³é—­äº†ã€‚è¿™ç§æƒ…å†µ æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ&lt;/p&gt;</summary>
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>electronå¤šçª—å£çŠ¶æ€åŒæ­¥ æ’ä»¶pinia-plugin-electron-shareå‡çº§ç‰ˆ</title>
    <link href="http://blog.ypintao.com/2025/12/16/%E5%89%8D%E7%AB%AF/electron/pinia-plugin-electron-share%E5%8D%87%E7%BA%A7%E7%89%88/"/>
    <id>http://blog.ypintao.com/2025/12/16/%E5%89%8D%E7%AB%AF/electron/pinia-plugin-electron-share%E5%8D%87%E7%BA%A7%E7%89%88/</id>
    <published>2025-12-16T13:45:41.109Z</published>
    <updated>2025-12-16T14:50:38.922Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é€šè¿‡indexDbå­˜å‚¨piniaçš„ç›¸å…³æ•°æ®ã€‚ä¼ è¾“çš„æ—¶å€™ä¸ç”¨ä¼ è¾“æ•´ä¸ªæ•°æ®</p><p><strong>æ ¸å¿ƒæ€æƒ³è½¬å˜ï¼š</strong><br>ä¹‹å‰çš„æ¨¡å¼æ˜¯ <strong>â€œæ•°æ®è·Ÿéšæ¶ˆæ¯â€ (Push Data)</strong>ï¼Œç°åœ¨çš„æ¨¡å¼æ˜¯ <strong>â€œæ¶ˆæ¯é€šçŸ¥ï¼Œæ•°æ®è‡ªå–â€ (Signal &amp; Pull)</strong>ã€‚</p><ol><li><strong>å†™å…¥æ–¹</strong>ï¼šStore å˜æ›´ -&gt; å†™å…¥ IndexedDB -&gt; å‘é€ â€œæ•°æ®å·²æ›´æ–°â€ çš„ä¿¡å·ï¼ˆä¸å¸¦æ•°æ®ï¼‰ã€‚</li><li><strong>æ¥æ”¶æ–¹</strong>ï¼šæ”¶åˆ°ä¿¡å· -&gt; ä» IndexedDB è¯»å–æœ€æ–°æ•°æ® -&gt; æ›´æ–° Storeã€‚</li><li><strong>åˆå§‹åŒ–</strong>ï¼šæ–°çª—å£å¯åŠ¨ -&gt; è¯·æ±‚åˆå§‹åŒ– -&gt; è€çª—å£å¼ºåˆ¶å°†å†…å­˜æ•°æ®åˆ·å…¥ IndexedDB -&gt; å‘é€ â€œå‡†å¤‡å¥½äº†â€ -&gt; æ–°çª—å£ä» DB è¯»å–ã€‚</li></ol><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ <code>BroadcastChannel</code> æå…¶è½»é‡ï¼Œä¸å†å—æ•°æ®å¤§å°é™åˆ¶ï¼Œä¸”æ•°æ®æŒä¹…åŒ–ç”± IndexedDB æ‰¿æ‹…ã€‚</p><span id="more"></span><p>ä¸‹é¢æ˜¯å®Œæ•´çš„å®ç°æ–¹æ¡ˆã€‚</p><h3 id="1-å°è£…-IndexedDB-å·¥å…·ç±»-src-utils-db-ts"><a href="#1-å°è£…-IndexedDB-å·¥å…·ç±»-src-utils-db-ts" class="headerlink" title="1. å°è£… IndexedDB å·¥å…·ç±» (src/utils/db.ts)"></a>1. å°è£… IndexedDB å·¥å…·ç±» (<code>src/utils/db.ts</code>)</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæç®€çš„ IDB åŒ…è£…å™¨ï¼Œç”¨äºå­˜å– Pinia çš„ Stateã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/utils/db.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DB_NAME</span> = <span class="string">&#x27;pinia-electron-db&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DB_VERSION</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STORE_NAME</span> = <span class="string">&#x27;pinia-state&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">SimpleIDB</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">dbRequest</span>: <span class="title class_">Promise</span>&lt;<span class="title class_">IDBDatabase</span>&gt;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dbRequest</span> = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> request = indexedDB.<span class="title function_">open</span>(<span class="variable constant_">DB_NAME</span>, <span class="variable constant_">DB_VERSION</span>)</span><br><span class="line">      </span><br><span class="line">      request.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="title function_">reject</span>(request.<span class="property">error</span>)</span><br><span class="line">      request.<span class="property">onsuccess</span> = <span class="function">() =&gt;</span> <span class="title function_">resolve</span>(request.<span class="property">result</span>)</span><br><span class="line">      </span><br><span class="line">      request.<span class="property">onupgradeneeded</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> db = (event.<span class="property">target</span> <span class="keyword">as</span> <span class="title class_">IDBOpenDBRequest</span>).<span class="property">result</span></span><br><span class="line">        <span class="keyword">if</span> (!db.<span class="property">objectStoreNames</span>.<span class="title function_">contains</span>(<span class="variable constant_">STORE_NAME</span>)) &#123;</span><br><span class="line">          db.<span class="title function_">createObjectStore</span>(<span class="variable constant_">STORE_NAME</span>) <span class="comment">// keyPath ä¸º storeId</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">setItem</span>(<span class="params"><span class="attr">key</span>: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> db = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">dbRequest</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> tx = db.<span class="title function_">transaction</span>(<span class="variable constant_">STORE_NAME</span>, <span class="string">&#x27;readwrite&#x27;</span>)</span><br><span class="line">      <span class="keyword">const</span> store = tx.<span class="title function_">objectStore</span>(<span class="variable constant_">STORE_NAME</span>)</span><br><span class="line">      <span class="keyword">const</span> req = store.<span class="title function_">put</span>(value, key)</span><br><span class="line">      </span><br><span class="line">      req.<span class="property">onsuccess</span> = <span class="function">() =&gt;</span> <span class="title function_">resolve</span>()</span><br><span class="line">      req.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="title function_">reject</span>(req.<span class="property">error</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getItem</span>(<span class="params"><span class="attr">key</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> db = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">dbRequest</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> tx = db.<span class="title function_">transaction</span>(<span class="variable constant_">STORE_NAME</span>, <span class="string">&#x27;readonly&#x27;</span>)</span><br><span class="line">      <span class="keyword">const</span> store = tx.<span class="title function_">objectStore</span>(<span class="variable constant_">STORE_NAME</span>)</span><br><span class="line">      <span class="keyword">const</span> req = store.<span class="title function_">get</span>(key)</span><br><span class="line">      </span><br><span class="line">      req.<span class="property">onsuccess</span> = <span class="function">() =&gt;</span> <span class="title function_">resolve</span>(req.<span class="property">result</span>)</span><br><span class="line">      req.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="title function_">reject</span>(req.<span class="property">error</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å‡ºå•ä¾‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> idb = <span class="keyword">new</span> <span class="title class_">SimpleIDB</span>()</span><br></pre></td></tr></table></figure><hr><h3 id="2-æ”¹é€ -Pinia-æ’ä»¶-src-index-ts"><a href="#2-æ”¹é€ -Pinia-æ’ä»¶-src-index-ts" class="headerlink" title="2. æ”¹é€  Pinia æ’ä»¶ (src/index.ts)"></a>2. æ”¹é€  Pinia æ’ä»¶ (<code>src/index.ts</code>)</h3><p><strong>å…³é”®æ”¹åŠ¨ç‚¹ï¼š</strong></p><ol><li><code>SyncPayload</code> ä¸­çš„ <code>data</code> å­—æ®µè¢«ç§»é™¤ï¼ˆæˆ–è®¾ä¸ºå¯é€‰ï¼Œè¿™é‡Œç›´æ¥ç§»é™¤ï¼‰ã€‚</li><li><code>$subscribe</code> ä¸å†ç›´æ¥å‘æ¶ˆæ¯ï¼Œè€Œæ˜¯å…ˆ <code>idb.setItem</code>ï¼ŒæˆåŠŸåå†å‘ <code>notify</code>ã€‚</li><li>æ¥æ”¶ç«¯æ”¶åˆ°æ¶ˆæ¯åï¼Œæ‰§è¡Œ <code>idb.getItem</code>ã€‚</li><li>å¢åŠ äº†<strong>å¼‚æ­¥é”</strong>é€»è¾‘ï¼Œé˜²æ­¢ IDB è¯»å†™æœŸé—´äº§ç”Ÿå†²çªã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PiniaPluginContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; idb &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/db&#x27;</span> <span class="comment">// å¼•å…¥ä¸Šé¢çš„å·¥å…·</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;pinia&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DefineStoreOptionsBase</span>&lt;S, <span class="title class_">Store</span>&gt; &#123;</span><br><span class="line">    <span class="attr">share</span>?: <span class="built_in">boolean</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ElectronShareOptions</span> &#123;</span><br><span class="line">  <span class="attr">channelName</span>?: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ¨ è½½è·ä¸å†åŒ…å« dataï¼ŒåªåŒ…å«é€šçŸ¥ä¿¡å·</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">SyncPayload</span> = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;NOTIFY_UPDATE&#x27;</span> | <span class="string">&#x27;REQUEST_INIT&#x27;</span> | <span class="string">&#x27;RESPONSE_READY&#x27;</span></span><br><span class="line">  <span class="attr">storeId</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">timestamp</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">srcId</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateId</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substr</span>(<span class="number">2</span>, <span class="number">9</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createElectronSharePlugin</span>(<span class="params"><span class="attr">globalOptions</span>: <span class="title class_">ElectronShareOptions</span> = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">CHANNEL_NAME</span> = globalOptions.<span class="property">channelName</span> || <span class="string">&#x27;pinia-electron-share&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="variable constant_">CHANNEL_NAME</span>)</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">WINDOW_ID</span> = <span class="title function_">generateId</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">&#123; store, options &#125;: <span class="title class_">PiniaPluginContext</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!options.<span class="property">share</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- çŠ¶æ€æ ‡å¿— ---</span></span><br><span class="line">    <span class="keyword">let</span> isExternalUpdate = <span class="literal">false</span> <span class="comment">// æ­£åœ¨åº”ç”¨å¤–éƒ¨æ•°æ®</span></span><br><span class="line">    <span class="keyword">let</span> isInitialized = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">initInterval</span>: <span class="built_in">any</span> = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">replyDebounceTimer</span>: <span class="built_in">any</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- æ ¸å¿ƒï¼šä» DB è¯»å–å¹¶åº”ç”¨æ•°æ® ---</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">applyStateFromDB</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> idb.<span class="title function_">getItem</span>(store.<span class="property">$id</span>)</span><br><span class="line">        <span class="keyword">if</span> (data) &#123;</span><br><span class="line">          <span class="comment">// æ ‡è®°ä¸ºå¤–éƒ¨æ›´æ–°ï¼Œé˜²æ­¢è§¦å‘ subscribe å†æ¬¡å†™å…¥ DB</span></span><br><span class="line">          isExternalUpdate = <span class="literal">true</span></span><br><span class="line">          store.$patch(data)</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// ç»™ä¸€ç‚¹ç¼“å†²æ—¶é—´è®© Vue Reactivity å®Œæˆï¼Œé˜²æ­¢ç«‹åˆ»è§¦å‘ subscribe</span></span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; isExternalUpdate = <span class="literal">false</span> &#125;, <span class="number">50</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> !!data</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[Share] Read DB failed:`</span>, err)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- æ¶ˆæ¯å¤„ç† ---</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">messageHandler</span> = <span class="keyword">async</span> (<span class="params"><span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">SyncPayload</span>&gt;</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="keyword">type</span>, storeId, srcId &#125; = event.<span class="property">data</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (storeId !== store.<span class="property">$id</span> || srcId === <span class="variable constant_">WINDOW_ID</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">switch</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;NOTIFY_UPDATE&#x27;</span>:</span><br><span class="line">          <span class="comment">// æ”¶åˆ°åˆ«äººçš„æ›´æ–°é€šçŸ¥ -&gt; å»æŸ¥ DB</span></span><br><span class="line">          <span class="keyword">if</span> (!isExternalUpdate) &#123;</span><br><span class="line">             <span class="keyword">await</span> <span class="title function_">applyStateFromDB</span>()</span><br><span class="line">             </span><br><span class="line">             <span class="comment">// å¦‚æœæˆ‘æ˜¯åˆšå¯åŠ¨çš„çª—å£ï¼Œæ”¶åˆ°è¿™ä¸ªä¹Ÿç®—åˆå§‹åŒ–å®Œæˆ</span></span><br><span class="line">             <span class="keyword">if</span> (!isInitialized) &#123;</span><br><span class="line">               isInitialized = <span class="literal">true</span></span><br><span class="line">               <span class="built_in">clearInterval</span>(initInterval)</span><br><span class="line">             &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;REQUEST_INIT&#x27;</span>:</span><br><span class="line">          <span class="comment">// åˆ«äººåœ¨è¯·æ±‚åˆå§‹åŒ–</span></span><br><span class="line">          <span class="keyword">if</span> (isInitialized) &#123;</span><br><span class="line">            <span class="comment">// ç«æ€æŠ‘åˆ¶ï¼šéšæœºå»¶è¿Ÿå›å¤</span></span><br><span class="line">            <span class="keyword">const</span> delay = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">90</span>) + <span class="number">10</span></span><br><span class="line">            replyDebounceTimer = <span class="built_in">setTimeout</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">              <span class="comment">// âœ¨ å…³é”®ï¼šå…ˆæŠŠæˆ‘ä¹Ÿè®¸è¿˜æ²¡ä¿å­˜çš„å†…å­˜çŠ¶æ€ï¼Œå¼ºåˆ¶åˆ·å…¥ DB</span></span><br><span class="line">              <span class="comment">// ç¡®ä¿æ–°çª—å£è¯»åˆ°çš„æ˜¯æœ€æ–°çš„</span></span><br><span class="line">              <span class="keyword">await</span> idb.<span class="title function_">setItem</span>(storeId, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(store.<span class="property">$state</span>)))</span><br><span class="line"></span><br><span class="line">              <span class="comment">// å‘é€ &quot;æ•°æ®å·²å°±ç»ª&quot; ä¿¡å· (ä¸å¸¦æ•°æ®)</span></span><br><span class="line">              channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;RESPONSE_READY&#x27;</span>,</span><br><span class="line">                <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">                <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">                <span class="attr">srcId</span>: <span class="variable constant_">WINDOW_ID</span></span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;, delay)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;RESPONSE_READY&#x27;</span>:</span><br><span class="line">          <span class="comment">// æ”¶åˆ° &quot;æ•°æ®å·²å°±ç»ª&quot; ä¿¡å·</span></span><br><span class="line">          <span class="keyword">if</span> (replyDebounceTimer) &#123;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(replyDebounceTimer)</span><br><span class="line">            replyDebounceTimer = <span class="literal">null</span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!isInitialized) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[Share] DB Ready signal received from <span class="subst">$&#123;srcId&#125;</span>`</span>)</span><br><span class="line">            <span class="comment">// å» DB æ‹‰å–æ•°æ®</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">applyStateFromDB</span>()</span><br><span class="line">            </span><br><span class="line">            isInitialized = <span class="literal">true</span></span><br><span class="line">            <span class="built_in">clearInterval</span>(initInterval)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    channel.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, messageHandler)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- ç›‘å¬çŠ¶æ€å˜åŒ– (å†™å…¥æ–¹) ---</span></span><br><span class="line">    store.$subscribe(<span class="title function_">async</span> (mutation, state) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (isExternalUpdate) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">if</span> (!isInitialized) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 1. å…ˆå†™å…¥ IndexedDB</span></span><br><span class="line">        <span class="keyword">const</span> rawState = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(state))</span><br><span class="line">        <span class="keyword">await</span> idb.<span class="title function_">setItem</span>(store.<span class="property">$id</span>, rawState)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. å†™å…¥æˆåŠŸåï¼Œå‘é€è½»é‡çº§é€šçŸ¥</span></span><br><span class="line">        channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;NOTIFY_UPDATE&#x27;</span>,</span><br><span class="line">          <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">          <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">          <span class="attr">srcId</span>: <span class="variable constant_">WINDOW_ID</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[Share] Save to DB error`</span>, e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- åˆå§‹åŒ–æµç¨‹ ---</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°è¯•ç›´æ¥ä» DB è¯»å–ä¸€æ¬¡ (ä¹Ÿè®¸æ˜¯åˆ·æ–°é¡µé¢ï¼ŒDBé‡Œå·²ç»æœ‰æ•°æ®äº†)</span></span><br><span class="line">    <span class="title function_">applyStateFromDB</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">hasData</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasData) &#123;</span><br><span class="line">            <span class="comment">// åªè¦ DB æœ‰æ•°æ®ï¼Œå°±ç®—åˆå§‹åŒ–å®Œæˆï¼Œä½†ä¹Ÿå¯èƒ½æ•°æ®æ˜¯æ—§çš„</span></span><br><span class="line">            <span class="comment">// æ‰€ä»¥æˆ‘ä»¬ä»ç„¶å¯ä»¥å‘ REQUEST_INIT ç¡®è®¤ä¸€ä¸‹æœ‰æ²¡æœ‰æ›´æƒå¨çš„çª—å£</span></span><br><span class="line">            <span class="comment">// ä½†ä¸ºäº†ç®€å•ï¼Œå¦‚æœ DB æœ‰æ•°æ®ï¼Œé€šå¸¸è®¤ä¸ºæ˜¯æŒä¹…åŒ–çš„ç»“æœ</span></span><br><span class="line">            isInitialized = <span class="literal">true</span></span><br><span class="line">            <span class="comment">// è¿™é‡Œçœ‹ç­–ç•¥ï¼š</span></span><br><span class="line">            <span class="comment">// ç­–ç•¥A: ä¿¡ä»» DBï¼Œç›´æ¥å®Œæˆã€‚</span></span><br><span class="line">            <span class="comment">// ç­–ç•¥B: å³ä½¿ DB æœ‰ï¼Œä¹Ÿé—®ä¸€ä¸‹å…¶ä»–çª—å£æœ‰æ²¡æœ‰æ›´æ–°çš„å†…å­˜æ•°æ®ã€‚</span></span><br><span class="line">            <span class="comment">// ä¸‹é¢ä»£ç é‡‡ç”¨ç­–ç•¥ Bï¼Œç»§ç»­è½®è¯¢ä¸€ä¼š</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    initInterval = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isInitialized) &#123;</span><br><span class="line">        <span class="built_in">clearInterval</span>(initInterval)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å–Šè¯ï¼šè°æœ‰æœ€æ–°æ•°æ®ï¼Ÿè¯·åˆ·å…¥ DB å¹¶å‘Šè¯‰æˆ‘</span></span><br><span class="line">      channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;REQUEST_INIT&#x27;</span>,</span><br><span class="line">        <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">        <span class="attr">srcId</span>: <span class="variable constant_">WINDOW_ID</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…œåº•</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isInitialized) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[Share] Init timeout, using local/DB state.&#x27;</span>)</span><br><span class="line">        isInitialized = <span class="literal">true</span></span><br><span class="line">        <span class="built_in">clearInterval</span>(initInterval)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ¡ˆè§£æ"><a href="#æ–¹æ¡ˆè§£æ" class="headerlink" title="æ–¹æ¡ˆè§£æ"></a>æ–¹æ¡ˆè§£æ</h3><ol><li><p><strong>æ•°æ®æµå‘</strong>ï¼š</p><ul><li><strong>æ—§æ–¹æ¡ˆ</strong>ï¼š<code>Memory (Window A)</code> -&gt; <code>BroadcastChannel (Huge String)</code> -&gt; <code>Memory (Window B)</code></li><li><strong>æ–°æ–¹æ¡ˆ</strong>ï¼š<code>Memory (Window A)</code> -&gt; <code>IndexedDB</code> -&gt; <code>BroadcastChannel (Notify)</code> -&gt; <code>Memory (Window B) reads IndexedDB</code></li></ul></li><li><p><strong>å¼‚æ­¥å¤„ç† (<code>isExternalUpdate</code> çš„å¾®å¦™ä¹‹å¤„)</strong>ï¼š</p><ul><li>å› ä¸º <code>idb.getItem</code> æ˜¯å¼‚æ­¥çš„ï¼Œä»å‘å‡ºè¯»å–è¯·æ±‚åˆ°æ•°æ® patch åˆ° store ä¹‹é—´æœ‰æ—¶é—´å·®ã€‚</li><li>æˆ‘ä»¬åœ¨ <code>applyStateFromDB</code> é‡Œè®¾ç½® <code>isExternalUpdate = true</code>ï¼Œå¹¶åœ¨ patch å®Œæˆåç¨å¾® <code>setTimeout</code> å»¶è¿Ÿé‡Šæ”¾ã€‚</li><li>è¿™ç¡®ä¿äº†ï¼š<strong>ä» DB è¯»å‡ºæ¥çš„æ•°æ®åº”ç”¨åˆ° Store æ—¶ï¼Œä¸ä¼šå†æ¬¡è§¦å‘ <code>$subscribe</code> å¯¼è‡´å›å†™ DB å’Œæ­»å¾ªç¯ã€‚</strong></li></ul></li><li><p><strong>åˆå§‹åŒ–é€»è¾‘å¢å¼º</strong>ï¼š</p><ul><li>å½“æ–°çª—å£å‘é€ <code>REQUEST_INIT</code> æ—¶ï¼Œè€çª—å£ä¸èƒ½åªå›ä¸ªâ€œæ”¶åˆ°â€ã€‚</li><li>è€çª—å£å¿…é¡»æ‰§è¡Œ <code>await idb.setItem(...)</code>ï¼Œ<strong>å¼ºåˆ¶æŠŠè‡ªå·±å†…å­˜é‡Œçš„æœ€æ–°çŠ¶æ€åˆ·å…¥ç£ç›˜</strong>ã€‚</li><li>å› ä¸º IndexedDB å¯èƒ½æ¯”å†…å­˜ç¨å¾®æ»åï¼ˆå¦‚æœä½ åœ¨ subscribe é‡Œåšäº†é˜²æŠ–ï¼‰ï¼Œè¿™ä¸€æ­¥å¼ºåˆ¶åˆ·æ–°ä¿è¯äº†æ–°çª—å£è¯»åˆ°çš„ä¸€å®šæ˜¯å†…å­˜é‡Œæœ€æ–°çš„ã€‚</li></ul></li><li><p><strong>æ€§èƒ½ä¼˜åŠ¿</strong>ï¼š</p><ul><li><strong>ä¼ è¾“æå¿«</strong>ï¼šIPC æ¶ˆæ¯ä½“åªæœ‰å‡ åå­—èŠ‚ï¼ˆID + Timestampï¼‰ï¼Œæ— è®º Store æœ‰å¤šå¤§ï¼ˆæ¯”å¦‚å­˜äº† 1MB çš„æ–‡æœ¬ï¼‰ï¼Œé€šä¿¡éƒ½ä¸ä¼šå¡é¡¿ã€‚</li><li><strong>è‡ªåŠ¨æŒä¹…åŒ–</strong>ï¼šä½ çš„åº”ç”¨å…³æ‰å†æ‰“å¼€ï¼Œæ•°æ®è¿˜åœ¨ IndexedDB é‡Œï¼ˆåªè¦ä½ åœ¨ä»£ç é‡Œå¤„ç†äº†å¯åŠ¨è¯»å–ï¼‰ï¼Œå¤©ç„¶æ”¯æŒäº†æ•°æ®æŒä¹…åŒ–éœ€æ±‚ã€‚</li></ul></li></ol><p>è¿™ä¸ªæ–¹æ¡ˆéå¸¸é€‚åˆ Electron åº”ç”¨ï¼Œå› ä¸ºå®ƒè§„é¿äº† IPC ä¼ è¾“å¤§æ•°æ®åºåˆ—åŒ–çš„æ€§èƒ½ç“¶é¢ˆã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;é€šè¿‡indexDbå­˜å‚¨piniaçš„ç›¸å…³æ•°æ®ã€‚ä¼ è¾“çš„æ—¶å€™ä¸ç”¨ä¼ è¾“æ•´ä¸ªæ•°æ®&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒæ€æƒ³è½¬å˜ï¼š&lt;/strong&gt;&lt;br&gt;ä¹‹å‰çš„æ¨¡å¼æ˜¯ &lt;strong&gt;â€œæ•°æ®è·Ÿéšæ¶ˆæ¯â€ (Push Data)&lt;/strong&gt;ï¼Œç°åœ¨çš„æ¨¡å¼æ˜¯ &lt;strong&gt;â€œæ¶ˆæ¯é€šçŸ¥ï¼Œæ•°æ®è‡ªå–â€ (Signal &amp;amp; Pull)&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å†™å…¥æ–¹&lt;/strong&gt;ï¼šStore å˜æ›´ -&amp;gt; å†™å…¥ IndexedDB -&amp;gt; å‘é€ â€œæ•°æ®å·²æ›´æ–°â€ çš„ä¿¡å·ï¼ˆä¸å¸¦æ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¥æ”¶æ–¹&lt;/strong&gt;ï¼šæ”¶åˆ°ä¿¡å· -&amp;gt; ä» IndexedDB è¯»å–æœ€æ–°æ•°æ® -&amp;gt; æ›´æ–° Storeã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹åŒ–&lt;/strong&gt;ï¼šæ–°çª—å£å¯åŠ¨ -&amp;gt; è¯·æ±‚åˆå§‹åŒ– -&amp;gt; è€çª—å£å¼ºåˆ¶å°†å†…å­˜æ•°æ®åˆ·å…¥ IndexedDB -&amp;gt; å‘é€ â€œå‡†å¤‡å¥½äº†â€ -&amp;gt; æ–°çª—å£ä» DB è¯»å–ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™æ ·åšçš„å¥½å¤„æ˜¯ &lt;code&gt;BroadcastChannel&lt;/code&gt; æå…¶è½»é‡ï¼Œä¸å†å—æ•°æ®å¤§å°é™åˆ¶ï¼Œä¸”æ•°æ®æŒä¹…åŒ–ç”± IndexedDB æ‰¿æ‹…ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>BroadcastChannel æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•</title>
    <link href="http://blog.ypintao.com/2025/12/14/%E5%89%8D%E7%AB%AF/electron/BroadcastChannel%20%E6%8F%A1%E6%89%8B%E6%9C%BA%E5%88%B6%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>http://blog.ypintao.com/2025/12/14/%E5%89%8D%E7%AB%AF/electron/BroadcastChannel%20%E6%8F%A1%E6%89%8B%E6%9C%BA%E5%88%B6%E7%9A%84%E6%96%B9%E6%B3%95/</id>
    <published>2025-12-14T09:26:57.271Z</published>
    <updated>2025-12-16T14:50:19.447Z</updated>
    
    <content type="html"><![CDATA[<h2 id="BroadcastChannel-æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°"><a href="#BroadcastChannel-æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°" class="headerlink" title="BroadcastChannel æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°"></a>BroadcastChannel æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°</h2><p>ä½¿ç”¨åœºæ™¯ï¼Œdokeview tabæ‹–å‡ºæ¥çª—å£å¤–ç¬¬ä¸€æ¬¡åˆ›å»ºçª—å£çš„æ—¶å€™ä¼ é€’å‚æ•°ã€‚</p><p>å°†è¿™ç§â€œæ¡æ‰‹â€é€»è¾‘å°è£…æˆé€šç”¨çš„å·¥å…·å‡½æ•°ï¼Œå¯ä»¥å¤§å¤§å‡å°‘é‡å¤ä»£ç ï¼Œå¹¶ä¿è¯é€»è¾‘çš„å¥å£®æ€§ã€‚</p><p>å°è£…äº†ä¸€ä¸ªç±»å‹å®‰å…¨ã€æ”¯æŒè¶…æ—¶æ§åˆ¶çš„ <strong><code>WindowSync</code></strong> å·¥å…·åº“ã€‚</p><span id="more"></span><h3 id="1-åˆ›å»ºå·¥å…·æ–‡ä»¶-src-utils-window-sync-ts"><a href="#1-åˆ›å»ºå·¥å…·æ–‡ä»¶-src-utils-window-sync-ts" class="headerlink" title="1. åˆ›å»ºå·¥å…·æ–‡ä»¶ (src/utils/window-sync.ts)"></a>1. åˆ›å»ºå·¥å…·æ–‡ä»¶ (<code>src/utils/window-sync.ts</code>)</h3><p>è¿™ä¸ªå·¥å…·åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒå‡½æ•°ï¼š</p><ol><li><code>sendToChild</code>: çˆ¶çª—å£è°ƒç”¨ï¼Œç­‰å¾…å­çª—å£å°±ç»ªåå‘é€æ•°æ®ã€‚</li><li><code>receiveFromParent</code>: å­çª—å£è°ƒç”¨ï¼Œå‘é€å°±ç»ªä¿¡å·å¹¶ç­‰å¾…æ•°æ®ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/utils/window-sync.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æ¶ˆæ¯åè®®</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">SyncMessage</span>&lt;T = <span class="built_in">any</span>&gt; = </span><br><span class="line">  | &#123; <span class="attr">type</span>: <span class="string">&#x27;CHILD_READY&#x27;</span>; <span class="attr">id</span>: <span class="built_in">string</span> &#125;</span><br><span class="line">  | &#123; <span class="attr">type</span>: <span class="string">&#x27;PARENT_DATA&#x27;</span>; <span class="attr">id</span>: <span class="built_in">string</span>; <span class="attr">payload</span>: T &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">SyncOptions</span> &#123;</span><br><span class="line">  <span class="attr">timeout</span>?: <span class="built_in">number</span>; <span class="comment">// è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 5000ms</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ã€çˆ¶çª—å£ç”¨ã€‘å‘é€æ•°æ®ç»™æ–°å¼€çš„å­çª—å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> channelName é¢‘é“åç§° (å¿…é¡»ä¸å­çª—å£ä¸€è‡´)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> targetId ç›®æ ‡çª—å£/é¢æ¿çš„å”¯ä¸€ID (ç”¨äºè¿‡æ»¤)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data è¦å‘é€çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> options é…ç½®é¡¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> sendToChild&lt;T&gt;(</span><br><span class="line">  <span class="attr">channelName</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">targetId</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">data</span>: T,</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">SyncOptions</span> = &#123;&#125;</span><br><span class="line">): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; timeout = <span class="number">5000</span> &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(channelName);</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">timer</span>: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¸…ç†å‡½æ•°</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">cleanup</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      channel.<span class="title function_">close</span>();</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. è®¾ç½®è¶…æ—¶æœºåˆ¶ (é˜²æ­¢å­çª—å£æ²¡æ‰“å¼€ï¼Œä¸€ç›´å¡æ­»åœ¨è¿™é‡Œ)</span></span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">cleanup</span>();</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`[WindowSync] Send timeout: Child window &quot;<span class="subst">$&#123;targetId&#125;</span>&quot; did not respond in <span class="subst">$&#123;timeout&#125;</span>ms`</span>));</span><br><span class="line">    &#125;, timeout);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç›‘å¬æ¶ˆæ¯</span></span><br><span class="line">    channel.<span class="property">onmessage</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">SyncMessage</span>&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="keyword">type</span>, id &#125; = event.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç­‰å¾… &quot;CHILD_READY&quot; ä¿¡å·ï¼Œä¸” ID å¿…é¡»åŒ¹é…</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">&#x27;CHILD_READY&#x27;</span> &amp;&amp; id === targetId) &#123;</span><br><span class="line">        <span class="comment">// 3. å‘é€æ•°æ®</span></span><br><span class="line">        channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;PARENT_DATA&#x27;</span>,</span><br><span class="line">          <span class="attr">id</span>: targetId,</span><br><span class="line">          <span class="attr">payload</span>: data,</span><br><span class="line">        &#125; <span class="keyword">as</span> <span class="title class_">SyncMessage</span>&lt;T&gt;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. å®Œæˆ</span></span><br><span class="line">        <span class="title function_">cleanup</span>();</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ã€å­çª—å£ç”¨ã€‘æ¥æ”¶æ¥è‡ªçˆ¶çª—å£çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> channelName é¢‘é“åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> myId è‡ªå·±çš„å”¯ä¸€ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> options é…ç½®é¡¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> receiveFromParent&lt;T&gt;(</span><br><span class="line">  <span class="attr">channelName</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">myId</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">SyncOptions</span> = &#123;&#125;</span><br><span class="line">): <span class="title class_">Promise</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; timeout = <span class="number">5000</span> &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(channelName);</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">timer</span>: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">cleanup</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      channel.<span class="title function_">close</span>();</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. è®¾ç½®è¶…æ—¶</span></span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">cleanup</span>();</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`[WindowSync] Receive timeout: Parent did not send data for &quot;<span class="subst">$&#123;myId&#125;</span>&quot;`</span>));</span><br><span class="line">    &#125;, timeout);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç›‘å¬çˆ¶çª—å£å‘æ¥çš„æ•°æ®</span></span><br><span class="line">    channel.<span class="property">onmessage</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">SyncMessage</span>&lt;T&gt;&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="keyword">type</span>, id, payload &#125; = event.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">&#x27;PARENT_DATA&#x27;</span> &amp;&amp; id === myId &amp;&amp; payload !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="title function_">cleanup</span>();</span><br><span class="line">        <span class="title function_">resolve</span>(payload);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. ä¸»åŠ¨å‘é€ &quot;æˆ‘å‡†å¤‡å¥½äº†&quot; ä¿¡å·</span></span><br><span class="line">    <span class="comment">// ç¨å¾®å»¶è¿Ÿä¸€ç‚¹ï¼Œç¡®ä¿çˆ¶çª—å£çš„ç›‘å¬å™¨å·²ç» ready (è™½ç„¶é€šå¸¸çˆ¶çª—å£æ—©å°± ready äº†)</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;CHILD_READY&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: myId,</span><br><span class="line">      &#125; <span class="keyword">as</span> <span class="title class_">SyncMessage</span>);</span><br><span class="line">    &#125;, <span class="number">50</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-åœ¨çˆ¶çª—å£ä¸­ä½¿ç”¨-CustomTab-vue"><a href="#2-åœ¨çˆ¶çª—å£ä¸­ä½¿ç”¨-CustomTab-vue" class="headerlink" title="2. åœ¨çˆ¶çª—å£ä¸­ä½¿ç”¨ (CustomTab.vue)"></a>2. åœ¨çˆ¶çª—å£ä¸­ä½¿ç”¨ (<code>CustomTab.vue</code>)</h3><p>ç°åœ¨ä½ çš„ä¸šåŠ¡ä»£ç ä¼šå˜å¾—éå¸¸ç®€æ´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; sendToChild &#125; from &#x27;../utils/window-sync&#x27; // å¼•å…¥å·¥å…·</span><br><span class="line"></span><br><span class="line">// ... </span><br><span class="line"></span><br><span class="line">const performPopout = async () =&gt; &#123;</span><br><span class="line">  const panelId = props.params.api.id</span><br><span class="line">  const title = props.params.api.title</span><br><span class="line"></span><br><span class="line">  // 1. å‡†å¤‡å¤§å¯¹è±¡æ•°æ®</span><br><span class="line">  const bigData = &#123;</span><br><span class="line">    panelId,</span><br><span class="line">    title,</span><br><span class="line">    userInfo: &#123; name: &#x27;Admin&#x27;, role: &#x27;SuperUser&#x27; &#125;,</span><br><span class="line">    heavyList: Array.from(&#123; length: 1000 &#125;, (_, i) =&gt; i)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 2. æ‰“å¼€çª—å£ (åªä¼ åŸºæœ¬ ID)</span><br><span class="line">  const url = `?popout=true&amp;panelId=$&#123;panelId&#125;&amp;title=$&#123;encodeURIComponent(title)&#125;`</span><br><span class="line">  window.open(url, &#x27;_blank&#x27;)</span><br><span class="line"></span><br><span class="line">  // 3. å…³é—­å½“å‰é¢æ¿ (UIä¸Šç«‹å³å“åº”)</span><br><span class="line">  props.params.api.group.api.closePanel(props.params.api.panel)</span><br><span class="line"></span><br><span class="line">  // 4. ã€å…³é”®ã€‘è°ƒç”¨å°è£…å¥½çš„å‘é€æ–¹æ³•</span><br><span class="line">  // ä¸ç”¨ç®¡ä»€ä¹ˆ addEventListenerï¼Œä¸€è¡Œä»£ç æå®š</span><br><span class="line">  try &#123;</span><br><span class="line">    await sendToChild(&#x27;dockview-popout&#x27;, panelId, bigData)</span><br><span class="line">    console.log(&#x27;âœ… æ•°æ®å‘é€æˆåŠŸï¼&#x27;)</span><br><span class="line">  &#125; catch (err) &#123;</span><br><span class="line">    console.error(&#x27;âŒ å‘é€å¤±è´¥ (å¯èƒ½æ˜¯çª—å£è¢«æ‹¦æˆªæˆ–å…³é—­äº†):&#x27;, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="3-åœ¨å­çª—å£ä¸­ä½¿ç”¨-App-vue"><a href="#3-åœ¨å­çª—å£ä¸­ä½¿ç”¨-App-vue" class="headerlink" title="3. åœ¨å­çª—å£ä¸­ä½¿ç”¨ (App.vue)"></a>3. åœ¨å­çª—å£ä¸­ä½¿ç”¨ (<code>App.vue</code>)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; receiveFromParent &#125; from &#x27;./utils/window-sync&#x27; // å¼•å…¥å·¥å…·</span><br><span class="line"></span><br><span class="line">const onReady = async (event: DockviewReadyEvent) =&gt; &#123;</span><br><span class="line">  const api = event.api</span><br><span class="line">  const urlParams = new URLSearchParams(window.location.search)</span><br><span class="line">  const isPopout = urlParams.get(&#x27;popout&#x27;) === &#x27;true&#x27;</span><br><span class="line">  const myPanelId = urlParams.get(&#x27;panelId&#x27;)</span><br><span class="line"></span><br><span class="line">  if (isPopout &amp;&amp; myPanelId) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      // 1. ã€å…³é”®ã€‘è°ƒç”¨å°è£…å¥½çš„æ¥æ”¶æ–¹æ³•</span><br><span class="line">      // è¿™é‡Œæ”¯æŒæ³›å‹ï¼Œä¼šæœ‰ä»£ç æç¤º</span><br><span class="line">      const data = await receiveFromParent&lt;any&gt;(&#x27;dockview-popout&#x27;, myPanelId)</span><br><span class="line">      </span><br><span class="line">      console.log(&#x27;ğŸ‘¶ æ”¶åˆ°çˆ¶çª—å£æŠ•å–‚:&#x27;, data)</span><br><span class="line"></span><br><span class="line">      // 2. åˆ›å»ºé¢æ¿</span><br><span class="line">      api.addPanel(&#123;</span><br><span class="line">        id: myPanelId,</span><br><span class="line">        component: &#x27;default&#x27;,</span><br><span class="line">        tabComponent: &#x27;myTab&#x27;,</span><br><span class="line">        params: &#123; </span><br><span class="line">          title: data.title,</span><br><span class="line">          extra: data.userInfo // ä½¿ç”¨æ¥æ”¶åˆ°çš„æ•°æ®</span><br><span class="line">        &#125;,</span><br><span class="line">        title: data.title</span><br><span class="line">      &#125;)</span><br><span class="line">      </span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">      console.error(&#x27;âŒ è·å–æ•°æ®å¤±è´¥:&#x27;, err)</span><br><span class="line">      // é™çº§å¤„ç†ï¼šæ¯”å¦‚æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯æç¤ºæˆ–è€…é»˜è®¤ç©ºé¢æ¿</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // ä¸»çª—å£é€»è¾‘...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="å°è£…åçš„ä¼˜åŠ¿"><a href="#å°è£…åçš„ä¼˜åŠ¿" class="headerlink" title="å°è£…åçš„ä¼˜åŠ¿"></a>å°è£…åçš„ä¼˜åŠ¿</h3><ol><li><strong>ä»£ç è§£è€¦</strong>ï¼šä¸šåŠ¡ç»„ä»¶ä¸éœ€è¦å…³å¿ƒ <code>BroadcastChannel</code> çš„åˆ›å»ºã€é”€æ¯ã€äº‹ä»¶ç›‘å¬é€»è¾‘ã€‚</li><li><strong>èµ„æºè‡ªåŠ¨å›æ”¶</strong>ï¼šå°è£…å†…è‡ªåŠ¨è°ƒç”¨äº† <code>channel.close()</code>ï¼Œé˜²æ­¢å¼€å‘è€…å¿˜è®°å…³é—­å¯¼è‡´å†…å­˜æ³„æ¼ã€‚</li><li><strong>å¥å£®æ€§</strong>ï¼šå¢åŠ äº† <code>timeout</code> è¶…æ—¶å¤„ç†ã€‚å¦‚æœæ–°çª—å£è¢«æµè§ˆå™¨æ‹¦æˆªäº†ï¼Œæˆ–è€…åŠ è½½å¤±è´¥äº†ï¼Œçˆ¶çª—å£çš„ <code>await</code> ä¸ä¼šä¸€ç›´å¡æ­»ã€‚</li><li><strong>ç±»å‹å®‰å…¨</strong>ï¼šæ”¯æŒ TypeScript æ³›å‹ï¼Œæ¥æ”¶åˆ°çš„ data ç›´æ¥æœ‰ç±»å‹æç¤ºã€‚</li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;BroadcastChannel-æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°&quot;&gt;&lt;a href=&quot;#BroadcastChannel-æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°&quot; class=&quot;headerlink&quot; title=&quot;BroadcastChannel æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°&quot;&gt;&lt;/a&gt;BroadcastChannel æ¡æ‰‹æœºåˆ¶çš„æ–¹æ³•å®ç°&lt;/h2&gt;&lt;p&gt;ä½¿ç”¨åœºæ™¯ï¼Œdokeview tabæ‹–å‡ºæ¥çª—å£å¤–ç¬¬ä¸€æ¬¡åˆ›å»ºçª—å£çš„æ—¶å€™ä¼ é€’å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å°†è¿™ç§â€œæ¡æ‰‹â€é€»è¾‘å°è£…æˆé€šç”¨çš„å·¥å…·å‡½æ•°ï¼Œå¯ä»¥å¤§å¤§å‡å°‘é‡å¤ä»£ç ï¼Œå¹¶ä¿è¯é€»è¾‘çš„å¥å£®æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å°è£…äº†ä¸€ä¸ªç±»å‹å®‰å…¨ã€æ”¯æŒè¶…æ—¶æ§åˆ¶çš„ &lt;strong&gt;&lt;code&gt;WindowSync&lt;/code&gt;&lt;/strong&gt; å·¥å…·åº“ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>å•ä¾‹ Tab ç­–ç•¥â€ (Singleton Tab Strategy)</title>
    <link href="http://blog.ypintao.com/2025/12/14/%E5%89%8D%E7%AB%AF/electron/%E5%8D%95%E4%BE%8B%20Tab%20%E7%AD%96%E7%95%A5/"/>
    <id>http://blog.ypintao.com/2025/12/14/%E5%89%8D%E7%AB%AF/electron/%E5%8D%95%E4%BE%8B%20Tab%20%E7%AD%96%E7%95%A5/</id>
    <published>2025-12-14T09:24:15.644Z</published>
    <updated>2025-12-16T14:48:55.249Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å•ä¾‹-Tab-ç­–ç•¥â€-Singleton-Tab-Strategy"><a href="#å•ä¾‹-Tab-ç­–ç•¥â€-Singleton-Tab-Strategy" class="headerlink" title="å•ä¾‹ Tab ç­–ç•¥â€ (Singleton Tab Strategy)"></a>å•ä¾‹ Tab ç­–ç•¥â€ (Singleton Tab Strategy)</h1><p>æ ¸å¿ƒé€»è¾‘å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š<strong>â€œå…ˆé—®ä¸€åœˆï¼Œæœ‰äººæœ‰å—ï¼Ÿæœ‰å°±è®©ä»–å¼¹å‡ºæ¥ï¼Œæ²¡äººæœ‰æˆ‘å°±è‡ªå·±é€ ã€‚â€</strong></p><p>æˆ‘ä»¬éœ€è¦è§£å†³ä¸‰ä¸ªæŠ€æœ¯ç‚¹ï¼š</p><ol><li><strong>å…¨å±€æŸ¥è¯¢</strong>ï¼šåˆ©ç”¨ <code>BroadcastChannel</code> è¯¢é—®æ‰€æœ‰çª—å£ï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰ã€‚</li><li><strong>çª—å£æ¿€æ´»</strong>ï¼šå¦‚æœåˆ«çš„çª—å£æœ‰ï¼Œé‚£ä¸ªçª—å£éœ€è¦æŠŠè‡ªå·±ç½®é¡¶ï¼ˆFocusï¼‰ã€‚</li><li><strong>Tab æ¿€æ´»</strong>ï¼šé‚£ä¸ªçª—å£éœ€è¦æŠŠå¯¹åº”çš„ Tab è®¾ä¸ºå½“å‰æ´»åŠ¨ Tabã€‚</li></ol><p>ä¸‹é¢æ˜¯ç³»ç»Ÿæ€§çš„å®ç°æ–¹æ¡ˆã€‚</p><hr><h3 id="ç¬¬ä¸€æ­¥ï¼šä¸»è¿›ç¨‹æ”¯æŒâ€œçª—å£æ¿€æ´»â€-src-main-ipc-window-ipc-ts"><a href="#ç¬¬ä¸€æ­¥ï¼šä¸»è¿›ç¨‹æ”¯æŒâ€œçª—å£æ¿€æ´»â€-src-main-ipc-window-ipc-ts" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šä¸»è¿›ç¨‹æ”¯æŒâ€œçª—å£æ¿€æ´»â€ (src/main/ipc/window-ipc.ts)"></a>ç¬¬ä¸€æ­¥ï¼šä¸»è¿›ç¨‹æ”¯æŒâ€œçª—å£æ¿€æ´»â€ (<code>src/main/ipc/window-ipc.ts</code>)</h3><p>å‰ç«¯æ¸²æŸ“è¿›ç¨‹ä¸èƒ½ç›´æ¥å¼ºåˆ¶æ“ä½œç³»ç»ŸæŠŠçª—å£ç½®é¡¶ï¼Œè¿™å¿…é¡»ç”±ä¸»è¿›ç¨‹ï¼ˆMain Processï¼‰æ¥åšã€‚</p><p>ä¿®æ”¹ <code>src/main/ipc/window-ipc.ts</code>ï¼Œå¢åŠ ä¸€ä¸ªè®©çª—å£â€œæ¿€æ´»è‡ªå·±â€çš„ IPC æ¥å£ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main/ipc/window-ipc.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; ipcMain, <span class="title class_">BrowserWindow</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupWindowIPC</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ... ä¹‹å‰çš„ check-cursor-outside-window ä»£ç  ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// âœ… æ–°å¢ï¼šæ¿€æ´»ï¼ˆç½®é¡¶/èšç„¦ï¼‰å‘é€è¯·æ±‚çš„é‚£ä¸ªçª—å£</span></span><br><span class="line">  ipcMain.<span class="title function_">handle</span>(<span class="string">&#x27;activate-current-window&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°è§¦å‘äº‹ä»¶çš„çª—å£</span></span><br><span class="line">    <span class="keyword">const</span> win = <span class="title class_">BrowserWindow</span>.<span class="title function_">fromWebContents</span>(event.<span class="property">sender</span>)</span><br><span class="line">    <span class="keyword">if</span> (win) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæœ€å°åŒ–äº†ï¼Œå…ˆè¿˜åŸ</span></span><br><span class="line">      <span class="keyword">if</span> (win.<span class="title function_">isMinimized</span>()) win.<span class="title function_">restore</span>()</span><br><span class="line">      <span class="comment">// èšç„¦çª—å£ (Windows/Mac/Linux é€šç”¨)</span></span><br><span class="line">      win.<span class="title function_">show</span>()</span><br><span class="line">      win.<span class="title function_">focus</span>()</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>(åˆ«å¿˜äº†åœ¨ <code>src/preload/index.ts</code> é‡ŒæŠŠè¿™ä¸ªæ–¹æ³•æš´éœ²ç»™å‰ç«¯ï¼Œç±»ä¼¼äºä¹‹å‰çš„ <code>checkCursorOutside</code>)</em></p><hr><h3 id="ç¬¬äºŒæ­¥ï¼šå°è£…â€œTab-æŸ¥è¯¢å·¥å…·â€-src-utils-tab-manager-ts"><a href="#ç¬¬äºŒæ­¥ï¼šå°è£…â€œTab-æŸ¥è¯¢å·¥å…·â€-src-utils-tab-manager-ts" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå°è£…â€œTab æŸ¥è¯¢å·¥å…·â€ (src/utils/tab-manager.ts)"></a>ç¬¬äºŒæ­¥ï¼šå°è£…â€œTab æŸ¥è¯¢å·¥å…·â€ (<code>src/utils/tab-manager.ts</code>)</h3><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œåˆ©ç”¨ <code>BroadcastChannel</code> å‘å‡ºè¯¢é—®ï¼Œå¹¶ç­‰å¾…å›å¤ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/utils/tab-manager.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TAB_CHANNEL_NAME</span> = <span class="string">&#x27;dockview-tab-manager&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TabMessage</span> &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;CHECK_TAB_EXIST&#x27;</span> | <span class="string">&#x27;TAB_FOUND&#x27;</span></span><br><span class="line">  <span class="attr">tabId</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°è¯•æŸ¥æ‰¾å¹¶æ¿€æ´»å·²å­˜åœ¨çš„ Tab</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tabId è¦æŸ¥æ‰¾çš„ Tab ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> Promise&lt;boolean&gt; true è¡¨ç¤ºæ‰¾åˆ°äº†å¹¶å·²æ¿€æ´»ï¼Œfalse è¡¨ç¤ºæ²¡æ‰¾åˆ°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">findAndActivateTab</span>(<span class="params"><span class="attr">tabId</span>: <span class="built_in">string</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="variable constant_">TAB_CHANNEL_NAME</span>)</span><br><span class="line">    <span class="keyword">let</span> isFound = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. ç›‘å¬å›å¤</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params"><span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">TabMessage</span>&gt;</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (event.<span class="property">data</span>.<span class="property">type</span> === <span class="string">&#x27;TAB_FOUND&#x27;</span> &amp;&amp; event.<span class="property">data</span>.<span class="property">tabId</span> === tabId) &#123;</span><br><span class="line">        isFound = <span class="literal">true</span></span><br><span class="line">        <span class="title function_">cleanup</span>()</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">true</span>) <span class="comment">// æ‰¾åˆ°äº†ï¼</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">cleanup</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      channel.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;message&#x27;</span>, handler)</span><br><span class="line">      channel.<span class="title function_">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    channel.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, handler)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. å‘å‡ºè¯¢é—®å¹¿æ’­</span></span><br><span class="line">    <span class="comment">// &quot;å˜¿ï¼å¤§å®¶æ³¨æ„ï¼Œæœ‰äººæœ‰ç‚¹åè¦æ‰¾ [tabId]ï¼Œæœ‰çš„è¯·å±ä¸€å£°å¹¶è·³å‡ºæ¥ï¼&quot;</span></span><br><span class="line">    channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;CHECK_TAB_EXIST&#x27;</span>,</span><br><span class="line">      tabId</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è®¾ç½®è¶…æ—¶</span></span><br><span class="line">    <span class="comment">// å¦‚æœ 200ms å†…æ²¡äººå›å¤ï¼Œå°±è®¤ä¸ºä¸å­˜åœ¨</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isFound) &#123;</span><br><span class="line">        <span class="title function_">cleanup</span>()</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">false</span>) <span class="comment">// æ²¡æ‰¾åˆ°</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">200</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ã€åœ¨ App.vue åˆå§‹åŒ–æ—¶è°ƒç”¨ã€‘</span></span><br><span class="line"><span class="comment"> * æ³¨å†Œç›‘å¬å™¨ï¼šå“åº”åˆ«äººçš„æŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dockAPI Dockview çš„ API å®ä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">registerTabManager</span>(<span class="params"><span class="attr">dockAPI</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="variable constant_">TAB_CHANNEL_NAME</span>)</span><br><span class="line"></span><br><span class="line">  channel.<span class="property">onmessage</span> = <span class="title function_">async</span> (<span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">TabMessage</span>&gt;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="property">data</span>.<span class="property">type</span> === <span class="string">&#x27;CHECK_TAB_EXIST&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> targetId = event.<span class="property">data</span>.<span class="property">tabId</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 1. æ£€æŸ¥æˆ‘è¿™ä¸ªçª—å£æœ‰æ²¡æœ‰è¿™ä¸ª Tab</span></span><br><span class="line">      <span class="keyword">const</span> panel = dockAPI.<span class="title function_">getPanel</span>(targetId)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (panel) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸ™‹â€â™‚ï¸ æˆ‘è¿™é‡Œæœ‰ Tab [<span class="subst">$&#123;targetId&#125;</span>]ï¼Œæ­£åœ¨æ¿€æ´»...`</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. å‘Šè¯‰å‘èµ·è€…ï¼šæˆ‘æ‰¾åˆ°äº†ï¼</span></span><br><span class="line">        channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;TAB_FOUND&#x27;</span>,</span><br><span class="line">          <span class="attr">tabId</span>: targetId</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. æ¿€æ´» Dockview é‡Œçš„ Tab (è®©å®ƒæ˜¾ç¤ºå‡ºæ¥)</span></span><br><span class="line">        panel.<span class="property">api</span>.<span class="title function_">setActive</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. è°ƒç”¨ä¸»è¿›ç¨‹ï¼šæŠŠè‡ªå·±è¿™ä¸ªçª—å£ç½®é¡¶</span></span><br><span class="line">        <span class="comment">// å‡è®¾ä½ åœ¨ preload é‡Œæš´éœ²äº† activateWindow</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">electronAPI</span> &amp;&amp; (<span class="variable language_">window</span>.<span class="property">electronAPI</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="property">activateWindow</span>) &#123;</span><br><span class="line">           <span class="title function_">await</span> (<span class="variable language_">window</span>.<span class="property">electronAPI</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="title function_">activateWindow</span>()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="comment">// å…¼å®¹å†™æ³•ï¼Œå¦‚æœ preload æ²¡é…å¥½ï¼Œç”¨ window.focus è¯•è¯• (æœ‰æ—¶å€™ä¼šè¢«æµè§ˆå™¨æ‹¦æˆª)</span></span><br><span class="line">           <span class="variable language_">window</span>.<span class="title function_">focus</span>() </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›æ¸…ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> channel.<span class="title function_">close</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ç¬¬ä¸‰æ­¥ï¼šPreload-è¡¥å……-src-preload-index-ts"><a href="#ç¬¬ä¸‰æ­¥ï¼šPreload-è¡¥å……-src-preload-index-ts" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šPreload è¡¥å…… (src/preload/index.ts)"></a>ç¬¬ä¸‰æ­¥ï¼šPreload è¡¥å…… (<code>src/preload/index.ts</code>)</h3><p>ä¸ºäº†è®© <code>activateWindow</code> ç”Ÿæ•ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ preload é‡Œè¡¥ä¸Šè¿™ä¸ª APIã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/preload/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; contextBridge, ipcRenderer &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api = &#123;</span><br><span class="line">  <span class="attr">checkCursorOutside</span>: <span class="function">() =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;check-cursor-outside-window&#x27;</span>),</span><br><span class="line">  <span class="comment">// âœ… æ–°å¢ï¼šè¯·æ±‚ä¸»è¿›ç¨‹æ¿€æ´»å½“å‰çª—å£</span></span><br><span class="line">  <span class="attr">activateWindow</span>: <span class="function">() =&gt;</span> ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&#x27;activate-current-window&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... exposeInMainWorld é€»è¾‘åŒå‰ ...</span></span><br></pre></td></tr></table></figure><p><em>(è®°å¾—æ›´æ–° <code>src/env.d.ts</code> æˆ– <code>window</code> ç±»å‹å®šä¹‰ï¼ŒåŠ ä¸Š <code>activateWindow</code>)</em></p><hr><h3 id="ç¬¬å››æ­¥ï¼šåœ¨-App-vue-æ³¨å†Œç›‘å¬-src-App-vue"><a href="#ç¬¬å››æ­¥ï¼šåœ¨-App-vue-æ³¨å†Œç›‘å¬-src-App-vue" class="headerlink" title="ç¬¬å››æ­¥ï¼šåœ¨ App.vue æ³¨å†Œç›‘å¬ (src/App.vue)"></a>ç¬¬å››æ­¥ï¼šåœ¨ App.vue æ³¨å†Œç›‘å¬ (<code>src/App.vue</code>)</h3><p>æ‰€æœ‰çª—å£ï¼ˆä¸»çª—å£å’Œå­çª—å£ï¼‰éƒ½è¿è¡Œ <code>App.vue</code>ï¼Œæ‰€ä»¥å®ƒä»¬éƒ½éœ€è¦â€œç›‘å¬åˆ«äººçš„æŸ¥è¯¢â€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- src/App.vue --&gt;</span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; onUnmounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; registerTabManager &#125; from &#x27;./utils/tab-manager&#x27; // å¼•å…¥åˆšæ‰å†™çš„å·¥å…·</span><br><span class="line"></span><br><span class="line">// ... ä½ çš„å…¶ä»–ä»£ç  ...</span><br><span class="line"></span><br><span class="line">let cleanupTabManager: Function | null = null</span><br><span class="line"></span><br><span class="line">const onReady = (event: DockviewReadyEvent) =&gt; &#123;</span><br><span class="line">  const api = event.api</span><br><span class="line">  </span><br><span class="line">  // âœ… 1. æ³¨å†Œå…¨å±€ Tab ç®¡ç†å™¨</span><br><span class="line">  // ä¸€æ—¦ dockview å‡†å¤‡å¥½ï¼Œæˆ‘å°±å¼€å§‹ç›‘å¬ &quot;æœ‰æ²¡æœ‰äººæ‰¾ Tab&quot;</span><br><span class="line">  cleanupTabManager = registerTabManager(api)</span><br><span class="line"></span><br><span class="line">  // ... åŸæœ‰çš„é€»è¾‘ ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onUnmounted(() =&gt; &#123;</span><br><span class="line">  // é”€æ¯æ—¶æ¸…ç†ç›‘å¬</span><br><span class="line">  if (cleanupTabManager) cleanupTabManager()</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="ç¬¬äº”æ­¥ï¼šä½¿ç”¨åŠŸèƒ½-åœ¨åˆ›å»º-Tab-çš„åœ°æ–¹"><a href="#ç¬¬äº”æ­¥ï¼šä½¿ç”¨åŠŸèƒ½-åœ¨åˆ›å»º-Tab-çš„åœ°æ–¹" class="headerlink" title="ç¬¬äº”æ­¥ï¼šä½¿ç”¨åŠŸèƒ½ (åœ¨åˆ›å»º Tab çš„åœ°æ–¹)"></a>ç¬¬äº”æ­¥ï¼šä½¿ç”¨åŠŸèƒ½ (åœ¨åˆ›å»º Tab çš„åœ°æ–¹)</h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªä¾§è¾¹æ èœå•æˆ–è€…æŒ‰é’®ç”¨æ¥æ‰“å¼€ Tabï¼Œç°åœ¨æŠŠ <code>dockAPI.addPanel</code> æ›¿æ¢ä¸ºä¸‹é¢çš„é€»è¾‘ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- å‡è®¾è¿™æ˜¯ä½ çš„ Sidebar.vue æˆ–è€…æŸä¸ªä¸šåŠ¡ç»„ä»¶ --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button @click=&quot;openSettings&quot;&gt;æ‰“å¼€è®¾ç½® (å”¯ä¸€)&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; findAndActivateTab &#125; from &#x27;../utils/tab-manager&#x27;</span><br><span class="line"></span><br><span class="line">// å‡è®¾ä½ èƒ½è·å–åˆ° dockAPI (é€šè¿‡ Provide/Inject æˆ–è€… Store)</span><br><span class="line">// å¦‚æœæ˜¯åœ¨ App.vue å†…éƒ¨ç›´æ¥è°ƒç”¨å°±æ›´ç®€å•äº†</span><br><span class="line">const props = defineProps&lt;&#123; dockAPI: any &#125;&gt;() </span><br><span class="line"></span><br><span class="line">const openSettings = async () =&gt; &#123;</span><br><span class="line">  const tabId = &#x27;settings_panel&#x27;</span><br><span class="line">  const tabTitle = &#x27;è®¾ç½®ä¸­å¿ƒ&#x27;</span><br><span class="line"></span><br><span class="line">  // 1. âœ¨ æ ¸å¿ƒæ­¥éª¤ï¼šå…ˆé—®ä¸€åœˆ</span><br><span class="line">  const exists = await findAndActivateTab(tabId)</span><br><span class="line"></span><br><span class="line">  if (exists) &#123;</span><br><span class="line">    console.log(&#x27;âœ… Tab å·²å­˜åœ¨äºæŸä¸ªçª—å£ï¼Œå·²è‡ªåŠ¨æ¿€æ´»ï¼Œæ— éœ€åˆ›å»ºã€‚&#x27;)</span><br><span class="line">    return // ç›´æ¥ç»“æŸ</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 2. å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±åœ¨å½“å‰çª—å£åˆ›å»º</span><br><span class="line">  console.log(&#x27;âœ¨ Tab ä¸å­˜åœ¨ï¼Œæ­£åœ¨å½“å‰çª—å£åˆ›å»º...&#x27;)</span><br><span class="line">  props.dockAPI.addPanel(&#123;</span><br><span class="line">    id: tabId,</span><br><span class="line">    component: &#x27;default&#x27;, // æ›¿æ¢ä¸ºä½ çš„ç»„ä»¶å</span><br><span class="line">    tabComponent: &#x27;myTab&#x27;,</span><br><span class="line">    params: &#123; title: tabTitle &#125;,</span><br><span class="line">    title: tabTitle</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="åœºæ™¯æ¼”ç¤º"><a href="#åœºæ™¯æ¼”ç¤º" class="headerlink" title="åœºæ™¯æ¼”ç¤º"></a>åœºæ™¯æ¼”ç¤º</h3><ol><li><p><strong>åœºæ™¯ Aï¼šåŒçª—å£åˆ‡æ¢</strong></p><ul><li><strong>ç°çŠ¶</strong>ï¼šä¸»çª—å£æœ‰â€œè®¾ç½®â€Tabï¼Œä½†è¢«â€œé¦–é¡µâ€Tab æŒ¡ä½äº†ã€‚</li><li><strong>æ“ä½œ</strong>ï¼šç‚¹å‡»â€œæ‰“å¼€è®¾ç½®â€ã€‚</li><li><strong>æµç¨‹</strong>ï¼š<code>findAndActivateTab</code> å¹¿æ’­ -&gt; ä¸»çª—å£æ”¶åˆ° -&gt; å‘ç°è‡ªå·±æœ‰ -&gt; <code>panel.api.setActive()</code> åˆ‡æ¢åˆ°è®¾ç½® Tab -&gt; æ¿€æ´»çª—å£ -&gt; å›å¤ <code>TAB_FOUND</code>ã€‚</li><li><strong>ç»“æœ</strong>ï¼šä¸»çª—å£ç›´æ¥åˆ‡åˆ°äº†è®¾ç½®é¡µã€‚</li></ul></li><li><p><strong>åœºæ™¯ Bï¼šè·¨çª—å£æ¿€æ´»</strong></p><ul><li><strong>ç°çŠ¶</strong>ï¼šä½ æŠŠâ€œè®¾ç½®â€Tab æ‹–æ‹½åˆ°äº†ä¸€ä¸ª<strong>ç‹¬ç«‹çš„æ–°çª—å£</strong>ï¼ˆå­çª—å£ï¼‰ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªå­çª—å£æœ€å°åŒ–äº†ã€‚</li><li><strong>æ“ä½œ</strong>ï¼šåœ¨<strong>ä¸»çª—å£</strong>ç‚¹å‡»â€œæ‰“å¼€è®¾ç½®â€ã€‚</li><li><strong>æµç¨‹</strong>ï¼šä¸»çª—å£å¹¿æ’­ -&gt; å­çª—å£æ”¶åˆ° -&gt; å‘ç°è‡ªå·±æœ‰ -&gt; è°ƒç”¨ <code>ipc: activate-current-window</code> -&gt; <strong>ä¸»è¿›ç¨‹æŠŠå­çª—å£è¿˜åŸå¹¶ç½®é¡¶</strong> -&gt; å­çª—å£å›å¤ <code>TAB_FOUND</code>ã€‚</li><li><strong>ç»“æœ</strong>ï¼šåŸæœ¬æœ€å°åŒ–çš„å­çª—å£å¼¹åˆ°äº†å±å¹•æœ€å‰é¢ï¼Œæ˜¾ç¤ºç€è®¾ç½®é¡µã€‚ä¸»çª—å£ä¸ä¼šåˆ›å»ºé‡å¤çš„ Tabã€‚</li></ul></li><li><p><strong>åœºæ™¯ Cï¼šä¸å­˜åœ¨</strong></p><ul><li><strong>ç°çŠ¶</strong>ï¼šæ‰€æœ‰çª—å£éƒ½å…³é—­äº†â€œè®¾ç½®â€ã€‚</li><li><strong>æ“ä½œ</strong>ï¼šç‚¹å‡»â€œæ‰“å¼€è®¾ç½®â€ã€‚</li><li><strong>æµç¨‹</strong>ï¼šå¹¿æ’­ -&gt; 200ms å†…æ²¡äººå› -&gt; è¿”å› <code>false</code> -&gt; æ‰§è¡Œ <code>addPanel</code>ã€‚</li><li><strong>ç»“æœ</strong>ï¼šåœ¨å½“å‰çª—å£æ–°å¼€ä¸€ä¸ªè®¾ç½® Tabã€‚</li></ul></li></ol><p>è¿™ä¸ªæ–¹æ¡ˆåˆ©ç”¨äº†ä½ ç°æœ‰çš„ <code>BroadcastChannel</code> æ¶æ„ï¼Œéå¸¸è½»é‡ä¸”é«˜æ•ˆã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å•ä¾‹-Tab-ç­–ç•¥â€-Singleton-Tab-Strategy&quot;&gt;&lt;a href=&quot;#å•ä¾‹-Tab-ç­–ç•¥â€-Singleton-Tab-Strategy&quot; class=&quot;headerlink&quot; title=&quot;å•ä¾‹ Tab ç­–ç•¥â€ (Singleton Tab </summary>
      
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>ç›‘å¬çª—å£åˆ›å»ºå®Œæˆ</title>
    <link href="http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/electron/%E7%9B%91%E5%90%AC%E7%AA%97%E5%8F%A3%E5%88%9B%E5%BB%BA%E5%AE%8C%E6%88%90/"/>
    <id>http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/electron/%E7%9B%91%E5%90%AC%E7%AA%97%E5%8F%A3%E5%88%9B%E5%BB%BA%E5%AE%8C%E6%88%90/</id>
    <published>2025-12-13T15:34:12.853Z</published>
    <updated>2025-12-16T14:49:33.110Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main/index.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. ç›‘å¬æ–°çª—å£åˆ›å»ºè¯·æ±‚ (æ‹¦æˆªå±‚)</span></span><br><span class="line">mainWindow.<span class="property">webContents</span>.<span class="title function_">setWindowOpenHandler</span>(<span class="function">(<span class="params">details</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// details.url åŒ…å«äº†æ–°çª—å£çš„ URL</span></span><br><span class="line">  <span class="comment">// details.frameName å¯èƒ½æ˜¯ dockview æŒ‡å®šçš„åå­—</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;âš¡ï¸ æ£€æµ‹åˆ° Tab è¢«æ‹–å‡ºï¼Œæ­£åœ¨è¯·æ±‚åˆ›å»ºçª—å£:&#x27;</span>, details.<span class="property">url</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½ å¯ä»¥åœ¨è¿™é‡Œåˆ¤æ–­ url æ˜¯å¦åŒ…å«ç‰¹å®šçš„ query å‚æ•°ï¼Œæ¥ç¡®å®šè¿™æ˜¯ dockview çš„å¼¹çª—</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123; </span><br><span class="line">    <span class="attr">action</span>: <span class="string">&#x27;allow&#x27;</span>,</span><br><span class="line">    <span class="attr">overrideBrowserWindowOptions</span>: &#123;</span><br><span class="line">      <span class="comment">// åœ¨è¿™é‡Œå¼ºåˆ¶æŒ‡å®šæ–°çª—å£çš„æ ·å¼</span></span><br><span class="line">      <span class="attr">autoHideMenuBar</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">        <span class="attr">preload</span>: <span class="title function_">join</span>(__dirname, <span class="string">&#x27;../preload/index.js&#x27;</span>), <span class="comment">// åˆ«å¿˜äº† preload</span></span><br><span class="line">        <span class="attr">backgroundThrottling</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="comment">// ...å…¶ä»–é…ç½®</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ç›‘å¬çª—å£åˆ›å»ºå®Œæˆ (ç»“æœå±‚)</span></span><br><span class="line">mainWindow.<span class="property">webContents</span>.<span class="title function_">on</span>(<span class="string">&#x27;did-create-window&#x27;</span>, <span class="function">(<span class="params">childWindow, details</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;âœ… æ–°çª—å£å®ä¾‹å·²åˆ›å»º (Tab å¼¹å‡ºæˆåŠŸ)&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¸šåŠ¡åœºæ™¯ï¼šä½ å¯èƒ½æƒ³å‘Šè¯‰ä¸»æ¸²æŸ“è¿›ç¨‹â€œæœ‰ä¸ªå­çª—å£è¯ç”Ÿäº†â€</span></span><br><span class="line">  mainWindow.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&#x27;popout-window-created&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: childWindow.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">title</span>: childWindow.<span class="title function_">getTitle</span>()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸šåŠ¡åœºæ™¯ï¼šç›‘å¬å­çª—å£çš„å…³é—­ï¼Œåšä¸€äº›æ¸…ç†å·¥ä½œ</span></span><br><span class="line">  childWindow.<span class="title function_">on</span>(<span class="string">&#x27;closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;âŒ å­çª—å£å·²å…³é—­&#x27;</span>)</span><br><span class="line">    mainWindow.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&#x27;popout-window-closed&#x27;</span>, &#123; <span class="attr">id</span>: childWindow.<span class="property">id</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><span id="more"></span>]]></content>
    
    
    <summary type="html">&lt;figure class=&quot;highlight typescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// src/main/index.ts&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 1. ç›‘å¬æ–°çª—å£åˆ›å»ºè¯·æ±‚ (æ‹¦æˆªå±‚)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mainWindow.&lt;span class=&quot;property&quot;&gt;webContents&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;setWindowOpenHandler&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;details&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// details.url åŒ…å«äº†æ–°çª—å£çš„ URL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// details.frameName å¯èƒ½æ˜¯ dockview æŒ‡å®šçš„åå­—&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;âš¡ï¸ æ£€æµ‹åˆ° Tab è¢«æ‹–å‡ºï¼Œæ­£åœ¨è¯·æ±‚åˆ›å»ºçª—å£:&amp;#x27;&lt;/span&gt;, details.&lt;span class=&quot;property&quot;&gt;url&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// ä½ å¯ä»¥åœ¨è¿™é‡Œåˆ¤æ–­ url æ˜¯å¦åŒ…å«ç‰¹å®šçš„ query å‚æ•°ï¼Œæ¥ç¡®å®šè¿™æ˜¯ dockview çš„å¼¹çª—&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;action&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;allow&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;overrideBrowserWindowOptions&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// åœ¨è¿™é‡Œå¼ºåˆ¶æŒ‡å®šæ–°çª—å£çš„æ ·å¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;autoHideMenuBar&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;webPreferences&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;preload&lt;/span&gt;: &lt;span class=&quot;title function_&quot;&gt;join&lt;/span&gt;(__dirname, &lt;span class=&quot;string&quot;&gt;&amp;#x27;../preload/index.js&amp;#x27;&lt;/span&gt;), &lt;span class=&quot;comment&quot;&gt;// åˆ«å¿˜äº† preload&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;backgroundThrottling&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// ...å…¶ä»–é…ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 2. ç›‘å¬çª—å£åˆ›å»ºå®Œæˆ (ç»“æœå±‚)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mainWindow.&lt;span class=&quot;property&quot;&gt;webContents&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;on&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;did-create-window&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;childWindow, details&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;âœ… æ–°çª—å£å®ä¾‹å·²åˆ›å»º (Tab å¼¹å‡ºæˆåŠŸ)&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// ä¸šåŠ¡åœºæ™¯ï¼šä½ å¯èƒ½æƒ³å‘Šè¯‰ä¸»æ¸²æŸ“è¿›ç¨‹â€œæœ‰ä¸ªå­çª—å£è¯ç”Ÿäº†â€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  mainWindow.&lt;span class=&quot;property&quot;&gt;webContents&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;send&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;popout-window-created&amp;#x27;&lt;/span&gt;, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;: childWindow.&lt;span class=&quot;property&quot;&gt;id&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;title&lt;/span&gt;: childWindow.&lt;span class=&quot;title function_&quot;&gt;getTitle&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// ä¸šåŠ¡åœºæ™¯ï¼šç›‘å¬å­çª—å£çš„å…³é—­ï¼Œåšä¸€äº›æ¸…ç†å·¥ä½œ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  childWindow.&lt;span class=&quot;title function_&quot;&gt;on&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;closed&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;âŒ å­çª—å£å·²å…³é—­&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mainWindow.&lt;span class=&quot;property&quot;&gt;webContents&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;send&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;popout-window-closed&amp;#x27;&lt;/span&gt;, &amp;#123; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;: childWindow.&lt;span class=&quot;property&quot;&gt;id&lt;/span&gt; &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>ä¸Šä¼ åˆ°npmä»“åº“</title>
    <link href="http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/electron/%E5%A6%82%E4%BD%95%E5%B0%86%E9%A1%B9%E7%9B%AE%E6%8F%92%E4%BB%B6%E4%BC%A0%E5%88%B0npm%E4%BB%93%E5%BA%93/"/>
    <id>http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/electron/%E5%A6%82%E4%BD%95%E5%B0%86%E9%A1%B9%E7%9B%AE%E6%8F%92%E4%BB%B6%E4%BC%A0%E5%88%B0npm%E4%BB%93%E5%BA%93/</id>
    <published>2025-12-13T14:05:39.322Z</published>
    <updated>2025-12-16T14:50:13.442Z</updated>
    
    <content type="html"><![CDATA[<p>å‘å¸ƒ npm åŒ…ä¸ä»…ä»…æ˜¯æŠŠä»£ç æ”¾ä¸Šå»ï¼Œè¿˜éœ€è¦è€ƒè™‘ <strong>æ„å»ºè§„èŒƒ (ESM&#x2F;CJS)</strong>ã€<strong>ç±»å‹å®šä¹‰ (TypeScript .d.ts)</strong>ã€<strong>Peer Dependencies</strong> ä»¥åŠ <strong>æ‰©å±•æ€§</strong>ã€‚</p><p>æ—¢ç„¶æˆ‘ä»¬è¦æŠŠå®ƒåšæˆä¸€ä¸ªé€šç”¨çš„ <code>pinia-plugin-electron-share</code>ï¼Œæˆ‘ä»¬éœ€è¦è®©å®ƒæ”¯æŒé…ç½®ï¼ˆæ¯”å¦‚è‡ªå®šä¹‰ Channel åç§°ï¼‰ï¼Œå¹¶ä¸”å…·å¤‡å®Œå–„çš„å·¥ç¨‹åŒ–ç»“æ„ã€‚</p><p>è¿™é‡Œæ˜¯<strong>å¯ä»¥ç›´æ¥ <code>npm publish</code> çš„å®Œæ•´å·¥ç¨‹ä»£ç ç»“æ„</strong>ã€‚</p><span id="more"></span><hr><h3 id="1-é¡¹ç›®ç›®å½•ç»“æ„"><a href="#1-é¡¹ç›®ç›®å½•ç»“æ„" class="headerlink" title="1. é¡¹ç›®ç›®å½•ç»“æ„"></a>1. é¡¹ç›®ç›®å½•ç»“æ„</h3><p>ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼ˆä¾‹å¦‚ <code>pinia-plugin-electron-share</code>ï¼‰ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pinia-plugin-electron-share/</span><br><span class="line">â”œâ”€â”€ src/</span><br><span class="line">â”‚   â””â”€â”€ index.ts        # æ ¸å¿ƒæºç </span><br><span class="line">â”œâ”€â”€ dist/               # æ„å»ºäº§ç‰© (è‡ªåŠ¨ç”Ÿæˆ)</span><br><span class="line">â”œâ”€â”€ package.json        # ä¾èµ–ä¸å…ƒæ•°æ®</span><br><span class="line">â”œâ”€â”€ tsconfig.json       # TS é…ç½®</span><br><span class="line">â”œâ”€â”€ vite.config.ts      # æ„å»ºè„šæœ¬ (ä½¿ç”¨ Vite åº“æ¨¡å¼)</span><br><span class="line">â””â”€â”€ README.md           # è¯´æ˜æ–‡æ¡£</span><br></pre></td></tr></table></figure><hr><h3 id="2-æ ¸å¿ƒä»£ç -src-index-ts"><a href="#2-æ ¸å¿ƒä»£ç -src-index-ts" class="headerlink" title="2. æ ¸å¿ƒä»£ç  (src/index.ts)"></a>2. æ ¸å¿ƒä»£ç  (<code>src/index.ts</code>)</h3><p>è¿™é‡Œæˆ‘åšäº†ä¸€äº›å¢å¼ºï¼š</p><ol><li><strong>æ”¯æŒæ’ä»¶çº§é…ç½®</strong>ï¼šå¯ä»¥åœ¨ <code>pinia.use()</code> æ—¶ä¼ å…¥å…¨å±€é…ç½®ã€‚</li><li><strong>ç±»å‹å£°æ˜å¢å¼º</strong>ï¼šå®Œç¾çš„ TypeScript ç±»å‹æç¤ºã€‚</li><li><strong>åºåˆ—åŒ–ä¿æŠ¤</strong>ï¼šå¢åŠ äº†å¯¹åºåˆ—åŒ–å¼‚å¸¸çš„åŸºç¡€æ•è·ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PiniaPluginContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. æ‰©å±• Pinia ç±»å‹å®šä¹‰</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;pinia&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DefineStoreOptionsBase</span>&lt;S, <span class="title class_">Store</span>&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Enable state synchronization across Electron windows.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@default</span> <span class="variable">false</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">share</span>?: <span class="built_in">boolean</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ’ä»¶é…ç½®æ¥å£</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ElectronShareOptions</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Custom name for BroadcastChannel.</span></span><br><span class="line"><span class="comment">   * Useful if you have multiple apps running on the same domain/protocol.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@default</span> &#x27;pinia-electron-share&#x27;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">channelName</span>?: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ¶ˆæ¯è½½è·å®šä¹‰</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">SyncPayload</span> = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;UPDATE&#x27;</span> | <span class="string">&#x27;REQUEST_INIT&#x27;</span> | <span class="string">&#x27;RESPONSE_INIT&#x27;</span></span><br><span class="line">  <span class="attr">storeId</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line">  <span class="attr">timestamp</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. æ’ä»¶ä¸»å‡½æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createElectronSharePlugin</span>(<span class="params"><span class="attr">globalOptions</span>: <span class="title class_">ElectronShareOptions</span> = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">CHANNEL_NAME</span> = globalOptions.<span class="property">channelName</span> || <span class="string">&#x27;pinia-electron-share&#x27;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºé¢‘é“ (ç”±äºæ˜¯å¹¿æ’­ï¼Œå¯ä»¥åœ¨æ’ä»¶å±‚çº§å¤ç”¨ä¸€ä¸ªå®ä¾‹ï¼Œä¹Ÿå¯ä»¥åœ¨ Store çº§åˆ›å»ºï¼Œè¿™é‡Œä¸ºäº†ç®€å•å’Œæ€§èƒ½å¤ç”¨ä¸€ä¸ª)</span></span><br><span class="line">  <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="variable constant_">CHANNEL_NAME</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">&#123; store, options &#125;: <span class="title class_">PiniaPluginContext</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœ Store æ²¡æœ‰å¼€å¯ shareï¼Œç›´æ¥è·³è¿‡</span></span><br><span class="line">    <span class="keyword">if</span> (!options.<span class="property">share</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> isExternalUpdate = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- æ¶ˆæ¯æ¥æ”¶é€»è¾‘ ---</span></span><br><span class="line">    channel.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">SyncPayload</span>&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="keyword">type</span>, storeId, data &#125; = event.<span class="property">data</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¿½ç•¥ä¸å±äºå½“å‰ Store çš„æ¶ˆæ¯</span></span><br><span class="line">      <span class="keyword">if</span> (storeId !== store.<span class="property">$id</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">switch</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;UPDATE&#x27;</span>:</span><br><span class="line">          <span class="keyword">if</span> (!isExternalUpdate) &#123;</span><br><span class="line">            isExternalUpdate = <span class="literal">true</span></span><br><span class="line">            store.$patch(data)</span><br><span class="line">            <span class="comment">// å®ä»»åŠ¡å»¶è¿Ÿé‡Šæ”¾é”ï¼Œç¡®ä¿ Vue å“åº”å¼é˜Ÿåˆ—æ¸…ç©º</span></span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; isExternalUpdate = <span class="literal">false</span> &#125;, <span class="number">0</span>)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;REQUEST_INIT&#x27;</span>:</span><br><span class="line">          <span class="comment">// æ”¶åˆ°æ–°çª—å£çš„è¯·æ±‚ï¼Œå‘é€å½“å‰çŠ¶æ€</span></span><br><span class="line">          channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;RESPONSE_INIT&#x27;</span>,</span><br><span class="line">            <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(store.<span class="property">$state</span>)),</span><br><span class="line">            <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;RESPONSE_INIT&#x27;</span>:</span><br><span class="line">          <span class="comment">// æ”¶åˆ°åˆå§‹åŒ–æ•°æ®ï¼Œåº”ç”¨åˆ°å½“å‰ Store</span></span><br><span class="line">          isExternalUpdate = <span class="literal">true</span></span><br><span class="line">          store.$patch(data)</span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; isExternalUpdate = <span class="literal">false</span> &#125;, <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- çŠ¶æ€å˜æ›´ç›‘å¬ ---</span></span><br><span class="line">    store.$subscribe(<span class="function">(<span class="params">mutation, state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isExternalUpdate) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> rawState = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(state))</span><br><span class="line">        </span><br><span class="line">        channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;UPDATE&#x27;</span>,</span><br><span class="line">          <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">          <span class="attr">data</span>: rawState,</span><br><span class="line">          <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[pinia-plugin-electron-share] Failed to serialize state for store &quot;<span class="subst">$&#123;store.$id&#125;</span>&quot;. Ensure state is JSON-serializable.`</span>, e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- åˆå§‹åŒ–æ¡æ‰‹ ---</span></span><br><span class="line">    <span class="comment">// å»¶è¿ŸæçŸ­æ—¶é—´å‘é€è¯·æ±‚ï¼Œç¡®ä¿ç›‘å¬å™¨å·²æŒ‚è½½</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;REQUEST_INIT&#x27;</span>,</span><br><span class="line">        <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">50</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="3-æ„å»ºé…ç½®-vite-config-ts"><a href="#3-æ„å»ºé…ç½®-vite-config-ts" class="headerlink" title="3. æ„å»ºé…ç½® (vite.config.ts)"></a>3. æ„å»ºé…ç½® (<code>vite.config.ts</code>)</h3><p>ä½¿ç”¨ Vite çš„åº“æ¨¡å¼ï¼ˆLibrary Modeï¼‰æ˜¯ç›®å‰æ‰“åŒ…ç°ä»£å‰ç«¯åº“çš„æœ€ä½³å®è·µã€‚æˆ‘ä»¬éœ€è¦åŒæ—¶è¾“å‡º ESM (ç»™ Vite&#x2F;Webpack ç”¨) å’Œ CJS (ç»™æ—§ Node ç¯å¢ƒç”¨ï¼Œè™½ç„¶åè€…åœ¨ Electron å‰ç«¯ä¸å¸¸ç”¨ï¼Œä½†ä¸ºäº†è§„èŒƒè¿˜æ˜¯åŠ ä¸Š)ã€‚</p><p>ä½ éœ€è¦å®‰è£…å¼€å‘ä¾èµ–ï¼š<br><code>npm install -D vite vite-plugin-dts typescript vue pinia</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> dts <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-dts&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// è‡ªåŠ¨ç”Ÿæˆ .d.ts ç±»å‹æ–‡ä»¶</span></span><br><span class="line">    <span class="title function_">dts</span>(&#123; </span><br><span class="line">      <span class="attr">include</span>: [<span class="string">&#x27;src/**/*.ts&#x27;</span>],</span><br><span class="line">      <span class="attr">insertTypesEntry</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">lib</span>: &#123;</span><br><span class="line">      <span class="attr">entry</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/index.ts&#x27;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;PiniaPluginElectronShare&#x27;</span>,</span><br><span class="line">      <span class="attr">fileName</span>: <span class="function">(<span class="params">format</span>) =&gt;</span> <span class="string">`index.<span class="subst">$&#123;format&#125;</span>.js`</span> <span class="comment">// index.es.js, index.umd.js</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">      <span class="comment">// ç¡®ä¿å¤–éƒ¨åŒ–å¤„ç†é‚£äº›ä½ ä¸æƒ³æ‰“åŒ…è¿›åº“çš„ä¾èµ–</span></span><br><span class="line">      <span class="attr">external</span>: [<span class="string">&#x27;pinia&#x27;</span>, <span class="string">&#x27;vue&#x27;</span>],</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="comment">// åœ¨ UMD æ„å»ºæ¨¡å¼ä¸‹ä¸ºè¿™äº›å¤–éƒ¨åŒ–çš„ä¾èµ–æä¾›ä¸€ä¸ªå…¨å±€å˜é‡</span></span><br><span class="line">        <span class="attr">globals</span>: &#123;</span><br><span class="line">          <span class="attr">vue</span>: <span class="string">&#x27;Vue&#x27;</span>,</span><br><span class="line">          <span class="attr">pinia</span>: <span class="string">&#x27;Pinia&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><hr><h3 id="4-package-json-é…ç½®"><a href="#4-package-json-é…ç½®" class="headerlink" title="4. package.json é…ç½®"></a>4. <code>package.json</code> é…ç½®</h3><p>è¿™é‡Œæœ‰å‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ol><li><strong><code>peerDependencies</code></strong>ï¼šæ˜ç¡®å‘Šè¯‰ä½¿ç”¨è€…ï¼Œä½ å¿…é¡»å…ˆå®‰è£… <code>pinia</code>ã€‚</li><li><strong><code>exports</code></strong>ï¼šç°ä»£ npm åŒ…çš„å¯¼å‡ºè§„èŒƒã€‚</li><li><strong><code>types</code></strong>ï¼šæŒ‡å‘ç”Ÿæˆçš„ç±»å‹æ–‡ä»¶ã€‚</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pinia-plugin-electron-share&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Sync Pinia state across Electron windows (Renderer processes) using BroadcastChannel. Ideal for Dockview.&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/index.umd.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/index.es.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/index.d.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;.&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;import&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/index.es.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;require&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/index.umd.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/index.d.ts&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;dist&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build --watch&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;prepublishOnly&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run build&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;pinia&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;electron&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;vue&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;share&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;multi-window&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;dockview&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Your Name&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MIT&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;peerDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pinia&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pinia&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;typescript&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vite-plugin-dts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><hr><h3 id="5-tsconfig-json"><a href="#5-tsconfig-json" class="headerlink" title="5. tsconfig.json"></a>5. <code>tsconfig.json</code></h3><p>ç¡®ä¿èƒ½æ­£ç¡®ç¼–è¯‘ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;useDefineForClassFields&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Node&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DOM&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;declaration&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><hr><h3 id="6-ä½¿ç”¨è¯´æ˜-README-md-ç‰‡æ®µ"><a href="#6-ä½¿ç”¨è¯´æ˜-README-md-ç‰‡æ®µ" class="headerlink" title="6. ä½¿ç”¨è¯´æ˜ (README.md ç‰‡æ®µ)"></a>6. ä½¿ç”¨è¯´æ˜ (<code>README.md</code> ç‰‡æ®µ)</h3><p>ä½ å¯ä»¥ç›´æ¥æŠŠè¿™æ®µè´´åˆ°æ–‡æ¡£é‡Œï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># pinia-plugin-electron-share</span></span><br><span class="line"></span><br><span class="line">Sync Pinia state across multiple Electron windows (Renderer Processes).</span><br><span class="line"></span><br><span class="line"><span class="section">## Installation</span></span><br><span class="line"></span><br><span class="line"><span class="code">```bash</span></span><br><span class="line"><span class="code">npm install pinia-plugin-electron-share</span></span><br></pre></td></tr></table></figure><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><h3 id="1-Register-the-Plugin"><a href="#1-Register-the-Plugin" class="headerlink" title="1. Register the Plugin"></a>1. Register the Plugin</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createElectronSharePlugin &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia-plugin-electron-share&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line"></span><br><span class="line">pinia.<span class="title function_">use</span>(<span class="title function_">createElectronSharePlugin</span>(&#123;</span><br><span class="line">  <span class="comment">// Optional: Custom channel name</span></span><br><span class="line">  <span class="attr">channelName</span>: <span class="string">&#x27;my-app-sync&#x27;</span> </span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pinia</span><br></pre></td></tr></table></figure><h3 id="2-Enable-in-Store"><a href="#2-Enable-in-Store" class="headerlink" title="2. Enable in Store"></a>2. Enable in Store</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/user.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>.<span class="property">count</span>++ &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// Enable sync for this store</span></span><br><span class="line">  <span class="attr">share</span>: <span class="literal">true</span> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">### 7. å‘å¸ƒæµç¨‹</span><br><span class="line"></span><br><span class="line">ä½œä¸ºé«˜çº§å·¥ç¨‹å¸ˆï¼Œä½ åº”è¯¥çŸ¥é“å‘å¸ƒæµç¨‹ï¼Œä½†ä¸ºäº†å®Œæ•´æ€§æˆ‘è¿˜æ˜¯åˆ—ä¸€ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">è¿™é‡Œæé†’ä¸€ä¸‹ npm å®˜ç½‘æ›´æ–°äº†éªŒè¯æœºåˆ¶ï¼Œä½ éœ€è¦å»åœ¨ä½ çš„è´¦æˆ·ä¸‹åˆ›å»ºä¸€ä¸ªaccess tokenï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ `npm login --registry=https://registry.npmjs.org/` ç™»å½•ã€‚</span><br><span class="line"></span><br><span class="line">åœ¨é¡¹ç›®ä¸‹åˆ›å»ºä¸€ä¸ª.npmrc æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</span><br></pre></td></tr></table></figure><p>registry&#x3D;<a href="https://registry.npmjs.com/">https://registry.npmjs.com/</a><br>&#x2F;&#x2F;registry.npmjs.com&#x2F;:_authToken&#x3D;YOUR_ACCESS_TOKEN</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1.  **æ„å»º**ï¼š</span><br><span class="line">    ```bash</span><br><span class="line">    npm run build</span><br></pre></td></tr></table></figure><pre><code>*(ç¡®ä¿ `dist` ç›®å½•ä¸‹ç”Ÿæˆäº† `index.es.js` å’Œ `index.d.ts`)*</code></pre><ol start="2"><li><p><strong>å‘å¸ƒ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm login</span><br><span class="line">npm publish --access public</span><br></pre></td></tr></table></figure></li><li><p><strong>åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨</strong>ï¼š<br>åœ¨ä½ çš„ Electron é¡¹ç›®ä¸­ <code>npm install pinia-plugin-electron-share</code>ï¼Œç„¶åæŒ‰ç…§ README é…ç½®å³å¯ã€‚</p></li></ol><h3 id="ä¸ºä»€ä¹ˆè¿™æ ·åšæ›´å¥½ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¿™æ ·åšæ›´å¥½ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¿™æ ·åšæ›´å¥½ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¿™æ ·åšæ›´å¥½ï¼Ÿ</h3><ol><li><strong>è§£è€¦</strong>ï¼šä½ çš„ä¸šåŠ¡ä»£ç åº“ä¸ä¼šæ··å…¥ä¸€å †å¤æ‚çš„ IPC é€šä¿¡é€»è¾‘ã€‚</li><li><strong>å¤ç”¨</strong>ï¼šå¦‚æœä½ æœ‰ä¸‹ä¸€ä¸ª Electron é¡¹ç›®ï¼Œç›´æ¥ install å³å¯ã€‚</li><li><strong>ç±»å‹å®‰å…¨</strong>ï¼šé€šè¿‡ <code>declare module</code>ï¼Œä½ çš„åŒäº‹åœ¨å†™ <code>defineStore</code> æ—¶ï¼Œè¾“å…¥ <code>share:</code> ä¼šè‡ªåŠ¨è·å¾—ä»£ç æç¤ºï¼Œè¿™æ‰æ˜¯é«˜çº§å¼€å‘ä½“éªŒã€‚</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;å‘å¸ƒ npm åŒ…ä¸ä»…ä»…æ˜¯æŠŠä»£ç æ”¾ä¸Šå»ï¼Œè¿˜éœ€è¦è€ƒè™‘ &lt;strong&gt;æ„å»ºè§„èŒƒ (ESM&amp;#x2F;CJS)&lt;/strong&gt;ã€&lt;strong&gt;ç±»å‹å®šä¹‰ (TypeScript .d.ts)&lt;/strong&gt;ã€&lt;strong&gt;Peer Dependencies&lt;/strong&gt; ä»¥åŠ &lt;strong&gt;æ‰©å±•æ€§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶æˆ‘ä»¬è¦æŠŠå®ƒåšæˆä¸€ä¸ªé€šç”¨çš„ &lt;code&gt;pinia-plugin-electron-share&lt;/code&gt;ï¼Œæˆ‘ä»¬éœ€è¦è®©å®ƒæ”¯æŒé…ç½®ï¼ˆæ¯”å¦‚è‡ªå®šä¹‰ Channel åç§°ï¼‰ï¼Œå¹¶ä¸”å…·å¤‡å®Œå–„çš„å·¥ç¨‹åŒ–ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæ˜¯&lt;strong&gt;å¯ä»¥ç›´æ¥ &lt;code&gt;npm publish&lt;/code&gt; çš„å®Œæ•´å·¥ç¨‹ä»£ç ç»“æ„&lt;/strong&gt;ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>electronå¤šçª—å£çŠ¶æ€åŒæ­¥ æ’ä»¶å¼€å‘pinia-plugin-electron-share</title>
    <link href="http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/electron/%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AApinia%E6%8F%92%E4%BB%B6/"/>
    <id>http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/electron/%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AApinia%E6%8F%92%E4%BB%B6/</id>
    <published>2025-12-13T14:02:22.024Z</published>
    <updated>2025-12-16T14:49:58.048Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>å¦‚ä½•å¼€å‘ä¸€ä¸ªelectronå¤šçª—å£çŠ¶æ€åŒæ­¥çš„æ’ä»¶ï¼Œè®©Dockviewå¼¹å‡ºçª—ä¹‹é—´çš„æ•°æ®åŒæ­¥ï¼Ÿ</p><span id="more"></span><h2 id="è®¾è®¡æ–¹æ¡ˆ"><a href="#è®¾è®¡æ–¹æ¡ˆ" class="headerlink" title="è®¾è®¡æ–¹æ¡ˆ"></a>è®¾è®¡æ–¹æ¡ˆ</h2><ol><li><strong>é›¶ä¸»è¿›ç¨‹ä¾èµ–</strong>ï¼šåŸºäº <code>BroadcastChannel</code>ï¼Œä¸éœ€è¦ä¿®æ”¹ Electron ä¸»è¿›ç¨‹ä»£ç ï¼Œçº¯å‰ç«¯å®ç°ã€‚</li><li><strong>è‡ªåŠ¨æ°´åˆï¼ˆHydrationï¼‰</strong>ï¼šæ–°çª—å£ï¼ˆDockview å¼¹å‡ºçª—ï¼‰æ‰“å¼€æ—¶ï¼Œä¼šè‡ªåŠ¨å‘è€çª—å£â€œè¦â€æ•°æ®ï¼Œè§£å†³åˆå§‹åŒ–ç©ºç™½é—®é¢˜ã€‚</li><li><strong>é˜²æ­»å¾ªç¯</strong>ï¼šå†…ç½®äº’æ–¥é”ï¼Œé˜²æ­¢ A -&gt; B -&gt; A çš„æ— é™æ›´æ–°ã€‚</li><li><strong>æŒ‰éœ€åŒæ­¥</strong>ï¼šä¸æ˜¯æ‰€æœ‰ Store éƒ½ä¼šåŒæ­¥ï¼Œä½ å¯ä»¥åœ¨å®šä¹‰ Store æ—¶é€šè¿‡ <code>share: true</code> å¼€å¯ã€‚</li></ol><!-- more --><hr><h3 id="1-æ ¸å¿ƒæ’ä»¶ä»£ç "><a href="#1-æ ¸å¿ƒæ’ä»¶ä»£ç " class="headerlink" title="1. æ ¸å¿ƒæ’ä»¶ä»£ç "></a>1. æ ¸å¿ƒæ’ä»¶ä»£ç </h3><p>è¯·åœ¨é¡¹ç›®ä¸­æ–°å»ºæ–‡ä»¶ <code>src/plugins/pinia-plugin-electron-share.ts</code>ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PiniaPluginContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰©å±• Pinia çš„å®šä¹‰ï¼Œä»¥ä¾¿åœ¨ä½¿ç”¨ defineStore æ—¶æœ‰ä»£ç æç¤º</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;pinia&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DefineStoreOptionsBase</span>&lt;S, <span class="title class_">Store</span>&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦åœ¨ Electron å¤šçª—å£ä¹‹é—´åŒæ­¥è¯¥ Store çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@default</span> <span class="variable">false</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">share</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆæ¯ç±»å‹å®šä¹‰</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">SyncPayload</span> = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;UPDATE&#x27;</span> | <span class="string">&#x27;REQUEST_INIT&#x27;</span> | <span class="string">&#x27;RESPONSE_INIT&#x27;</span>;</span><br><span class="line">  <span class="attr">storeId</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">data</span>?: <span class="built_in">any</span>; <span class="comment">// State object</span></span><br><span class="line">  <span class="attr">timestamp</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢‘é“åç§°</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CHANNEL_NAME</span> = <span class="string">&#x27;electron-pinia-share-channel&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">piniaPluginElectronShare</span>(<span class="params">&#123; store, options &#125;: <span class="title class_">PiniaPluginContext</span></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. æ£€æŸ¥å½“å‰ Store æ˜¯å¦å¼€å¯äº†å…±äº«</span></span><br><span class="line">  <span class="keyword">if</span> (!options.<span class="property">share</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. åˆ›å»ºå¹¿æ’­é¢‘é“ (æ‰€æœ‰çª—å£å…±ç”¨åŒä¸€ä¸ªé¢‘é“å)</span></span><br><span class="line">  <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="variable constant_">CHANNEL_NAME</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å†…éƒ¨çŠ¶æ€é”ï¼šé˜²æ­¢æ­»å¾ªç¯ (æ”¶åˆ°æ¶ˆæ¯æ›´æ–°æ—¶ï¼Œä¸å†å¹¿æ’­å‡ºå»)</span></span><br><span class="line">  <span class="keyword">let</span> isExternalUpdate = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ ¸å¿ƒé€»è¾‘ï¼šå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  channel.<span class="property">onmessage</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">MessageEvent</span>&lt;<span class="title class_">SyncPayload</span>&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="keyword">type</span>, storeId, data, timestamp &#125; = event.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åªå¤„ç†å½“å‰ Store çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">if</span> (storeId !== store.<span class="property">$id</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">      <span class="comment">// åœºæ™¯ A: æ”¶åˆ°å…¶ä»–çª—å£çš„çŠ¶æ€æ›´æ–°</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;UPDATE&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> (!isExternalUpdate) &#123;</span><br><span class="line">          isExternalUpdate = <span class="literal">true</span>;</span><br><span class="line">          store.$patch(data);</span><br><span class="line">          <span class="comment">// è¿™é‡Œç¨å¾®å»¶è¿Ÿä¸€ç‚¹é‡Šæ”¾é”ï¼Œç¡®ä¿ Vue å“åº”å¼ç³»ç»Ÿå¤„ç†å®Œæ¯•</span></span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; isExternalUpdate = <span class="literal">false</span>; &#125;, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åœºæ™¯ B: æ–°çª—å£åˆšæ‰“å¼€ï¼Œè¯·æ±‚åˆå§‹åŒ–æ•°æ® (æˆ‘æ˜¯è€çª—å£ï¼Œæˆ‘æœ‰æ•°æ®)</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;REQUEST_INIT&#x27;</span>:</span><br><span class="line">        <span class="comment">// ä¸ºäº†é¿å…å¤šä¸ªè€çª—å£åŒæ—¶å›å¤ï¼Œè¿™é‡Œå¯ä»¥åšä¸€ä¸ªç®€å•çš„éšæœºå»¶è¿Ÿï¼Œæˆ–è€…ç”±äºæ˜¯æ›¿æ¢æ“ä½œï¼Œå¤šæ¬¡å›å¤ä¹Ÿæ— æ‰€è°“</span></span><br><span class="line">        <span class="comment">// ç›´æ¥å‘é€å½“å‰çŠ¶æ€ç»™æ–°çª—å£</span></span><br><span class="line">        channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;RESPONSE_INIT&#x27;</span>,</span><br><span class="line">          <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">          <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(store.<span class="property">$state</span>)),</span><br><span class="line">          <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åœºæ™¯ C: æˆ‘æ˜¯æ–°çª—å£ï¼Œæ”¶åˆ°äº†åˆå§‹åŒ–æ•°æ®</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;RESPONSE_INIT&#x27;</span>:</span><br><span class="line">        isExternalUpdate = <span class="literal">true</span>;</span><br><span class="line">        store.$patch(data);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; isExternalUpdate = <span class="literal">false</span>; &#125;, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ ¸å¿ƒé€»è¾‘ï¼šç›‘å¬å½“å‰ Store å˜åŒ–å¹¶å¹¿æ’­</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  store.$subscribe(<span class="function">(<span class="params">mutation, state</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯ç”±å¤–éƒ¨æ¶ˆæ¯è§¦å‘çš„æ›´æ–°ï¼Œåˆ™ä¸å¹¿æ’­ï¼Œæ–­ç»æ­»å¾ªç¯</span></span><br><span class="line">    <span class="keyword">if</span> (isExternalUpdate) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ– State (å»é™¤ Vue çš„å“åº”å¼ä»£ç†ï¼Œè½¬ä¸ºçº¯ JSON)</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šå¦‚æœæœ‰ Date/Map/Set éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œè¿™é‡Œå‡è®¾æ˜¯åŸºç¡€ JSON</span></span><br><span class="line">    <span class="keyword">const</span> rawState = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(state));</span><br><span class="line"></span><br><span class="line">    channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;UPDATE&#x27;</span>,</span><br><span class="line">      <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">      <span class="attr">data</span>: rawState,</span><br><span class="line">      <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–é€»è¾‘ï¼š</span></span><br><span class="line"><span class="comment">   * æ’ä»¶åŠ è½½ï¼ˆStore åˆ›å»ºï¼‰æ—¶ï¼Œå¦‚æœæ˜¯æ–°çª—å£ï¼Œå¯èƒ½æ•°æ®æ˜¯ç©ºçš„ã€‚</span></span><br><span class="line"><span class="comment">   * å‘é€ä¸€ä¸ª &quot;REQUEST_INIT&quot; å¹¿æ’­ï¼Œé—®é—®æœ‰æ²¡æœ‰å…¶ä»–çª—å£å­˜æ´»ç€å¹¶æœ‰æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// å»¶æ—¶æçŸ­çš„æ—¶é—´ï¼Œç¡®ä¿ BroadcastChannel å·²ç»å‡†å¤‡å¥½ï¼Œä¸”ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    channel.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;REQUEST_INIT&#x27;</span>,</span><br><span class="line">      <span class="attr">storeId</span>: store.<span class="property">$id</span>,</span><br><span class="line">      <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, <span class="number">50</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç»„ä»¶é”€æ¯æ—¶å…³é—­é¢‘é“ (å¯é€‰ï¼ŒPinia Store é€šå¸¸ç”Ÿå‘½å‘¨æœŸä¼´éšæ•´ä¸ªåº”ç”¨ï¼Œä¸å…³ä¹Ÿæ²¡äº‹)</span></span><br><span class="line">  <span class="comment">// return () =&gt; &#123; channel.close(); &#125; </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-åœ¨-Pinia-ä¸­æ³¨å†Œæ’ä»¶"><a href="#2-åœ¨-Pinia-ä¸­æ³¨å†Œæ’ä»¶" class="headerlink" title="2. åœ¨ Pinia ä¸­æ³¨å†Œæ’ä»¶"></a>2. åœ¨ Pinia ä¸­æ³¨å†Œæ’ä»¶</h3><p>ä¿®æ”¹ä½ çš„ <code>src/store/index.ts</code> (æˆ–è€…ä½ åˆ›å»º pinia çš„åœ°æ–¹)ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; piniaPluginElectronShare &#125; <span class="keyword">from</span> <span class="string">&#x27;../plugins/pinia-plugin-electron-share&#x27;</span>; <span class="comment">// å¼•å…¥ä¸Šé¢å†™çš„æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œæ’ä»¶</span></span><br><span class="line">pinia.<span class="title function_">use</span>(piniaPluginElectronShare);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pinia;</span><br></pre></td></tr></table></figure><hr><h3 id="3-å¦‚ä½•åœ¨-Store-ä¸­ä½¿ç”¨"><a href="#3-å¦‚ä½•åœ¨-Store-ä¸­ä½¿ç”¨" class="headerlink" title="3. å¦‚ä½•åœ¨ Store ä¸­ä½¿ç”¨"></a>3. å¦‚ä½•åœ¨ Store ä¸­ä½¿ç”¨</h3><p>è¿™æ­¥æœ€å…³é”®ã€‚ä½ éœ€è¦åœ¨é‚£äº›â€œéœ€è¦åœ¨ Dockview çª—å£é—´åŒæ­¥â€çš„ Store é‡Œï¼ŒåŠ ä¸Š <code>share: true</code>ã€‚</p><p>ä¾‹å¦‚ <code>src/store/modules/user.ts</code>ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">userInfo</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Guest&#x27;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å‡è®¾è¿™æ˜¯ Dockview çš„å¸ƒå±€é…ç½®ï¼Œä¹Ÿéœ€è¦åŒæ­¥</span></span><br><span class="line">    <span class="attr">layoutConfig</span>: &#123;&#125; </span><br><span class="line">  &#125;),</span><br><span class="line">  </span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">updateName</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">userInfo</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¼€å¯å¤šçª—å£åŒæ­¥</span></span><br><span class="line">  <span class="attr">share</span>: <span class="literal">true</span> </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ Setup Store å†™æ³•ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123; count.<span class="property">value</span>++ &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; count, increment &#125;;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="comment">// Setup Store çš„é…ç½®é¡¹åœ¨è¿™é‡Œ</span></span><br><span class="line">  <span class="attr">share</span>: <span class="literal">true</span> </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><h3 id="4-éªŒè¯ä¸è°ƒè¯•æ–¹æ³•"><a href="#4-éªŒè¯ä¸è°ƒè¯•æ–¹æ³•" class="headerlink" title="4. éªŒè¯ä¸è°ƒè¯•æ–¹æ³•"></a>4. éªŒè¯ä¸è°ƒè¯•æ–¹æ³•</h3><p>æˆ‘å»ºè®®ä½ æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤éªŒè¯æ–¹æ¡ˆæ˜¯å¦ç”Ÿæ•ˆï¼š</p><ol><li><strong>å¯åŠ¨åº”ç”¨</strong>ï¼šæ‰“å¼€ä¸»çª—å£ã€‚</li><li><strong>ä¿®æ”¹æ•°æ®</strong>ï¼šåœ¨ä¸»çª—å£ä¿®æ”¹ <code>useUserStore</code> ä¸­çš„æ•°æ®ï¼ˆæ¯”å¦‚ç™»å½•ï¼Œæˆ–è€…æ”¹ä¸ªåå­—ï¼‰ã€‚</li><li><strong>å¼¹å‡ºçª—å£ (Dockview)</strong>ï¼šæ‹–æ‹½ Tab å½¢æˆä¸€ä¸ªæ–°çš„å¼¹å‡ºçª—å£ã€‚<ul><li><strong>é¢„æœŸ</strong>ï¼šå¼¹å‡ºçª—å£åº”è¯¥ç«‹å³æ˜¾ç¤ºåˆšæ‰ä¿®æ”¹è¿‡çš„æ•°æ®ï¼ˆè¿™æ˜¯ <code>REQUEST_INIT</code> é€»è¾‘åœ¨èµ·ä½œç”¨ï¼‰ã€‚</li></ul></li><li><strong>åŒå‘åŒæ­¥æµ‹è¯•</strong>ï¼š<ul><li>åœ¨<strong>å¼¹å‡ºçª—å£</strong>é‡Œä¿®æ”¹æ•°æ®ã€‚</li><li>è§‚å¯Ÿ<strong>ä¸»çª—å£</strong>ï¼ˆä»¥åŠå…¶ä»–å¼¹å‡ºçª—å£ï¼‰çš„æ•°æ®æ˜¯å¦è·Ÿç€å˜äº†ã€‚</li><li><strong>é¢„æœŸ</strong>ï¼šåº”è¯¥æ¯«ç§’çº§åŒæ­¥ã€‚</li></ul></li></ol><h3 id="5-æ³¨æ„äº‹é¡¹-Senior-Tips"><a href="#5-æ³¨æ„äº‹é¡¹-Senior-Tips" class="headerlink" title="5. æ³¨æ„äº‹é¡¹ (Senior Tips)"></a>5. æ³¨æ„äº‹é¡¹ (Senior Tips)</h3><ol><li><strong>åŒæºç­–ç•¥</strong>ï¼š<br><code>BroadcastChannel</code> ä¾èµ–æµè§ˆå™¨çš„åŒæºç­–ç•¥ã€‚ç¡®ä¿ä½ çš„ <code>electron-vite</code> åœ¨å¼€å‘æ¨¡å¼ä¸‹æ‰€æœ‰çª—å£éƒ½æ˜¯ <code>http://localhost:xxxx</code>ï¼Œæˆ–è€…åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹åŠ è½½çš„éƒ½æ˜¯ <code>file://</code> æˆ–è€…è‡ªå®šä¹‰åè®® <code>app://</code>ã€‚åªè¦å®ƒä»¬å±äºåŒä¸€ä¸ª Originï¼Œè¿™ä¸ªæ–¹æ¡ˆå°± 100% æœ‰æ•ˆã€‚</li><li><strong>æ€§èƒ½</strong>ï¼š<br>è™½ç„¶ <code>BroadcastChannel</code> å¾ˆå¿«ï¼Œä½†ä¸è¦ç”¨å®ƒä¼ è¾“éå¸¸å¤§çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ Base64ã€è¶…é•¿æ–‡æœ¬ï¼‰ã€‚å¦‚æœ State ç‰¹åˆ«å¤§ï¼Œå»ºè®®å°†å¤§æ•°æ®æ”¾åœ¨ IndexedDBï¼ŒStore é‡Œåªå­˜ IDã€‚</li><li><strong>éåºåˆ—åŒ–æ•°æ®</strong>ï¼š<br><code>JSON.stringify</code> ä¼šä¸¢å¤± <code>Function</code>ã€<code>Map</code>ã€<code>Set</code> ç­‰ç±»å‹ã€‚è¯·ç¡®ä¿ä½ çš„ Pinia State æ˜¯çº¯æ•°æ®å¯¹è±¡ï¼ˆPlain Objectï¼‰ã€‚è¿™æ˜¯ Vue å’Œ Pinia çš„æœ€ä½³å®è·µï¼Œä¹Ÿæ˜¯å¤šè¿›ç¨‹é€šä¿¡çš„é™åˆ¶ã€‚</li></ol><p>è¿™å¥—ä»£ç è™½ç„¶çœ‹èµ·æ¥ç®€å•ï¼Œä½†å¤„ç†äº†å¤šè¿›ç¨‹æ¶æ„ä¸­æœ€æ£˜æ‰‹çš„â€œç«äº‰â€å’Œâ€œåˆå§‹åŒ–â€é—®é¢˜ï¼Œå®Œå…¨å¯ä»¥ç›´æ¥åˆå…¥é¡¹ç›®ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;é—®é¢˜&quot;&gt;&lt;a href=&quot;#é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜&quot;&gt;&lt;/a&gt;é—®é¢˜&lt;/h2&gt;&lt;p&gt;å¦‚ä½•å¼€å‘ä¸€ä¸ªelectronå¤šçª—å£çŠ¶æ€åŒæ­¥çš„æ’ä»¶ï¼Œè®©Dockviewå¼¹å‡ºçª—ä¹‹é—´çš„æ•°æ®åŒæ­¥ï¼Ÿ&lt;/p&gt;</summary>
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>electron å¼€å‘è€…çš„è‡ªæˆ‘ä»‹ç»</title>
    <link href="http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/%E5%A6%82%E4%BD%95%E6%8F%8F%E8%BF%B0%E8%87%AA%E5%B7%B1%E5%81%9A%E7%9A%84%E4%BA%8B%E6%83%85/"/>
    <id>http://blog.ypintao.com/2025/12/13/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/%E5%A6%82%E4%BD%95%E6%8F%8F%E8%BF%B0%E8%87%AA%E5%B7%B1%E5%81%9A%E7%9A%84%E4%BA%8B%E6%83%85/</id>
    <published>2025-12-13T03:47:13.697Z</published>
    <updated>2025-12-13T03:56:15.612Z</updated>
    
    <content type="html"><![CDATA[<p>ä½œä¸ºä¸€ååœ¨å‰ç«¯å’Œæ¡Œé¢ç«¯åº”ç”¨å¼€å‘é¢†åŸŸæ·±è€• 10 å¹´çš„é«˜çº§æ¶æ„å¸ˆï¼Œæˆ‘ä¸ä»…ç†Ÿæ‚‰ Electron çš„åº•å±‚åŸç†ï¼ˆChromium + Node.js + Native APIsï¼‰ï¼Œä¹Ÿæ·±è°™ç°ä»£å‰ç«¯æ¡†æ¶ï¼ˆVue3&#x2F;Reactï¼‰ä¸åç«¯æœåŠ¡ï¼ˆNest.js&#x2F;Next.jsï¼‰çš„ç»“åˆä¹‹é“ã€‚<br>&lt;â€“moreâ€“&gt;<br>åœ¨ Electron å¼€å‘ä¸­ï¼Œæˆ‘é€šå¸¸ä¼šä»ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»´åº¦ä¸ºæ‚¨æ„å»ºç³»ç»Ÿæ€§çš„è§£å†³æ–¹æ¡ˆï¼š<br>æ¶æ„è®¾è®¡ (Architecture)ï¼š<br>è¿›ç¨‹æ¨¡å‹ï¼šä¸»è¿›ç¨‹ (Main)ã€æ¸²æŸ“è¿›ç¨‹ (Renderer) ä¸ GPU è¿›ç¨‹çš„èŒè´£åˆ’åˆ†ã€‚<br>é€šä¿¡æœºåˆ¶ï¼šå¦‚ä½•è®¾è®¡é«˜æ•ˆã€ç±»å‹å®‰å…¨ï¼ˆType-safeï¼‰çš„ IPCï¼ˆInter-Process Communicationï¼‰é€šä¿¡ç­–ç•¥ï¼ˆä¾‹å¦‚ä½¿ç”¨ ipcRenderer.invoke + handle æ¨¡å¼ï¼‰ã€‚<br>å®‰å…¨æ€§ (Security)ï¼šä¸Šä¸‹æ–‡éš”ç¦» (Context Isolation)ã€æ²™ç®±æ¨¡å¼ (Sandbox)ã€ä»¥åŠå¦‚ä½•å®‰å…¨åœ°æš´éœ² Node.js èƒ½åŠ›ï¼ˆPreload Scriptsï¼‰ã€‚<br>æŠ€æœ¯æ ˆæ•´åˆ (Integration)ï¼š<br>Vue3&#x2F;Reactï¼šå¦‚ä½•å¤„ç†è·¯ç”±ï¼ˆHash vs History modeï¼‰ã€çŠ¶æ€ç®¡ç†ï¼ˆPinia&#x2F;Redux&#x2F;Zustandï¼‰åœ¨å¤šçª—å£é—´çš„æ•°æ®åŒæ­¥ã€‚<br>åç«¯äº¤äº’ï¼šå¦‚ä½•ä¸ Nest.js ç­‰åç«¯å¾®æœåŠ¡è¿›è¡Œé‰´æƒã€Socket è¿æ¥æˆ–æœ¬åœ° Node.js æœåŠ¡çš„é›†æˆã€‚<br>æ€§èƒ½ä¼˜åŒ– (Performance)ï¼š<br>å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–ï¼ˆVite&#x2F;Webpack æ„å»ºè°ƒä¼˜ï¼‰ã€‚<br>å†…å­˜æ³„æ¼æ’æŸ¥ä¸é•¿åˆ—è¡¨æ¸²æŸ“ã€‚<br>å®‰è£…åŒ…ä½“ç§¯ç˜¦èº«ï¼ˆAsaræ‰“åŒ…ã€ä¾èµ–å‰”é™¤ï¼‰ã€‚<br>åŸç”Ÿèƒ½åŠ›ä¸å·¥ç¨‹åŒ– (Native &amp; DevOps)ï¼š<br>æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€ç³»ç»Ÿæ‰˜ç›˜ã€åŸç”Ÿèœå•ã€å¿«æ·é”®ã€‚<br>C++&#x2F;Rust Addons è°ƒç”¨ï¼ˆNode-APIï¼‰ã€‚<br>è‡ªåŠ¨æ›´æ–° (Auto-updater) ç­–ç•¥ã€‚<br>CI&#x2F;CD æµç¨‹åŠå¤šå¹³å°ï¼ˆWin&#x2F;Mac&#x2F;Linuxï¼‰ç­¾åä¸æ„å»ºã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä½œä¸ºä¸€ååœ¨å‰ç«¯å’Œæ¡Œé¢ç«¯åº”ç”¨å¼€å‘é¢†åŸŸæ·±è€• 10 å¹´çš„é«˜çº§æ¶æ„å¸ˆï¼Œæˆ‘ä¸ä»…ç†Ÿæ‚‰ Electron çš„åº•å±‚åŸç†ï¼ˆChromium + Node.js + Native APIsï¼‰ï¼Œä¹Ÿæ·±è°™ç°ä»£å‰ç«¯æ¡†æ¶ï¼ˆVue3&amp;#x2F;Reactï¼‰ä¸åç«¯æœåŠ¡ï¼ˆNest.js&amp;#x2F;Next.j</summary>
      
    
    
    
    <category term="cocos" scheme="http://blog.ypintao.com/categories/cocos/"/>
    
    
    <category term="cocos" scheme="http://blog.ypintao.com/tags/cocos/"/>
    
  </entry>
  
  <entry>
    <title>electron-viteç›¸å…³</title>
    <link href="http://blog.ypintao.com/2025/12/07/%E5%89%8D%E7%AB%AF/electron/electron-vite%E7%9B%B8%E5%85%B3/"/>
    <id>http://blog.ypintao.com/2025/12/07/%E5%89%8D%E7%AB%AF/electron/electron-vite%E7%9B%B8%E5%85%B3/</id>
    <published>2025-12-07T14:46:54.676Z</published>
    <updated>2025-12-13T03:53:23.050Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»"><a href="#1-electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»" class="headerlink" title="1. electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»"></a>1. electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»</h2><p><a href="https://github.com/alex8088/electron-vite">https://github.com/alex8088/electron-vite</a><br><a href="https://cn.electron-vite.org/">https://cn.electron-vite.org/</a></p><span id="more"></span><h2 id="2-electron-viteå¦‚ä½•é›†æˆ-Dockview"><a href="#2-electron-viteå¦‚ä½•é›†æˆ-Dockview" class="headerlink" title="2. electron-viteå¦‚ä½•é›†æˆ Dockview"></a>2. electron-viteå¦‚ä½•é›†æˆ Dockview</h2><p><a href="https://dockview.dev/templates/">https://dockview.dev/templates/</a><br>å®Œæ•´ Dockview æµ®åŠ¨çª—å£ç¤ºä¾‹ (Electron-Vite)</p><ol><li>âš™ï¸ ä¸»è¿›ç¨‹ (Main Process) è®¾ç½®<br>åœ¨ä½ çš„ Electron ä¸»è¿›ç¨‹æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ src&#x2F;main&#x2F;index.ts æˆ– src&#x2F;main&#x2F;main.tsï¼‰ä¸­ï¼Œä½ éœ€è¦æ·»åŠ ä»£ç æ¥ç›‘å¬æ¸²æŸ“è¿›ç¨‹å‘å‡ºçš„åˆ›å»ºæ–°çª—å£çš„è¯·æ±‚ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">TypeScript</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/main/index.ts (æˆ–ç±»ä¼¼çš„ä¸»è¿›ç¨‹æ–‡ä»¶)</span></span><br><span class="line"><span class="keyword">import</span> &#123; app, <span class="title class_">BrowserWindow</span>, ipcMain &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; join &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... (çœç•¥äº† createWindow ç­‰åˆå§‹åŒ–ä»£ç )</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> externalWindows = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">BrowserWindow</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬æ¸²æŸ“è¿›ç¨‹è¯·æ±‚åˆ›å»ºæµ®åŠ¨é¢æ¿çª—å£</span></span><br><span class="line">ipcMain.<span class="title function_">on</span>(<span class="string">&#x27;create-external-panel-window&#x27;</span>, <span class="function">(<span class="params">_, <span class="attr">data</span>: &#123; groupId: <span class="built_in">string</span>, initialBounds: <span class="built_in">any</span>, url: <span class="built_in">string</span> &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; groupId, initialBounds, url &#125; = data;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (externalWindows.<span class="title function_">has</span>(groupId)) &#123;</span><br><span class="line">    externalWindows.<span class="title function_">get</span>(groupId)?.<span class="title function_">focus</span>();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Electron æµè§ˆå™¨çª—å£</span></span><br><span class="line">  <span class="keyword">const</span> externalWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">x</span>: initialBounds.<span class="property">x</span>,</span><br><span class="line">    <span class="attr">y</span>: initialBounds.<span class="property">y</span>,</span><br><span class="line">    <span class="attr">width</span>: initialBounds.<span class="property">width</span>,</span><br><span class="line">    <span class="attr">height</span>: initialBounds.<span class="property">height</span>,</span><br><span class="line">    <span class="attr">show</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">      <span class="attr">preload</span>: <span class="title function_">join</span>(__dirname, <span class="string">&#x27;../preload/index.js&#x27;</span>),</span><br><span class="line">      <span class="comment">// æ³¨æ„ï¼šè¿™é‡Œéœ€è¦å¯ç”¨ sandboxï¼Œç„¶åé€šè¿‡ preload æš´éœ²å®‰å…¨ API</span></span><br><span class="line">      <span class="attr">sandbox</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">contextIsolation</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  externalWindow.<span class="title function_">on</span>(<span class="string">&#x27;closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    externalWindows.<span class="title function_">delete</span>(groupId);</span><br><span class="line">    <span class="comment">// é€šçŸ¥ä¸»çª—å£é¢æ¿å·²å…³é—­</span></span><br><span class="line">    <span class="title class_">BrowserWindow</span>.<span class="title function_">getAllWindows</span>().<span class="title function_">forEach</span>(<span class="function"><span class="params">win</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (win !== externalWindow) &#123;</span><br><span class="line">            win.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&#x27;external-panel-closed&#x27;</span>, groupId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŠ è½½ Dockview å¤–éƒ¨çª—å£çš„ç‰¹å®š URL</span></span><br><span class="line">  <span class="comment">// æˆ‘ä»¬å°†ä½¿ç”¨ä¸»çª—å£çš„ URLï¼Œä½†å¸¦ä¸ŠæŸ¥è¯¢å‚æ•°æ¥æŒ‡ç¤ºå®ƒæ˜¯å¤–éƒ¨çª—å£</span></span><br><span class="line">  externalWindow.<span class="title function_">loadURL</span>(<span class="string">`<span class="subst">$&#123;url&#125;</span>?groupId=<span class="subst">$&#123;groupId&#125;</span>&amp;external=true`</span>);</span><br><span class="line">  </span><br><span class="line">  externalWindow.<span class="title function_">once</span>(<span class="string">&#x27;ready-to-show&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    externalWindow.<span class="title function_">show</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  externalWindows.<span class="title function_">set</span>(groupId, externalWindow);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬å¹¶è½¬å‘æ¥è‡ªä¸»çª—å£çš„æ¶ˆæ¯åˆ°ç‰¹å®šçš„å¤–éƒ¨çª—å£</span></span><br><span class="line">ipcMain.<span class="title function_">on</span>(<span class="string">&#x27;external-panel-message&#x27;</span>, <span class="function">(<span class="params">_, <span class="attr">groupId</span>: <span class="built_in">string</span>, <span class="attr">message</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> win = externalWindows.<span class="title function_">get</span>(groupId);</span><br><span class="line">    <span class="keyword">if</span> (win) &#123;</span><br><span class="line">        win.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&#x27;dockview-message&#x27;</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="2"><li>Preload è„šæœ¬è®¾ç½®<br>ä¸ºäº†åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­å®‰å…¨åœ°ä½¿ç”¨ IPCï¼Œä½ éœ€è¦é€šè¿‡ contextBridge åœ¨ Preload è„šæœ¬ä¸­æš´éœ²å¿…è¦çš„ IPC åŠŸèƒ½ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">TypeScript</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/preload/index.ts (æˆ–ç±»ä¼¼çš„ Preload æ–‡ä»¶)</span></span><br><span class="line"><span class="keyword">import</span> &#123; contextBridge, ipcRenderer &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... (çœç•¥äº†å…¶ä»– IPC æš´éœ²)</span></span><br><span class="line"></span><br><span class="line">contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&#x27;electron&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">ipcRenderer</span>: &#123;</span><br><span class="line">    <span class="comment">// Dockview å¤–éƒ¨åŒ–åŠŸèƒ½æ‰€éœ€çš„ IPC</span></span><br><span class="line">    <span class="attr">send</span>: <span class="function">(<span class="params"><span class="attr">channel</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> validChannels = [</span><br><span class="line">          <span class="string">&#x27;create-external-panel-window&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;external-panel-message&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;dispose-external-panel-window&#x27;</span></span><br><span class="line">      ];</span><br><span class="line">      <span class="keyword">if</span> (validChannels.<span class="title function_">includes</span>(channel)) &#123;</span><br><span class="line">        ipcRenderer.<span class="title function_">send</span>(channel, ...args);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">on</span>: <span class="function">(<span class="params"><span class="attr">channel</span>: <span class="built_in">string</span>, <span class="attr">func</span>: (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">void</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> validChannels = [</span><br><span class="line">          <span class="string">&#x27;dockview-message&#x27;</span>, <span class="comment">// æ¥æ”¶æ¥è‡ªä¸»è¿›ç¨‹çš„æ¶ˆæ¯</span></span><br><span class="line">          <span class="string">&#x27;external-panel-closed&#x27;</span></span><br><span class="line">      ];</span><br><span class="line">      <span class="keyword">if</span> (validChannels.<span class="title function_">includes</span>(channel)) &#123;</span><br><span class="line">        <span class="comment">// ... (çœç•¥äº†ç±»å‹æ£€æŸ¥å’Œ IPC ç›‘å¬çš„å®ç°ç»†èŠ‚)</span></span><br><span class="line">        ipcRenderer.<span class="title function_">on</span>(channel, <span class="function">(<span class="params">_event, ...args</span>) =&gt;</span> <span class="title function_">func</span>(...args));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ... å…¶ä»–å¿…è¦çš„ IPC æ–¹æ³•</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="3"><li>ğŸ–¼ï¸ æ¸²æŸ“è¿›ç¨‹ (Renderer Process) - Dockview ç»„ä»¶ä¿®æ”¹<br>ä½ éœ€è¦ä¿®æ”¹ DockviewContainer.vueï¼Œå®ç° createExternalWindow é’©å­ã€‚</li></ol><p>ä»£ç æ®µ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;containerRef&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; &#x27;dockview-external-host&#x27;: isExternal &#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 100vh; width: 100vw;&quot;</span>/&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">import &#123; ref, onMounted, shallowRef &#125; from &#x27;vue&#x27;;</span></span><br><span class="line"><span class="language-xml">import &#123; createApp, type App &#125; from &#x27;vue&#x27;;</span></span><br><span class="line"><span class="language-xml">import &#123; DockviewComponent, IDockviewPanel, DockviewExternalWindow &#125; from &#x27;dockview&#x27;;</span></span><br><span class="line"><span class="language-xml">import PanelContent from &#x27;./PanelContent.vue&#x27;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// --- æ£€æŸ¥æ˜¯å¦ä¸ºå¤–éƒ¨çª—å£ ---</span></span><br><span class="line"><span class="language-xml">// ç®€å•æ–¹æ³•ï¼šæ£€æŸ¥ URL æ˜¯å¦æœ‰ `?external=true` æŸ¥è¯¢å‚æ•°</span></span><br><span class="line"><span class="language-xml">const isExternal = window.location.search.includes(&#x27;external=true&#x27;);</span></span><br><span class="line"><span class="language-xml">const urlParams = new URLSearchParams(window.location.search);</span></span><br><span class="line"><span class="language-xml">const groupId = urlParams.get(&#x27;groupId&#x27;) || &#x27;&#x27;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// ... (çœç•¥ PanelContent æŒ‚è½½å’Œ vueApps Map çš„ä»£ç ï¼Œè§ä¸Šä¸€ä¸ªå›ç­”)</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// --- Dockview å¤–éƒ¨åŒ–é…ç½® ---</span></span><br><span class="line"><span class="language-xml">const createExternalWindow = (event: &#123;</span></span><br><span class="line"><span class="language-xml">    groupId: string;</span></span><br><span class="line"><span class="language-xml">    bounds: &#123; x: number; y: number; width: number; height: number &#125;;</span></span><br><span class="line"><span class="language-xml">&#125;): DockviewExternalWindow =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    // 1. é€šçŸ¥ä¸»è¿›ç¨‹åˆ›å»ºæ–°çª—å£</span></span><br><span class="line"><span class="language-xml">    window.electron.ipcRenderer.send(&#x27;create-external-panel-window&#x27;, &#123;</span></span><br><span class="line"><span class="language-xml">        groupId: event.groupId,</span></span><br><span class="line"><span class="language-xml">        initialBounds: event.bounds,</span></span><br><span class="line"><span class="language-xml">        // ä¼ é€’å½“å‰ URLï¼Œè®©æ–°çª—å£çŸ¥é“åŠ è½½ä»€ä¹ˆ</span></span><br><span class="line"><span class="language-xml">        url: window.location.href.split(&#x27;?&#x27;)[0] </span></span><br><span class="line"><span class="language-xml">    &#125;);</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    // 2. è¿”å› Dockview éœ€è¦çš„ PostMessage æ¥å£</span></span><br><span class="line"><span class="language-xml">    return &#123;</span></span><br><span class="line"><span class="language-xml">        // ç”¨äºå‘æ–°çª—å£å‘é€æ•°æ® (ç”± Dockview å†…éƒ¨è°ƒç”¨)</span></span><br><span class="line"><span class="language-xml">        postMessage: (message) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">            window.electron.ipcRenderer.send(&#x27;external-panel-message&#x27;, event.groupId, message);</span></span><br><span class="line"><span class="language-xml">        &#125;,</span></span><br><span class="line"><span class="language-xml">        // å½“æµ®åŠ¨é¢æ¿å…³é—­æˆ–è¢«é‡æ–°æ‹–å›ä¸»çª—å£æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="language-xml">        dispose: () =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">            window.electron.ipcRenderer.send(&#x27;dispose-external-panel-window&#x27;, event.groupId);</span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">    &#125;;</span></span><br><span class="line"><span class="language-xml">&#125;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// --- Dockview å®ä¾‹åŒ– ---</span></span><br><span class="line"><span class="language-xml">onMounted(() =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">  if (!containerRef.value) return;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  const dockview = new DockviewComponent(&#123;</span></span><br><span class="line"><span class="language-xml">    parentElement: containerRef.value,</span></span><br><span class="line"><span class="language-xml">    createComponent: createVueComponent,</span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    // å¯ç”¨å¤–éƒ¨æ‹–æ‹½</span></span><br><span class="line"><span class="language-xml">    allowExternalDrag: true, </span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    // å®ç°åˆ›å»ºå¤–éƒ¨çª—å£çš„é’©å­</span></span><br><span class="line"><span class="language-xml">    createExternalWindow: createExternalWindow, </span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    // å¦‚æœæ˜¯å¤–éƒ¨çª—å£ï¼Œéœ€è¦ä¼ å…¥ groupdId æ¥æ¢å¤å¸ƒå±€</span></span><br><span class="line"><span class="language-xml">    is\&#x27;external\&#x27; = isExternal,</span></span><br><span class="line"><span class="language-xml">    externalGroupId: groupId || undefined</span></span><br><span class="line"><span class="language-xml">  &#125;);</span></span><br><span class="line"><span class="language-xml">  dockviewRef.value = dockview;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  // --- å¤–éƒ¨çª—å£çš„ç‰¹æ®Šå¤„ç† ---</span></span><br><span class="line"><span class="language-xml">  if (isExternal) &#123;</span></span><br><span class="line"><span class="language-xml">    // 1. ç›‘å¬æ¥è‡ªä¸»çª—å£çš„æ¶ˆæ¯ï¼Œå¹¶è½¬å‘ç»™ Dockview å®ä¾‹</span></span><br><span class="line"><span class="language-xml">    window.electron.ipcRenderer.on(&#x27;dockview-message&#x27;, (message) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        dockview.processExternalWindowMessage(message);</span></span><br><span class="line"><span class="language-xml">    &#125;);</span></span><br><span class="line"><span class="language-xml">  &#125; else &#123;</span></span><br><span class="line"><span class="language-xml">    // 2. ä¸»çª—å£åˆå§‹åŒ–å¸ƒå±€</span></span><br><span class="line"><span class="language-xml">    dockview.addPanel(&#123; id: &#x27;panel-1&#x27;, component: &#x27;vue-panel&#x27;, title: &#x27;ä¸»çª—å£é¢æ¿ 1&#x27; &#125;);</span></span><br><span class="line"><span class="language-xml">    dockview.addPanel(&#123; id: &#x27;panel-2&#x27;, component: &#x27;vue-panel&#x27;, title: &#x27;ä¸»çª—å£é¢æ¿ 2&#x27; &#125;);</span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    // 3. ç›‘å¬å¤–éƒ¨çª—å£å…³é—­äº‹ä»¶</span></span><br><span class="line"><span class="language-xml">    window.electron.ipcRenderer.on(&#x27;external-panel-closed&#x27;, (closedGroupId) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        // é€šçŸ¥ Dockview å¤–éƒ¨ç»„å·²å…³é—­ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ¸…ç†å†…éƒ¨çŠ¶æ€</span></span><br><span class="line"><span class="language-xml">        dockview.removeExternalComponent(closedGroupId);</span></span><br><span class="line"><span class="language-xml">    &#125;);</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  // ... (çœç•¥ resize ç›‘å¬ä»£ç )</span></span><br><span class="line"><span class="language-xml">&#125;);</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="comment">/* å¯é€‰ï¼šä¸ºå¤–éƒ¨çª—å£æä¾›ä¸€ä¸ªä¸åŒçš„èƒŒæ™¯æˆ–è¾¹æ¡† */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.dockview-external-host</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="comment">/* å¤–éƒ¨çª—å£é€šå¸¸ä¸éœ€è¦è¾¹æ¡† */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ğŸ”‘ æ€»ç»“å’Œæ“ä½œæ­¥éª¤<br>è®¾ç½® IPC (Preload &amp; Main): åœ¨ä¸»è¿›ç¨‹ä¸­é…ç½® ipcMain æ¥åˆ›å»º BrowserWindowï¼Œå¹¶åœ¨ Preload ä¸­é€šè¿‡ contextBridge å®‰å…¨æš´éœ² ipcRenderer çš„ send å’Œ on æ–¹æ³•ã€‚</p><p>å®ç° createExternalWindow: åœ¨ DockviewContainer.vue ä¸­ï¼Œå®ç° createExternalWindow é’©å­ï¼Œå®ƒå‘ä¸»è¿›ç¨‹å‘é€åˆ›å»ºæ–°çª—å£çš„è¯·æ±‚ï¼Œå¹¶è¿”å› Dockview æ‰€éœ€çš„ postMessage æ¥å£ã€‚</p><p>å¤„ç†å¤–éƒ¨çª—å£åˆå§‹åŒ–:</p><p>æ£€æŸ¥ URL ä¸­çš„æŸ¥è¯¢å‚æ•° (?external&#x3D;true) æ¥åˆ¤æ–­å½“å‰çª—å£æ˜¯ä¸»çª—å£è¿˜æ˜¯æµ®åŠ¨é¢æ¿çª—å£ã€‚</p><p>å¦‚æœæ˜¯æµ®åŠ¨é¢æ¿çª—å£ï¼Œåœ¨å®ä¾‹åŒ– DockviewComponent æ—¶ä¼ å…¥ isExternal: true å’Œ externalGroupIdï¼Œå¹¶ç›‘å¬ä¸»çª—å£å‘æ¥çš„ dockview-messageã€‚</p><p>æ“ä½œæ­¥éª¤ï¼š</p><p>è¿è¡Œä½ çš„ Electron-Vite åº”ç”¨ã€‚</p><p>ç‚¹å‡»ä¸€ä¸ªé¢æ¿çš„æ ‡é¢˜æ ã€‚</p><p>å°†æ ‡é¢˜æ æ‹–å‡ºä¸»çª—å£çš„è¾¹ç•Œã€‚</p><p>é‡Šæ”¾é¼ æ ‡ï¼Œä¸€ä¸ªæ–°çš„ã€ç‹¬ç«‹çš„ Electron çª—å£å°±ä¼šå¼¹å‡ºï¼Œå…¶ä¸­åŒ…å«ä½ æ‹–å‡ºçš„é¢æ¿</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»&quot;&gt;&lt;a href=&quot;#1-electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»&quot; class=&quot;headerlink&quot; title=&quot;1. electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»&quot;&gt;&lt;/a&gt;1. electron-viteç›¸å…³çš„é—®é¢˜æ±‡æ€»&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/alex8088/electron-vite&quot;&gt;https://github.com/alex8088/electron-vite&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://cn.electron-vite.org/&quot;&gt;https://cn.electron-vite.org/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="electron" scheme="http://blog.ypintao.com/categories/electron/"/>
    
    
    <category term="electron" scheme="http://blog.ypintao.com/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>viteæ³¨æ„äº‹é¡¹</title>
    <link href="http://blog.ypintao.com/2025/12/07/tools/vite%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E6%A0%B7%E5%BC%8F%E5%86%B2%E7%AA%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>http://blog.ypintao.com/2025/12/07/tools/vite%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E6%A0%B7%E5%BC%8F%E5%86%B2%E7%AA%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</id>
    <published>2025-12-07T04:00:00.000Z</published>
    <updated>2025-12-07T14:46:02.479Z</updated>
    
    <content type="html"><![CDATA[<h1 id="viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ"><a href="#viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ" class="headerlink" title="viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ"></a>viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ</h1><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨ä½¿ç”¨viteå¼€å‘vueé¡¹ç›®æ—¶ï¼Œ<br>åŒæ—¶ä½¿ç”¨äº† elementui-pluså’Œ element-plus-x,<br>ç„¶å åœ¨å¼€å‘ç¯å¢ƒ é‡Œé¢æœ‰ä¸€äº› element-plus-x çš„ç‰¹æ®Šæ ·å¼ä¼šæ±¡æŸ“elementui-plusçš„åŸæœ‰æ ·å¼ã€‚</p><span id="more"></span><p>æ¯”å¦‚ ThoughtChain  è¿™ä¸ªæ€ç»´é“¾çš„ç»„ä»¶ ç”¨äº† el-collapse ï¼Œç„¶åä¿®æ”¹äº†ä»–çš„æ ·å¼çš„é«˜åº¦ height<br>elementui-plusçš„åŸæ ·å¼</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.el-collapse-item__header</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="built_in">var</span>(--el-collapse-header-height);</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="built_in">var</span>(--el-collapse-header-height);</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--el-collapse-header-bg-color);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--el-collapse-header-text-color);</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--el-collapse-border-color);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--el-collapse-header-font-size);</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">    <span class="attribute">transition</span>: border-bottom-color <span class="built_in">var</span>(--el-transition-duration);</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å å¤šäº†ä¸€ä¸ªå›ºå®šé«˜åº¦</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#elx_wrapper</span> <span class="selector-class">.el-collapse-item__header</span> &#123;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--el-collapse-header-bg-color);</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--el-collapse-border-color);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--el-collapse-header-text-color);</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--el-collapse-header-font-size);</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="built_in">var</span>(--el-collapse-header-height); //è¿™ä¸€è¡Œ ä¸Šé¢æ˜¯æ²¡æœ‰çš„ã€‚</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="built_in">var</span>(--el-collapse-header-height);</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transition</span>: border-bottom-color <span class="built_in">var</span>(--el-transition-duration);</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢åªæ˜¯ä¸ªæ¯”å–»</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ä¹Ÿæ˜¯è€ƒè™‘äº†å¥½å‡ ç§æ–¹æ¡ˆã€‚ä½†æ˜¯éƒ½æ„Ÿè§‰å¯¹å·²æœ‰é¡¹ç›®çš„æ”¹åŠ¨å¤ªå¤§ã€‚</p><ul><li>æ–¹æ¡ˆä¸€ï¼š<br>ç”¨element-plusçš„ el-config-provider åŒ…è£¹ï¼Œç„¶åä¿®æ”¹namespaceä¸ºepã€‚å…¨å±€ä¿®æ”¹element-plusçš„æ ·å¼æµ…é†‰</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-config-provider namespace=<span class="string">&quot;ep&quot;</span>&gt;</span><br><span class="line">    &lt;!-- ... --&gt;</span><br><span class="line">  &lt;/el-config-provider&gt;</span><br><span class="line"></span><br><span class="line">  å†™ä¸€ä¸ª css styles/element/index.<span class="property">scss</span>ï¼š</span><br><span class="line">  @forward <span class="string">&#x27;element-plus/theme-chalk/src/mixins/config.scss&#x27;</span> <span class="title function_">with</span> (</span><br><span class="line">  <span class="attr">$namespace</span>: <span class="string">&#x27;ep&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">åœ¨ vite.<span class="property">config</span>.<span class="property">ts</span> ä¸­å¯¼å…¥ styles/element/index.<span class="property">scss</span>ï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="attr">preprocessorOptions</span>: &#123;</span><br><span class="line">      <span class="attr">scss</span>: &#123;</span><br><span class="line">        <span class="attr">additionalData</span>: <span class="string">`@use &quot;~/styles/element/index.scss&quot; as *;`</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>æ–¹æ¡ˆäºŒï¼š ä½¿ç”¨posscssæ’ä»¶</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">åœ¨vite.<span class="property">config</span>.<span class="property">ts</span>ä¸­é…ç½®</span><br><span class="line"><span class="keyword">import</span> prefixSelector <span class="keyword">from</span> <span class="string">&#x27;postcss-prefix-selector&#x27;</span></span><br><span class="line"><span class="attr">css</span>: &#123;</span><br><span class="line">      <span class="attr">preprocessorOptions</span>: &#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰å…¨å±€ SCSS å˜é‡</span></span><br><span class="line">        <span class="attr">scss</span>: &#123;</span><br><span class="line">          <span class="attr">additionalData</span>: <span class="string">`@use &quot;@/styles/variables.scss&quot; as *;`</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">postcss</span>: &#123;</span><br><span class="line">      <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">prefixSelector</span>(&#123;</span><br><span class="line">          <span class="comment">// åªæœ‰å½“å¤„ç† element-plus-x çš„æ ·å¼æ–‡ä»¶æ—¶æ‰ç”Ÿæ•ˆ</span></span><br><span class="line">          <span class="comment">// æ³¨æ„ï¼šä½ éœ€è¦ç¡®è®¤è¯¥åº“æ ·å¼æ–‡ä»¶çš„å…·ä½“è·¯å¾„ç‰¹å¾</span></span><br><span class="line">          <span class="attr">includeFiles</span>: [<span class="regexp">/element-plus-x/</span>, <span class="regexp">/node_modules\/element-plus-x/</span>], </span><br><span class="line">          </span><br><span class="line">          <span class="comment">// å¿½ç•¥ html å’Œ body æ ‡ç­¾ï¼Œé¿å…ç ´åå…¨å±€åŸºç¡€æ ·å¼</span></span><br><span class="line">          <span class="attr">exclude</span>: [<span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;:root&#x27;</span>],</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// æ ¸å¿ƒï¼šå°†æ‰€æœ‰æ ·å¼é™åˆ¶åœ¨è¿™ä¸ª ID ä¸‹</span></span><br><span class="line">          <span class="attr">prefix</span>: <span class="string">&#x27;#elx_wrapper&#x27;</span>, </span><br><span class="line">          </span><br><span class="line">          <span class="title function_">transform</span>(<span class="params">prefix: string, selector: string, prefixedSelector: string, filePath: string</span>) &#123;</span><br><span class="line">            <span class="comment">// å¯¹äº :root ä¸‹çš„å˜é‡å®šä¹‰ï¼Œå¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†ä»¥å…ä¸¢å¤±</span></span><br><span class="line">            <span class="keyword">if</span> (selector === <span class="string">&#x27;:root&#x27;</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="string">&#x27;:root #elx_wrapper&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> prefixedSelector</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ&quot;&gt;&lt;a href=&quot;#viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ&quot; class=&quot;headerlink&quot; title=&quot;viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ&quot;&gt;&lt;/a&gt;viteæœ¬åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªè§£å†³æ–¹æ¡ˆ&lt;/h1&gt;&lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;åœ¨ä½¿ç”¨viteå¼€å‘vueé¡¹ç›®æ—¶ï¼Œ&lt;br&gt;åŒæ—¶ä½¿ç”¨äº† elementui-pluså’Œ element-plus-x,&lt;br&gt;ç„¶å åœ¨å¼€å‘ç¯å¢ƒ é‡Œé¢æœ‰ä¸€äº› element-plus-x çš„ç‰¹æ®Šæ ·å¼ä¼šæ±¡æŸ“elementui-plusçš„åŸæœ‰æ ·å¼ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="vite" scheme="http://blog.ypintao.com/categories/vite/"/>
    
    
    <category term="vite" scheme="http://blog.ypintao.com/tags/vite/"/>
    
  </entry>
  
  <entry>
    <title>nuxtç›¸å…³é—®é¢˜</title>
    <link href="http://blog.ypintao.com/2025/12/07/%E5%89%8D%E7%AB%AF/vue/nuxt%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/"/>
    <id>http://blog.ypintao.com/2025/12/07/%E5%89%8D%E7%AB%AF/vue/nuxt%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/</id>
    <published>2025-12-07T04:00:00.000Z</published>
    <updated>2025-12-07T14:52:46.527Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜"><a href="#1-nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜" class="headerlink" title="1. nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜"></a>1. nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜</h2><p>assets&#x2F;: ç”¨äºå­˜å‚¨æœªç¼–è¯‘çš„èµ„æºï¼Œå¦‚å›¾åƒã€å­—ä½“å’Œæ ·å¼è¡¨ã€‚</p><p>components&#x2F;: ç”¨äºå­˜å‚¨ Vue ç»„ä»¶ï¼ŒNuxt ä¼šè‡ªåŠ¨å¯¼å…¥ã€‚</p><p>composables&#x2F;: å­˜æ”¾å¯å¤ç”¨çš„ Composition API å‡½æ•°ï¼ˆç»„åˆå¼å‡½æ•°ï¼‰ã€‚</p><p>layouts&#x2F;: å®šä¹‰åº”ç”¨ç¨‹åºçš„å¸ƒå±€ç»“æ„ï¼ˆå¦‚é¡µçœ‰ã€é¡µè„šï¼‰ã€‚</p><p>pages&#x2F;: æœ€é‡è¦çš„ç›®å½•ï¼Œç”¨äºå®šä¹‰åº”ç”¨ç¨‹åºçš„è·¯ç”±å’Œè§†å›¾ã€‚</p><p>plugins&#x2F;: ç”¨äºåœ¨ Nuxt åº”ç”¨ç¨‹åºå¯åŠ¨å‰è¿è¡Œçš„ JavaScript æ’ä»¶ã€‚</p><p>server&#x2F;: å­˜æ”¾ Nitro å¼•æ“ çš„æœåŠ¡ç«¯è·¯ç”±å’Œ API æ¥å£ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜&quot;&gt;&lt;a href=&quot;#1-nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;1. nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜&quot;&gt;&lt;/a&gt;1. nuxté¡¹ç›®èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜&lt;/h2&gt;&lt;p&gt;assets&amp;#x2F;: ç”¨äº</summary>
      
    
    
    
    <category term="vue3" scheme="http://blog.ypintao.com/categories/vue3/"/>
    
    <category term="nuxt" scheme="http://blog.ypintao.com/categories/vue3/nuxt/"/>
    
    
    <category term="vue3" scheme="http://blog.ypintao.com/tags/vue3/"/>
    
    <category term="nuxt" scheme="http://blog.ypintao.com/tags/nuxt/"/>
    
  </entry>
  
  <entry>
    <title>viteæ³¨æ„äº‹é¡¹</title>
    <link href="http://blog.ypintao.com/2025/03/01/tools/vite/"/>
    <id>http://blog.ypintao.com/2025/03/01/tools/vite/</id>
    <published>2025-03-01T04:00:00.000Z</published>
    <updated>2025-12-07T14:46:05.893Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Vite-æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Vite-æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Vite æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Vite æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Viteçš„å¿«é€Ÿå¼€å‘ä½“éªŒæ˜¯é€šè¿‡ä»¥ä¸‹åŸç†å®ç°çš„ï¼š</p><p>ä½¿ç”¨åŸç”ŸESæ¨¡å—åŒ–ï¼Œæ— éœ€é¢„æ‰“åŒ…ã€‚<br>åˆ©ç”¨æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰å°†æºä»£ç è½¬æ¢ä¸ºæµè§ˆå™¨å¯è¯†åˆ«çš„æ¨¡å—ã€‚<br>åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼ŒæŒ‰éœ€ç¼–è¯‘å’Œæä¾›æ¨¡å—ï¼Œå®ç°å¿«é€Ÿçš„å†·å¯åŠ¨å’Œçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰ã€‚</p><span id="more"></span>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Vite-æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;a href=&quot;#Vite-æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;Vite æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;/a&gt;Vite æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿå¼€å‘çš„ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;&lt;p&gt;Viteçš„å¿«é€Ÿå¼€å‘ä½“éªŒæ˜¯é€šè¿‡ä»¥ä¸‹åŸç†å®ç°çš„ï¼š&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨åŸç”ŸESæ¨¡å—åŒ–ï¼Œæ— éœ€é¢„æ‰“åŒ…ã€‚&lt;br&gt;åˆ©ç”¨æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰å°†æºä»£ç è½¬æ¢ä¸ºæµè§ˆå™¨å¯è¯†åˆ«çš„æ¨¡å—ã€‚&lt;br&gt;åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼ŒæŒ‰éœ€ç¼–è¯‘å’Œæä¾›æ¨¡å—ï¼Œå®ç°å¿«é€Ÿçš„å†·å¯åŠ¨å’Œçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="vite" scheme="http://blog.ypintao.com/categories/vite/"/>
    
    
    <category term="vite" scheme="http://blog.ypintao.com/tags/vite/"/>
    
  </entry>
  
  <entry>
    <title>webpackæ‰“åŒ…å·¥å…·æ³¨æ„äº‹é¡¹</title>
    <link href="http://blog.ypintao.com/2025/03/01/tools/webpack/"/>
    <id>http://blog.ypintao.com/2025/03/01/tools/webpack/</id>
    <published>2025-03-01T04:00:00.000Z</published>
    <updated>2025-12-07T14:45:45.279Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Webpack-çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Webpack-çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Webpack çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Webpack çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>åˆ—ä¸¾å¹¶ç®€è¿° Webpack çš„å››å¤§æ ¸å¿ƒé…ç½®é¡¹ã€‚<br>æ¦‚å¿µæè¿°<br>entryå…¥å£æ–‡ä»¶ï¼ŒæŒ‡å®š Webpack å¼€å§‹æ„å»ºçš„ä½ç½®<br>outputè¾“å‡ºè·¯å¾„ä¸æ–‡ä»¶åé…ç½®<br>loaderå¤„ç†é JS æ–‡ä»¶ï¼ˆå¦‚ CSSã€å›¾ç‰‡ã€TypeScriptï¼‰<br>pluginæ‰©å±• Webpack åŠŸèƒ½ï¼ˆå¦‚å‹ç¼©ã€ä¼˜åŒ–ã€æ³¨å…¥å˜é‡ï¼‰</p><span id="more"></span><h2 id="å¦‚ä½•é…ç½®å¤šä¸ªå…¥å£ï¼ˆentryï¼‰ï¼Ÿ"><a href="#å¦‚ä½•é…ç½®å¤šä¸ªå…¥å£ï¼ˆentryï¼‰ï¼Ÿ" class="headerlink" title="å¦‚ä½•é…ç½®å¤šä¸ªå…¥å£ï¼ˆentryï¼‰ï¼Ÿ"></a>å¦‚ä½•é…ç½®å¤šä¸ªå…¥å£ï¼ˆentryï¼‰ï¼Ÿ</h2><p>é…ç½® Webpack åŒæ—¶æ‰“åŒ…ä¸¤ä¸ªç‹¬ç«‹é¡µé¢ï¼ˆå¦‚ index å’Œ about é¡µé¢ï¼‰ã€‚</p><h2 id="å¦‚ä½•é…ç½®ç¯å¢ƒå˜é‡ï¼Ÿ"><a href="#å¦‚ä½•é…ç½®ç¯å¢ƒå˜é‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•é…ç½®ç¯å¢ƒå˜é‡ï¼Ÿ"></a>å¦‚ä½•é…ç½®ç¯å¢ƒå˜é‡ï¼Ÿ</h2><p> åœ¨ä¸åŒç¯å¢ƒä¸­æ³¨å…¥ä¸åŒçš„ API åœ°å€ã€‚<br> ä½¿ç”¨ DefinePlugin å®šä¹‰å…¨å±€å˜é‡ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Tree-Shakingï¼Ÿå¦‚ä½•å¯ç”¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Tree-Shakingï¼Ÿå¦‚ä½•å¯ç”¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Tree Shakingï¼Ÿå¦‚ä½•å¯ç”¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Tree Shakingï¼Ÿå¦‚ä½•å¯ç”¨ï¼Ÿ</h2><p> åªæ‰“åŒ…å®é™…ä½¿ç”¨çš„ä»£ç ï¼Œå‡å°‘ä½“ç§¯ã€‚<br> Tree Shaking æ˜¯é€šè¿‡ ES Module é™æ€åˆ†æåˆ é™¤æœªä½¿ç”¨ä»£ç çš„æŠ€æœ¯ã€‚</p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">usedExports</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;sideEffects&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•ä¼˜åŒ–æ‰“åŒ…ä½“ç§¯ï¼Ÿ"><a href="#å¦‚ä½•ä¼˜åŒ–æ‰“åŒ…ä½“ç§¯ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–æ‰“åŒ…ä½“ç§¯ï¼Ÿ"></a>å¦‚ä½•ä¼˜åŒ–æ‰“åŒ…ä½“ç§¯ï¼Ÿ</h2><p>å‡å°‘æœ€ç»ˆæ‰“åŒ…æ–‡ä»¶å¤§å°çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ</p><p>ä½¿ç”¨ TerserPlugin å‹ç¼© JSã€‚<br>ä½¿ç”¨ MiniCssExtractPlugin æå– CSSã€‚<br>ä½¿ç”¨ SplitChunksPlugin åˆ†åŒ…ã€‚<br>ç§»é™¤æ— ç”¨ä»£ç ï¼ˆTree Shakingï¼‰ã€‚<br>ä½¿ç”¨ externals æ’é™¤ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ Reactï¼‰ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">  <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">minimizer</span>: [<span class="keyword">new</span> <span class="title class_">TerserPlugin</span>()],</span><br><span class="line">  <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">    <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•é…ç½®-Webpack-æ„å»ºå¤šé¡µåº”ç”¨ï¼ˆMPAï¼‰ï¼Ÿ"><a href="#å¦‚ä½•é…ç½®-Webpack-æ„å»ºå¤šé¡µåº”ç”¨ï¼ˆMPAï¼‰ï¼Ÿ" class="headerlink" title="å¦‚ä½•é…ç½® Webpack æ„å»ºå¤šé¡µåº”ç”¨ï¼ˆMPAï¼‰ï¼Ÿ"></a>å¦‚ä½•é…ç½® Webpack æ„å»ºå¤šé¡µåº”ç”¨ï¼ˆMPAï¼‰ï¼Ÿ</h2><p>åŒæ—¶æ‰“åŒ…å¤šä¸ª HTML é¡µé¢ï¼Œæ¯ä¸ªé¡µé¢å¯¹åº”ä¸€ä¸ªå…¥å£æ–‡ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">home</span>: <span class="string">&#x27;./src/home.js&#x27;</span>,</span><br><span class="line">    <span class="attr">about</span>: <span class="string">&#x27;./src/about.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123; <span class="attr">filename</span>: <span class="string">&#x27;home.html&#x27;</span>, <span class="attr">template</span>: <span class="string">&#x27;./src/home.html&#x27;</span>, <span class="attr">chunks</span>: [<span class="string">&#x27;home&#x27;</span>] &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123; <span class="attr">filename</span>: <span class="string">&#x27;about.html&#x27;</span>, <span class="attr">template</span>: <span class="string">&#x27;./src/about.html&#x27;</span>, <span class="attr">chunks</span>: [<span class="string">&#x27;about&#x27;</span>] &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Webpack-çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;a href=&quot;#Webpack-çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;Webpack çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;/a&gt;Webpack çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;&lt;p&gt;åˆ—ä¸¾å¹¶ç®€è¿° Webpack çš„å››å¤§æ ¸å¿ƒé…ç½®é¡¹ã€‚&lt;br&gt;æ¦‚å¿µ	æè¿°&lt;br&gt;entry	å…¥å£æ–‡ä»¶ï¼ŒæŒ‡å®š Webpack å¼€å§‹æ„å»ºçš„ä½ç½®&lt;br&gt;output	è¾“å‡ºè·¯å¾„ä¸æ–‡ä»¶åé…ç½®&lt;br&gt;loader	å¤„ç†é JS æ–‡ä»¶ï¼ˆå¦‚ CSSã€å›¾ç‰‡ã€TypeScriptï¼‰&lt;br&gt;plugin	æ‰©å±• Webpack åŠŸèƒ½ï¼ˆå¦‚å‹ç¼©ã€ä¼˜åŒ–ã€æ³¨å…¥å˜é‡ï¼‰&lt;/p&gt;</summary>
    
    
    
    <category term="webpack" scheme="http://blog.ypintao.com/categories/webpack/"/>
    
    
    <category term="webpack" scheme="http://blog.ypintao.com/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>cocoså°æ¸¸æˆå¼€å‘</title>
    <link href="http://blog.ypintao.com/2025/01/01/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/cocos%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3/"/>
    <id>http://blog.ypintao.com/2025/01/01/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/cocos%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3/</id>
    <published>2025-01-01T04:00:00.000Z</published>
    <updated>2025-09-25T02:31:15.893Z</updated>
    
    
    
    
    <category term="cocos" scheme="http://blog.ypintao.com/categories/cocos/"/>
    
    
    <category term="cocos" scheme="http://blog.ypintao.com/tags/cocos/"/>
    
  </entry>
  
  <entry>
    <title>Vue2ç»„ä»¶åº“å¼€å‘</title>
    <link href="http://blog.ypintao.com/2024/06/01/%E5%89%8D%E7%AB%AF/vue/vue2%E7%BB%84%E4%BB%B6%E5%BA%93/"/>
    <id>http://blog.ypintao.com/2024/06/01/%E5%89%8D%E7%AB%AF/vue/vue2%E7%BB%84%E4%BB%B6%E5%BA%93/</id>
    <published>2024-06-01T04:00:00.000Z</published>
    <updated>2025-09-25T06:57:13.061Z</updated>
    
    <content type="html"><![CDATA[<p>Vue2ç»„ä»¶åº“å¼€å‘</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Vue2ç»„ä»¶åº“å¼€å‘&lt;/p&gt;
</summary>
      
    
    
    
    <category term="vue2" scheme="http://blog.ypintao.com/categories/vue2/"/>
    
    
    <category term="vue2" scheme="http://blog.ypintao.com/tags/vue2/"/>
    
  </entry>
  
  <entry>
    <title>Vue3é‡ç‚¹</title>
    <link href="http://blog.ypintao.com/2024/05/01/%E5%89%8D%E7%AB%AF/vue/vue3%E9%9D%A2%E8%AF%95/"/>
    <id>http://blog.ypintao.com/2024/05/01/%E5%89%8D%E7%AB%AF/vue/vue3%E9%9D%A2%E8%AF%95/</id>
    <published>2024-05-01T04:00:00.000Z</published>
    <updated>2025-09-25T06:57:20.974Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Vue-3-é¢è¯•é¢˜é›†"><a href="#Vue-3-é¢è¯•é¢˜é›†" class="headerlink" title="Vue 3 é¢è¯•é¢˜é›†"></a>Vue 3 é¢è¯•é¢˜é›†</h1><h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><h3 id="1-Vue-3-ç›¸æ¯”-Vue-2-æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ"><a href="#1-Vue-3-ç›¸æ¯”-Vue-2-æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ" class="headerlink" title="1. Vue 3 ç›¸æ¯” Vue 2 æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ"></a>1. Vue 3 ç›¸æ¯” Vue 2 æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š</p><ul><li><strong>æ€§èƒ½æå‡</strong>ï¼šVue 3 é‡å†™äº†è™šæ‹Ÿ DOM å®ç°ï¼Œæ¸²æŸ“æ€§èƒ½æå‡çº¦ 1.3~2 å€ï¼Œå†…å­˜å ç”¨å‡å°‘çº¦ 50%</li><li><strong>Composition API</strong>ï¼šæ–°å¢ç»„åˆå¼ APIï¼Œæä¾›æ›´çµæ´»çš„é€»è¾‘ç»„ç»‡å’Œå¤ç”¨æ–¹å¼</li><li><strong>TypeScript æ”¯æŒ</strong>ï¼šVue 3 æ˜¯ç”¨ TypeScript é‡å†™çš„ï¼Œæä¾›äº†æ›´å¥½çš„ç±»å‹æ¨æ–­</li><li><strong>Teleport ç»„ä»¶</strong>ï¼šå…è®¸å°†ç»„ä»¶çš„å†…å®¹ä¼ é€åˆ° DOM çš„å…¶ä»–ä½ç½®</li><li><strong>Fragments</strong>ï¼šç»„ä»¶å¯ä»¥æœ‰å¤šä¸ªæ ¹èŠ‚ç‚¹</li><li><strong>Suspense</strong>ï¼šå¤„ç†å¼‚æ­¥ç»„ä»¶çš„æ–°ç‰¹æ€§</li><li><strong>å“åº”å¼ç³»ç»Ÿå‡çº§</strong>ï¼šä½¿ç”¨ ES6 çš„ Proxy ä»£æ›¿ Object.definePropertyï¼Œè§£å†³äº† Vue 2 ä¸­çš„æ•°ç»„å’Œå¯¹è±¡å“åº”å¼é—®é¢˜</li><li><strong>å…¨å±€ API æ”¹ä¸ºåº”ç”¨å®ä¾‹è°ƒç”¨</strong>ï¼šå‡å°‘äº†å…¨å±€æ±¡æŸ“</li><li><strong>æ›´å¥½çš„ Tree-shaking æ”¯æŒ</strong>ï¼šå‡å°æ‰“åŒ…ä½“ç§¯</li></ul><span id="more"></span><h3 id="2-ä»€ä¹ˆæ˜¯-Composition-APIï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#2-ä»€ä¹ˆæ˜¯-Composition-APIï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="2. ä»€ä¹ˆæ˜¯ Composition APIï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>2. ä»€ä¹ˆæ˜¯ Composition APIï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Composition API æ˜¯ Vue 3 å¼•å…¥çš„ä¸€ç§æ–°çš„ç»„ä»¶é€»è¾‘ç»„ç»‡æ–¹å¼ï¼Œå®ƒå…è®¸æˆ‘ä»¬æŒ‰ç…§åŠŸèƒ½&#x2F;å…³æ³¨ç‚¹ç»„ç»‡ä»£ç ï¼Œè€Œä¸æ˜¯æŒ‰ç…§é€‰é¡¹ï¼ˆdataã€methodsã€computed ç­‰ï¼‰ã€‚</p><p><strong>è§£å†³çš„é—®é¢˜</strong>ï¼š</p><ul><li><strong>é€»è¾‘å¤ç”¨</strong>ï¼šç›¸æ¯”äº Vue 2 çš„ mixinsï¼ŒComposition API æä¾›äº†æ›´æ¸…æ™°ã€æ›´çµæ´»çš„é€»è¾‘å¤ç”¨æ–¹å¼</li><li><strong>æ›´å¥½çš„ç±»å‹æ¨æ–­</strong>ï¼šå¯¹ TypeScript çš„æ”¯æŒæ›´å¥½</li><li><strong>ä»£ç ç»„ç»‡</strong>ï¼šç›¸å…³åŠŸèƒ½çš„ä»£ç å¯ä»¥æ”¾åœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯åˆ†æ•£åœ¨ä¸åŒçš„é€‰é¡¹ä¸­</li><li><strong>é¿å…å‘½åå†²çª</strong>ï¼šä¸åŒåŠŸèƒ½æ¨¡å—å¯ä»¥åœ¨å„è‡ªçš„ä½œç”¨åŸŸä¸­å®šä¹‰å˜é‡ï¼Œé¿å…äº† mixins ä¸­çš„å‘½åå†²çªé—®é¢˜</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vue 2 çš„ Options API</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">user</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">age</span>: <span class="number">0</span> &#125;,</span><br><span class="line">      <span class="attr">posts</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">fetchUserData</span>(<span class="params"></span>) &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">    <span class="title function_">fetchUserPosts</span>(<span class="params"></span>) &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="title function_">userFullName</span>(<span class="params"></span>) &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue 3 çš„ Composition API</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ç”¨æˆ·ç›¸å…³é€»è¾‘</span></span><br><span class="line">    <span class="keyword">const</span> user = <span class="title function_">ref</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">age</span>: <span class="number">0</span> &#125;)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fetchUserData</span> = (<span class="params"></span>) =&gt; &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">    <span class="keyword">const</span> userFullName = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">/* ... */</span> &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ–‡ç« ç›¸å…³é€»è¾‘</span></span><br><span class="line">    <span class="keyword">const</span> posts = <span class="title function_">ref</span>([])</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fetchUserPosts</span> = (<span class="params"></span>) =&gt; &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">fetchUserData</span>()</span><br><span class="line">      <span class="title function_">fetchUserPosts</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      user,</span><br><span class="line">      posts,</span><br><span class="line">      userFullName,</span><br><span class="line">      fetchUserData,</span><br><span class="line">      fetchUserPosts</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ref-å’Œ-reactive-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å®ƒä»¬ï¼Ÿ"><a href="#3-ref-å’Œ-reactive-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å®ƒä»¬ï¼Ÿ" class="headerlink" title="3. ref å’Œ reactive æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å®ƒä»¬ï¼Ÿ"></a>3. ref å’Œ reactive æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å®ƒä»¬ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>ref å’Œ reactive éƒ½æ˜¯ç”¨äºåˆ›å»ºå“åº”å¼æ•°æ®çš„ APIï¼Œä½†å®ƒä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š</p><p><strong>ref</strong>ï¼š</p><ul><li>å¯ä»¥åŒ…è£…ä»»ä½•ç±»å‹çš„å€¼ï¼ˆåŸºæœ¬ç±»å‹å’Œå¯¹è±¡ç±»å‹ï¼‰</li><li>åˆ›å»ºä¸€ä¸ªåŒ…å« <code>.value</code> å±æ€§çš„å“åº”å¼å¯¹è±¡</li><li>åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ—¶ä¼šè‡ªåŠ¨è§£åŒ…ï¼ˆä¸éœ€è¦ <code>.value</code>ï¼‰</li><li>é€‚åˆå¤„ç†åŸºæœ¬ç±»å‹å€¼ï¼ˆå¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ï¼‰</li></ul><p><strong>reactive</strong>ï¼š</p><ul><li>åªèƒ½ç”¨äºå¯¹è±¡ç±»å‹ï¼ˆåŒ…æ‹¬æ•°ç»„å’Œæ™®é€šå¯¹è±¡ï¼‰</li><li>ç›´æ¥è¿”å›åŸå§‹å¯¹è±¡çš„å“åº”å¼ä»£ç†</li><li>ä¸èƒ½ç”¨äºåŸºæœ¬ç±»å‹å€¼</li><li>ä¸èƒ½è¢«é‡æ–°èµ‹å€¼ï¼ˆä¼šç ´åå“åº”æ€§ï¼‰</li></ul><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>å¯¹äºåŸºæœ¬ç±»å‹å€¼ï¼ˆå¦‚ stringã€numberã€booleanï¼‰ï¼Œå¿…é¡»ä½¿ç”¨ ref</li><li>å¯¹äºå¤æ‚å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ reactive æˆ– ref</li><li>å¦‚æœéœ€è¦æ•´ä½“æ›¿æ¢ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œåº”è¯¥ä½¿ç”¨ ref</li><li>å¦‚æœåªéœ€è¦ä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ reactive</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ ref</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>) <span class="comment">// 0</span></span><br><span class="line">count.<span class="property">value</span>++</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ reactive</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">count</span>) <span class="comment">// 0</span></span><br><span class="line">state.<span class="property">count</span>++</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">count</span>) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ref å¯ä»¥åŒ…è£…å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="title function_">ref</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;)</span><br><span class="line">user.<span class="property">value</span>.<span class="property">age</span>++</span><br><span class="line"><span class="comment">// æˆ–è€…æ•´ä½“æ›¿æ¢</span></span><br><span class="line">user.<span class="property">value</span> = &#123; <span class="attr">name</span>: <span class="string">&#x27;Jane&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// reactive ä¸èƒ½é‡æ–°èµ‹å€¼</span></span><br><span class="line"><span class="keyword">const</span> user2 = <span class="title function_">reactive</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;)</span><br><span class="line">user2.<span class="property">age</span>++</span><br><span class="line"><span class="comment">// ä¸‹é¢è¿™æ ·ä¼šç ´åå“åº”æ€§</span></span><br><span class="line"><span class="comment">// user2 = &#123; name: &#x27;Jane&#x27;, age: 25 &#125; // é”™è¯¯ç”¨æ³•</span></span><br></pre></td></tr></table></figure><h3 id="4-Vue-3-ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å“ªäº›å˜åŒ–ï¼Ÿ"><a href="#4-Vue-3-ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å“ªäº›å˜åŒ–ï¼Ÿ" class="headerlink" title="4. Vue 3 ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å“ªäº›å˜åŒ–ï¼Ÿ"></a>4. Vue 3 ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å“ªäº›å˜åŒ–ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸ Vue 2 ç›¸æ¯”æœ‰ä»¥ä¸‹å˜åŒ–ï¼š</p><ol><li><p><strong>å‘½åå˜åŒ–</strong>ï¼š</p><ul><li><code>beforeCreate</code> å’Œ <code>created</code> è¢« <code>setup()</code> å‡½æ•°æœ¬èº«æ›¿ä»£</li><li>å…¶ä»–é’©å­å‰ç¼€æ”¹ä¸º <code>on</code>ï¼Œå¦‚ <code>mounted</code> å˜ä¸º <code>onMounted</code></li></ul></li><li><p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼šåœ¨ Composition API ä¸­ï¼Œç”Ÿå‘½å‘¨æœŸé’©å­ä½œä¸ºå‡½æ•°å¯¼å…¥å¹¶åœ¨ <code>setup()</code> ä¸­è°ƒç”¨</p></li><li><p><strong>æ–°å¢é’©å­</strong>ï¼š</p><ul><li><code>onRenderTracked</code>ï¼šå½“ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹ä¸­è¿½è¸ªåˆ°å“åº”å¼ä¾èµ–æ—¶è°ƒç”¨</li><li><code>onRenderTriggered</code>ï¼šå½“å“åº”å¼ä¾èµ–è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶è°ƒç”¨</li></ul></li><li><p><strong>ç§»é™¤é’©å­</strong>ï¼š</p><ul><li><code>beforeDestroy</code> æ”¹åä¸º <code>beforeUnmount</code></li><li><code>destroyed</code> æ”¹åä¸º <code>unmounted</code></li></ul></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">  onBeforeMount, </span><br><span class="line">  onMounted, </span><br><span class="line">  onBeforeUpdate, </span><br><span class="line">  onUpdated, </span><br><span class="line">  onBeforeUnmount, </span><br><span class="line">  onUnmounted,</span><br><span class="line">  onActivated,</span><br><span class="line">  onDeactivated,</span><br><span class="line">  onErrorCaptured</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">onBeforeMount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç»„ä»¶æŒ‚è½½å‰&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç»„ä»¶æŒ‚è½½å®Œæˆ&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¶ä»–ç”Ÿå‘½å‘¨æœŸé’©å­...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-ä»€ä¹ˆæ˜¯-Teleportï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#5-ä»€ä¹ˆæ˜¯-Teleportï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="5. ä»€ä¹ˆæ˜¯ Teleportï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>5. ä»€ä¹ˆæ˜¯ Teleportï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Teleport æ˜¯ Vue 3 æ–°å¢çš„ä¸€ä¸ªå†…ç½®ç»„ä»¶ï¼Œå®ƒå¯ä»¥å°†ç»„ä»¶çš„ä¸€éƒ¨åˆ† DOM ä¼ é€åˆ°ç»„ä»¶ DOM æ ‘ä¹‹å¤–çš„ä½ç½®ã€‚</p><p><strong>è§£å†³çš„é—®é¢˜</strong>ï¼š</p><ul><li>è§£å†³äº†æ¨¡æ€æ¡†ã€å¼¹å‡ºèœå•ã€é€šçŸ¥ç­‰éœ€è¦æ‰“ç ´ç»„ä»¶å±‚æ¬¡ç»“æ„çš„ UI å…ƒç´ çš„å®šä½é—®é¢˜</li><li>é¿å…äº† CSS æ ·å¼ï¼ˆå¦‚ z-indexã€overflowã€positionï¼‰å¸¦æ¥çš„é™åˆ¶</li><li>ä¿æŒäº†ç»„ä»¶çš„é€»è¾‘å°è£…ï¼ŒåŒæ—¶å…è®¸ DOM ç»“æ„çš„çµæ´»å¸ƒå±€</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showModal = true&quot;</span>&gt;</span>æ‰“å¼€æ¨¡æ€æ¡†<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- ä½¿ç”¨ Teleport å°†æ¨¡æ€æ¡†ä¼ é€åˆ° body ä¸‹ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;showModal&quot;</span> <span class="attr">class</span>=<span class="string">&quot;modal&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>æ¨¡æ€æ¡†æ ‡é¢˜<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ¨¡æ€æ¡†å†…å®¹...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showModal = false&quot;</span>&gt;</span>å…³é—­<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">teleport</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> showModal = <span class="title function_">ref</span>(<span class="literal">false</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123; showModal &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å“åº”å¼ç³»ç»Ÿ"><a href="#å“åº”å¼ç³»ç»Ÿ" class="headerlink" title="å“åº”å¼ç³»ç»Ÿ"></a>å“åº”å¼ç³»ç»Ÿ</h2><h3 id="6-Vue-3-çš„å“åº”å¼ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"><a href="#6-Vue-3-çš„å“åº”å¼ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ" class="headerlink" title="6. Vue 3 çš„å“åº”å¼ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"></a>6. Vue 3 çš„å“åº”å¼ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 çš„å“åº”å¼ç³»ç»ŸåŸºäº ES6 çš„ Proxy å®ç°ï¼Œä¸»è¦å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>åˆ›å»ºå“åº”å¼å¯¹è±¡</strong>ï¼šé€šè¿‡ <code>reactive()</code> æˆ– <code>ref()</code> åˆ›å»ºå“åº”å¼å¯¹è±¡</li><li><strong>ä»£ç†æ‹¦æˆª</strong>ï¼šä½¿ç”¨ Proxy æ‹¦æˆªå¯¹è±¡çš„å±æ€§è®¿é—®ã€ä¿®æ”¹ç­‰æ“ä½œ</li><li><strong>ä¾èµ–è¿½è¸ª</strong>ï¼šå½“ç»„ä»¶æ¸²æŸ“æˆ–è®¡ç®—å±æ€§è®¡ç®—æ—¶ï¼Œä¼šè®¿é—®å“åº”å¼å¯¹è±¡çš„å±æ€§ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šè®°å½•è¿™äº›ä¾èµ–å…³ç³»</li><li><strong>å˜æ›´é€šçŸ¥</strong>ï¼šå½“å“åº”å¼å¯¹è±¡çš„å±æ€§è¢«ä¿®æ”¹æ—¶ï¼ŒProxy çš„ set å¤„ç†å™¨ä¼šè¢«è§¦å‘ï¼Œç„¶åé€šçŸ¥æ‰€æœ‰ä¾èµ–äºè¯¥å±æ€§çš„å‰¯ä½œç”¨ï¼ˆå¦‚ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼‰</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®€åŒ–ç‰ˆçš„å“åº”å¼ç³»ç»Ÿå®ç°åŸç†</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">      <span class="comment">// è¿½è¸ªä¾èµ–</span></span><br><span class="line">      <span class="title function_">track</span>(target, key)</span><br><span class="line">      <span class="keyword">const</span> value = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver)</span><br><span class="line">      <span class="comment">// å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œåˆ™é€’å½’ä½¿å…¶å“åº”å¼</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> value === <span class="string">&#x27;object&#x27;</span> ? <span class="title function_">reactive</span>(value) : value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, value, receiver</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> oldValue = target[key]</span><br><span class="line">      <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, value, receiver)</span><br><span class="line">      <span class="keyword">if</span> (oldValue !== value) &#123;</span><br><span class="line">        <span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line">        <span class="title function_">trigger</span>(target, key)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-Vue-3-ä¸­å¦‚ä½•å®ç°è®¡ç®—å±æ€§ï¼Ÿ"><a href="#7-Vue-3-ä¸­å¦‚ä½•å®ç°è®¡ç®—å±æ€§ï¼Ÿ" class="headerlink" title="7. Vue 3 ä¸­å¦‚ä½•å®ç°è®¡ç®—å±æ€§ï¼Ÿ"></a>7. Vue 3 ä¸­å¦‚ä½•å®ç°è®¡ç®—å±æ€§ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 ä¸­ä½¿ç”¨ <code>computed()</code> å‡½æ•°æ¥åˆ›å»ºè®¡ç®—å±æ€§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> firstName = <span class="title function_">ref</span>(<span class="string">&#x27;John&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> lastName = <span class="title function_">ref</span>(<span class="string">&#x27;Doe&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºåªè¯»è®¡ç®—å±æ€§</span></span><br><span class="line">    <span class="keyword">const</span> fullName = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;firstName.value&#125;</span> <span class="subst">$&#123;lastName.value&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºå¯å†™è®¡ç®—å±æ€§</span></span><br><span class="line">    <span class="keyword">const</span> fullName2 = <span class="title function_">computed</span>(&#123;</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;firstName.value&#125;</span> <span class="subst">$&#123;lastName.value&#125;</span>`</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> names = newValue.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        firstName.<span class="property">value</span> = names[<span class="number">0</span>]</span><br><span class="line">        lastName.<span class="property">value</span> = names[<span class="number">1</span>] || <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      firstName,</span><br><span class="line">      lastName,</span><br><span class="line">      fullName,</span><br><span class="line">      fullName2</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¡ç®—å±æ€§å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>åŸºäºå…¶å“åº”å¼ä¾èµ–è¿›è¡Œç¼“å­˜</li><li>åªæœ‰å½“ä¾èµ–é¡¹å˜åŒ–æ—¶æ‰ä¼šé‡æ–°è®¡ç®—</li><li>è¿”å›ä¸€ä¸ªåªè¯»çš„å“åº”å¼å¼•ç”¨</li><li>å¯ä»¥é€šè¿‡æä¾› get å’Œ set å‡½æ•°åˆ›å»ºå¯å†™çš„è®¡ç®—å±æ€§</li></ul><h3 id="8-watchEffect-å’Œ-watch-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#8-watchEffect-å’Œ-watch-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="8. watchEffect å’Œ watch æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>8. watchEffect å’Œ watch æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br><code>watchEffect</code> å’Œ <code>watch</code> éƒ½ç”¨äºä¾¦å¬å“åº”å¼æ•°æ®çš„å˜åŒ–å¹¶æ‰§è¡Œå‰¯ä½œç”¨ï¼Œä½†å®ƒä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š</p><p><strong>watchEffect</strong>ï¼š</p><ul><li>ç«‹å³æ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°ï¼Œå¹¶è‡ªåŠ¨è¿½è¸ªå…¶ä¸­çš„å“åº”å¼ä¾èµ–</li><li>å½“ä»»ä½•ä¾èµ–é¡¹å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œå›è°ƒ</li><li>ä¸éœ€è¦æ˜ç¡®æŒ‡å®šè¦ä¾¦å¬çš„æ•°æ®æº</li><li>æ— æ³•è·å–è¢«ä¾¦å¬çŠ¶æ€çš„å‰ä¸€ä¸ªå€¼</li></ul><p><strong>watch</strong>ï¼š</p><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰åœ¨ä¾¦å¬çš„æºæ•°æ®å˜åŒ–æ—¶æ‰æ‰§è¡Œå›è°ƒ</li><li>éœ€è¦æ˜ç¡®æŒ‡å®šè¦ä¾¦å¬çš„æ•°æ®æº</li><li>å¯ä»¥è®¿é—®è¢«ä¾¦å¬çŠ¶æ€çš„å½“å‰å€¼å’Œå‰ä¸€ä¸ªå€¼</li><li>æ”¯æŒä¾¦å¬å¤šä¸ªæ•°æ®æº</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, watch, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> name = <span class="title function_">ref</span>(<span class="string">&#x27;Vue&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// watchEffect ç¤ºä¾‹</span></span><br><span class="line">    <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Count is: <span class="subst">$&#123;count.value&#125;</span>, Name is: <span class="subst">$&#123;name.value&#125;</span>`</span>)</span><br><span class="line">      <span class="comment">// è‡ªåŠ¨è¿½è¸ª count å’Œ name çš„å˜åŒ–</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// watch ç¤ºä¾‹ - ä¾¦å¬å•ä¸ªæ•°æ®æº</span></span><br><span class="line">    <span class="title function_">watch</span>(count, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Count changed from <span class="subst">$&#123;oldValue&#125;</span> to <span class="subst">$&#123;newValue&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// watch ç¤ºä¾‹ - ä¾¦å¬å¤šä¸ªæ•°æ®æº</span></span><br><span class="line">    <span class="title function_">watch</span>([count, name], <span class="function">(<span class="params">[newCount, newName], [oldCount, oldName]</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Count: <span class="subst">$&#123;oldCount&#125;</span> -&gt; <span class="subst">$&#123;newCount&#125;</span>, Name: <span class="subst">$&#123;oldName&#125;</span> -&gt; <span class="subst">$&#123;newName&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// watch ç¤ºä¾‹ - æ·±åº¦ä¾¦å¬</span></span><br><span class="line">    <span class="keyword">const</span> user = <span class="title function_">ref</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;)</span><br><span class="line">    <span class="title function_">watch</span>(user, <span class="function">(<span class="params">newUser, oldUser</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;User changed:&#x27;</span>, newUser, oldUser)</span><br><span class="line">    &#125;, &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count,</span><br><span class="line">      name,</span><br><span class="line">      user</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»„ä»¶é€šä¿¡"><a href="#ç»„ä»¶é€šä¿¡" class="headerlink" title="ç»„ä»¶é€šä¿¡"></a>ç»„ä»¶é€šä¿¡</h2><h3 id="9-Vue-3-ä¸­ç»„ä»¶ä¹‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ"><a href="#9-Vue-3-ä¸­ç»„ä»¶ä¹‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ" class="headerlink" title="9. Vue 3 ä¸­ç»„ä»¶ä¹‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ"></a>9. Vue 3 ä¸­ç»„ä»¶ä¹‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 ä¸­ç»„ä»¶é€šä¿¡çš„ä¸»è¦æ–¹å¼åŒ…æ‹¬ï¼š</p><ol><li><p><strong>Props å’Œ Events</strong>ï¼š</p><ul><li>çˆ¶ç»„ä»¶é€šè¿‡ props å‘å­ç»„ä»¶ä¼ é€’æ•°æ®</li><li>å­ç»„ä»¶é€šè¿‡ emits å‘çˆ¶ç»„ä»¶å‘é€äº‹ä»¶</li></ul></li><li><p><strong>v-model</strong>ï¼š</p><ul><li>Vue 3 ä¸­çš„ v-model å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ prop å’Œäº‹ä»¶</li><li>å¯ä»¥åœ¨åŒä¸€ç»„ä»¶ä¸Šä½¿ç”¨å¤šä¸ª v-model</li></ul></li><li><p><strong>provide&#x2F;inject</strong>ï¼š</p><ul><li>é€‚ç”¨äºæ·±å±‚ç»„ä»¶åµŒå¥—çš„åœºæ™¯</li><li>ç¥–å…ˆç»„ä»¶é€šè¿‡ provide æä¾›æ•°æ®ï¼Œåä»£ç»„ä»¶é€šè¿‡ inject æ³¨å…¥æ•°æ®</li></ul></li><li><p><strong>Vuex&#x2F;Pinia</strong>ï¼š</p><ul><li>é›†ä¸­å¼çŠ¶æ€ç®¡ç†</li><li>é€‚ç”¨äºå¤æ‚åº”ç”¨çš„å…¨å±€çŠ¶æ€ç®¡ç†</li></ul></li><li><p><strong>mitt&#x2F;tiny-emitter</strong>ï¼š</p><ul><li>äº‹ä»¶æ€»çº¿ï¼Œç”¨äºä»»æ„ç»„ä»¶é—´é€šä¿¡</li><li>Vue 3 ç§»é™¤äº† $on, $off ç­‰äº‹ä»¶ APIï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å®ç°</li></ul></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Props å’Œ Events</span></span><br><span class="line"><span class="comment">// å­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;update&#x27;</span>],</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, &#123; emit &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">emit</span>(<span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;New message&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; handleClick &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çˆ¶ç»„ä»¶</span></span><br><span class="line">&lt;child-component </span><br><span class="line">  :message=<span class="string">&quot;parentMessage&quot;</span> </span><br><span class="line">  @update=<span class="string">&quot;parentMessage = $event&quot;</span> </span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// provide/inject</span></span><br><span class="line"><span class="comment">// çˆ¶ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> &#123; provide, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> theme = <span class="title function_">ref</span>(<span class="string">&#x27;light&#x27;</span>)</span><br><span class="line">    <span class="title function_">provide</span>(<span class="string">&#x27;theme&#x27;</span>, theme) <span class="comment">// æä¾›å“åº”å¼æ•°æ®</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; theme &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç»„ä»¶æˆ–åä»£ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> theme = <span class="title function_">inject</span>(<span class="string">&#x27;theme&#x27;</span>) <span class="comment">// æ³¨å…¥æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> &#123; theme &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-Vue-3-ä¸­çš„-v-model-æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ"><a href="#10-Vue-3-ä¸­çš„-v-model-æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ" class="headerlink" title="10. Vue 3 ä¸­çš„ v-model æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ"></a>10. Vue 3 ä¸­çš„ v-model æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 ä¸­çš„ v-model ç›¸æ¯” Vue 2 æœ‰ä»¥ä¸‹å˜åŒ–ï¼š</p><ol><li><p><strong>é»˜è®¤ prop å’Œäº‹ä»¶åç§°å˜åŒ–</strong>ï¼š</p><ul><li>Vue 2ï¼šprop ä¸º <code>value</code>ï¼Œäº‹ä»¶ä¸º <code>input</code></li><li>Vue 3ï¼šprop ä¸º <code>modelValue</code>ï¼Œäº‹ä»¶ä¸º <code>update:modelValue</code></li></ul></li><li><p><strong>æ”¯æŒå¤šä¸ª v-model</strong>ï¼š</p><ul><li>Vue 3 å…è®¸åœ¨åŒä¸€ç»„ä»¶ä¸Šä½¿ç”¨å¤šä¸ª v-modelï¼Œæ¯ä¸ªç»‘å®šå¯ä»¥æœ‰ä¸åŒçš„åç§°</li></ul></li><li><p><strong>ç§»é™¤ .sync ä¿®é¥°ç¬¦</strong>ï¼š</p><ul><li>Vue 3 ä¸­ v-model å¯ä»¥æ›¿ä»£ Vue 2 ä¸­çš„ .sync ä¿®é¥°ç¬¦</li></ul></li><li><p><strong>è‡ªå®šä¹‰ v-model ä¿®é¥°ç¬¦</strong>ï¼š</p><ul><li>Vue 3 æ”¯æŒè‡ªå®šä¹‰ v-model ä¿®é¥°ç¬¦</li></ul></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åŸºæœ¬ç”¨æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">custom-input</span> <span class="attr">v-model</span>=<span class="string">&quot;searchText&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç­‰ä»·äº --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">custom-input</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:modelValue</span>=<span class="string">&quot;searchText&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">update:modelValue</span>=<span class="string">&quot;searchText = $event&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¤šä¸ª v-model --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user-form</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model:name</span>=<span class="string">&quot;userName&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model:age</span>=<span class="string">&quot;userAge&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç­‰ä»·äº --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user-form</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:name</span>=<span class="string">&quot;userName&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">update:name</span>=<span class="string">&quot;userName = $event&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:age</span>=<span class="string">&quot;userAge&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">update:age</span>=<span class="string">&quot;userAge = $event&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¸¦ä¿®é¥°ç¬¦çš„ v-model --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">custom-input</span> <span class="attr">v-model.capitalize</span>=<span class="string">&quot;searchText&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>ç»„ä»¶å®ç°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å•ä¸ª v-model</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">modelValue</span>: <span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;update:modelValue&#x27;</span>],</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, &#123; emit &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleInput</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">emit</span>(<span class="string">&#x27;update:modelValue&#x27;</span>, e.<span class="property">target</span>.<span class="property">value</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; handleInput &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šä¸ª v-model</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;update:name&#x27;</span>, <span class="string">&#x27;update:age&#x27;</span>],</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, &#123; emit &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">updateName</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">emit</span>(<span class="string">&#x27;update:name&#x27;</span>, name)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">updateAge</span> = (<span class="params">age</span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">emit</span>(<span class="string">&#x27;update:age&#x27;</span>, age)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; updateName, updateAge &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ä¿®é¥°ç¬¦</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">modelValue</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">modelModifiers</span>: &#123;</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> (&#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;update:modelValue&#x27;</span>],</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, &#123; emit &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleInput</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> value = e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// åº”ç”¨ä¿®é¥°ç¬¦</span></span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">modelModifiers</span>.<span class="property">capitalize</span>) &#123;</span><br><span class="line">        value = value.<span class="title function_">charAt</span>(<span class="number">0</span>).<span class="title function_">toUpperCase</span>() + value.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="title function_">emit</span>(<span class="string">&#x27;update:modelValue&#x27;</span>, value)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; handleInput &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h2><h3 id="11-Vue-3-ä¸­å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Ÿ"><a href="#11-Vue-3-ä¸­å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Ÿ" class="headerlink" title="11. Vue 3 ä¸­å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Ÿ"></a>11. Vue 3 ä¸­å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 ä¸­çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•åŒ…æ‹¬ï¼š</p><ol><li><p><strong>ä½¿ç”¨ v-memo å‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</strong>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-memo</span>=<span class="string">&quot;[item.id === selected]&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- åªæœ‰å½“ item.id === selected å˜åŒ–æ—¶æ‰ä¼šé‡æ–°æ¸²æŸ“ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ v-once æ¸²æŸ“é™æ€å†…å®¹</strong>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-once</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- åªæ¸²æŸ“ä¸€æ¬¡ï¼Œä¹‹åä¸å†æ›´æ–° --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ computed ç¼“å­˜è®¡ç®—ç»“æœ</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> filteredItems = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> items.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">price</span> &gt; <span class="number">100</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ shallowRef å’Œ shallowReactive å‡å°‘æ·±å±‚å“åº”</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åªæœ‰ state çš„é¡¶å±‚å±æ€§æ˜¯å“åº”å¼çš„</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">shallowReactive</span>(&#123;</span><br><span class="line">  <span class="attr">user</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">address</span>: &#123; <span class="attr">city</span>: <span class="string">&#x27;New York&#x27;</span> &#125; &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ defineAsyncComponent å¼‚æ­¥åŠ è½½ç»„ä»¶</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">AsyncComponent</span> = <span class="title function_">defineAsyncComponent</span>(<span class="function">() =&gt;</span> </span><br><span class="line">  <span class="keyword">import</span>(<span class="string">&#x27;./components/AsyncComponent.vue&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ KeepAlive ç¼“å­˜ç»„ä»¶å®ä¾‹</strong>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;currentComponent&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ Suspense å¤„ç†å¼‚æ­¥ä¾èµ–</strong>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">suspense</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">async-component</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">fallback</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loading-spinner</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">suspense</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨æ¸²æŸ“å¤§é‡æ•°æ®</strong>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">virtual-list</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:items</span>=<span class="string">&quot;items&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:item-height</span>=<span class="string">&quot;50&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-slot</span>=<span class="string">&quot;&#123; item &#125;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">virtual-list</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="12-Vue-3-ä¸­å¦‚ä½•å®ç°è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ"><a href="#12-Vue-3-ä¸­å¦‚ä½•å®ç°è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ" class="headerlink" title="12. Vue 3 ä¸­å¦‚ä½•å®ç°è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ"></a>12. Vue 3 ä¸­å¦‚ä½•å®ç°è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 ä¸­è‡ªå®šä¹‰æŒ‡ä»¤çš„å®ç°æ–¹å¼ä¸ Vue 2 æœ‰æ‰€ä¸åŒï¼Œä¸»è¦å˜åŒ–åœ¨äºé’©å­å‡½æ•°çš„åç§°ä¸ç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¨å±€æ³¨å†Œ</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    el.<span class="title function_">focus</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å±€éƒ¨æ³¨å†Œ</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">directives</span>: &#123;</span><br><span class="line">    <span class="attr">focus</span>: &#123;</span><br><span class="line">      <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">        el.<span class="title function_">focus</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Vue 3 ä¸­è‡ªå®šä¹‰æŒ‡ä»¤çš„é’©å­å‡½æ•°åŒ…æ‹¬ï¼š</p><ul><li><code>created</code>ï¼šåœ¨ç»‘å®šå…ƒç´ çš„ attribute æˆ–äº‹ä»¶ç›‘å¬å™¨è¢«åº”ç”¨ä¹‹å‰è°ƒç”¨</li><li><code>beforeMount</code>ï¼šåœ¨å…ƒç´ è¢«æ’å…¥åˆ° DOM ä¹‹å‰è°ƒç”¨</li><li><code>mounted</code>ï¼šåœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶è¢«æŒ‚è½½åè°ƒç”¨</li><li><code>beforeUpdate</code>ï¼šåœ¨åŒ…å«ç»„ä»¶çš„ VNode æ›´æ–°ä¹‹å‰è°ƒç”¨</li><li><code>updated</code>ï¼šåœ¨åŒ…å«ç»„ä»¶çš„ VNode åŠå…¶å­ç»„ä»¶çš„ VNode æ›´æ–°ä¹‹åè°ƒç”¨</li><li><code>beforeUnmount</code>ï¼šåœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶å¸è½½ä¹‹å‰è°ƒç”¨</li><li><code>unmounted</code>ï¼šå½“æŒ‡ä»¤ä¸å…ƒç´ è§£é™¤ç»‘å®šä¸”çˆ¶ç»„ä»¶å·²å¸è½½æ—¶è°ƒç”¨</li></ul><p>è‡ªå®šä¹‰æŒ‡ä»¤çš„å‚æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">directive</span>(<span class="string">&#x27;my-directive&#x27;</span>, <span class="function">(<span class="params">el, binding, vnode, prevVnode</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// binding åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</span></span><br><span class="line">  <span class="comment">// valueï¼šä¼ é€’ç»™æŒ‡ä»¤çš„å€¼</span></span><br><span class="line">  <span class="comment">// oldValueï¼šä¹‹å‰çš„å€¼ï¼Œä»…åœ¨ beforeUpdate å’Œ updated ä¸­å¯ç”¨</span></span><br><span class="line">  <span class="comment">// argï¼šä¼ é€’ç»™æŒ‡ä»¤çš„å‚æ•°ï¼Œå¦‚ v-my-directive:arg</span></span><br><span class="line">  <span class="comment">// modifiersï¼šåŒ…å«ä¿®é¥°ç¬¦çš„å¯¹è±¡ï¼Œå¦‚ v-my-directive.foo.bar ä¸­ï¼Œmodifiers ä¸º &#123; foo: true, bar: true &#125;</span></span><br><span class="line">  <span class="comment">// instanceï¼šä½¿ç”¨è¯¥æŒ‡ä»¤çš„ç»„ä»¶å®ä¾‹</span></span><br><span class="line">  <span class="comment">// dirï¼šæŒ‡ä»¤å®šä¹‰å¯¹è±¡</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="å·¥ç¨‹åŒ–ä¸ç”Ÿæ€"><a href="#å·¥ç¨‹åŒ–ä¸ç”Ÿæ€" class="headerlink" title="å·¥ç¨‹åŒ–ä¸ç”Ÿæ€"></a>å·¥ç¨‹åŒ–ä¸ç”Ÿæ€</h2><h3 id="13-Vue-3-ä¸­å¦‚ä½•ä½¿ç”¨-TypeScriptï¼Ÿ"><a href="#13-Vue-3-ä¸­å¦‚ä½•ä½¿ç”¨-TypeScriptï¼Ÿ" class="headerlink" title="13. Vue 3 ä¸­å¦‚ä½•ä½¿ç”¨ TypeScriptï¼Ÿ"></a>13. Vue 3 ä¸­å¦‚ä½•ä½¿ç”¨ TypeScriptï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Vue 3 å¯¹ TypeScript æœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œä¸»è¦ä½¿ç”¨æ–¹å¼åŒ…æ‹¬ï¼š</p><ol><li><p><strong>ä½¿ç”¨ defineComponent åŒ…è£…ç»„ä»¶é€‰é¡¹</strong>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>åœ¨ setup å‡½æ•°ä¸­ä½¿ç”¨ç±»å‹æ³¨è§£</strong>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, ref, <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">count</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt; = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">User</span>&gt; = <span class="title function_">ref</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; count, user &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ defineProps å’Œ defineEmits</strong>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="comment">// ä½¿ç”¨è¿è¡Œæ—¶å£°æ˜</span></span><br><span class="line"><span class="keyword">const</span> props = defineProps&lt;&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>?: <span class="built_in">number</span>;</span><br><span class="line">&#125;&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emit = defineEmits&lt;&#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&#x27;update&#x27;</span>, <span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&#x27;delete&#x27;</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;&gt;()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line"><span class="title function_">withDefaults</span>(defineProps&lt;&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>?: <span class="built_in">number</span>;</span><br><span class="line">&#125;&gt;(), &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¸º ref å’Œ reactive æä¾›ç±»å‹</strong>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸º ref æä¾›ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> user = ref&lt;<span class="title class_">User</span>&gt;(&#123; <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸º reactive æä¾›ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> state = reactive&lt;&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">users</span>: <span class="title class_">User</span>[];</span><br><span class="line">&#125;&gt;(&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">users</span>: []</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ PropType å®šä¹‰å¤æ‚ prop ç±»å‹</strong>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, <span class="title class_">PropType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">user</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Object</span> <span class="keyword">as</span> <span class="title class_">PropType</span>&lt;<span class="title class_">User</span>&gt;,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">callback</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Function</span> <span class="keyword">as</span> <span class="title class_">PropType</span>&lt;<span class="function">(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span>&gt;,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><h3 id="14-Vue-3-ä¸­å¦‚ä½•ä½¿ç”¨-Pinia-è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Ÿ"><a href="#14-Vue-3-ä¸­å¦‚ä½•ä½¿ç”¨-Pinia-è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Ÿ" class="headerlink" title="14. Vue 3 ä¸­å¦‚ä½•ä½¿ç”¨ Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Ÿ"></a>14. Vue 3 ä¸­å¦‚ä½•ä½¿ç”¨ Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br>Pinia æ˜¯ Vue å®˜æ–¹æ¨èçš„çŠ¶æ€ç®¡ç†åº“ï¼Œç”¨äºæ›¿ä»£ Vuexã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><ol><li><p><strong>å®‰è£… Pinia</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ›å»º Pinia å®ä¾‹å¹¶æŒ‚è½½åˆ°åº”ç”¨</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(pinia)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p><strong>å®šä¹‰ Store</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stores/counter.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åº”ç”¨ä¸­ store çš„å”¯ä¸€ ID</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">// state</span></span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Eduardo&#x27;</span></span><br><span class="line">  &#125;),</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// getters</span></span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">doubleCount</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span>,</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ this è®¿é—®å…¶ä»– getter</span></span><br><span class="line">    <span class="title function_">doubleCountPlusOne</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">doubleCount</span> + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// actions</span></span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> api.<span class="title function_">get</span>(<span class="string">&#x27;...&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span> = data.<span class="property">count</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ Setup Stores</strong>ï¼ˆæ›´ç®€æ´çš„è¯­æ³•ï¼‰ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// state</span></span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> name = <span class="title function_">ref</span>(<span class="string">&#x27;Eduardo&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// getters</span></span><br><span class="line">  <span class="keyword">const</span> doubleCount = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> count.<span class="property">value</span> * <span class="number">2</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// actions</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">    count.<span class="property">value</span>++</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123; count, name, doubleCount, increment &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Store</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Count: &#123;&#123; counter.count &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;Double count: &#123;&#123; counter.doubleCount &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;button @click=&quot;counter.increment()&quot;&gt;Increment&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;increment&quot;&gt;Increment (extracted)&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useCounterStore &#125; from &#x27;@/stores/counter&#x27;</span><br><span class="line">import &#123; storeToRefs &#125; from &#x27;pinia&#x27;</span><br><span class="line"></span><br><span class="line">const counter = useCounterStore()</span><br><span class="line"></span><br><span class="line">// è§£æ„ store æ—¶ä¿æŒå“åº”æ€§</span><br><span class="line">const &#123; count, doubleCount &#125; = storeToRefs(counter)</span><br><span class="line">// ç›´æ¥è§£æ„ actions</span><br><span class="line">const &#123; increment &#125; = counter</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¿®æ”¹ State</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼ 1ï¼šç›´æ¥ä¿®æ”¹</span></span><br><span class="line">counter.<span class="property">count</span>++</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼ 2ï¼šä½¿ç”¨ $patch æ–¹æ³•</span></span><br><span class="line">counter.$patch(&#123;</span><br><span class="line">  <span class="attr">count</span>: counter.<span class="property">count</span> + <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Alex&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼ 3ï¼šä½¿ç”¨ $patch å‡½æ•°</span></span><br><span class="line">counter.$patch(<span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">  state.<span class="property">count</span>++</span><br><span class="line">  state.<span class="property">name</span> = <span class="string">&#x27;Alex&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼ 4ï¼šä½¿ç”¨ actions</span></span><br><span class="line">counter.<span class="title function_">increment</span>()</span><br></pre></td></tr></table></figure></li><li><p><strong>é‡ç½® State</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">counter.$reset()</span><br></pre></td></tr></table></figure></li></ol><h3 id="15-Vue-3-ä¸­çš„-script-setup-è¯­æ³•æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"><a href="#15-Vue-3-ä¸­çš„-script-setup-è¯­æ³•æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ" class="headerlink" title="15. Vue 3 ä¸­çš„ script setup è¯­æ³•æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"></a>15. Vue 3 ä¸­çš„ script setup è¯­æ³•æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</h3><p><strong>ç­”æ¡ˆ</strong>ï¼š<br><code>&lt;script setup&gt;</code> æ˜¯ Vue 3.2 å¼•å…¥çš„ç¼–è¯‘æ—¶è¯­æ³•ç³–ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p><ol><li><p><strong>æ›´å°‘çš„æ ·æ¿ä»£ç </strong>ï¼š</p><ul><li>ä¸éœ€è¦è¿”å›è¦æš´éœ²ç»™æ¨¡æ¿çš„å˜é‡</li><li>å¯¼å…¥çš„ç»„ä»¶è‡ªåŠ¨æ³¨å†Œï¼Œæ— éœ€åœ¨ components é€‰é¡¹ä¸­å£°æ˜</li></ul></li><li><p><strong>æ›´å¥½çš„æ€§èƒ½</strong>ï¼š</p><ul><li>ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œå‡å°‘è¿è¡Œæ—¶å¼€é”€</li><li>æ¨¡æ¿ä¸­çš„å˜é‡è®¿é—®ä¸éœ€è¦é€šè¿‡ä»£ç†</li></ul></li><li><p><strong>æ›´å¥½çš„ TypeScript æ”¯æŒ</strong>ï¼š</p><ul><li>ç›´æ¥åœ¨ <code>&lt;script setup&gt;</code> ä¸­ä½¿ç”¨ TypeScript</li><li>ä½¿ç”¨ defineProps å’Œ defineEmits è·å¾—å®Œæ•´çš„ç±»å‹æ¨æ–­</li></ul></li><li><p><strong>æ›´å¥½çš„ IDE æ”¯æŒ</strong>ï¼š</p><ul><li>æ›´å¥½çš„è‡ªåŠ¨è¡¥å…¨</li><li>æ›´å‡†ç¡®çš„ç±»å‹æ£€æŸ¥</li></ul></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, computed &#125; from &#x27;vue&#x27;</span><br><span class="line">import MyComponent from &#x27;./MyComponent.vue&#x27; // è‡ªåŠ¨æ³¨å†Œ</span><br><span class="line"></span><br><span class="line">// å£°æ˜å“åº”å¼çŠ¶æ€</span><br><span class="line">const count = ref(0)</span><br><span class="line"></span><br><span class="line">// è®¡ç®—å±æ€§</span><br><span class="line">const doubleCount = computed(() =&gt; count.value * 2)</span><br><span class="line"></span><br><span class="line">// æ–¹æ³•</span><br><span class="line">function increment() &#123;</span><br><span class="line">  count.value++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç”Ÿå‘½å‘¨æœŸé’©å­</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  console.log(&#x27;Component mounted&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// ç›´æ¥å¯¼å…¥å¹¶ä½¿ç”¨ç»„ä»¶ï¼Œæ— éœ€æ³¨å†Œ</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Count: &#123;&#123; count &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;Double count: &#123;&#123; doubleCount &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;button @click=&quot;increment&quot;&gt;Increment&lt;/button&gt;</span><br><span class="line">    &lt;MyComponent /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ defineProps å’Œ defineEmitsï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">// å£°æ˜ props</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  title: String,</span><br><span class="line">  likes: &#123;</span><br><span class="line">    type: Number,</span><br><span class="line">    default: 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// å£°æ˜ emits</span><br><span class="line">const emit = defineEmits([&#x27;update&#x27;, &#x27;delete&#x27;])</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨ emit</span><br><span class="line">function handleClick() &#123;</span><br><span class="line">  emit(&#x27;update&#x27;, 123)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ TypeScriptï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">// ä½¿ç”¨ç±»å‹å£°æ˜ props</span><br><span class="line">const props = defineProps&lt;&#123;</span><br><span class="line">  title: string;</span><br><span class="line">  likes?: number;</span><br><span class="line">&#125;&gt;()</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨ç±»å‹å£°æ˜ emits</span><br><span class="line">const emit = defineEmits&lt;&#123;</span><br><span class="line">  (e: &#x27;update&#x27;, id: number): void;</span><br><span class="line">  (e: &#x27;delete&#x27;): void;</span><br><span class="line">&#125;&gt;()</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="é€‚åˆå¿«é€Ÿç†Ÿæ‚‰-Vue-3-çš„-GitHub-é¡¹ç›®"><a href="#é€‚åˆå¿«é€Ÿç†Ÿæ‚‰-Vue-3-çš„-GitHub-é¡¹ç›®" class="headerlink" title="é€‚åˆå¿«é€Ÿç†Ÿæ‚‰ Vue 3 çš„ GitHub é¡¹ç›®"></a>é€‚åˆå¿«é€Ÿç†Ÿæ‚‰ Vue 3 çš„ GitHub é¡¹ç›®</h2><p>ä»¥ä¸‹æ˜¯ä¸€äº›ä¼˜è´¨çš„ Vue 3 é¡¹ç›®ï¼Œå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿç†Ÿæ‚‰ Vue 3 çš„å„ç§ç‰¹æ€§å’Œæœ€ä½³å®è·µï¼š</p><ol><li><p><strong>Vue 3 å®˜æ–¹ç¤ºä¾‹</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/vuejs/vue-next-examples">https://github.com/vuejs/vue-next-examples</a></li><li>æè¿°ï¼šVue å›¢é˜Ÿæä¾›çš„ Vue 3 ç¤ºä¾‹é›†åˆï¼Œæ¶µç›–äº†å„ç§ API çš„ä½¿ç”¨æ–¹æ³•</li></ul></li><li><p><strong>Hoppscotch</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/hoppscotch/hoppscotch">https://github.com/hoppscotch/hoppscotch</a></li><li>æè¿°ï¼šå¼€æºçš„ API å¼€å‘ç”Ÿæ€ç³»ç»Ÿï¼Œä½¿ç”¨ Vue 3 + TypeScript æ„å»ºï¼Œæ‹¥æœ‰ 55K+ stars</li></ul></li><li><p><strong>VueUse</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/vueuse/vueuse">https://github.com/vueuse/vueuse</a></li><li>æè¿°ï¼šVue Composition API çš„å®ç”¨å·¥å…·é›†åˆï¼ŒåŒ…å«å¤§é‡å¯å¤ç”¨çš„ç»„åˆå¼å‡½æ•°</li></ul></li><li><p><strong>Element Plus</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/element-plus/element-plus">https://github.com/element-plus/element-plus</a></li><li>æè¿°ï¼šåŸºäº Vue 3 çš„æ¡Œé¢ç«¯ç»„ä»¶åº“</li></ul></li><li><p><strong>Vite</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/vitejs/vite">https://github.com/vitejs/vite</a></li><li>æè¿°ï¼šä¸‹ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…·ï¼Œç”± Vue ä½œè€…å°¤é›¨æºªåˆ›å»ºï¼Œä¸ Vue 3 é…åˆä½¿ç”¨æ•ˆæœæœ€ä½³</li></ul></li><li><p><strong>Vue 3 Instagram Clone</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/selemondev/8-Awesome-Vue-Projects">https://github.com/selemondev/8-Awesome-Vue-Projects</a></li><li>æè¿°ï¼šä½¿ç”¨ Vue 3ã€Piniaã€TailwindCSS å’Œ Firebase æ„å»ºçš„ Instagram å…‹éš†é¡¹ç›®</li></ul></li><li><p><strong>Vue 3 Whatsapp Clone</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/selemondev/8-Awesome-Vue-Projects">https://github.com/selemondev/8-Awesome-Vue-Projects</a></li><li>æè¿°ï¼šä½¿ç”¨ Vue 3ã€Piniaã€TailwindCSS å’Œ Firebase æ„å»ºçš„ Whatsapp å…‹éš†é¡¹ç›®</li></ul></li><li><p><strong>Vue 3 Netflix Clone</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/selemondev/8-Awesome-Vue-Projects">https://github.com/selemondev/8-Awesome-Vue-Projects</a></li><li>æè¿°ï¼šä½¿ç”¨ Vue 3ã€Supabaseã€Pinia å’Œ TailwindCSS æ„å»ºçš„ Netflix å…‹éš†é¡¹ç›®</li></ul></li><li><p><strong>Elk</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/elk-zone/elk">https://github.com/elk-zone/elk</a></li><li>æè¿°ï¼šä¸€ä¸ª Mastodon ç½‘é¡µå®¢æˆ·ç«¯ï¼Œä½¿ç”¨ Vue 3 å’Œ Nuxt 3 æ„å»º</li></ul></li><li><p><strong>Pinia</strong>ï¼š</p><ul><li>é“¾æ¥ï¼š<a href="https://github.com/vuejs/pinia">https://github.com/vuejs/pinia</a></li><li>æè¿°ï¼šVue å®˜æ–¹æ¨èçš„çŠ¶æ€ç®¡ç†åº“ï¼Œäº†è§£å…¶æºç æœ‰åŠ©äºæ·±å…¥ç†è§£ Vue 3 çš„å“åº”å¼ç³»ç»Ÿ</li></ul></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;Vue-3-é¢è¯•é¢˜é›†&quot;&gt;&lt;a href=&quot;#Vue-3-é¢è¯•é¢˜é›†&quot; class=&quot;headerlink&quot; title=&quot;Vue 3 é¢è¯•é¢˜é›†&quot;&gt;&lt;/a&gt;Vue 3 é¢è¯•é¢˜é›†&lt;/h1&gt;&lt;h2 id=&quot;åŸºç¡€æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#åŸºç¡€æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;åŸºç¡€æ¦‚å¿µ&quot;&gt;&lt;/a&gt;åŸºç¡€æ¦‚å¿µ&lt;/h2&gt;&lt;h3 id=&quot;1-Vue-3-ç›¸æ¯”-Vue-2-æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-Vue-3-ç›¸æ¯”-Vue-2-æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1. Vue 3 ç›¸æ¯” Vue 2 æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ&quot;&gt;&lt;/a&gt;1. Vue 3 ç›¸æ¯” Vue 2 æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç­”æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½æå‡&lt;/strong&gt;ï¼šVue 3 é‡å†™äº†è™šæ‹Ÿ DOM å®ç°ï¼Œæ¸²æŸ“æ€§èƒ½æå‡çº¦ 1.3~2 å€ï¼Œå†…å­˜å ç”¨å‡å°‘çº¦ 50%&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Composition API&lt;/strong&gt;ï¼šæ–°å¢ç»„åˆå¼ APIï¼Œæä¾›æ›´çµæ´»çš„é€»è¾‘ç»„ç»‡å’Œå¤ç”¨æ–¹å¼&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TypeScript æ”¯æŒ&lt;/strong&gt;ï¼šVue 3 æ˜¯ç”¨ TypeScript é‡å†™çš„ï¼Œæä¾›äº†æ›´å¥½çš„ç±»å‹æ¨æ–­&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Teleport ç»„ä»¶&lt;/strong&gt;ï¼šå…è®¸å°†ç»„ä»¶çš„å†…å®¹ä¼ é€åˆ° DOM çš„å…¶ä»–ä½ç½®&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Fragments&lt;/strong&gt;ï¼šç»„ä»¶å¯ä»¥æœ‰å¤šä¸ªæ ¹èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Suspense&lt;/strong&gt;ï¼šå¤„ç†å¼‚æ­¥ç»„ä»¶çš„æ–°ç‰¹æ€§&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å“åº”å¼ç³»ç»Ÿå‡çº§&lt;/strong&gt;ï¼šä½¿ç”¨ ES6 çš„ Proxy ä»£æ›¿ Object.definePropertyï¼Œè§£å†³äº† Vue 2 ä¸­çš„æ•°ç»„å’Œå¯¹è±¡å“åº”å¼é—®é¢˜&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€ API æ”¹ä¸ºåº”ç”¨å®ä¾‹è°ƒç”¨&lt;/strong&gt;ï¼šå‡å°‘äº†å…¨å±€æ±¡æŸ“&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›´å¥½çš„ Tree-shaking æ”¯æŒ&lt;/strong&gt;ï¼šå‡å°æ‰“åŒ…ä½“ç§¯&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="vue3" scheme="http://blog.ypintao.com/categories/vue3/"/>
    
    
    <category term="vue3" scheme="http://blog.ypintao.com/tags/vue3/"/>
    
  </entry>
  
  <entry>
    <title>webpack æ’ä»¶å¦‚ä½•ç¼–å†™</title>
    <link href="http://blog.ypintao.com/2024/04/01/tools/webpack%20%E6%8F%92%E4%BB%B6%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99/"/>
    <id>http://blog.ypintao.com/2024/04/01/tools/webpack%20%E6%8F%92%E4%BB%B6%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99/</id>
    <published>2024-04-01T04:00:00.000Z</published>
    <updated>2025-12-07T14:45:51.824Z</updated>
    
    <content type="html"><![CDATA[<p>ç¼–å†™ Webpack æ’ä»¶å¯ä»¥å¸®åŠ©ä½ åœ¨ Webpack æ„å»ºè¿‡ç¨‹ä¸­æ·»åŠ è‡ªå®šä¹‰è¡Œä¸ºã€‚Webpack æ’ä»¶æ˜¯ä¸€ä¸ªå…·æœ‰ apply æ–¹æ³•çš„ JavaScript å¯¹è±¡ã€‚è¿™ä¸ª apply æ–¹æ³•ä¼šåœ¨ Webpack ç¼–è¯‘å™¨å®ä¾‹ä¸Šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è®¿é—® Webpack çš„ç¼–è¯‘å™¨å¯¹è±¡ï¼Œä»è€Œåœ¨ç‰¹å®šçš„ç¼–è¯‘é˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚   ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ­¥éª¤æŒ‡å—å’Œç¤ºä¾‹ä»£ç ï¼Œå¸®åŠ©ä½ ç¼–å†™ä¸€ä¸ªåŸºæœ¬çš„ Webpack æ’ä»¶ã€‚<br>æ­¥éª¤æŒ‡å—<br>åˆ›å»ºæ’ä»¶å¯¹è±¡ï¼šåˆ›å»ºä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œå¹¶å®šä¹‰ä¸€ä¸ª apply æ–¹æ³•ã€‚<br>è®¿é—®ç¼–è¯‘å™¨å¯¹è±¡ï¼šåœ¨ apply æ–¹æ³•ä¸­ï¼Œé€šè¿‡å‚æ•°è®¿é—® Webpack ç¼–è¯‘å™¨å¯¹è±¡ã€‚<br>ç»‘å®šé’©å­ï¼šä½¿ç”¨ç¼–è¯‘å™¨å¯¹è±¡æä¾›çš„é’©å­æ¥ç»‘å®šä½ çš„æ’ä»¶é€»è¾‘ã€‚<br>å¯¼å‡ºæ’ä»¶ï¼šå°†ä½ çš„æ’ä»¶å¯¹è±¡å¯¼å‡ºï¼Œä»¥ä¾¿åœ¨ Webpack é…ç½®ä¸­ä½¿ç”¨ã€‚<br>ç¤ºä¾‹ä»£ç <br>å‡è®¾æˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªç®€å•çš„æ’ä»¶ï¼Œåœ¨ Webpack æ„å»ºå®Œæˆåè¾“å‡ºä¸€æ¡æ¶ˆæ¯åˆ°æ§åˆ¶å°ã€‚<br>åˆ›å»ºæ’ä»¶æ–‡ä»¶   é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ MyWebpackPlugin.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><span id="more"></span><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;./MyWebpackPlugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MyWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;è‡ªå®šä¹‰æ„å»ºæ¶ˆæ¯ï¼šæ„å»ºæˆåŠŸï¼&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¯¦ç»†è¯´æ˜<br>æ’ä»¶å¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyWebpackPlugin</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">options</span> = options;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">done</span>.<span class="title function_">tap</span>(<span class="string">&#x27;MyWebpackPlugin&#x27;</span>, <span class="function">(<span class="params">stats</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Webpack æ„å»ºå®Œæˆï¼&#x27;</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æ„å»ºæ—¶é—´: <span class="subst">$&#123;stats.endTime - stats.startTime&#125;</span> ms`</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">message</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">message</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°ï¼šç”¨äºæ¥æ”¶é…ç½®é€‰é¡¹ã€‚<br>apply æ–¹æ³•ï¼šè¿™æ˜¯æ’ä»¶çš„æ ¸å¿ƒæ–¹æ³•ã€‚å®ƒä¼šåœ¨ Webpack ç¼–è¯‘å™¨å®ä¾‹ä¸Šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”ä½ å¯ä»¥é€šè¿‡å‚æ•°è®¿é—®ç¼–è¯‘å™¨å¯¹è±¡ã€‚<br>ç»‘å®šé’©å­ï¼šåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† compiler.hooks.done.tap æ¥ç»‘å®šåˆ° Webpack çš„ done é’©å­ã€‚done é’©å­åœ¨æ„å»ºå®Œæˆæ—¶è§¦å‘ã€‚tap æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ’ä»¶çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä¼šåœ¨é’©å­è§¦å‘æ—¶æ‰§è¡Œ</p><p>ä½¿ç”¨æ’ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;./MyWebpackPlugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MyWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;è‡ªå®šä¹‰æ„å»ºæ¶ˆæ¯ï¼šæ„å»ºæˆåŠŸï¼&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¼•å…¥æ’ä»¶ï¼šä½¿ç”¨ require å¼•å…¥ä½ ç¼–å†™çš„æ’ä»¶ã€‚<br>é…ç½®æ’ä»¶ï¼šåœ¨ plugins æ•°ç»„ä¸­å®ä¾‹åŒ–ä½ çš„æ’ä»¶ï¼Œå¹¶ä¼ å…¥é…ç½®é€‰é¡¹ã€‚<br>æ›´å¤šé’©å­<br>Webpack æä¾›äº†è®¸å¤šä¸åŒçš„é’©å­ï¼Œå¯ä»¥åœ¨ä¸åŒçš„ç¼–è¯‘é˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„é’©å­ï¼š<br>compiler.hooks.compileï¼šåœ¨ç¼–è¯‘å¼€å§‹æ—¶è§¦å‘ã€‚<br>compiler.hooks.emitï¼šåœ¨ç”Ÿæˆæ–‡ä»¶ä¹‹å‰è§¦å‘ï¼Œå¯ä»¥ç”¨æ¥ä¿®æ”¹ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹ã€‚<br>compiler.hooks.doneï¼šåœ¨ç¼–è¯‘å®Œæˆæ—¶è§¦å‘ã€‚<br>compilation.hooks.moduleIdsï¼šåœ¨æ¨¡å— ID åˆ†é…æ—¶è§¦å‘ã€‚<br>compilation.hooks.chunkIdsï¼šåœ¨ chunk ID åˆ†é…æ—¶è§¦å‘ã€‚<br>compilation.hooks.optimizeDependenciesï¼šåœ¨ä¼˜åŒ–ä¾èµ–æ—¶è§¦å‘ã€‚<br>ä½ å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„é’©å­æ¥å®ç°ä½ çš„æ’ä»¶åŠŸèƒ½ã€‚<br>æ€»ç»“<br>ç¼–å†™ Webpack æ’ä»¶çš„åŸºæœ¬æ­¥éª¤åŒ…æ‹¬åˆ›å»ºæ’ä»¶å¯¹è±¡ã€å®šä¹‰ apply æ–¹æ³•ã€è®¿é—®ç¼–è¯‘å™¨å¯¹è±¡ã€ç»‘å®šé’©å­ä»¥åŠå¯¼å‡ºæ’ä»¶ã€‚é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œä½ å¯ä»¥ä¸º Webpack æ„å»ºè¿‡ç¨‹æ·»åŠ å„ç§è‡ªå®šä¹‰è¡Œä¸ºï¼Œä»è€Œæ›´å¥½åœ°æ»¡è¶³é¡¹ç›®çš„ç‰¹å®šéœ€æ±‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç¼–å†™ Webpack æ’ä»¶å¯ä»¥å¸®åŠ©ä½ åœ¨ Webpack æ„å»ºè¿‡ç¨‹ä¸­æ·»åŠ è‡ªå®šä¹‰è¡Œä¸ºã€‚Webpack æ’ä»¶æ˜¯ä¸€ä¸ªå…·æœ‰ apply æ–¹æ³•çš„ JavaScript å¯¹è±¡ã€‚è¿™ä¸ª apply æ–¹æ³•ä¼šåœ¨ Webpack ç¼–è¯‘å™¨å®ä¾‹ä¸Šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è®¿é—® Webpack çš„ç¼–è¯‘å™¨å¯¹è±¡ï¼Œä»è€Œåœ¨ç‰¹å®šçš„ç¼–è¯‘é˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚   ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ­¥éª¤æŒ‡å—å’Œç¤ºä¾‹ä»£ç ï¼Œå¸®åŠ©ä½ ç¼–å†™ä¸€ä¸ªåŸºæœ¬çš„ Webpack æ’ä»¶ã€‚&lt;br&gt;æ­¥éª¤æŒ‡å—&lt;br&gt;åˆ›å»ºæ’ä»¶å¯¹è±¡ï¼šåˆ›å»ºä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œå¹¶å®šä¹‰ä¸€ä¸ª apply æ–¹æ³•ã€‚&lt;br&gt;è®¿é—®ç¼–è¯‘å™¨å¯¹è±¡ï¼šåœ¨ apply æ–¹æ³•ä¸­ï¼Œé€šè¿‡å‚æ•°è®¿é—® Webpack ç¼–è¯‘å™¨å¯¹è±¡ã€‚&lt;br&gt;ç»‘å®šé’©å­ï¼šä½¿ç”¨ç¼–è¯‘å™¨å¯¹è±¡æä¾›çš„é’©å­æ¥ç»‘å®šä½ çš„æ’ä»¶é€»è¾‘ã€‚&lt;br&gt;å¯¼å‡ºæ’ä»¶ï¼šå°†ä½ çš„æ’ä»¶å¯¹è±¡å¯¼å‡ºï¼Œä»¥ä¾¿åœ¨ Webpack é…ç½®ä¸­ä½¿ç”¨ã€‚&lt;br&gt;ç¤ºä¾‹ä»£ç &lt;br&gt;å‡è®¾æˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªç®€å•çš„æ’ä»¶ï¼Œåœ¨ Webpack æ„å»ºå®Œæˆåè¾“å‡ºä¸€æ¡æ¶ˆæ¯åˆ°æ§åˆ¶å°ã€‚&lt;br&gt;åˆ›å»ºæ’ä»¶æ–‡ä»¶   é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ MyWebpackPlugin.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;</summary>
    
    
    
    <category term="webpack" scheme="http://blog.ypintao.com/categories/webpack/"/>
    
    
    <category term="webpack" scheme="http://blog.ypintao.com/tags/webpack/"/>
    
  </entry>
  
</feed>
